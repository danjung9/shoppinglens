(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))a(o);new MutationObserver(o=>{for(const l of o)if(l.type==="childList")for(const f of l.addedNodes)f.tagName==="LINK"&&f.rel==="modulepreload"&&a(f)}).observe(document,{childList:!0,subtree:!0});function i(o){const l={};return o.integrity&&(l.integrity=o.integrity),o.referrerPolicy&&(l.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?l.credentials="include":o.crossOrigin==="anonymous"?l.credentials="omit":l.credentials="same-origin",l}function a(o){if(o.ep)return;o.ep=!0;const l=i(o);fetch(o.href,l)}})();var Xu={exports:{}},ur={};/**
 * @license React
 * react-jsx-runtime.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Tg;function XS(){if(Tg)return ur;Tg=1;var r=Symbol.for("react.transitional.element"),t=Symbol.for("react.fragment");function i(a,o,l){var f=null;if(l!==void 0&&(f=""+l),o.key!==void 0&&(f=""+o.key),"key"in o){l={};for(var u in o)u!=="key"&&(l[u]=o[u])}else l=o;return o=l.ref,{$$typeof:r,type:a,key:f,ref:o!==void 0?o:null,props:l}}return ur.Fragment=t,ur.jsx=i,ur.jsxs=i,ur}var Cg;function ZS(){return Cg||(Cg=1,Xu.exports=XS()),Xu.exports}var F=ZS(),Zu={exports:{}},ge={};/**
 * @license React
 * react.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var kg;function WS(){if(kg)return ge;kg=1;var r=Symbol.for("react.transitional.element"),t=Symbol.for("react.portal"),i=Symbol.for("react.fragment"),a=Symbol.for("react.strict_mode"),o=Symbol.for("react.profiler"),l=Symbol.for("react.consumer"),f=Symbol.for("react.context"),u=Symbol.for("react.forward_ref"),m=Symbol.for("react.suspense"),p=Symbol.for("react.memo"),g=Symbol.for("react.lazy"),v=Symbol.for("react.activity"),S=Symbol.iterator;function k(R){return R===null||typeof R!="object"?null:(R=S&&R[S]||R["@@iterator"],typeof R=="function"?R:null)}var O={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},E=Object.assign,j={};function U(R,V,te){this.props=R,this.context=V,this.refs=j,this.updater=te||O}U.prototype.isReactComponent={},U.prototype.setState=function(R,V){if(typeof R!="object"&&typeof R!="function"&&R!=null)throw Error("takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,R,V,"setState")},U.prototype.forceUpdate=function(R){this.updater.enqueueForceUpdate(this,R,"forceUpdate")};function Y(){}Y.prototype=U.prototype;function Z(R,V,te){this.props=R,this.context=V,this.refs=j,this.updater=te||O}var M=Z.prototype=new Y;M.constructor=Z,E(M,U.prototype),M.isPureReactComponent=!0;var N=Array.isArray;function q(){}var Q={H:null,A:null,T:null,S:null},ae=Object.prototype.hasOwnProperty;function ne(R,V,te){var oe=te.ref;return{$$typeof:r,type:R,key:V,ref:oe!==void 0?oe:null,props:te}}function ie(R,V){return ne(R.type,V,R.props)}function se(R){return typeof R=="object"&&R!==null&&R.$$typeof===r}function ue(R){var V={"=":"=0",":":"=2"};return"$"+R.replace(/[=:]/g,function(te){return V[te]})}var Ne=/\/+/g;function Ze(R,V){return typeof R=="object"&&R!==null&&R.key!=null?ue(""+R.key):V.toString(36)}function ht(R){switch(R.status){case"fulfilled":return R.value;case"rejected":throw R.reason;default:switch(typeof R.status=="string"?R.then(q,q):(R.status="pending",R.then(function(V){R.status==="pending"&&(R.status="fulfilled",R.value=V)},function(V){R.status==="pending"&&(R.status="rejected",R.reason=V)})),R.status){case"fulfilled":return R.value;case"rejected":throw R.reason}}throw R}function I(R,V,te,oe,pe){var ye=typeof R;(ye==="undefined"||ye==="boolean")&&(R=null);var Ie=!1;if(R===null)Ie=!0;else switch(ye){case"bigint":case"string":case"number":Ie=!0;break;case"object":switch(R.$$typeof){case r:case t:Ie=!0;break;case g:return Ie=R._init,I(Ie(R._payload),V,te,oe,pe)}}if(Ie)return pe=pe(R),Ie=oe===""?"."+Ze(R,0):oe,N(pe)?(te="",Ie!=null&&(te=Ie.replace(Ne,"$&/")+"/"),I(pe,V,te,"",function(vs){return vs})):pe!=null&&(se(pe)&&(pe=ie(pe,te+(pe.key==null||R&&R.key===pe.key?"":(""+pe.key).replace(Ne,"$&/")+"/")+Ie)),V.push(pe)),1;Ie=0;var At=oe===""?".":oe+":";if(N(R))for(var it=0;it<R.length;it++)oe=R[it],ye=At+Ze(oe,it),Ie+=I(oe,V,te,ye,pe);else if(it=k(R),typeof it=="function")for(R=it.call(R),it=0;!(oe=R.next()).done;)oe=oe.value,ye=At+Ze(oe,it++),Ie+=I(oe,V,te,ye,pe);else if(ye==="object"){if(typeof R.then=="function")return I(ht(R),V,te,oe,pe);throw V=String(R),Error("Objects are not valid as a React child (found: "+(V==="[object Object]"?"object with keys {"+Object.keys(R).join(", ")+"}":V)+"). If you meant to render a collection of children, use an array instead.")}return Ie}function W(R,V,te){if(R==null)return R;var oe=[],pe=0;return I(R,oe,"","",function(ye){return V.call(te,ye,pe++)}),oe}function de(R){if(R._status===-1){var V=R._result;V=V(),V.then(function(te){(R._status===0||R._status===-1)&&(R._status=1,R._result=te)},function(te){(R._status===0||R._status===-1)&&(R._status=2,R._result=te)}),R._status===-1&&(R._status=0,R._result=V)}if(R._status===1)return R._result.default;throw R._result}var Me=typeof reportError=="function"?reportError:function(R){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var V=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof R=="object"&&R!==null&&typeof R.message=="string"?String(R.message):String(R),error:R});if(!window.dispatchEvent(V))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",R);return}console.error(R)},Pe={map:W,forEach:function(R,V,te){W(R,function(){V.apply(this,arguments)},te)},count:function(R){var V=0;return W(R,function(){V++}),V},toArray:function(R){return W(R,function(V){return V})||[]},only:function(R){if(!se(R))throw Error("React.Children.only expected to receive a single React element child.");return R}};return ge.Activity=v,ge.Children=Pe,ge.Component=U,ge.Fragment=i,ge.Profiler=o,ge.PureComponent=Z,ge.StrictMode=a,ge.Suspense=m,ge.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=Q,ge.__COMPILER_RUNTIME={__proto__:null,c:function(R){return Q.H.useMemoCache(R)}},ge.cache=function(R){return function(){return R.apply(null,arguments)}},ge.cacheSignal=function(){return null},ge.cloneElement=function(R,V,te){if(R==null)throw Error("The argument must be a React element, but you passed "+R+".");var oe=E({},R.props),pe=R.key;if(V!=null)for(ye in V.key!==void 0&&(pe=""+V.key),V)!ae.call(V,ye)||ye==="key"||ye==="__self"||ye==="__source"||ye==="ref"&&V.ref===void 0||(oe[ye]=V[ye]);var ye=arguments.length-2;if(ye===1)oe.children=te;else if(1<ye){for(var Ie=Array(ye),At=0;At<ye;At++)Ie[At]=arguments[At+2];oe.children=Ie}return ne(R.type,pe,oe)},ge.createContext=function(R){return R={$$typeof:f,_currentValue:R,_currentValue2:R,_threadCount:0,Provider:null,Consumer:null},R.Provider=R,R.Consumer={$$typeof:l,_context:R},R},ge.createElement=function(R,V,te){var oe,pe={},ye=null;if(V!=null)for(oe in V.key!==void 0&&(ye=""+V.key),V)ae.call(V,oe)&&oe!=="key"&&oe!=="__self"&&oe!=="__source"&&(pe[oe]=V[oe]);var Ie=arguments.length-2;if(Ie===1)pe.children=te;else if(1<Ie){for(var At=Array(Ie),it=0;it<Ie;it++)At[it]=arguments[it+2];pe.children=At}if(R&&R.defaultProps)for(oe in Ie=R.defaultProps,Ie)pe[oe]===void 0&&(pe[oe]=Ie[oe]);return ne(R,ye,pe)},ge.createRef=function(){return{current:null}},ge.forwardRef=function(R){return{$$typeof:u,render:R}},ge.isValidElement=se,ge.lazy=function(R){return{$$typeof:g,_payload:{_status:-1,_result:R},_init:de}},ge.memo=function(R,V){return{$$typeof:p,type:R,compare:V===void 0?null:V}},ge.startTransition=function(R){var V=Q.T,te={};Q.T=te;try{var oe=R(),pe=Q.S;pe!==null&&pe(te,oe),typeof oe=="object"&&oe!==null&&typeof oe.then=="function"&&oe.then(q,Me)}catch(ye){Me(ye)}finally{V!==null&&te.types!==null&&(V.types=te.types),Q.T=V}},ge.unstable_useCacheRefresh=function(){return Q.H.useCacheRefresh()},ge.use=function(R){return Q.H.use(R)},ge.useActionState=function(R,V,te){return Q.H.useActionState(R,V,te)},ge.useCallback=function(R,V){return Q.H.useCallback(R,V)},ge.useContext=function(R){return Q.H.useContext(R)},ge.useDebugValue=function(){},ge.useDeferredValue=function(R,V){return Q.H.useDeferredValue(R,V)},ge.useEffect=function(R,V){return Q.H.useEffect(R,V)},ge.useEffectEvent=function(R){return Q.H.useEffectEvent(R)},ge.useId=function(){return Q.H.useId()},ge.useImperativeHandle=function(R,V,te){return Q.H.useImperativeHandle(R,V,te)},ge.useInsertionEffect=function(R,V){return Q.H.useInsertionEffect(R,V)},ge.useLayoutEffect=function(R,V){return Q.H.useLayoutEffect(R,V)},ge.useMemo=function(R,V){return Q.H.useMemo(R,V)},ge.useOptimistic=function(R,V){return Q.H.useOptimistic(R,V)},ge.useReducer=function(R,V,te){return Q.H.useReducer(R,V,te)},ge.useRef=function(R){return Q.H.useRef(R)},ge.useState=function(R){return Q.H.useState(R)},ge.useSyncExternalStore=function(R,V,te){return Q.H.useSyncExternalStore(R,V,te)},ge.useTransition=function(){return Q.H.useTransition()},ge.version="19.2.3",ge}var Eg;function Kd(){return Eg||(Eg=1,Zu.exports=WS()),Zu.exports}var me=Kd(),Wu={exports:{}},dr={},$u={exports:{}},ed={};/**
 * @license React
 * scheduler.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var _g;function $S(){return _g||(_g=1,(function(r){function t(I,W){var de=I.length;I.push(W);e:for(;0<de;){var Me=de-1>>>1,Pe=I[Me];if(0<o(Pe,W))I[Me]=W,I[de]=Pe,de=Me;else break e}}function i(I){return I.length===0?null:I[0]}function a(I){if(I.length===0)return null;var W=I[0],de=I.pop();if(de!==W){I[0]=de;e:for(var Me=0,Pe=I.length,R=Pe>>>1;Me<R;){var V=2*(Me+1)-1,te=I[V],oe=V+1,pe=I[oe];if(0>o(te,de))oe<Pe&&0>o(pe,te)?(I[Me]=pe,I[oe]=de,Me=oe):(I[Me]=te,I[V]=de,Me=V);else if(oe<Pe&&0>o(pe,de))I[Me]=pe,I[oe]=de,Me=oe;else break e}}return W}function o(I,W){var de=I.sortIndex-W.sortIndex;return de!==0?de:I.id-W.id}if(r.unstable_now=void 0,typeof performance=="object"&&typeof performance.now=="function"){var l=performance;r.unstable_now=function(){return l.now()}}else{var f=Date,u=f.now();r.unstable_now=function(){return f.now()-u}}var m=[],p=[],g=1,v=null,S=3,k=!1,O=!1,E=!1,j=!1,U=typeof setTimeout=="function"?setTimeout:null,Y=typeof clearTimeout=="function"?clearTimeout:null,Z=typeof setImmediate<"u"?setImmediate:null;function M(I){for(var W=i(p);W!==null;){if(W.callback===null)a(p);else if(W.startTime<=I)a(p),W.sortIndex=W.expirationTime,t(m,W);else break;W=i(p)}}function N(I){if(E=!1,M(I),!O)if(i(m)!==null)O=!0,q||(q=!0,ue());else{var W=i(p);W!==null&&ht(N,W.startTime-I)}}var q=!1,Q=-1,ae=5,ne=-1;function ie(){return j?!0:!(r.unstable_now()-ne<ae)}function se(){if(j=!1,q){var I=r.unstable_now();ne=I;var W=!0;try{e:{O=!1,E&&(E=!1,Y(Q),Q=-1),k=!0;var de=S;try{t:{for(M(I),v=i(m);v!==null&&!(v.expirationTime>I&&ie());){var Me=v.callback;if(typeof Me=="function"){v.callback=null,S=v.priorityLevel;var Pe=Me(v.expirationTime<=I);if(I=r.unstable_now(),typeof Pe=="function"){v.callback=Pe,M(I),W=!0;break t}v===i(m)&&a(m),M(I)}else a(m);v=i(m)}if(v!==null)W=!0;else{var R=i(p);R!==null&&ht(N,R.startTime-I),W=!1}}break e}finally{v=null,S=de,k=!1}W=void 0}}finally{W?ue():q=!1}}}var ue;if(typeof Z=="function")ue=function(){Z(se)};else if(typeof MessageChannel<"u"){var Ne=new MessageChannel,Ze=Ne.port2;Ne.port1.onmessage=se,ue=function(){Ze.postMessage(null)}}else ue=function(){U(se,0)};function ht(I,W){Q=U(function(){I(r.unstable_now())},W)}r.unstable_IdlePriority=5,r.unstable_ImmediatePriority=1,r.unstable_LowPriority=4,r.unstable_NormalPriority=3,r.unstable_Profiling=null,r.unstable_UserBlockingPriority=2,r.unstable_cancelCallback=function(I){I.callback=null},r.unstable_forceFrameRate=function(I){0>I||125<I?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):ae=0<I?Math.floor(1e3/I):5},r.unstable_getCurrentPriorityLevel=function(){return S},r.unstable_next=function(I){switch(S){case 1:case 2:case 3:var W=3;break;default:W=S}var de=S;S=W;try{return I()}finally{S=de}},r.unstable_requestPaint=function(){j=!0},r.unstable_runWithPriority=function(I,W){switch(I){case 1:case 2:case 3:case 4:case 5:break;default:I=3}var de=S;S=I;try{return W()}finally{S=de}},r.unstable_scheduleCallback=function(I,W,de){var Me=r.unstable_now();switch(typeof de=="object"&&de!==null?(de=de.delay,de=typeof de=="number"&&0<de?Me+de:Me):de=Me,I){case 1:var Pe=-1;break;case 2:Pe=250;break;case 5:Pe=1073741823;break;case 4:Pe=1e4;break;default:Pe=5e3}return Pe=de+Pe,I={id:g++,callback:W,priorityLevel:I,startTime:de,expirationTime:Pe,sortIndex:-1},de>Me?(I.sortIndex=de,t(p,I),i(m)===null&&I===i(p)&&(E?(Y(Q),Q=-1):E=!0,ht(N,de-Me))):(I.sortIndex=Pe,t(m,I),O||k||(O=!0,q||(q=!0,ue()))),I},r.unstable_shouldYield=ie,r.unstable_wrapCallback=function(I){var W=S;return function(){var de=S;S=W;try{return I.apply(this,arguments)}finally{S=de}}}})(ed)),ed}var Rg;function eT(){return Rg||(Rg=1,$u.exports=$S()),$u.exports}var td={exports:{}},Ot={};/**
 * @license React
 * react-dom.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Og;function tT(){if(Og)return Ot;Og=1;var r=Kd();function t(m){var p="https://react.dev/errors/"+m;if(1<arguments.length){p+="?args[]="+encodeURIComponent(arguments[1]);for(var g=2;g<arguments.length;g++)p+="&args[]="+encodeURIComponent(arguments[g])}return"Minified React error #"+m+"; visit "+p+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function i(){}var a={d:{f:i,r:function(){throw Error(t(522))},D:i,C:i,L:i,m:i,X:i,S:i,M:i},p:0,findDOMNode:null},o=Symbol.for("react.portal");function l(m,p,g){var v=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:o,key:v==null?null:""+v,children:m,containerInfo:p,implementation:g}}var f=r.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE;function u(m,p){if(m==="font")return"";if(typeof p=="string")return p==="use-credentials"?p:""}return Ot.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=a,Ot.createPortal=function(m,p){var g=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!p||p.nodeType!==1&&p.nodeType!==9&&p.nodeType!==11)throw Error(t(299));return l(m,p,null,g)},Ot.flushSync=function(m){var p=f.T,g=a.p;try{if(f.T=null,a.p=2,m)return m()}finally{f.T=p,a.p=g,a.d.f()}},Ot.preconnect=function(m,p){typeof m=="string"&&(p?(p=p.crossOrigin,p=typeof p=="string"?p==="use-credentials"?p:"":void 0):p=null,a.d.C(m,p))},Ot.prefetchDNS=function(m){typeof m=="string"&&a.d.D(m)},Ot.preinit=function(m,p){if(typeof m=="string"&&p&&typeof p.as=="string"){var g=p.as,v=u(g,p.crossOrigin),S=typeof p.integrity=="string"?p.integrity:void 0,k=typeof p.fetchPriority=="string"?p.fetchPriority:void 0;g==="style"?a.d.S(m,typeof p.precedence=="string"?p.precedence:void 0,{crossOrigin:v,integrity:S,fetchPriority:k}):g==="script"&&a.d.X(m,{crossOrigin:v,integrity:S,fetchPriority:k,nonce:typeof p.nonce=="string"?p.nonce:void 0})}},Ot.preinitModule=function(m,p){if(typeof m=="string")if(typeof p=="object"&&p!==null){if(p.as==null||p.as==="script"){var g=u(p.as,p.crossOrigin);a.d.M(m,{crossOrigin:g,integrity:typeof p.integrity=="string"?p.integrity:void 0,nonce:typeof p.nonce=="string"?p.nonce:void 0})}}else p==null&&a.d.M(m)},Ot.preload=function(m,p){if(typeof m=="string"&&typeof p=="object"&&p!==null&&typeof p.as=="string"){var g=p.as,v=u(g,p.crossOrigin);a.d.L(m,g,{crossOrigin:v,integrity:typeof p.integrity=="string"?p.integrity:void 0,nonce:typeof p.nonce=="string"?p.nonce:void 0,type:typeof p.type=="string"?p.type:void 0,fetchPriority:typeof p.fetchPriority=="string"?p.fetchPriority:void 0,referrerPolicy:typeof p.referrerPolicy=="string"?p.referrerPolicy:void 0,imageSrcSet:typeof p.imageSrcSet=="string"?p.imageSrcSet:void 0,imageSizes:typeof p.imageSizes=="string"?p.imageSizes:void 0,media:typeof p.media=="string"?p.media:void 0})}},Ot.preloadModule=function(m,p){if(typeof m=="string")if(p){var g=u(p.as,p.crossOrigin);a.d.m(m,{as:typeof p.as=="string"&&p.as!=="script"?p.as:void 0,crossOrigin:g,integrity:typeof p.integrity=="string"?p.integrity:void 0})}else a.d.m(m)},Ot.requestFormReset=function(m){a.d.r(m)},Ot.unstable_batchedUpdates=function(m,p){return m(p)},Ot.useFormState=function(m,p,g){return f.H.useFormState(m,p,g)},Ot.useFormStatus=function(){return f.H.useHostTransitionStatus()},Ot.version="19.2.3",Ot}var Ag;function nT(){if(Ag)return td.exports;Ag=1;function r(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(r)}catch(t){console.error(t)}}return r(),td.exports=tT(),td.exports}/**
 * @license React
 * react-dom-client.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Dg;function iT(){if(Dg)return dr;Dg=1;var r=eT(),t=Kd(),i=nT();function a(e){var n="https://react.dev/errors/"+e;if(1<arguments.length){n+="?args[]="+encodeURIComponent(arguments[1]);for(var s=2;s<arguments.length;s++)n+="&args[]="+encodeURIComponent(arguments[s])}return"Minified React error #"+e+"; visit "+n+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function o(e){return!(!e||e.nodeType!==1&&e.nodeType!==9&&e.nodeType!==11)}function l(e){var n=e,s=e;if(e.alternate)for(;n.return;)n=n.return;else{e=n;do n=e,(n.flags&4098)!==0&&(s=n.return),e=n.return;while(e)}return n.tag===3?s:null}function f(e){if(e.tag===13){var n=e.memoizedState;if(n===null&&(e=e.alternate,e!==null&&(n=e.memoizedState)),n!==null)return n.dehydrated}return null}function u(e){if(e.tag===31){var n=e.memoizedState;if(n===null&&(e=e.alternate,e!==null&&(n=e.memoizedState)),n!==null)return n.dehydrated}return null}function m(e){if(l(e)!==e)throw Error(a(188))}function p(e){var n=e.alternate;if(!n){if(n=l(e),n===null)throw Error(a(188));return n!==e?null:e}for(var s=e,c=n;;){var d=s.return;if(d===null)break;var h=d.alternate;if(h===null){if(c=d.return,c!==null){s=c;continue}break}if(d.child===h.child){for(h=d.child;h;){if(h===s)return m(d),e;if(h===c)return m(d),n;h=h.sibling}throw Error(a(188))}if(s.return!==c.return)s=d,c=h;else{for(var y=!1,b=d.child;b;){if(b===s){y=!0,s=d,c=h;break}if(b===c){y=!0,c=d,s=h;break}b=b.sibling}if(!y){for(b=h.child;b;){if(b===s){y=!0,s=h,c=d;break}if(b===c){y=!0,c=h,s=d;break}b=b.sibling}if(!y)throw Error(a(189))}}if(s.alternate!==c)throw Error(a(190))}if(s.tag!==3)throw Error(a(188));return s.stateNode.current===s?e:n}function g(e){var n=e.tag;if(n===5||n===26||n===27||n===6)return e;for(e=e.child;e!==null;){if(n=g(e),n!==null)return n;e=e.sibling}return null}var v=Object.assign,S=Symbol.for("react.element"),k=Symbol.for("react.transitional.element"),O=Symbol.for("react.portal"),E=Symbol.for("react.fragment"),j=Symbol.for("react.strict_mode"),U=Symbol.for("react.profiler"),Y=Symbol.for("react.consumer"),Z=Symbol.for("react.context"),M=Symbol.for("react.forward_ref"),N=Symbol.for("react.suspense"),q=Symbol.for("react.suspense_list"),Q=Symbol.for("react.memo"),ae=Symbol.for("react.lazy"),ne=Symbol.for("react.activity"),ie=Symbol.for("react.memo_cache_sentinel"),se=Symbol.iterator;function ue(e){return e===null||typeof e!="object"?null:(e=se&&e[se]||e["@@iterator"],typeof e=="function"?e:null)}var Ne=Symbol.for("react.client.reference");function Ze(e){if(e==null)return null;if(typeof e=="function")return e.$$typeof===Ne?null:e.displayName||e.name||null;if(typeof e=="string")return e;switch(e){case E:return"Fragment";case U:return"Profiler";case j:return"StrictMode";case N:return"Suspense";case q:return"SuspenseList";case ne:return"Activity"}if(typeof e=="object")switch(e.$$typeof){case O:return"Portal";case Z:return e.displayName||"Context";case Y:return(e._context.displayName||"Context")+".Consumer";case M:var n=e.render;return e=e.displayName,e||(e=n.displayName||n.name||"",e=e!==""?"ForwardRef("+e+")":"ForwardRef"),e;case Q:return n=e.displayName||null,n!==null?n:Ze(e.type)||"Memo";case ae:n=e._payload,e=e._init;try{return Ze(e(n))}catch{}}return null}var ht=Array.isArray,I=t.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,W=i.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,de={pending:!1,data:null,method:null,action:null},Me=[],Pe=-1;function R(e){return{current:e}}function V(e){0>Pe||(e.current=Me[Pe],Me[Pe]=null,Pe--)}function te(e,n){Pe++,Me[Pe]=e.current,e.current=n}var oe=R(null),pe=R(null),ye=R(null),Ie=R(null);function At(e,n){switch(te(ye,n),te(pe,e),te(oe,null),n.nodeType){case 9:case 11:e=(e=n.documentElement)&&(e=e.namespaceURI)?Fp(e):0;break;default:if(e=n.tagName,n=n.namespaceURI)n=Fp(n),e=Gp(n,e);else switch(e){case"svg":e=1;break;case"math":e=2;break;default:e=0}}V(oe),te(oe,e)}function it(){V(oe),V(pe),V(ye)}function vs(e){e.memoizedState!==null&&te(Ie,e);var n=oe.current,s=Gp(n,e.type);n!==s&&(te(pe,e),te(oe,s))}function Mr(e){pe.current===e&&(V(oe),V(pe)),Ie.current===e&&(V(Ie),rr._currentValue=de)}var xc,Sf;function Ki(e){if(xc===void 0)try{throw Error()}catch(s){var n=s.stack.trim().match(/\n( *(at )?)/);xc=n&&n[1]||"",Sf=-1<s.stack.indexOf(`
    at`)?" (<anonymous>)":-1<s.stack.indexOf("@")?"@unknown:0:0":""}return`
`+xc+e+Sf}var Nc=!1;function Pc(e,n){if(!e||Nc)return"";Nc=!0;var s=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{var c={DetermineComponentFrameRoot:function(){try{if(n){var H=function(){throw Error()};if(Object.defineProperty(H.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(H,[])}catch(L){var P=L}Reflect.construct(e,[],H)}else{try{H.call()}catch(L){P=L}e.call(H.prototype)}}else{try{throw Error()}catch(L){P=L}(H=e())&&typeof H.catch=="function"&&H.catch(function(){})}}catch(L){if(L&&P&&typeof L.stack=="string")return[L.stack,P.stack]}return[null,null]}};c.DetermineComponentFrameRoot.displayName="DetermineComponentFrameRoot";var d=Object.getOwnPropertyDescriptor(c.DetermineComponentFrameRoot,"name");d&&d.configurable&&Object.defineProperty(c.DetermineComponentFrameRoot,"name",{value:"DetermineComponentFrameRoot"});var h=c.DetermineComponentFrameRoot(),y=h[0],b=h[1];if(y&&b){var C=y.split(`
`),w=b.split(`
`);for(d=c=0;c<C.length&&!C[c].includes("DetermineComponentFrameRoot");)c++;for(;d<w.length&&!w[d].includes("DetermineComponentFrameRoot");)d++;if(c===C.length||d===w.length)for(c=C.length-1,d=w.length-1;1<=c&&0<=d&&C[c]!==w[d];)d--;for(;1<=c&&0<=d;c--,d--)if(C[c]!==w[d]){if(c!==1||d!==1)do if(c--,d--,0>d||C[c]!==w[d]){var B=`
`+C[c].replace(" at new "," at ");return e.displayName&&B.includes("<anonymous>")&&(B=B.replace("<anonymous>",e.displayName)),B}while(1<=c&&0<=d);break}}}finally{Nc=!1,Error.prepareStackTrace=s}return(s=e?e.displayName||e.name:"")?Ki(s):""}function Oy(e,n){switch(e.tag){case 26:case 27:case 5:return Ki(e.type);case 16:return Ki("Lazy");case 13:return e.child!==n&&n!==null?Ki("Suspense Fallback"):Ki("Suspense");case 19:return Ki("SuspenseList");case 0:case 15:return Pc(e.type,!1);case 11:return Pc(e.type.render,!1);case 1:return Pc(e.type,!0);case 31:return Ki("Activity");default:return""}}function Tf(e){try{var n="",s=null;do n+=Oy(e,s),s=e,e=e.return;while(e);return n}catch(c){return`
Error generating stack: `+c.message+`
`+c.stack}}var Uc=Object.prototype.hasOwnProperty,Lc=r.unstable_scheduleCallback,Ic=r.unstable_cancelCallback,Ay=r.unstable_shouldYield,Dy=r.unstable_requestPaint,Kt=r.unstable_now,My=r.unstable_getCurrentPriorityLevel,Cf=r.unstable_ImmediatePriority,kf=r.unstable_UserBlockingPriority,wr=r.unstable_NormalPriority,wy=r.unstable_LowPriority,Ef=r.unstable_IdlePriority,xy=r.log,Ny=r.unstable_setDisableYieldValue,ys=null,Yt=null;function li(e){if(typeof xy=="function"&&Ny(e),Yt&&typeof Yt.setStrictMode=="function")try{Yt.setStrictMode(ys,e)}catch{}}var Qt=Math.clz32?Math.clz32:Ly,Py=Math.log,Uy=Math.LN2;function Ly(e){return e>>>=0,e===0?32:31-(Py(e)/Uy|0)|0}var xr=256,Nr=262144,Pr=4194304;function Yi(e){var n=e&42;if(n!==0)return n;switch(e&-e){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:return 64;case 128:return 128;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:return e&261888;case 262144:case 524288:case 1048576:case 2097152:return e&3932160;case 4194304:case 8388608:case 16777216:case 33554432:return e&62914560;case 67108864:return 67108864;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 0;default:return e}}function Ur(e,n,s){var c=e.pendingLanes;if(c===0)return 0;var d=0,h=e.suspendedLanes,y=e.pingedLanes;e=e.warmLanes;var b=c&134217727;return b!==0?(c=b&~h,c!==0?d=Yi(c):(y&=b,y!==0?d=Yi(y):s||(s=b&~e,s!==0&&(d=Yi(s))))):(b=c&~h,b!==0?d=Yi(b):y!==0?d=Yi(y):s||(s=c&~e,s!==0&&(d=Yi(s)))),d===0?0:n!==0&&n!==d&&(n&h)===0&&(h=d&-d,s=n&-n,h>=s||h===32&&(s&4194048)!==0)?n:d}function bs(e,n){return(e.pendingLanes&~(e.suspendedLanes&~e.pingedLanes)&n)===0}function Iy(e,n){switch(e){case 1:case 2:case 4:case 8:case 64:return n+250;case 16:case 32:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return n+5e3;case 4194304:case 8388608:case 16777216:case 33554432:return-1;case 67108864:case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function _f(){var e=Pr;return Pr<<=1,(Pr&62914560)===0&&(Pr=4194304),e}function jc(e){for(var n=[],s=0;31>s;s++)n.push(e);return n}function Ss(e,n){e.pendingLanes|=n,n!==268435456&&(e.suspendedLanes=0,e.pingedLanes=0,e.warmLanes=0)}function jy(e,n,s,c,d,h){var y=e.pendingLanes;e.pendingLanes=s,e.suspendedLanes=0,e.pingedLanes=0,e.warmLanes=0,e.expiredLanes&=s,e.entangledLanes&=s,e.errorRecoveryDisabledLanes&=s,e.shellSuspendCounter=0;var b=e.entanglements,C=e.expirationTimes,w=e.hiddenUpdates;for(s=y&~s;0<s;){var B=31-Qt(s),H=1<<B;b[B]=0,C[B]=-1;var P=w[B];if(P!==null)for(w[B]=null,B=0;B<P.length;B++){var L=P[B];L!==null&&(L.lane&=-536870913)}s&=~H}c!==0&&Rf(e,c,0),h!==0&&d===0&&e.tag!==0&&(e.suspendedLanes|=h&~(y&~n))}function Rf(e,n,s){e.pendingLanes|=n,e.suspendedLanes&=~n;var c=31-Qt(n);e.entangledLanes|=n,e.entanglements[c]=e.entanglements[c]|1073741824|s&261930}function Of(e,n){var s=e.entangledLanes|=n;for(e=e.entanglements;s;){var c=31-Qt(s),d=1<<c;d&n|e[c]&n&&(e[c]|=n),s&=~d}}function Af(e,n){var s=n&-n;return s=(s&42)!==0?1:Bc(s),(s&(e.suspendedLanes|n))!==0?0:s}function Bc(e){switch(e){case 2:e=1;break;case 8:e=4;break;case 32:e=16;break;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:e=128;break;case 268435456:e=134217728;break;default:e=0}return e}function zc(e){return e&=-e,2<e?8<e?(e&134217727)!==0?32:268435456:8:2}function Df(){var e=W.p;return e!==0?e:(e=window.event,e===void 0?32:mg(e.type))}function Mf(e,n){var s=W.p;try{return W.p=e,n()}finally{W.p=s}}var ui=Math.random().toString(36).slice(2),St="__reactFiber$"+ui,Ut="__reactProps$"+ui,va="__reactContainer$"+ui,qc="__reactEvents$"+ui,By="__reactListeners$"+ui,zy="__reactHandles$"+ui,wf="__reactResources$"+ui,Ts="__reactMarker$"+ui;function Vc(e){delete e[St],delete e[Ut],delete e[qc],delete e[By],delete e[zy]}function ya(e){var n=e[St];if(n)return n;for(var s=e.parentNode;s;){if(n=s[va]||s[St]){if(s=n.alternate,n.child!==null||s!==null&&s.child!==null)for(e=Wp(e);e!==null;){if(s=e[St])return s;e=Wp(e)}return n}e=s,s=e.parentNode}return null}function ba(e){if(e=e[St]||e[va]){var n=e.tag;if(n===5||n===6||n===13||n===31||n===26||n===27||n===3)return e}return null}function Cs(e){var n=e.tag;if(n===5||n===26||n===27||n===6)return e.stateNode;throw Error(a(33))}function Sa(e){var n=e[wf];return n||(n=e[wf]={hoistableStyles:new Map,hoistableScripts:new Map}),n}function gt(e){e[Ts]=!0}var xf=new Set,Nf={};function Qi(e,n){Ta(e,n),Ta(e+"Capture",n)}function Ta(e,n){for(Nf[e]=n,e=0;e<n.length;e++)xf.add(n[e])}var qy=RegExp("^[:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD][:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD\\-.0-9\\u00B7\\u0300-\\u036F\\u203F-\\u2040]*$"),Pf={},Uf={};function Vy(e){return Uc.call(Uf,e)?!0:Uc.call(Pf,e)?!1:qy.test(e)?Uf[e]=!0:(Pf[e]=!0,!1)}function Lr(e,n,s){if(Vy(n))if(s===null)e.removeAttribute(n);else{switch(typeof s){case"undefined":case"function":case"symbol":e.removeAttribute(n);return;case"boolean":var c=n.toLowerCase().slice(0,5);if(c!=="data-"&&c!=="aria-"){e.removeAttribute(n);return}}e.setAttribute(n,""+s)}}function Ir(e,n,s){if(s===null)e.removeAttribute(n);else{switch(typeof s){case"undefined":case"function":case"symbol":case"boolean":e.removeAttribute(n);return}e.setAttribute(n,""+s)}}function jn(e,n,s,c){if(c===null)e.removeAttribute(s);else{switch(typeof c){case"undefined":case"function":case"symbol":case"boolean":e.removeAttribute(s);return}e.setAttributeNS(n,s,""+c)}}function an(e){switch(typeof e){case"bigint":case"boolean":case"number":case"string":case"undefined":return e;case"object":return e;default:return""}}function Lf(e){var n=e.type;return(e=e.nodeName)&&e.toLowerCase()==="input"&&(n==="checkbox"||n==="radio")}function Hy(e,n,s){var c=Object.getOwnPropertyDescriptor(e.constructor.prototype,n);if(!e.hasOwnProperty(n)&&typeof c<"u"&&typeof c.get=="function"&&typeof c.set=="function"){var d=c.get,h=c.set;return Object.defineProperty(e,n,{configurable:!0,get:function(){return d.call(this)},set:function(y){s=""+y,h.call(this,y)}}),Object.defineProperty(e,n,{enumerable:c.enumerable}),{getValue:function(){return s},setValue:function(y){s=""+y},stopTracking:function(){e._valueTracker=null,delete e[n]}}}}function Hc(e){if(!e._valueTracker){var n=Lf(e)?"checked":"value";e._valueTracker=Hy(e,n,""+e[n])}}function If(e){if(!e)return!1;var n=e._valueTracker;if(!n)return!0;var s=n.getValue(),c="";return e&&(c=Lf(e)?e.checked?"true":"false":e.value),e=c,e!==s?(n.setValue(e),!0):!1}function jr(e){if(e=e||(typeof document<"u"?document:void 0),typeof e>"u")return null;try{return e.activeElement||e.body}catch{return e.body}}var Fy=/[\n"\\]/g;function sn(e){return e.replace(Fy,function(n){return"\\"+n.charCodeAt(0).toString(16)+" "})}function Fc(e,n,s,c,d,h,y,b){e.name="",y!=null&&typeof y!="function"&&typeof y!="symbol"&&typeof y!="boolean"?e.type=y:e.removeAttribute("type"),n!=null?y==="number"?(n===0&&e.value===""||e.value!=n)&&(e.value=""+an(n)):e.value!==""+an(n)&&(e.value=""+an(n)):y!=="submit"&&y!=="reset"||e.removeAttribute("value"),n!=null?Gc(e,y,an(n)):s!=null?Gc(e,y,an(s)):c!=null&&e.removeAttribute("value"),d==null&&h!=null&&(e.defaultChecked=!!h),d!=null&&(e.checked=d&&typeof d!="function"&&typeof d!="symbol"),b!=null&&typeof b!="function"&&typeof b!="symbol"&&typeof b!="boolean"?e.name=""+an(b):e.removeAttribute("name")}function jf(e,n,s,c,d,h,y,b){if(h!=null&&typeof h!="function"&&typeof h!="symbol"&&typeof h!="boolean"&&(e.type=h),n!=null||s!=null){if(!(h!=="submit"&&h!=="reset"||n!=null)){Hc(e);return}s=s!=null?""+an(s):"",n=n!=null?""+an(n):s,b||n===e.value||(e.value=n),e.defaultValue=n}c=c??d,c=typeof c!="function"&&typeof c!="symbol"&&!!c,e.checked=b?e.checked:!!c,e.defaultChecked=!!c,y!=null&&typeof y!="function"&&typeof y!="symbol"&&typeof y!="boolean"&&(e.name=y),Hc(e)}function Gc(e,n,s){n==="number"&&jr(e.ownerDocument)===e||e.defaultValue===""+s||(e.defaultValue=""+s)}function Ca(e,n,s,c){if(e=e.options,n){n={};for(var d=0;d<s.length;d++)n["$"+s[d]]=!0;for(s=0;s<e.length;s++)d=n.hasOwnProperty("$"+e[s].value),e[s].selected!==d&&(e[s].selected=d),d&&c&&(e[s].defaultSelected=!0)}else{for(s=""+an(s),n=null,d=0;d<e.length;d++){if(e[d].value===s){e[d].selected=!0,c&&(e[d].defaultSelected=!0);return}n!==null||e[d].disabled||(n=e[d])}n!==null&&(n.selected=!0)}}function Bf(e,n,s){if(n!=null&&(n=""+an(n),n!==e.value&&(e.value=n),s==null)){e.defaultValue!==n&&(e.defaultValue=n);return}e.defaultValue=s!=null?""+an(s):""}function zf(e,n,s,c){if(n==null){if(c!=null){if(s!=null)throw Error(a(92));if(ht(c)){if(1<c.length)throw Error(a(93));c=c[0]}s=c}s==null&&(s=""),n=s}s=an(n),e.defaultValue=s,c=e.textContent,c===s&&c!==""&&c!==null&&(e.value=c),Hc(e)}function ka(e,n){if(n){var s=e.firstChild;if(s&&s===e.lastChild&&s.nodeType===3){s.nodeValue=n;return}}e.textContent=n}var Gy=new Set("animationIterationCount aspectRatio borderImageOutset borderImageSlice borderImageWidth boxFlex boxFlexGroup boxOrdinalGroup columnCount columns flex flexGrow flexPositive flexShrink flexNegative flexOrder gridArea gridRow gridRowEnd gridRowSpan gridRowStart gridColumn gridColumnEnd gridColumnSpan gridColumnStart fontWeight lineClamp lineHeight opacity order orphans scale tabSize widows zIndex zoom fillOpacity floodOpacity stopOpacity strokeDasharray strokeDashoffset strokeMiterlimit strokeOpacity strokeWidth MozAnimationIterationCount MozBoxFlex MozBoxFlexGroup MozLineClamp msAnimationIterationCount msFlex msZoom msFlexGrow msFlexNegative msFlexOrder msFlexPositive msFlexShrink msGridColumn msGridColumnSpan msGridRow msGridRowSpan WebkitAnimationIterationCount WebkitBoxFlex WebKitBoxFlexGroup WebkitBoxOrdinalGroup WebkitColumnCount WebkitColumns WebkitFlex WebkitFlexGrow WebkitFlexPositive WebkitFlexShrink WebkitLineClamp".split(" "));function qf(e,n,s){var c=n.indexOf("--")===0;s==null||typeof s=="boolean"||s===""?c?e.setProperty(n,""):n==="float"?e.cssFloat="":e[n]="":c?e.setProperty(n,s):typeof s!="number"||s===0||Gy.has(n)?n==="float"?e.cssFloat=s:e[n]=(""+s).trim():e[n]=s+"px"}function Vf(e,n,s){if(n!=null&&typeof n!="object")throw Error(a(62));if(e=e.style,s!=null){for(var c in s)!s.hasOwnProperty(c)||n!=null&&n.hasOwnProperty(c)||(c.indexOf("--")===0?e.setProperty(c,""):c==="float"?e.cssFloat="":e[c]="");for(var d in n)c=n[d],n.hasOwnProperty(d)&&s[d]!==c&&qf(e,d,c)}else for(var h in n)n.hasOwnProperty(h)&&qf(e,h,n[h])}function Kc(e){if(e.indexOf("-")===-1)return!1;switch(e){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var Ky=new Map([["acceptCharset","accept-charset"],["htmlFor","for"],["httpEquiv","http-equiv"],["crossOrigin","crossorigin"],["accentHeight","accent-height"],["alignmentBaseline","alignment-baseline"],["arabicForm","arabic-form"],["baselineShift","baseline-shift"],["capHeight","cap-height"],["clipPath","clip-path"],["clipRule","clip-rule"],["colorInterpolation","color-interpolation"],["colorInterpolationFilters","color-interpolation-filters"],["colorProfile","color-profile"],["colorRendering","color-rendering"],["dominantBaseline","dominant-baseline"],["enableBackground","enable-background"],["fillOpacity","fill-opacity"],["fillRule","fill-rule"],["floodColor","flood-color"],["floodOpacity","flood-opacity"],["fontFamily","font-family"],["fontSize","font-size"],["fontSizeAdjust","font-size-adjust"],["fontStretch","font-stretch"],["fontStyle","font-style"],["fontVariant","font-variant"],["fontWeight","font-weight"],["glyphName","glyph-name"],["glyphOrientationHorizontal","glyph-orientation-horizontal"],["glyphOrientationVertical","glyph-orientation-vertical"],["horizAdvX","horiz-adv-x"],["horizOriginX","horiz-origin-x"],["imageRendering","image-rendering"],["letterSpacing","letter-spacing"],["lightingColor","lighting-color"],["markerEnd","marker-end"],["markerMid","marker-mid"],["markerStart","marker-start"],["overlinePosition","overline-position"],["overlineThickness","overline-thickness"],["paintOrder","paint-order"],["panose-1","panose-1"],["pointerEvents","pointer-events"],["renderingIntent","rendering-intent"],["shapeRendering","shape-rendering"],["stopColor","stop-color"],["stopOpacity","stop-opacity"],["strikethroughPosition","strikethrough-position"],["strikethroughThickness","strikethrough-thickness"],["strokeDasharray","stroke-dasharray"],["strokeDashoffset","stroke-dashoffset"],["strokeLinecap","stroke-linecap"],["strokeLinejoin","stroke-linejoin"],["strokeMiterlimit","stroke-miterlimit"],["strokeOpacity","stroke-opacity"],["strokeWidth","stroke-width"],["textAnchor","text-anchor"],["textDecoration","text-decoration"],["textRendering","text-rendering"],["transformOrigin","transform-origin"],["underlinePosition","underline-position"],["underlineThickness","underline-thickness"],["unicodeBidi","unicode-bidi"],["unicodeRange","unicode-range"],["unitsPerEm","units-per-em"],["vAlphabetic","v-alphabetic"],["vHanging","v-hanging"],["vIdeographic","v-ideographic"],["vMathematical","v-mathematical"],["vectorEffect","vector-effect"],["vertAdvY","vert-adv-y"],["vertOriginX","vert-origin-x"],["vertOriginY","vert-origin-y"],["wordSpacing","word-spacing"],["writingMode","writing-mode"],["xmlnsXlink","xmlns:xlink"],["xHeight","x-height"]]),Yy=/^[\u0000-\u001F ]*j[\r\n\t]*a[\r\n\t]*v[\r\n\t]*a[\r\n\t]*s[\r\n\t]*c[\r\n\t]*r[\r\n\t]*i[\r\n\t]*p[\r\n\t]*t[\r\n\t]*:/i;function Br(e){return Yy.test(""+e)?"javascript:throw new Error('React has blocked a javascript: URL as a security precaution.')":e}function Bn(){}var Yc=null;function Qc(e){return e=e.target||e.srcElement||window,e.correspondingUseElement&&(e=e.correspondingUseElement),e.nodeType===3?e.parentNode:e}var Ea=null,_a=null;function Hf(e){var n=ba(e);if(n&&(e=n.stateNode)){var s=e[Ut]||null;e:switch(e=n.stateNode,n.type){case"input":if(Fc(e,s.value,s.defaultValue,s.defaultValue,s.checked,s.defaultChecked,s.type,s.name),n=s.name,s.type==="radio"&&n!=null){for(s=e;s.parentNode;)s=s.parentNode;for(s=s.querySelectorAll('input[name="'+sn(""+n)+'"][type="radio"]'),n=0;n<s.length;n++){var c=s[n];if(c!==e&&c.form===e.form){var d=c[Ut]||null;if(!d)throw Error(a(90));Fc(c,d.value,d.defaultValue,d.defaultValue,d.checked,d.defaultChecked,d.type,d.name)}}for(n=0;n<s.length;n++)c=s[n],c.form===e.form&&If(c)}break e;case"textarea":Bf(e,s.value,s.defaultValue);break e;case"select":n=s.value,n!=null&&Ca(e,!!s.multiple,n,!1)}}}var Jc=!1;function Ff(e,n,s){if(Jc)return e(n,s);Jc=!0;try{var c=e(n);return c}finally{if(Jc=!1,(Ea!==null||_a!==null)&&(Oo(),Ea&&(n=Ea,e=_a,_a=Ea=null,Hf(n),e)))for(n=0;n<e.length;n++)Hf(e[n])}}function ks(e,n){var s=e.stateNode;if(s===null)return null;var c=s[Ut]||null;if(c===null)return null;s=c[n];e:switch(n){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(c=!c.disabled)||(e=e.type,c=!(e==="button"||e==="input"||e==="select"||e==="textarea")),e=!c;break e;default:e=!1}if(e)return null;if(s&&typeof s!="function")throw Error(a(231,n,typeof s));return s}var zn=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),Xc=!1;if(zn)try{var Es={};Object.defineProperty(Es,"passive",{get:function(){Xc=!0}}),window.addEventListener("test",Es,Es),window.removeEventListener("test",Es,Es)}catch{Xc=!1}var di=null,Zc=null,zr=null;function Gf(){if(zr)return zr;var e,n=Zc,s=n.length,c,d="value"in di?di.value:di.textContent,h=d.length;for(e=0;e<s&&n[e]===d[e];e++);var y=s-e;for(c=1;c<=y&&n[s-c]===d[h-c];c++);return zr=d.slice(e,1<c?1-c:void 0)}function qr(e){var n=e.keyCode;return"charCode"in e?(e=e.charCode,e===0&&n===13&&(e=13)):e=n,e===10&&(e=13),32<=e||e===13?e:0}function Vr(){return!0}function Kf(){return!1}function Lt(e){function n(s,c,d,h,y){this._reactName=s,this._targetInst=d,this.type=c,this.nativeEvent=h,this.target=y,this.currentTarget=null;for(var b in e)e.hasOwnProperty(b)&&(s=e[b],this[b]=s?s(h):h[b]);return this.isDefaultPrevented=(h.defaultPrevented!=null?h.defaultPrevented:h.returnValue===!1)?Vr:Kf,this.isPropagationStopped=Kf,this}return v(n.prototype,{preventDefault:function(){this.defaultPrevented=!0;var s=this.nativeEvent;s&&(s.preventDefault?s.preventDefault():typeof s.returnValue!="unknown"&&(s.returnValue=!1),this.isDefaultPrevented=Vr)},stopPropagation:function(){var s=this.nativeEvent;s&&(s.stopPropagation?s.stopPropagation():typeof s.cancelBubble!="unknown"&&(s.cancelBubble=!0),this.isPropagationStopped=Vr)},persist:function(){},isPersistent:Vr}),n}var Ji={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(e){return e.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},Hr=Lt(Ji),_s=v({},Ji,{view:0,detail:0}),Qy=Lt(_s),Wc,$c,Rs,Fr=v({},_s,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:tl,button:0,buttons:0,relatedTarget:function(e){return e.relatedTarget===void 0?e.fromElement===e.srcElement?e.toElement:e.fromElement:e.relatedTarget},movementX:function(e){return"movementX"in e?e.movementX:(e!==Rs&&(Rs&&e.type==="mousemove"?(Wc=e.screenX-Rs.screenX,$c=e.screenY-Rs.screenY):$c=Wc=0,Rs=e),Wc)},movementY:function(e){return"movementY"in e?e.movementY:$c}}),Yf=Lt(Fr),Jy=v({},Fr,{dataTransfer:0}),Xy=Lt(Jy),Zy=v({},_s,{relatedTarget:0}),el=Lt(Zy),Wy=v({},Ji,{animationName:0,elapsedTime:0,pseudoElement:0}),$y=Lt(Wy),eb=v({},Ji,{clipboardData:function(e){return"clipboardData"in e?e.clipboardData:window.clipboardData}}),tb=Lt(eb),nb=v({},Ji,{data:0}),Qf=Lt(nb),ib={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},ab={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},sb={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function rb(e){var n=this.nativeEvent;return n.getModifierState?n.getModifierState(e):(e=sb[e])?!!n[e]:!1}function tl(){return rb}var ob=v({},_s,{key:function(e){if(e.key){var n=ib[e.key]||e.key;if(n!=="Unidentified")return n}return e.type==="keypress"?(e=qr(e),e===13?"Enter":String.fromCharCode(e)):e.type==="keydown"||e.type==="keyup"?ab[e.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:tl,charCode:function(e){return e.type==="keypress"?qr(e):0},keyCode:function(e){return e.type==="keydown"||e.type==="keyup"?e.keyCode:0},which:function(e){return e.type==="keypress"?qr(e):e.type==="keydown"||e.type==="keyup"?e.keyCode:0}}),cb=Lt(ob),lb=v({},Fr,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),Jf=Lt(lb),ub=v({},_s,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:tl}),db=Lt(ub),fb=v({},Ji,{propertyName:0,elapsedTime:0,pseudoElement:0}),hb=Lt(fb),mb=v({},Fr,{deltaX:function(e){return"deltaX"in e?e.deltaX:"wheelDeltaX"in e?-e.wheelDeltaX:0},deltaY:function(e){return"deltaY"in e?e.deltaY:"wheelDeltaY"in e?-e.wheelDeltaY:"wheelDelta"in e?-e.wheelDelta:0},deltaZ:0,deltaMode:0}),pb=Lt(mb),gb=v({},Ji,{newState:0,oldState:0}),vb=Lt(gb),yb=[9,13,27,32],nl=zn&&"CompositionEvent"in window,Os=null;zn&&"documentMode"in document&&(Os=document.documentMode);var bb=zn&&"TextEvent"in window&&!Os,Xf=zn&&(!nl||Os&&8<Os&&11>=Os),Zf=" ",Wf=!1;function $f(e,n){switch(e){case"keyup":return yb.indexOf(n.keyCode)!==-1;case"keydown":return n.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function eh(e){return e=e.detail,typeof e=="object"&&"data"in e?e.data:null}var Ra=!1;function Sb(e,n){switch(e){case"compositionend":return eh(n);case"keypress":return n.which!==32?null:(Wf=!0,Zf);case"textInput":return e=n.data,e===Zf&&Wf?null:e;default:return null}}function Tb(e,n){if(Ra)return e==="compositionend"||!nl&&$f(e,n)?(e=Gf(),zr=Zc=di=null,Ra=!1,e):null;switch(e){case"paste":return null;case"keypress":if(!(n.ctrlKey||n.altKey||n.metaKey)||n.ctrlKey&&n.altKey){if(n.char&&1<n.char.length)return n.char;if(n.which)return String.fromCharCode(n.which)}return null;case"compositionend":return Xf&&n.locale!=="ko"?null:n.data;default:return null}}var Cb={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function th(e){var n=e&&e.nodeName&&e.nodeName.toLowerCase();return n==="input"?!!Cb[e.type]:n==="textarea"}function nh(e,n,s,c){Ea?_a?_a.push(c):_a=[c]:Ea=c,n=Po(n,"onChange"),0<n.length&&(s=new Hr("onChange","change",null,s,c),e.push({event:s,listeners:n}))}var As=null,Ds=null;function kb(e){jp(e,0)}function Gr(e){var n=Cs(e);if(If(n))return e}function ih(e,n){if(e==="change")return n}var ah=!1;if(zn){var il;if(zn){var al="oninput"in document;if(!al){var sh=document.createElement("div");sh.setAttribute("oninput","return;"),al=typeof sh.oninput=="function"}il=al}else il=!1;ah=il&&(!document.documentMode||9<document.documentMode)}function rh(){As&&(As.detachEvent("onpropertychange",oh),Ds=As=null)}function oh(e){if(e.propertyName==="value"&&Gr(Ds)){var n=[];nh(n,Ds,e,Qc(e)),Ff(kb,n)}}function Eb(e,n,s){e==="focusin"?(rh(),As=n,Ds=s,As.attachEvent("onpropertychange",oh)):e==="focusout"&&rh()}function _b(e){if(e==="selectionchange"||e==="keyup"||e==="keydown")return Gr(Ds)}function Rb(e,n){if(e==="click")return Gr(n)}function Ob(e,n){if(e==="input"||e==="change")return Gr(n)}function Ab(e,n){return e===n&&(e!==0||1/e===1/n)||e!==e&&n!==n}var Jt=typeof Object.is=="function"?Object.is:Ab;function Ms(e,n){if(Jt(e,n))return!0;if(typeof e!="object"||e===null||typeof n!="object"||n===null)return!1;var s=Object.keys(e),c=Object.keys(n);if(s.length!==c.length)return!1;for(c=0;c<s.length;c++){var d=s[c];if(!Uc.call(n,d)||!Jt(e[d],n[d]))return!1}return!0}function ch(e){for(;e&&e.firstChild;)e=e.firstChild;return e}function lh(e,n){var s=ch(e);e=0;for(var c;s;){if(s.nodeType===3){if(c=e+s.textContent.length,e<=n&&c>=n)return{node:s,offset:n-e};e=c}e:{for(;s;){if(s.nextSibling){s=s.nextSibling;break e}s=s.parentNode}s=void 0}s=ch(s)}}function uh(e,n){return e&&n?e===n?!0:e&&e.nodeType===3?!1:n&&n.nodeType===3?uh(e,n.parentNode):"contains"in e?e.contains(n):e.compareDocumentPosition?!!(e.compareDocumentPosition(n)&16):!1:!1}function dh(e){e=e!=null&&e.ownerDocument!=null&&e.ownerDocument.defaultView!=null?e.ownerDocument.defaultView:window;for(var n=jr(e.document);n instanceof e.HTMLIFrameElement;){try{var s=typeof n.contentWindow.location.href=="string"}catch{s=!1}if(s)e=n.contentWindow;else break;n=jr(e.document)}return n}function sl(e){var n=e&&e.nodeName&&e.nodeName.toLowerCase();return n&&(n==="input"&&(e.type==="text"||e.type==="search"||e.type==="tel"||e.type==="url"||e.type==="password")||n==="textarea"||e.contentEditable==="true")}var Db=zn&&"documentMode"in document&&11>=document.documentMode,Oa=null,rl=null,ws=null,ol=!1;function fh(e,n,s){var c=s.window===s?s.document:s.nodeType===9?s:s.ownerDocument;ol||Oa==null||Oa!==jr(c)||(c=Oa,"selectionStart"in c&&sl(c)?c={start:c.selectionStart,end:c.selectionEnd}:(c=(c.ownerDocument&&c.ownerDocument.defaultView||window).getSelection(),c={anchorNode:c.anchorNode,anchorOffset:c.anchorOffset,focusNode:c.focusNode,focusOffset:c.focusOffset}),ws&&Ms(ws,c)||(ws=c,c=Po(rl,"onSelect"),0<c.length&&(n=new Hr("onSelect","select",null,n,s),e.push({event:n,listeners:c}),n.target=Oa)))}function Xi(e,n){var s={};return s[e.toLowerCase()]=n.toLowerCase(),s["Webkit"+e]="webkit"+n,s["Moz"+e]="moz"+n,s}var Aa={animationend:Xi("Animation","AnimationEnd"),animationiteration:Xi("Animation","AnimationIteration"),animationstart:Xi("Animation","AnimationStart"),transitionrun:Xi("Transition","TransitionRun"),transitionstart:Xi("Transition","TransitionStart"),transitioncancel:Xi("Transition","TransitionCancel"),transitionend:Xi("Transition","TransitionEnd")},cl={},hh={};zn&&(hh=document.createElement("div").style,"AnimationEvent"in window||(delete Aa.animationend.animation,delete Aa.animationiteration.animation,delete Aa.animationstart.animation),"TransitionEvent"in window||delete Aa.transitionend.transition);function Zi(e){if(cl[e])return cl[e];if(!Aa[e])return e;var n=Aa[e],s;for(s in n)if(n.hasOwnProperty(s)&&s in hh)return cl[e]=n[s];return e}var mh=Zi("animationend"),ph=Zi("animationiteration"),gh=Zi("animationstart"),Mb=Zi("transitionrun"),wb=Zi("transitionstart"),xb=Zi("transitioncancel"),vh=Zi("transitionend"),yh=new Map,ll="abort auxClick beforeToggle cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");ll.push("scrollEnd");function vn(e,n){yh.set(e,n),Qi(n,[e])}var Kr=typeof reportError=="function"?reportError:function(e){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var n=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof e=="object"&&e!==null&&typeof e.message=="string"?String(e.message):String(e),error:e});if(!window.dispatchEvent(n))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",e);return}console.error(e)},rn=[],Da=0,ul=0;function Yr(){for(var e=Da,n=ul=Da=0;n<e;){var s=rn[n];rn[n++]=null;var c=rn[n];rn[n++]=null;var d=rn[n];rn[n++]=null;var h=rn[n];if(rn[n++]=null,c!==null&&d!==null){var y=c.pending;y===null?d.next=d:(d.next=y.next,y.next=d),c.pending=d}h!==0&&bh(s,d,h)}}function Qr(e,n,s,c){rn[Da++]=e,rn[Da++]=n,rn[Da++]=s,rn[Da++]=c,ul|=c,e.lanes|=c,e=e.alternate,e!==null&&(e.lanes|=c)}function dl(e,n,s,c){return Qr(e,n,s,c),Jr(e)}function Wi(e,n){return Qr(e,null,null,n),Jr(e)}function bh(e,n,s){e.lanes|=s;var c=e.alternate;c!==null&&(c.lanes|=s);for(var d=!1,h=e.return;h!==null;)h.childLanes|=s,c=h.alternate,c!==null&&(c.childLanes|=s),h.tag===22&&(e=h.stateNode,e===null||e._visibility&1||(d=!0)),e=h,h=h.return;return e.tag===3?(h=e.stateNode,d&&n!==null&&(d=31-Qt(s),e=h.hiddenUpdates,c=e[d],c===null?e[d]=[n]:c.push(n),n.lane=s|536870912),h):null}function Jr(e){if(50<$s)throw $s=0,Su=null,Error(a(185));for(var n=e.return;n!==null;)e=n,n=e.return;return e.tag===3?e.stateNode:null}var Ma={};function Nb(e,n,s,c){this.tag=e,this.key=s,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.refCleanup=this.ref=null,this.pendingProps=n,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=c,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Xt(e,n,s,c){return new Nb(e,n,s,c)}function fl(e){return e=e.prototype,!(!e||!e.isReactComponent)}function qn(e,n){var s=e.alternate;return s===null?(s=Xt(e.tag,n,e.key,e.mode),s.elementType=e.elementType,s.type=e.type,s.stateNode=e.stateNode,s.alternate=e,e.alternate=s):(s.pendingProps=n,s.type=e.type,s.flags=0,s.subtreeFlags=0,s.deletions=null),s.flags=e.flags&65011712,s.childLanes=e.childLanes,s.lanes=e.lanes,s.child=e.child,s.memoizedProps=e.memoizedProps,s.memoizedState=e.memoizedState,s.updateQueue=e.updateQueue,n=e.dependencies,s.dependencies=n===null?null:{lanes:n.lanes,firstContext:n.firstContext},s.sibling=e.sibling,s.index=e.index,s.ref=e.ref,s.refCleanup=e.refCleanup,s}function Sh(e,n){e.flags&=65011714;var s=e.alternate;return s===null?(e.childLanes=0,e.lanes=n,e.child=null,e.subtreeFlags=0,e.memoizedProps=null,e.memoizedState=null,e.updateQueue=null,e.dependencies=null,e.stateNode=null):(e.childLanes=s.childLanes,e.lanes=s.lanes,e.child=s.child,e.subtreeFlags=0,e.deletions=null,e.memoizedProps=s.memoizedProps,e.memoizedState=s.memoizedState,e.updateQueue=s.updateQueue,e.type=s.type,n=s.dependencies,e.dependencies=n===null?null:{lanes:n.lanes,firstContext:n.firstContext}),e}function Xr(e,n,s,c,d,h){var y=0;if(c=e,typeof e=="function")fl(e)&&(y=1);else if(typeof e=="string")y=jS(e,s,oe.current)?26:e==="html"||e==="head"||e==="body"?27:5;else e:switch(e){case ne:return e=Xt(31,s,n,d),e.elementType=ne,e.lanes=h,e;case E:return $i(s.children,d,h,n);case j:y=8,d|=24;break;case U:return e=Xt(12,s,n,d|2),e.elementType=U,e.lanes=h,e;case N:return e=Xt(13,s,n,d),e.elementType=N,e.lanes=h,e;case q:return e=Xt(19,s,n,d),e.elementType=q,e.lanes=h,e;default:if(typeof e=="object"&&e!==null)switch(e.$$typeof){case Z:y=10;break e;case Y:y=9;break e;case M:y=11;break e;case Q:y=14;break e;case ae:y=16,c=null;break e}y=29,s=Error(a(130,e===null?"null":typeof e,"")),c=null}return n=Xt(y,s,n,d),n.elementType=e,n.type=c,n.lanes=h,n}function $i(e,n,s,c){return e=Xt(7,e,c,n),e.lanes=s,e}function hl(e,n,s){return e=Xt(6,e,null,n),e.lanes=s,e}function Th(e){var n=Xt(18,null,null,0);return n.stateNode=e,n}function ml(e,n,s){return n=Xt(4,e.children!==null?e.children:[],e.key,n),n.lanes=s,n.stateNode={containerInfo:e.containerInfo,pendingChildren:null,implementation:e.implementation},n}var Ch=new WeakMap;function on(e,n){if(typeof e=="object"&&e!==null){var s=Ch.get(e);return s!==void 0?s:(n={value:e,source:n,stack:Tf(n)},Ch.set(e,n),n)}return{value:e,source:n,stack:Tf(n)}}var wa=[],xa=0,Zr=null,xs=0,cn=[],ln=0,fi=null,On=1,An="";function Vn(e,n){wa[xa++]=xs,wa[xa++]=Zr,Zr=e,xs=n}function kh(e,n,s){cn[ln++]=On,cn[ln++]=An,cn[ln++]=fi,fi=e;var c=On;e=An;var d=32-Qt(c)-1;c&=~(1<<d),s+=1;var h=32-Qt(n)+d;if(30<h){var y=d-d%5;h=(c&(1<<y)-1).toString(32),c>>=y,d-=y,On=1<<32-Qt(n)+d|s<<d|c,An=h+e}else On=1<<h|s<<d|c,An=e}function pl(e){e.return!==null&&(Vn(e,1),kh(e,1,0))}function gl(e){for(;e===Zr;)Zr=wa[--xa],wa[xa]=null,xs=wa[--xa],wa[xa]=null;for(;e===fi;)fi=cn[--ln],cn[ln]=null,An=cn[--ln],cn[ln]=null,On=cn[--ln],cn[ln]=null}function Eh(e,n){cn[ln++]=On,cn[ln++]=An,cn[ln++]=fi,On=n.id,An=n.overflow,fi=e}var Tt=null,Ye=null,Ae=!1,hi=null,un=!1,vl=Error(a(519));function mi(e){var n=Error(a(418,1<arguments.length&&arguments[1]!==void 0&&arguments[1]?"text":"HTML",""));throw Ns(on(n,e)),vl}function _h(e){var n=e.stateNode,s=e.type,c=e.memoizedProps;switch(n[St]=e,n[Ut]=c,s){case"dialog":ke("cancel",n),ke("close",n);break;case"iframe":case"object":case"embed":ke("load",n);break;case"video":case"audio":for(s=0;s<tr.length;s++)ke(tr[s],n);break;case"source":ke("error",n);break;case"img":case"image":case"link":ke("error",n),ke("load",n);break;case"details":ke("toggle",n);break;case"input":ke("invalid",n),jf(n,c.value,c.defaultValue,c.checked,c.defaultChecked,c.type,c.name,!0);break;case"select":ke("invalid",n);break;case"textarea":ke("invalid",n),zf(n,c.value,c.defaultValue,c.children)}s=c.children,typeof s!="string"&&typeof s!="number"&&typeof s!="bigint"||n.textContent===""+s||c.suppressHydrationWarning===!0||Vp(n.textContent,s)?(c.popover!=null&&(ke("beforetoggle",n),ke("toggle",n)),c.onScroll!=null&&ke("scroll",n),c.onScrollEnd!=null&&ke("scrollend",n),c.onClick!=null&&(n.onclick=Bn),n=!0):n=!1,n||mi(e,!0)}function Rh(e){for(Tt=e.return;Tt;)switch(Tt.tag){case 5:case 31:case 13:un=!1;return;case 27:case 3:un=!0;return;default:Tt=Tt.return}}function Na(e){if(e!==Tt)return!1;if(!Ae)return Rh(e),Ae=!0,!1;var n=e.tag,s;if((s=n!==3&&n!==27)&&((s=n===5)&&(s=e.type,s=!(s!=="form"&&s!=="button")||Uu(e.type,e.memoizedProps)),s=!s),s&&Ye&&mi(e),Rh(e),n===13){if(e=e.memoizedState,e=e!==null?e.dehydrated:null,!e)throw Error(a(317));Ye=Zp(e)}else if(n===31){if(e=e.memoizedState,e=e!==null?e.dehydrated:null,!e)throw Error(a(317));Ye=Zp(e)}else n===27?(n=Ye,Ai(e.type)?(e=zu,zu=null,Ye=e):Ye=n):Ye=Tt?fn(e.stateNode.nextSibling):null;return!0}function ea(){Ye=Tt=null,Ae=!1}function yl(){var e=hi;return e!==null&&(zt===null?zt=e:zt.push.apply(zt,e),hi=null),e}function Ns(e){hi===null?hi=[e]:hi.push(e)}var bl=R(null),ta=null,Hn=null;function pi(e,n,s){te(bl,n._currentValue),n._currentValue=s}function Fn(e){e._currentValue=bl.current,V(bl)}function Sl(e,n,s){for(;e!==null;){var c=e.alternate;if((e.childLanes&n)!==n?(e.childLanes|=n,c!==null&&(c.childLanes|=n)):c!==null&&(c.childLanes&n)!==n&&(c.childLanes|=n),e===s)break;e=e.return}}function Tl(e,n,s,c){var d=e.child;for(d!==null&&(d.return=e);d!==null;){var h=d.dependencies;if(h!==null){var y=d.child;h=h.firstContext;e:for(;h!==null;){var b=h;h=d;for(var C=0;C<n.length;C++)if(b.context===n[C]){h.lanes|=s,b=h.alternate,b!==null&&(b.lanes|=s),Sl(h.return,s,e),c||(y=null);break e}h=b.next}}else if(d.tag===18){if(y=d.return,y===null)throw Error(a(341));y.lanes|=s,h=y.alternate,h!==null&&(h.lanes|=s),Sl(y,s,e),y=null}else y=d.child;if(y!==null)y.return=d;else for(y=d;y!==null;){if(y===e){y=null;break}if(d=y.sibling,d!==null){d.return=y.return,y=d;break}y=y.return}d=y}}function Pa(e,n,s,c){e=null;for(var d=n,h=!1;d!==null;){if(!h){if((d.flags&524288)!==0)h=!0;else if((d.flags&262144)!==0)break}if(d.tag===10){var y=d.alternate;if(y===null)throw Error(a(387));if(y=y.memoizedProps,y!==null){var b=d.type;Jt(d.pendingProps.value,y.value)||(e!==null?e.push(b):e=[b])}}else if(d===Ie.current){if(y=d.alternate,y===null)throw Error(a(387));y.memoizedState.memoizedState!==d.memoizedState.memoizedState&&(e!==null?e.push(rr):e=[rr])}d=d.return}e!==null&&Tl(n,e,s,c),n.flags|=262144}function Wr(e){for(e=e.firstContext;e!==null;){if(!Jt(e.context._currentValue,e.memoizedValue))return!0;e=e.next}return!1}function na(e){ta=e,Hn=null,e=e.dependencies,e!==null&&(e.firstContext=null)}function Ct(e){return Oh(ta,e)}function $r(e,n){return ta===null&&na(e),Oh(e,n)}function Oh(e,n){var s=n._currentValue;if(n={context:n,memoizedValue:s,next:null},Hn===null){if(e===null)throw Error(a(308));Hn=n,e.dependencies={lanes:0,firstContext:n},e.flags|=524288}else Hn=Hn.next=n;return s}var Pb=typeof AbortController<"u"?AbortController:function(){var e=[],n=this.signal={aborted:!1,addEventListener:function(s,c){e.push(c)}};this.abort=function(){n.aborted=!0,e.forEach(function(s){return s()})}},Ub=r.unstable_scheduleCallback,Lb=r.unstable_NormalPriority,ct={$$typeof:Z,Consumer:null,Provider:null,_currentValue:null,_currentValue2:null,_threadCount:0};function Cl(){return{controller:new Pb,data:new Map,refCount:0}}function Ps(e){e.refCount--,e.refCount===0&&Ub(Lb,function(){e.controller.abort()})}var Us=null,kl=0,Ua=0,La=null;function Ib(e,n){if(Us===null){var s=Us=[];kl=0,Ua=Ru(),La={status:"pending",value:void 0,then:function(c){s.push(c)}}}return kl++,n.then(Ah,Ah),n}function Ah(){if(--kl===0&&Us!==null){La!==null&&(La.status="fulfilled");var e=Us;Us=null,Ua=0,La=null;for(var n=0;n<e.length;n++)(0,e[n])()}}function jb(e,n){var s=[],c={status:"pending",value:null,reason:null,then:function(d){s.push(d)}};return e.then(function(){c.status="fulfilled",c.value=n;for(var d=0;d<s.length;d++)(0,s[d])(n)},function(d){for(c.status="rejected",c.reason=d,d=0;d<s.length;d++)(0,s[d])(void 0)}),c}var Dh=I.S;I.S=function(e,n){fp=Kt(),typeof n=="object"&&n!==null&&typeof n.then=="function"&&Ib(e,n),Dh!==null&&Dh(e,n)};var ia=R(null);function El(){var e=ia.current;return e!==null?e:Fe.pooledCache}function eo(e,n){n===null?te(ia,ia.current):te(ia,n.pool)}function Mh(){var e=El();return e===null?null:{parent:ct._currentValue,pool:e}}var Ia=Error(a(460)),_l=Error(a(474)),to=Error(a(542)),no={then:function(){}};function wh(e){return e=e.status,e==="fulfilled"||e==="rejected"}function xh(e,n,s){switch(s=e[s],s===void 0?e.push(n):s!==n&&(n.then(Bn,Bn),n=s),n.status){case"fulfilled":return n.value;case"rejected":throw e=n.reason,Ph(e),e;default:if(typeof n.status=="string")n.then(Bn,Bn);else{if(e=Fe,e!==null&&100<e.shellSuspendCounter)throw Error(a(482));e=n,e.status="pending",e.then(function(c){if(n.status==="pending"){var d=n;d.status="fulfilled",d.value=c}},function(c){if(n.status==="pending"){var d=n;d.status="rejected",d.reason=c}})}switch(n.status){case"fulfilled":return n.value;case"rejected":throw e=n.reason,Ph(e),e}throw sa=n,Ia}}function aa(e){try{var n=e._init;return n(e._payload)}catch(s){throw s!==null&&typeof s=="object"&&typeof s.then=="function"?(sa=s,Ia):s}}var sa=null;function Nh(){if(sa===null)throw Error(a(459));var e=sa;return sa=null,e}function Ph(e){if(e===Ia||e===to)throw Error(a(483))}var ja=null,Ls=0;function io(e){var n=Ls;return Ls+=1,ja===null&&(ja=[]),xh(ja,e,n)}function Is(e,n){n=n.props.ref,e.ref=n!==void 0?n:null}function ao(e,n){throw n.$$typeof===S?Error(a(525)):(e=Object.prototype.toString.call(n),Error(a(31,e==="[object Object]"?"object with keys {"+Object.keys(n).join(", ")+"}":e)))}function Uh(e){function n(A,_){if(e){var D=A.deletions;D===null?(A.deletions=[_],A.flags|=16):D.push(_)}}function s(A,_){if(!e)return null;for(;_!==null;)n(A,_),_=_.sibling;return null}function c(A){for(var _=new Map;A!==null;)A.key!==null?_.set(A.key,A):_.set(A.index,A),A=A.sibling;return _}function d(A,_){return A=qn(A,_),A.index=0,A.sibling=null,A}function h(A,_,D){return A.index=D,e?(D=A.alternate,D!==null?(D=D.index,D<_?(A.flags|=67108866,_):D):(A.flags|=67108866,_)):(A.flags|=1048576,_)}function y(A){return e&&A.alternate===null&&(A.flags|=67108866),A}function b(A,_,D,z){return _===null||_.tag!==6?(_=hl(D,A.mode,z),_.return=A,_):(_=d(_,D),_.return=A,_)}function C(A,_,D,z){var le=D.type;return le===E?B(A,_,D.props.children,z,D.key):_!==null&&(_.elementType===le||typeof le=="object"&&le!==null&&le.$$typeof===ae&&aa(le)===_.type)?(_=d(_,D.props),Is(_,D),_.return=A,_):(_=Xr(D.type,D.key,D.props,null,A.mode,z),Is(_,D),_.return=A,_)}function w(A,_,D,z){return _===null||_.tag!==4||_.stateNode.containerInfo!==D.containerInfo||_.stateNode.implementation!==D.implementation?(_=ml(D,A.mode,z),_.return=A,_):(_=d(_,D.children||[]),_.return=A,_)}function B(A,_,D,z,le){return _===null||_.tag!==7?(_=$i(D,A.mode,z,le),_.return=A,_):(_=d(_,D),_.return=A,_)}function H(A,_,D){if(typeof _=="string"&&_!==""||typeof _=="number"||typeof _=="bigint")return _=hl(""+_,A.mode,D),_.return=A,_;if(typeof _=="object"&&_!==null){switch(_.$$typeof){case k:return D=Xr(_.type,_.key,_.props,null,A.mode,D),Is(D,_),D.return=A,D;case O:return _=ml(_,A.mode,D),_.return=A,_;case ae:return _=aa(_),H(A,_,D)}if(ht(_)||ue(_))return _=$i(_,A.mode,D,null),_.return=A,_;if(typeof _.then=="function")return H(A,io(_),D);if(_.$$typeof===Z)return H(A,$r(A,_),D);ao(A,_)}return null}function P(A,_,D,z){var le=_!==null?_.key:null;if(typeof D=="string"&&D!==""||typeof D=="number"||typeof D=="bigint")return le!==null?null:b(A,_,""+D,z);if(typeof D=="object"&&D!==null){switch(D.$$typeof){case k:return D.key===le?C(A,_,D,z):null;case O:return D.key===le?w(A,_,D,z):null;case ae:return D=aa(D),P(A,_,D,z)}if(ht(D)||ue(D))return le!==null?null:B(A,_,D,z,null);if(typeof D.then=="function")return P(A,_,io(D),z);if(D.$$typeof===Z)return P(A,_,$r(A,D),z);ao(A,D)}return null}function L(A,_,D,z,le){if(typeof z=="string"&&z!==""||typeof z=="number"||typeof z=="bigint")return A=A.get(D)||null,b(_,A,""+z,le);if(typeof z=="object"&&z!==null){switch(z.$$typeof){case k:return A=A.get(z.key===null?D:z.key)||null,C(_,A,z,le);case O:return A=A.get(z.key===null?D:z.key)||null,w(_,A,z,le);case ae:return z=aa(z),L(A,_,D,z,le)}if(ht(z)||ue(z))return A=A.get(D)||null,B(_,A,z,le,null);if(typeof z.then=="function")return L(A,_,D,io(z),le);if(z.$$typeof===Z)return L(A,_,D,$r(_,z),le);ao(_,z)}return null}function re(A,_,D,z){for(var le=null,we=null,ce=_,be=_=0,Oe=null;ce!==null&&be<D.length;be++){ce.index>be?(Oe=ce,ce=null):Oe=ce.sibling;var xe=P(A,ce,D[be],z);if(xe===null){ce===null&&(ce=Oe);break}e&&ce&&xe.alternate===null&&n(A,ce),_=h(xe,_,be),we===null?le=xe:we.sibling=xe,we=xe,ce=Oe}if(be===D.length)return s(A,ce),Ae&&Vn(A,be),le;if(ce===null){for(;be<D.length;be++)ce=H(A,D[be],z),ce!==null&&(_=h(ce,_,be),we===null?le=ce:we.sibling=ce,we=ce);return Ae&&Vn(A,be),le}for(ce=c(ce);be<D.length;be++)Oe=L(ce,A,be,D[be],z),Oe!==null&&(e&&Oe.alternate!==null&&ce.delete(Oe.key===null?be:Oe.key),_=h(Oe,_,be),we===null?le=Oe:we.sibling=Oe,we=Oe);return e&&ce.forEach(function(Ni){return n(A,Ni)}),Ae&&Vn(A,be),le}function fe(A,_,D,z){if(D==null)throw Error(a(151));for(var le=null,we=null,ce=_,be=_=0,Oe=null,xe=D.next();ce!==null&&!xe.done;be++,xe=D.next()){ce.index>be?(Oe=ce,ce=null):Oe=ce.sibling;var Ni=P(A,ce,xe.value,z);if(Ni===null){ce===null&&(ce=Oe);break}e&&ce&&Ni.alternate===null&&n(A,ce),_=h(Ni,_,be),we===null?le=Ni:we.sibling=Ni,we=Ni,ce=Oe}if(xe.done)return s(A,ce),Ae&&Vn(A,be),le;if(ce===null){for(;!xe.done;be++,xe=D.next())xe=H(A,xe.value,z),xe!==null&&(_=h(xe,_,be),we===null?le=xe:we.sibling=xe,we=xe);return Ae&&Vn(A,be),le}for(ce=c(ce);!xe.done;be++,xe=D.next())xe=L(ce,A,be,xe.value,z),xe!==null&&(e&&xe.alternate!==null&&ce.delete(xe.key===null?be:xe.key),_=h(xe,_,be),we===null?le=xe:we.sibling=xe,we=xe);return e&&ce.forEach(function(JS){return n(A,JS)}),Ae&&Vn(A,be),le}function Ve(A,_,D,z){if(typeof D=="object"&&D!==null&&D.type===E&&D.key===null&&(D=D.props.children),typeof D=="object"&&D!==null){switch(D.$$typeof){case k:e:{for(var le=D.key;_!==null;){if(_.key===le){if(le=D.type,le===E){if(_.tag===7){s(A,_.sibling),z=d(_,D.props.children),z.return=A,A=z;break e}}else if(_.elementType===le||typeof le=="object"&&le!==null&&le.$$typeof===ae&&aa(le)===_.type){s(A,_.sibling),z=d(_,D.props),Is(z,D),z.return=A,A=z;break e}s(A,_);break}else n(A,_);_=_.sibling}D.type===E?(z=$i(D.props.children,A.mode,z,D.key),z.return=A,A=z):(z=Xr(D.type,D.key,D.props,null,A.mode,z),Is(z,D),z.return=A,A=z)}return y(A);case O:e:{for(le=D.key;_!==null;){if(_.key===le)if(_.tag===4&&_.stateNode.containerInfo===D.containerInfo&&_.stateNode.implementation===D.implementation){s(A,_.sibling),z=d(_,D.children||[]),z.return=A,A=z;break e}else{s(A,_);break}else n(A,_);_=_.sibling}z=ml(D,A.mode,z),z.return=A,A=z}return y(A);case ae:return D=aa(D),Ve(A,_,D,z)}if(ht(D))return re(A,_,D,z);if(ue(D)){if(le=ue(D),typeof le!="function")throw Error(a(150));return D=le.call(D),fe(A,_,D,z)}if(typeof D.then=="function")return Ve(A,_,io(D),z);if(D.$$typeof===Z)return Ve(A,_,$r(A,D),z);ao(A,D)}return typeof D=="string"&&D!==""||typeof D=="number"||typeof D=="bigint"?(D=""+D,_!==null&&_.tag===6?(s(A,_.sibling),z=d(_,D),z.return=A,A=z):(s(A,_),z=hl(D,A.mode,z),z.return=A,A=z),y(A)):s(A,_)}return function(A,_,D,z){try{Ls=0;var le=Ve(A,_,D,z);return ja=null,le}catch(ce){if(ce===Ia||ce===to)throw ce;var we=Xt(29,ce,null,A.mode);return we.lanes=z,we.return=A,we}finally{}}}var ra=Uh(!0),Lh=Uh(!1),gi=!1;function Rl(e){e.updateQueue={baseState:e.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,lanes:0,hiddenCallbacks:null},callbacks:null}}function Ol(e,n){e=e.updateQueue,n.updateQueue===e&&(n.updateQueue={baseState:e.baseState,firstBaseUpdate:e.firstBaseUpdate,lastBaseUpdate:e.lastBaseUpdate,shared:e.shared,callbacks:null})}function vi(e){return{lane:e,tag:0,payload:null,callback:null,next:null}}function yi(e,n,s){var c=e.updateQueue;if(c===null)return null;if(c=c.shared,(Ue&2)!==0){var d=c.pending;return d===null?n.next=n:(n.next=d.next,d.next=n),c.pending=n,n=Jr(e),bh(e,null,s),n}return Qr(e,c,n,s),Jr(e)}function js(e,n,s){if(n=n.updateQueue,n!==null&&(n=n.shared,(s&4194048)!==0)){var c=n.lanes;c&=e.pendingLanes,s|=c,n.lanes=s,Of(e,s)}}function Al(e,n){var s=e.updateQueue,c=e.alternate;if(c!==null&&(c=c.updateQueue,s===c)){var d=null,h=null;if(s=s.firstBaseUpdate,s!==null){do{var y={lane:s.lane,tag:s.tag,payload:s.payload,callback:null,next:null};h===null?d=h=y:h=h.next=y,s=s.next}while(s!==null);h===null?d=h=n:h=h.next=n}else d=h=n;s={baseState:c.baseState,firstBaseUpdate:d,lastBaseUpdate:h,shared:c.shared,callbacks:c.callbacks},e.updateQueue=s;return}e=s.lastBaseUpdate,e===null?s.firstBaseUpdate=n:e.next=n,s.lastBaseUpdate=n}var Dl=!1;function Bs(){if(Dl){var e=La;if(e!==null)throw e}}function zs(e,n,s,c){Dl=!1;var d=e.updateQueue;gi=!1;var h=d.firstBaseUpdate,y=d.lastBaseUpdate,b=d.shared.pending;if(b!==null){d.shared.pending=null;var C=b,w=C.next;C.next=null,y===null?h=w:y.next=w,y=C;var B=e.alternate;B!==null&&(B=B.updateQueue,b=B.lastBaseUpdate,b!==y&&(b===null?B.firstBaseUpdate=w:b.next=w,B.lastBaseUpdate=C))}if(h!==null){var H=d.baseState;y=0,B=w=C=null,b=h;do{var P=b.lane&-536870913,L=P!==b.lane;if(L?(Re&P)===P:(c&P)===P){P!==0&&P===Ua&&(Dl=!0),B!==null&&(B=B.next={lane:0,tag:b.tag,payload:b.payload,callback:null,next:null});e:{var re=e,fe=b;P=n;var Ve=s;switch(fe.tag){case 1:if(re=fe.payload,typeof re=="function"){H=re.call(Ve,H,P);break e}H=re;break e;case 3:re.flags=re.flags&-65537|128;case 0:if(re=fe.payload,P=typeof re=="function"?re.call(Ve,H,P):re,P==null)break e;H=v({},H,P);break e;case 2:gi=!0}}P=b.callback,P!==null&&(e.flags|=64,L&&(e.flags|=8192),L=d.callbacks,L===null?d.callbacks=[P]:L.push(P))}else L={lane:P,tag:b.tag,payload:b.payload,callback:b.callback,next:null},B===null?(w=B=L,C=H):B=B.next=L,y|=P;if(b=b.next,b===null){if(b=d.shared.pending,b===null)break;L=b,b=L.next,L.next=null,d.lastBaseUpdate=L,d.shared.pending=null}}while(!0);B===null&&(C=H),d.baseState=C,d.firstBaseUpdate=w,d.lastBaseUpdate=B,h===null&&(d.shared.lanes=0),ki|=y,e.lanes=y,e.memoizedState=H}}function Ih(e,n){if(typeof e!="function")throw Error(a(191,e));e.call(n)}function jh(e,n){var s=e.callbacks;if(s!==null)for(e.callbacks=null,e=0;e<s.length;e++)Ih(s[e],n)}var Ba=R(null),so=R(0);function Bh(e,n){e=$n,te(so,e),te(Ba,n),$n=e|n.baseLanes}function Ml(){te(so,$n),te(Ba,Ba.current)}function wl(){$n=so.current,V(Ba),V(so)}var Zt=R(null),dn=null;function bi(e){var n=e.alternate;te(at,at.current&1),te(Zt,e),dn===null&&(n===null||Ba.current!==null||n.memoizedState!==null)&&(dn=e)}function xl(e){te(at,at.current),te(Zt,e),dn===null&&(dn=e)}function zh(e){e.tag===22?(te(at,at.current),te(Zt,e),dn===null&&(dn=e)):Si()}function Si(){te(at,at.current),te(Zt,Zt.current)}function Wt(e){V(Zt),dn===e&&(dn=null),V(at)}var at=R(0);function ro(e){for(var n=e;n!==null;){if(n.tag===13){var s=n.memoizedState;if(s!==null&&(s=s.dehydrated,s===null||ju(s)||Bu(s)))return n}else if(n.tag===19&&(n.memoizedProps.revealOrder==="forwards"||n.memoizedProps.revealOrder==="backwards"||n.memoizedProps.revealOrder==="unstable_legacy-backwards"||n.memoizedProps.revealOrder==="together")){if((n.flags&128)!==0)return n}else if(n.child!==null){n.child.return=n,n=n.child;continue}if(n===e)break;for(;n.sibling===null;){if(n.return===null||n.return===e)return null;n=n.return}n.sibling.return=n.return,n=n.sibling}return null}var Gn=0,ve=null,ze=null,lt=null,oo=!1,za=!1,oa=!1,co=0,qs=0,qa=null,Bb=0;function We(){throw Error(a(321))}function Nl(e,n){if(n===null)return!1;for(var s=0;s<n.length&&s<e.length;s++)if(!Jt(e[s],n[s]))return!1;return!0}function Pl(e,n,s,c,d,h){return Gn=h,ve=n,n.memoizedState=null,n.updateQueue=null,n.lanes=0,I.H=e===null||e.memoizedState===null?km:Jl,oa=!1,h=s(c,d),oa=!1,za&&(h=Vh(n,s,c,d)),qh(e),h}function qh(e){I.H=Fs;var n=ze!==null&&ze.next!==null;if(Gn=0,lt=ze=ve=null,oo=!1,qs=0,qa=null,n)throw Error(a(300));e===null||ut||(e=e.dependencies,e!==null&&Wr(e)&&(ut=!0))}function Vh(e,n,s,c){ve=e;var d=0;do{if(za&&(qa=null),qs=0,za=!1,25<=d)throw Error(a(301));if(d+=1,lt=ze=null,e.updateQueue!=null){var h=e.updateQueue;h.lastEffect=null,h.events=null,h.stores=null,h.memoCache!=null&&(h.memoCache.index=0)}I.H=Em,h=n(s,c)}while(za);return h}function zb(){var e=I.H,n=e.useState()[0];return n=typeof n.then=="function"?Vs(n):n,e=e.useState()[0],(ze!==null?ze.memoizedState:null)!==e&&(ve.flags|=1024),n}function Ul(){var e=co!==0;return co=0,e}function Ll(e,n,s){n.updateQueue=e.updateQueue,n.flags&=-2053,e.lanes&=~s}function Il(e){if(oo){for(e=e.memoizedState;e!==null;){var n=e.queue;n!==null&&(n.pending=null),e=e.next}oo=!1}Gn=0,lt=ze=ve=null,za=!1,qs=co=0,qa=null}function Dt(){var e={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return lt===null?ve.memoizedState=lt=e:lt=lt.next=e,lt}function st(){if(ze===null){var e=ve.alternate;e=e!==null?e.memoizedState:null}else e=ze.next;var n=lt===null?ve.memoizedState:lt.next;if(n!==null)lt=n,ze=e;else{if(e===null)throw ve.alternate===null?Error(a(467)):Error(a(310));ze=e,e={memoizedState:ze.memoizedState,baseState:ze.baseState,baseQueue:ze.baseQueue,queue:ze.queue,next:null},lt===null?ve.memoizedState=lt=e:lt=lt.next=e}return lt}function lo(){return{lastEffect:null,events:null,stores:null,memoCache:null}}function Vs(e){var n=qs;return qs+=1,qa===null&&(qa=[]),e=xh(qa,e,n),n=ve,(lt===null?n.memoizedState:lt.next)===null&&(n=n.alternate,I.H=n===null||n.memoizedState===null?km:Jl),e}function uo(e){if(e!==null&&typeof e=="object"){if(typeof e.then=="function")return Vs(e);if(e.$$typeof===Z)return Ct(e)}throw Error(a(438,String(e)))}function jl(e){var n=null,s=ve.updateQueue;if(s!==null&&(n=s.memoCache),n==null){var c=ve.alternate;c!==null&&(c=c.updateQueue,c!==null&&(c=c.memoCache,c!=null&&(n={data:c.data.map(function(d){return d.slice()}),index:0})))}if(n==null&&(n={data:[],index:0}),s===null&&(s=lo(),ve.updateQueue=s),s.memoCache=n,s=n.data[n.index],s===void 0)for(s=n.data[n.index]=Array(e),c=0;c<e;c++)s[c]=ie;return n.index++,s}function Kn(e,n){return typeof n=="function"?n(e):n}function fo(e){var n=st();return Bl(n,ze,e)}function Bl(e,n,s){var c=e.queue;if(c===null)throw Error(a(311));c.lastRenderedReducer=s;var d=e.baseQueue,h=c.pending;if(h!==null){if(d!==null){var y=d.next;d.next=h.next,h.next=y}n.baseQueue=d=h,c.pending=null}if(h=e.baseState,d===null)e.memoizedState=h;else{n=d.next;var b=y=null,C=null,w=n,B=!1;do{var H=w.lane&-536870913;if(H!==w.lane?(Re&H)===H:(Gn&H)===H){var P=w.revertLane;if(P===0)C!==null&&(C=C.next={lane:0,revertLane:0,gesture:null,action:w.action,hasEagerState:w.hasEagerState,eagerState:w.eagerState,next:null}),H===Ua&&(B=!0);else if((Gn&P)===P){w=w.next,P===Ua&&(B=!0);continue}else H={lane:0,revertLane:w.revertLane,gesture:null,action:w.action,hasEagerState:w.hasEagerState,eagerState:w.eagerState,next:null},C===null?(b=C=H,y=h):C=C.next=H,ve.lanes|=P,ki|=P;H=w.action,oa&&s(h,H),h=w.hasEagerState?w.eagerState:s(h,H)}else P={lane:H,revertLane:w.revertLane,gesture:w.gesture,action:w.action,hasEagerState:w.hasEagerState,eagerState:w.eagerState,next:null},C===null?(b=C=P,y=h):C=C.next=P,ve.lanes|=H,ki|=H;w=w.next}while(w!==null&&w!==n);if(C===null?y=h:C.next=b,!Jt(h,e.memoizedState)&&(ut=!0,B&&(s=La,s!==null)))throw s;e.memoizedState=h,e.baseState=y,e.baseQueue=C,c.lastRenderedState=h}return d===null&&(c.lanes=0),[e.memoizedState,c.dispatch]}function zl(e){var n=st(),s=n.queue;if(s===null)throw Error(a(311));s.lastRenderedReducer=e;var c=s.dispatch,d=s.pending,h=n.memoizedState;if(d!==null){s.pending=null;var y=d=d.next;do h=e(h,y.action),y=y.next;while(y!==d);Jt(h,n.memoizedState)||(ut=!0),n.memoizedState=h,n.baseQueue===null&&(n.baseState=h),s.lastRenderedState=h}return[h,c]}function Hh(e,n,s){var c=ve,d=st(),h=Ae;if(h){if(s===void 0)throw Error(a(407));s=s()}else s=n();var y=!Jt((ze||d).memoizedState,s);if(y&&(d.memoizedState=s,ut=!0),d=d.queue,Hl(Kh.bind(null,c,d,e),[e]),d.getSnapshot!==n||y||lt!==null&&lt.memoizedState.tag&1){if(c.flags|=2048,Va(9,{destroy:void 0},Gh.bind(null,c,d,s,n),null),Fe===null)throw Error(a(349));h||(Gn&127)!==0||Fh(c,n,s)}return s}function Fh(e,n,s){e.flags|=16384,e={getSnapshot:n,value:s},n=ve.updateQueue,n===null?(n=lo(),ve.updateQueue=n,n.stores=[e]):(s=n.stores,s===null?n.stores=[e]:s.push(e))}function Gh(e,n,s,c){n.value=s,n.getSnapshot=c,Yh(n)&&Qh(e)}function Kh(e,n,s){return s(function(){Yh(n)&&Qh(e)})}function Yh(e){var n=e.getSnapshot;e=e.value;try{var s=n();return!Jt(e,s)}catch{return!0}}function Qh(e){var n=Wi(e,2);n!==null&&qt(n,e,2)}function ql(e){var n=Dt();if(typeof e=="function"){var s=e;if(e=s(),oa){li(!0);try{s()}finally{li(!1)}}}return n.memoizedState=n.baseState=e,n.queue={pending:null,lanes:0,dispatch:null,lastRenderedReducer:Kn,lastRenderedState:e},n}function Jh(e,n,s,c){return e.baseState=s,Bl(e,ze,typeof c=="function"?c:Kn)}function qb(e,n,s,c,d){if(po(e))throw Error(a(485));if(e=n.action,e!==null){var h={payload:d,action:e,next:null,isTransition:!0,status:"pending",value:null,reason:null,listeners:[],then:function(y){h.listeners.push(y)}};I.T!==null?s(!0):h.isTransition=!1,c(h),s=n.pending,s===null?(h.next=n.pending=h,Xh(n,h)):(h.next=s.next,n.pending=s.next=h)}}function Xh(e,n){var s=n.action,c=n.payload,d=e.state;if(n.isTransition){var h=I.T,y={};I.T=y;try{var b=s(d,c),C=I.S;C!==null&&C(y,b),Zh(e,n,b)}catch(w){Vl(e,n,w)}finally{h!==null&&y.types!==null&&(h.types=y.types),I.T=h}}else try{h=s(d,c),Zh(e,n,h)}catch(w){Vl(e,n,w)}}function Zh(e,n,s){s!==null&&typeof s=="object"&&typeof s.then=="function"?s.then(function(c){Wh(e,n,c)},function(c){return Vl(e,n,c)}):Wh(e,n,s)}function Wh(e,n,s){n.status="fulfilled",n.value=s,$h(n),e.state=s,n=e.pending,n!==null&&(s=n.next,s===n?e.pending=null:(s=s.next,n.next=s,Xh(e,s)))}function Vl(e,n,s){var c=e.pending;if(e.pending=null,c!==null){c=c.next;do n.status="rejected",n.reason=s,$h(n),n=n.next;while(n!==c)}e.action=null}function $h(e){e=e.listeners;for(var n=0;n<e.length;n++)(0,e[n])()}function em(e,n){return n}function tm(e,n){if(Ae){var s=Fe.formState;if(s!==null){e:{var c=ve;if(Ae){if(Ye){t:{for(var d=Ye,h=un;d.nodeType!==8;){if(!h){d=null;break t}if(d=fn(d.nextSibling),d===null){d=null;break t}}h=d.data,d=h==="F!"||h==="F"?d:null}if(d){Ye=fn(d.nextSibling),c=d.data==="F!";break e}}mi(c)}c=!1}c&&(n=s[0])}}return s=Dt(),s.memoizedState=s.baseState=n,c={pending:null,lanes:0,dispatch:null,lastRenderedReducer:em,lastRenderedState:n},s.queue=c,s=Sm.bind(null,ve,c),c.dispatch=s,c=ql(!1),h=Ql.bind(null,ve,!1,c.queue),c=Dt(),d={state:n,dispatch:null,action:e,pending:null},c.queue=d,s=qb.bind(null,ve,d,h,s),d.dispatch=s,c.memoizedState=e,[n,s,!1]}function nm(e){var n=st();return im(n,ze,e)}function im(e,n,s){if(n=Bl(e,n,em)[0],e=fo(Kn)[0],typeof n=="object"&&n!==null&&typeof n.then=="function")try{var c=Vs(n)}catch(y){throw y===Ia?to:y}else c=n;n=st();var d=n.queue,h=d.dispatch;return s!==n.memoizedState&&(ve.flags|=2048,Va(9,{destroy:void 0},Vb.bind(null,d,s),null)),[c,h,e]}function Vb(e,n){e.action=n}function am(e){var n=st(),s=ze;if(s!==null)return im(n,s,e);st(),n=n.memoizedState,s=st();var c=s.queue.dispatch;return s.memoizedState=e,[n,c,!1]}function Va(e,n,s,c){return e={tag:e,create:s,deps:c,inst:n,next:null},n=ve.updateQueue,n===null&&(n=lo(),ve.updateQueue=n),s=n.lastEffect,s===null?n.lastEffect=e.next=e:(c=s.next,s.next=e,e.next=c,n.lastEffect=e),e}function sm(){return st().memoizedState}function ho(e,n,s,c){var d=Dt();ve.flags|=e,d.memoizedState=Va(1|n,{destroy:void 0},s,c===void 0?null:c)}function mo(e,n,s,c){var d=st();c=c===void 0?null:c;var h=d.memoizedState.inst;ze!==null&&c!==null&&Nl(c,ze.memoizedState.deps)?d.memoizedState=Va(n,h,s,c):(ve.flags|=e,d.memoizedState=Va(1|n,h,s,c))}function rm(e,n){ho(8390656,8,e,n)}function Hl(e,n){mo(2048,8,e,n)}function Hb(e){ve.flags|=4;var n=ve.updateQueue;if(n===null)n=lo(),ve.updateQueue=n,n.events=[e];else{var s=n.events;s===null?n.events=[e]:s.push(e)}}function om(e){var n=st().memoizedState;return Hb({ref:n,nextImpl:e}),function(){if((Ue&2)!==0)throw Error(a(440));return n.impl.apply(void 0,arguments)}}function cm(e,n){return mo(4,2,e,n)}function lm(e,n){return mo(4,4,e,n)}function um(e,n){if(typeof n=="function"){e=e();var s=n(e);return function(){typeof s=="function"?s():n(null)}}if(n!=null)return e=e(),n.current=e,function(){n.current=null}}function dm(e,n,s){s=s!=null?s.concat([e]):null,mo(4,4,um.bind(null,n,e),s)}function Fl(){}function fm(e,n){var s=st();n=n===void 0?null:n;var c=s.memoizedState;return n!==null&&Nl(n,c[1])?c[0]:(s.memoizedState=[e,n],e)}function hm(e,n){var s=st();n=n===void 0?null:n;var c=s.memoizedState;if(n!==null&&Nl(n,c[1]))return c[0];if(c=e(),oa){li(!0);try{e()}finally{li(!1)}}return s.memoizedState=[c,n],c}function Gl(e,n,s){return s===void 0||(Gn&1073741824)!==0&&(Re&261930)===0?e.memoizedState=n:(e.memoizedState=s,e=mp(),ve.lanes|=e,ki|=e,s)}function mm(e,n,s,c){return Jt(s,n)?s:Ba.current!==null?(e=Gl(e,s,c),Jt(e,n)||(ut=!0),e):(Gn&42)===0||(Gn&1073741824)!==0&&(Re&261930)===0?(ut=!0,e.memoizedState=s):(e=mp(),ve.lanes|=e,ki|=e,n)}function pm(e,n,s,c,d){var h=W.p;W.p=h!==0&&8>h?h:8;var y=I.T,b={};I.T=b,Ql(e,!1,n,s);try{var C=d(),w=I.S;if(w!==null&&w(b,C),C!==null&&typeof C=="object"&&typeof C.then=="function"){var B=jb(C,c);Hs(e,n,B,tn(e))}else Hs(e,n,c,tn(e))}catch(H){Hs(e,n,{then:function(){},status:"rejected",reason:H},tn())}finally{W.p=h,y!==null&&b.types!==null&&(y.types=b.types),I.T=y}}function Fb(){}function Kl(e,n,s,c){if(e.tag!==5)throw Error(a(476));var d=gm(e).queue;pm(e,d,n,de,s===null?Fb:function(){return vm(e),s(c)})}function gm(e){var n=e.memoizedState;if(n!==null)return n;n={memoizedState:de,baseState:de,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:Kn,lastRenderedState:de},next:null};var s={};return n.next={memoizedState:s,baseState:s,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:Kn,lastRenderedState:s},next:null},e.memoizedState=n,e=e.alternate,e!==null&&(e.memoizedState=n),n}function vm(e){var n=gm(e);n.next===null&&(n=e.alternate.memoizedState),Hs(e,n.next.queue,{},tn())}function Yl(){return Ct(rr)}function ym(){return st().memoizedState}function bm(){return st().memoizedState}function Gb(e){for(var n=e.return;n!==null;){switch(n.tag){case 24:case 3:var s=tn();e=vi(s);var c=yi(n,e,s);c!==null&&(qt(c,n,s),js(c,n,s)),n={cache:Cl()},e.payload=n;return}n=n.return}}function Kb(e,n,s){var c=tn();s={lane:c,revertLane:0,gesture:null,action:s,hasEagerState:!1,eagerState:null,next:null},po(e)?Tm(n,s):(s=dl(e,n,s,c),s!==null&&(qt(s,e,c),Cm(s,n,c)))}function Sm(e,n,s){var c=tn();Hs(e,n,s,c)}function Hs(e,n,s,c){var d={lane:c,revertLane:0,gesture:null,action:s,hasEagerState:!1,eagerState:null,next:null};if(po(e))Tm(n,d);else{var h=e.alternate;if(e.lanes===0&&(h===null||h.lanes===0)&&(h=n.lastRenderedReducer,h!==null))try{var y=n.lastRenderedState,b=h(y,s);if(d.hasEagerState=!0,d.eagerState=b,Jt(b,y))return Qr(e,n,d,0),Fe===null&&Yr(),!1}catch{}finally{}if(s=dl(e,n,d,c),s!==null)return qt(s,e,c),Cm(s,n,c),!0}return!1}function Ql(e,n,s,c){if(c={lane:2,revertLane:Ru(),gesture:null,action:c,hasEagerState:!1,eagerState:null,next:null},po(e)){if(n)throw Error(a(479))}else n=dl(e,s,c,2),n!==null&&qt(n,e,2)}function po(e){var n=e.alternate;return e===ve||n!==null&&n===ve}function Tm(e,n){za=oo=!0;var s=e.pending;s===null?n.next=n:(n.next=s.next,s.next=n),e.pending=n}function Cm(e,n,s){if((s&4194048)!==0){var c=n.lanes;c&=e.pendingLanes,s|=c,n.lanes=s,Of(e,s)}}var Fs={readContext:Ct,use:uo,useCallback:We,useContext:We,useEffect:We,useImperativeHandle:We,useLayoutEffect:We,useInsertionEffect:We,useMemo:We,useReducer:We,useRef:We,useState:We,useDebugValue:We,useDeferredValue:We,useTransition:We,useSyncExternalStore:We,useId:We,useHostTransitionStatus:We,useFormState:We,useActionState:We,useOptimistic:We,useMemoCache:We,useCacheRefresh:We};Fs.useEffectEvent=We;var km={readContext:Ct,use:uo,useCallback:function(e,n){return Dt().memoizedState=[e,n===void 0?null:n],e},useContext:Ct,useEffect:rm,useImperativeHandle:function(e,n,s){s=s!=null?s.concat([e]):null,ho(4194308,4,um.bind(null,n,e),s)},useLayoutEffect:function(e,n){return ho(4194308,4,e,n)},useInsertionEffect:function(e,n){ho(4,2,e,n)},useMemo:function(e,n){var s=Dt();n=n===void 0?null:n;var c=e();if(oa){li(!0);try{e()}finally{li(!1)}}return s.memoizedState=[c,n],c},useReducer:function(e,n,s){var c=Dt();if(s!==void 0){var d=s(n);if(oa){li(!0);try{s(n)}finally{li(!1)}}}else d=n;return c.memoizedState=c.baseState=d,e={pending:null,lanes:0,dispatch:null,lastRenderedReducer:e,lastRenderedState:d},c.queue=e,e=e.dispatch=Kb.bind(null,ve,e),[c.memoizedState,e]},useRef:function(e){var n=Dt();return e={current:e},n.memoizedState=e},useState:function(e){e=ql(e);var n=e.queue,s=Sm.bind(null,ve,n);return n.dispatch=s,[e.memoizedState,s]},useDebugValue:Fl,useDeferredValue:function(e,n){var s=Dt();return Gl(s,e,n)},useTransition:function(){var e=ql(!1);return e=pm.bind(null,ve,e.queue,!0,!1),Dt().memoizedState=e,[!1,e]},useSyncExternalStore:function(e,n,s){var c=ve,d=Dt();if(Ae){if(s===void 0)throw Error(a(407));s=s()}else{if(s=n(),Fe===null)throw Error(a(349));(Re&127)!==0||Fh(c,n,s)}d.memoizedState=s;var h={value:s,getSnapshot:n};return d.queue=h,rm(Kh.bind(null,c,h,e),[e]),c.flags|=2048,Va(9,{destroy:void 0},Gh.bind(null,c,h,s,n),null),s},useId:function(){var e=Dt(),n=Fe.identifierPrefix;if(Ae){var s=An,c=On;s=(c&~(1<<32-Qt(c)-1)).toString(32)+s,n="_"+n+"R_"+s,s=co++,0<s&&(n+="H"+s.toString(32)),n+="_"}else s=Bb++,n="_"+n+"r_"+s.toString(32)+"_";return e.memoizedState=n},useHostTransitionStatus:Yl,useFormState:tm,useActionState:tm,useOptimistic:function(e){var n=Dt();n.memoizedState=n.baseState=e;var s={pending:null,lanes:0,dispatch:null,lastRenderedReducer:null,lastRenderedState:null};return n.queue=s,n=Ql.bind(null,ve,!0,s),s.dispatch=n,[e,n]},useMemoCache:jl,useCacheRefresh:function(){return Dt().memoizedState=Gb.bind(null,ve)},useEffectEvent:function(e){var n=Dt(),s={impl:e};return n.memoizedState=s,function(){if((Ue&2)!==0)throw Error(a(440));return s.impl.apply(void 0,arguments)}}},Jl={readContext:Ct,use:uo,useCallback:fm,useContext:Ct,useEffect:Hl,useImperativeHandle:dm,useInsertionEffect:cm,useLayoutEffect:lm,useMemo:hm,useReducer:fo,useRef:sm,useState:function(){return fo(Kn)},useDebugValue:Fl,useDeferredValue:function(e,n){var s=st();return mm(s,ze.memoizedState,e,n)},useTransition:function(){var e=fo(Kn)[0],n=st().memoizedState;return[typeof e=="boolean"?e:Vs(e),n]},useSyncExternalStore:Hh,useId:ym,useHostTransitionStatus:Yl,useFormState:nm,useActionState:nm,useOptimistic:function(e,n){var s=st();return Jh(s,ze,e,n)},useMemoCache:jl,useCacheRefresh:bm};Jl.useEffectEvent=om;var Em={readContext:Ct,use:uo,useCallback:fm,useContext:Ct,useEffect:Hl,useImperativeHandle:dm,useInsertionEffect:cm,useLayoutEffect:lm,useMemo:hm,useReducer:zl,useRef:sm,useState:function(){return zl(Kn)},useDebugValue:Fl,useDeferredValue:function(e,n){var s=st();return ze===null?Gl(s,e,n):mm(s,ze.memoizedState,e,n)},useTransition:function(){var e=zl(Kn)[0],n=st().memoizedState;return[typeof e=="boolean"?e:Vs(e),n]},useSyncExternalStore:Hh,useId:ym,useHostTransitionStatus:Yl,useFormState:am,useActionState:am,useOptimistic:function(e,n){var s=st();return ze!==null?Jh(s,ze,e,n):(s.baseState=e,[e,s.queue.dispatch])},useMemoCache:jl,useCacheRefresh:bm};Em.useEffectEvent=om;function Xl(e,n,s,c){n=e.memoizedState,s=s(c,n),s=s==null?n:v({},n,s),e.memoizedState=s,e.lanes===0&&(e.updateQueue.baseState=s)}var Zl={enqueueSetState:function(e,n,s){e=e._reactInternals;var c=tn(),d=vi(c);d.payload=n,s!=null&&(d.callback=s),n=yi(e,d,c),n!==null&&(qt(n,e,c),js(n,e,c))},enqueueReplaceState:function(e,n,s){e=e._reactInternals;var c=tn(),d=vi(c);d.tag=1,d.payload=n,s!=null&&(d.callback=s),n=yi(e,d,c),n!==null&&(qt(n,e,c),js(n,e,c))},enqueueForceUpdate:function(e,n){e=e._reactInternals;var s=tn(),c=vi(s);c.tag=2,n!=null&&(c.callback=n),n=yi(e,c,s),n!==null&&(qt(n,e,s),js(n,e,s))}};function _m(e,n,s,c,d,h,y){return e=e.stateNode,typeof e.shouldComponentUpdate=="function"?e.shouldComponentUpdate(c,h,y):n.prototype&&n.prototype.isPureReactComponent?!Ms(s,c)||!Ms(d,h):!0}function Rm(e,n,s,c){e=n.state,typeof n.componentWillReceiveProps=="function"&&n.componentWillReceiveProps(s,c),typeof n.UNSAFE_componentWillReceiveProps=="function"&&n.UNSAFE_componentWillReceiveProps(s,c),n.state!==e&&Zl.enqueueReplaceState(n,n.state,null)}function ca(e,n){var s=n;if("ref"in n){s={};for(var c in n)c!=="ref"&&(s[c]=n[c])}if(e=e.defaultProps){s===n&&(s=v({},s));for(var d in e)s[d]===void 0&&(s[d]=e[d])}return s}function Om(e){Kr(e)}function Am(e){console.error(e)}function Dm(e){Kr(e)}function go(e,n){try{var s=e.onUncaughtError;s(n.value,{componentStack:n.stack})}catch(c){setTimeout(function(){throw c})}}function Mm(e,n,s){try{var c=e.onCaughtError;c(s.value,{componentStack:s.stack,errorBoundary:n.tag===1?n.stateNode:null})}catch(d){setTimeout(function(){throw d})}}function Wl(e,n,s){return s=vi(s),s.tag=3,s.payload={element:null},s.callback=function(){go(e,n)},s}function wm(e){return e=vi(e),e.tag=3,e}function xm(e,n,s,c){var d=s.type.getDerivedStateFromError;if(typeof d=="function"){var h=c.value;e.payload=function(){return d(h)},e.callback=function(){Mm(n,s,c)}}var y=s.stateNode;y!==null&&typeof y.componentDidCatch=="function"&&(e.callback=function(){Mm(n,s,c),typeof d!="function"&&(Ei===null?Ei=new Set([this]):Ei.add(this));var b=c.stack;this.componentDidCatch(c.value,{componentStack:b!==null?b:""})})}function Yb(e,n,s,c,d){if(s.flags|=32768,c!==null&&typeof c=="object"&&typeof c.then=="function"){if(n=s.alternate,n!==null&&Pa(n,s,d,!0),s=Zt.current,s!==null){switch(s.tag){case 31:case 13:return dn===null?Ao():s.alternate===null&&$e===0&&($e=3),s.flags&=-257,s.flags|=65536,s.lanes=d,c===no?s.flags|=16384:(n=s.updateQueue,n===null?s.updateQueue=new Set([c]):n.add(c),ku(e,c,d)),!1;case 22:return s.flags|=65536,c===no?s.flags|=16384:(n=s.updateQueue,n===null?(n={transitions:null,markerInstances:null,retryQueue:new Set([c])},s.updateQueue=n):(s=n.retryQueue,s===null?n.retryQueue=new Set([c]):s.add(c)),ku(e,c,d)),!1}throw Error(a(435,s.tag))}return ku(e,c,d),Ao(),!1}if(Ae)return n=Zt.current,n!==null?((n.flags&65536)===0&&(n.flags|=256),n.flags|=65536,n.lanes=d,c!==vl&&(e=Error(a(422),{cause:c}),Ns(on(e,s)))):(c!==vl&&(n=Error(a(423),{cause:c}),Ns(on(n,s))),e=e.current.alternate,e.flags|=65536,d&=-d,e.lanes|=d,c=on(c,s),d=Wl(e.stateNode,c,d),Al(e,d),$e!==4&&($e=2)),!1;var h=Error(a(520),{cause:c});if(h=on(h,s),Ws===null?Ws=[h]:Ws.push(h),$e!==4&&($e=2),n===null)return!0;c=on(c,s),s=n;do{switch(s.tag){case 3:return s.flags|=65536,e=d&-d,s.lanes|=e,e=Wl(s.stateNode,c,e),Al(s,e),!1;case 1:if(n=s.type,h=s.stateNode,(s.flags&128)===0&&(typeof n.getDerivedStateFromError=="function"||h!==null&&typeof h.componentDidCatch=="function"&&(Ei===null||!Ei.has(h))))return s.flags|=65536,d&=-d,s.lanes|=d,d=wm(d),xm(d,e,s,c),Al(s,d),!1}s=s.return}while(s!==null);return!1}var $l=Error(a(461)),ut=!1;function kt(e,n,s,c){n.child=e===null?Lh(n,null,s,c):ra(n,e.child,s,c)}function Nm(e,n,s,c,d){s=s.render;var h=n.ref;if("ref"in c){var y={};for(var b in c)b!=="ref"&&(y[b]=c[b])}else y=c;return na(n),c=Pl(e,n,s,y,h,d),b=Ul(),e!==null&&!ut?(Ll(e,n,d),Yn(e,n,d)):(Ae&&b&&pl(n),n.flags|=1,kt(e,n,c,d),n.child)}function Pm(e,n,s,c,d){if(e===null){var h=s.type;return typeof h=="function"&&!fl(h)&&h.defaultProps===void 0&&s.compare===null?(n.tag=15,n.type=h,Um(e,n,h,c,d)):(e=Xr(s.type,null,c,n,n.mode,d),e.ref=n.ref,e.return=n,n.child=e)}if(h=e.child,!ou(e,d)){var y=h.memoizedProps;if(s=s.compare,s=s!==null?s:Ms,s(y,c)&&e.ref===n.ref)return Yn(e,n,d)}return n.flags|=1,e=qn(h,c),e.ref=n.ref,e.return=n,n.child=e}function Um(e,n,s,c,d){if(e!==null){var h=e.memoizedProps;if(Ms(h,c)&&e.ref===n.ref)if(ut=!1,n.pendingProps=c=h,ou(e,d))(e.flags&131072)!==0&&(ut=!0);else return n.lanes=e.lanes,Yn(e,n,d)}return eu(e,n,s,c,d)}function Lm(e,n,s,c){var d=c.children,h=e!==null?e.memoizedState:null;if(e===null&&n.stateNode===null&&(n.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),c.mode==="hidden"){if((n.flags&128)!==0){if(h=h!==null?h.baseLanes|s:s,e!==null){for(c=n.child=e.child,d=0;c!==null;)d=d|c.lanes|c.childLanes,c=c.sibling;c=d&~h}else c=0,n.child=null;return Im(e,n,h,s,c)}if((s&536870912)!==0)n.memoizedState={baseLanes:0,cachePool:null},e!==null&&eo(n,h!==null?h.cachePool:null),h!==null?Bh(n,h):Ml(),zh(n);else return c=n.lanes=536870912,Im(e,n,h!==null?h.baseLanes|s:s,s,c)}else h!==null?(eo(n,h.cachePool),Bh(n,h),Si(),n.memoizedState=null):(e!==null&&eo(n,null),Ml(),Si());return kt(e,n,d,s),n.child}function Gs(e,n){return e!==null&&e.tag===22||n.stateNode!==null||(n.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),n.sibling}function Im(e,n,s,c,d){var h=El();return h=h===null?null:{parent:ct._currentValue,pool:h},n.memoizedState={baseLanes:s,cachePool:h},e!==null&&eo(n,null),Ml(),zh(n),e!==null&&Pa(e,n,c,!0),n.childLanes=d,null}function vo(e,n){return n=bo({mode:n.mode,children:n.children},e.mode),n.ref=e.ref,e.child=n,n.return=e,n}function jm(e,n,s){return ra(n,e.child,null,s),e=vo(n,n.pendingProps),e.flags|=2,Wt(n),n.memoizedState=null,e}function Qb(e,n,s){var c=n.pendingProps,d=(n.flags&128)!==0;if(n.flags&=-129,e===null){if(Ae){if(c.mode==="hidden")return e=vo(n,c),n.lanes=536870912,Gs(null,e);if(xl(n),(e=Ye)?(e=Xp(e,un),e=e!==null&&e.data==="&"?e:null,e!==null&&(n.memoizedState={dehydrated:e,treeContext:fi!==null?{id:On,overflow:An}:null,retryLane:536870912,hydrationErrors:null},s=Th(e),s.return=n,n.child=s,Tt=n,Ye=null)):e=null,e===null)throw mi(n);return n.lanes=536870912,null}return vo(n,c)}var h=e.memoizedState;if(h!==null){var y=h.dehydrated;if(xl(n),d)if(n.flags&256)n.flags&=-257,n=jm(e,n,s);else if(n.memoizedState!==null)n.child=e.child,n.flags|=128,n=null;else throw Error(a(558));else if(ut||Pa(e,n,s,!1),d=(s&e.childLanes)!==0,ut||d){if(c=Fe,c!==null&&(y=Af(c,s),y!==0&&y!==h.retryLane))throw h.retryLane=y,Wi(e,y),qt(c,e,y),$l;Ao(),n=jm(e,n,s)}else e=h.treeContext,Ye=fn(y.nextSibling),Tt=n,Ae=!0,hi=null,un=!1,e!==null&&Eh(n,e),n=vo(n,c),n.flags|=4096;return n}return e=qn(e.child,{mode:c.mode,children:c.children}),e.ref=n.ref,n.child=e,e.return=n,e}function yo(e,n){var s=n.ref;if(s===null)e!==null&&e.ref!==null&&(n.flags|=4194816);else{if(typeof s!="function"&&typeof s!="object")throw Error(a(284));(e===null||e.ref!==s)&&(n.flags|=4194816)}}function eu(e,n,s,c,d){return na(n),s=Pl(e,n,s,c,void 0,d),c=Ul(),e!==null&&!ut?(Ll(e,n,d),Yn(e,n,d)):(Ae&&c&&pl(n),n.flags|=1,kt(e,n,s,d),n.child)}function Bm(e,n,s,c,d,h){return na(n),n.updateQueue=null,s=Vh(n,c,s,d),qh(e),c=Ul(),e!==null&&!ut?(Ll(e,n,h),Yn(e,n,h)):(Ae&&c&&pl(n),n.flags|=1,kt(e,n,s,h),n.child)}function zm(e,n,s,c,d){if(na(n),n.stateNode===null){var h=Ma,y=s.contextType;typeof y=="object"&&y!==null&&(h=Ct(y)),h=new s(c,h),n.memoizedState=h.state!==null&&h.state!==void 0?h.state:null,h.updater=Zl,n.stateNode=h,h._reactInternals=n,h=n.stateNode,h.props=c,h.state=n.memoizedState,h.refs={},Rl(n),y=s.contextType,h.context=typeof y=="object"&&y!==null?Ct(y):Ma,h.state=n.memoizedState,y=s.getDerivedStateFromProps,typeof y=="function"&&(Xl(n,s,y,c),h.state=n.memoizedState),typeof s.getDerivedStateFromProps=="function"||typeof h.getSnapshotBeforeUpdate=="function"||typeof h.UNSAFE_componentWillMount!="function"&&typeof h.componentWillMount!="function"||(y=h.state,typeof h.componentWillMount=="function"&&h.componentWillMount(),typeof h.UNSAFE_componentWillMount=="function"&&h.UNSAFE_componentWillMount(),y!==h.state&&Zl.enqueueReplaceState(h,h.state,null),zs(n,c,h,d),Bs(),h.state=n.memoizedState),typeof h.componentDidMount=="function"&&(n.flags|=4194308),c=!0}else if(e===null){h=n.stateNode;var b=n.memoizedProps,C=ca(s,b);h.props=C;var w=h.context,B=s.contextType;y=Ma,typeof B=="object"&&B!==null&&(y=Ct(B));var H=s.getDerivedStateFromProps;B=typeof H=="function"||typeof h.getSnapshotBeforeUpdate=="function",b=n.pendingProps!==b,B||typeof h.UNSAFE_componentWillReceiveProps!="function"&&typeof h.componentWillReceiveProps!="function"||(b||w!==y)&&Rm(n,h,c,y),gi=!1;var P=n.memoizedState;h.state=P,zs(n,c,h,d),Bs(),w=n.memoizedState,b||P!==w||gi?(typeof H=="function"&&(Xl(n,s,H,c),w=n.memoizedState),(C=gi||_m(n,s,C,c,P,w,y))?(B||typeof h.UNSAFE_componentWillMount!="function"&&typeof h.componentWillMount!="function"||(typeof h.componentWillMount=="function"&&h.componentWillMount(),typeof h.UNSAFE_componentWillMount=="function"&&h.UNSAFE_componentWillMount()),typeof h.componentDidMount=="function"&&(n.flags|=4194308)):(typeof h.componentDidMount=="function"&&(n.flags|=4194308),n.memoizedProps=c,n.memoizedState=w),h.props=c,h.state=w,h.context=y,c=C):(typeof h.componentDidMount=="function"&&(n.flags|=4194308),c=!1)}else{h=n.stateNode,Ol(e,n),y=n.memoizedProps,B=ca(s,y),h.props=B,H=n.pendingProps,P=h.context,w=s.contextType,C=Ma,typeof w=="object"&&w!==null&&(C=Ct(w)),b=s.getDerivedStateFromProps,(w=typeof b=="function"||typeof h.getSnapshotBeforeUpdate=="function")||typeof h.UNSAFE_componentWillReceiveProps!="function"&&typeof h.componentWillReceiveProps!="function"||(y!==H||P!==C)&&Rm(n,h,c,C),gi=!1,P=n.memoizedState,h.state=P,zs(n,c,h,d),Bs();var L=n.memoizedState;y!==H||P!==L||gi||e!==null&&e.dependencies!==null&&Wr(e.dependencies)?(typeof b=="function"&&(Xl(n,s,b,c),L=n.memoizedState),(B=gi||_m(n,s,B,c,P,L,C)||e!==null&&e.dependencies!==null&&Wr(e.dependencies))?(w||typeof h.UNSAFE_componentWillUpdate!="function"&&typeof h.componentWillUpdate!="function"||(typeof h.componentWillUpdate=="function"&&h.componentWillUpdate(c,L,C),typeof h.UNSAFE_componentWillUpdate=="function"&&h.UNSAFE_componentWillUpdate(c,L,C)),typeof h.componentDidUpdate=="function"&&(n.flags|=4),typeof h.getSnapshotBeforeUpdate=="function"&&(n.flags|=1024)):(typeof h.componentDidUpdate!="function"||y===e.memoizedProps&&P===e.memoizedState||(n.flags|=4),typeof h.getSnapshotBeforeUpdate!="function"||y===e.memoizedProps&&P===e.memoizedState||(n.flags|=1024),n.memoizedProps=c,n.memoizedState=L),h.props=c,h.state=L,h.context=C,c=B):(typeof h.componentDidUpdate!="function"||y===e.memoizedProps&&P===e.memoizedState||(n.flags|=4),typeof h.getSnapshotBeforeUpdate!="function"||y===e.memoizedProps&&P===e.memoizedState||(n.flags|=1024),c=!1)}return h=c,yo(e,n),c=(n.flags&128)!==0,h||c?(h=n.stateNode,s=c&&typeof s.getDerivedStateFromError!="function"?null:h.render(),n.flags|=1,e!==null&&c?(n.child=ra(n,e.child,null,d),n.child=ra(n,null,s,d)):kt(e,n,s,d),n.memoizedState=h.state,e=n.child):e=Yn(e,n,d),e}function qm(e,n,s,c){return ea(),n.flags|=256,kt(e,n,s,c),n.child}var tu={dehydrated:null,treeContext:null,retryLane:0,hydrationErrors:null};function nu(e){return{baseLanes:e,cachePool:Mh()}}function iu(e,n,s){return e=e!==null?e.childLanes&~s:0,n&&(e|=en),e}function Vm(e,n,s){var c=n.pendingProps,d=!1,h=(n.flags&128)!==0,y;if((y=h)||(y=e!==null&&e.memoizedState===null?!1:(at.current&2)!==0),y&&(d=!0,n.flags&=-129),y=(n.flags&32)!==0,n.flags&=-33,e===null){if(Ae){if(d?bi(n):Si(),(e=Ye)?(e=Xp(e,un),e=e!==null&&e.data!=="&"?e:null,e!==null&&(n.memoizedState={dehydrated:e,treeContext:fi!==null?{id:On,overflow:An}:null,retryLane:536870912,hydrationErrors:null},s=Th(e),s.return=n,n.child=s,Tt=n,Ye=null)):e=null,e===null)throw mi(n);return Bu(e)?n.lanes=32:n.lanes=536870912,null}var b=c.children;return c=c.fallback,d?(Si(),d=n.mode,b=bo({mode:"hidden",children:b},d),c=$i(c,d,s,null),b.return=n,c.return=n,b.sibling=c,n.child=b,c=n.child,c.memoizedState=nu(s),c.childLanes=iu(e,y,s),n.memoizedState=tu,Gs(null,c)):(bi(n),au(n,b))}var C=e.memoizedState;if(C!==null&&(b=C.dehydrated,b!==null)){if(h)n.flags&256?(bi(n),n.flags&=-257,n=su(e,n,s)):n.memoizedState!==null?(Si(),n.child=e.child,n.flags|=128,n=null):(Si(),b=c.fallback,d=n.mode,c=bo({mode:"visible",children:c.children},d),b=$i(b,d,s,null),b.flags|=2,c.return=n,b.return=n,c.sibling=b,n.child=c,ra(n,e.child,null,s),c=n.child,c.memoizedState=nu(s),c.childLanes=iu(e,y,s),n.memoizedState=tu,n=Gs(null,c));else if(bi(n),Bu(b)){if(y=b.nextSibling&&b.nextSibling.dataset,y)var w=y.dgst;y=w,c=Error(a(419)),c.stack="",c.digest=y,Ns({value:c,source:null,stack:null}),n=su(e,n,s)}else if(ut||Pa(e,n,s,!1),y=(s&e.childLanes)!==0,ut||y){if(y=Fe,y!==null&&(c=Af(y,s),c!==0&&c!==C.retryLane))throw C.retryLane=c,Wi(e,c),qt(y,e,c),$l;ju(b)||Ao(),n=su(e,n,s)}else ju(b)?(n.flags|=192,n.child=e.child,n=null):(e=C.treeContext,Ye=fn(b.nextSibling),Tt=n,Ae=!0,hi=null,un=!1,e!==null&&Eh(n,e),n=au(n,c.children),n.flags|=4096);return n}return d?(Si(),b=c.fallback,d=n.mode,C=e.child,w=C.sibling,c=qn(C,{mode:"hidden",children:c.children}),c.subtreeFlags=C.subtreeFlags&65011712,w!==null?b=qn(w,b):(b=$i(b,d,s,null),b.flags|=2),b.return=n,c.return=n,c.sibling=b,n.child=c,Gs(null,c),c=n.child,b=e.child.memoizedState,b===null?b=nu(s):(d=b.cachePool,d!==null?(C=ct._currentValue,d=d.parent!==C?{parent:C,pool:C}:d):d=Mh(),b={baseLanes:b.baseLanes|s,cachePool:d}),c.memoizedState=b,c.childLanes=iu(e,y,s),n.memoizedState=tu,Gs(e.child,c)):(bi(n),s=e.child,e=s.sibling,s=qn(s,{mode:"visible",children:c.children}),s.return=n,s.sibling=null,e!==null&&(y=n.deletions,y===null?(n.deletions=[e],n.flags|=16):y.push(e)),n.child=s,n.memoizedState=null,s)}function au(e,n){return n=bo({mode:"visible",children:n},e.mode),n.return=e,e.child=n}function bo(e,n){return e=Xt(22,e,null,n),e.lanes=0,e}function su(e,n,s){return ra(n,e.child,null,s),e=au(n,n.pendingProps.children),e.flags|=2,n.memoizedState=null,e}function Hm(e,n,s){e.lanes|=n;var c=e.alternate;c!==null&&(c.lanes|=n),Sl(e.return,n,s)}function ru(e,n,s,c,d,h){var y=e.memoizedState;y===null?e.memoizedState={isBackwards:n,rendering:null,renderingStartTime:0,last:c,tail:s,tailMode:d,treeForkCount:h}:(y.isBackwards=n,y.rendering=null,y.renderingStartTime=0,y.last=c,y.tail=s,y.tailMode=d,y.treeForkCount=h)}function Fm(e,n,s){var c=n.pendingProps,d=c.revealOrder,h=c.tail;c=c.children;var y=at.current,b=(y&2)!==0;if(b?(y=y&1|2,n.flags|=128):y&=1,te(at,y),kt(e,n,c,s),c=Ae?xs:0,!b&&e!==null&&(e.flags&128)!==0)e:for(e=n.child;e!==null;){if(e.tag===13)e.memoizedState!==null&&Hm(e,s,n);else if(e.tag===19)Hm(e,s,n);else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===n)break e;for(;e.sibling===null;){if(e.return===null||e.return===n)break e;e=e.return}e.sibling.return=e.return,e=e.sibling}switch(d){case"forwards":for(s=n.child,d=null;s!==null;)e=s.alternate,e!==null&&ro(e)===null&&(d=s),s=s.sibling;s=d,s===null?(d=n.child,n.child=null):(d=s.sibling,s.sibling=null),ru(n,!1,d,s,h,c);break;case"backwards":case"unstable_legacy-backwards":for(s=null,d=n.child,n.child=null;d!==null;){if(e=d.alternate,e!==null&&ro(e)===null){n.child=d;break}e=d.sibling,d.sibling=s,s=d,d=e}ru(n,!0,s,null,h,c);break;case"together":ru(n,!1,null,null,void 0,c);break;default:n.memoizedState=null}return n.child}function Yn(e,n,s){if(e!==null&&(n.dependencies=e.dependencies),ki|=n.lanes,(s&n.childLanes)===0)if(e!==null){if(Pa(e,n,s,!1),(s&n.childLanes)===0)return null}else return null;if(e!==null&&n.child!==e.child)throw Error(a(153));if(n.child!==null){for(e=n.child,s=qn(e,e.pendingProps),n.child=s,s.return=n;e.sibling!==null;)e=e.sibling,s=s.sibling=qn(e,e.pendingProps),s.return=n;s.sibling=null}return n.child}function ou(e,n){return(e.lanes&n)!==0?!0:(e=e.dependencies,!!(e!==null&&Wr(e)))}function Jb(e,n,s){switch(n.tag){case 3:At(n,n.stateNode.containerInfo),pi(n,ct,e.memoizedState.cache),ea();break;case 27:case 5:vs(n);break;case 4:At(n,n.stateNode.containerInfo);break;case 10:pi(n,n.type,n.memoizedProps.value);break;case 31:if(n.memoizedState!==null)return n.flags|=128,xl(n),null;break;case 13:var c=n.memoizedState;if(c!==null)return c.dehydrated!==null?(bi(n),n.flags|=128,null):(s&n.child.childLanes)!==0?Vm(e,n,s):(bi(n),e=Yn(e,n,s),e!==null?e.sibling:null);bi(n);break;case 19:var d=(e.flags&128)!==0;if(c=(s&n.childLanes)!==0,c||(Pa(e,n,s,!1),c=(s&n.childLanes)!==0),d){if(c)return Fm(e,n,s);n.flags|=128}if(d=n.memoizedState,d!==null&&(d.rendering=null,d.tail=null,d.lastEffect=null),te(at,at.current),c)break;return null;case 22:return n.lanes=0,Lm(e,n,s,n.pendingProps);case 24:pi(n,ct,e.memoizedState.cache)}return Yn(e,n,s)}function Gm(e,n,s){if(e!==null)if(e.memoizedProps!==n.pendingProps)ut=!0;else{if(!ou(e,s)&&(n.flags&128)===0)return ut=!1,Jb(e,n,s);ut=(e.flags&131072)!==0}else ut=!1,Ae&&(n.flags&1048576)!==0&&kh(n,xs,n.index);switch(n.lanes=0,n.tag){case 16:e:{var c=n.pendingProps;if(e=aa(n.elementType),n.type=e,typeof e=="function")fl(e)?(c=ca(e,c),n.tag=1,n=zm(null,n,e,c,s)):(n.tag=0,n=eu(null,n,e,c,s));else{if(e!=null){var d=e.$$typeof;if(d===M){n.tag=11,n=Nm(null,n,e,c,s);break e}else if(d===Q){n.tag=14,n=Pm(null,n,e,c,s);break e}}throw n=Ze(e)||e,Error(a(306,n,""))}}return n;case 0:return eu(e,n,n.type,n.pendingProps,s);case 1:return c=n.type,d=ca(c,n.pendingProps),zm(e,n,c,d,s);case 3:e:{if(At(n,n.stateNode.containerInfo),e===null)throw Error(a(387));c=n.pendingProps;var h=n.memoizedState;d=h.element,Ol(e,n),zs(n,c,null,s);var y=n.memoizedState;if(c=y.cache,pi(n,ct,c),c!==h.cache&&Tl(n,[ct],s,!0),Bs(),c=y.element,h.isDehydrated)if(h={element:c,isDehydrated:!1,cache:y.cache},n.updateQueue.baseState=h,n.memoizedState=h,n.flags&256){n=qm(e,n,c,s);break e}else if(c!==d){d=on(Error(a(424)),n),Ns(d),n=qm(e,n,c,s);break e}else{switch(e=n.stateNode.containerInfo,e.nodeType){case 9:e=e.body;break;default:e=e.nodeName==="HTML"?e.ownerDocument.body:e}for(Ye=fn(e.firstChild),Tt=n,Ae=!0,hi=null,un=!0,s=Lh(n,null,c,s),n.child=s;s;)s.flags=s.flags&-3|4096,s=s.sibling}else{if(ea(),c===d){n=Yn(e,n,s);break e}kt(e,n,c,s)}n=n.child}return n;case 26:return yo(e,n),e===null?(s=ng(n.type,null,n.pendingProps,null))?n.memoizedState=s:Ae||(s=n.type,e=n.pendingProps,c=Uo(ye.current).createElement(s),c[St]=n,c[Ut]=e,Et(c,s,e),gt(c),n.stateNode=c):n.memoizedState=ng(n.type,e.memoizedProps,n.pendingProps,e.memoizedState),null;case 27:return vs(n),e===null&&Ae&&(c=n.stateNode=$p(n.type,n.pendingProps,ye.current),Tt=n,un=!0,d=Ye,Ai(n.type)?(zu=d,Ye=fn(c.firstChild)):Ye=d),kt(e,n,n.pendingProps.children,s),yo(e,n),e===null&&(n.flags|=4194304),n.child;case 5:return e===null&&Ae&&((d=c=Ye)&&(c=_S(c,n.type,n.pendingProps,un),c!==null?(n.stateNode=c,Tt=n,Ye=fn(c.firstChild),un=!1,d=!0):d=!1),d||mi(n)),vs(n),d=n.type,h=n.pendingProps,y=e!==null?e.memoizedProps:null,c=h.children,Uu(d,h)?c=null:y!==null&&Uu(d,y)&&(n.flags|=32),n.memoizedState!==null&&(d=Pl(e,n,zb,null,null,s),rr._currentValue=d),yo(e,n),kt(e,n,c,s),n.child;case 6:return e===null&&Ae&&((e=s=Ye)&&(s=RS(s,n.pendingProps,un),s!==null?(n.stateNode=s,Tt=n,Ye=null,e=!0):e=!1),e||mi(n)),null;case 13:return Vm(e,n,s);case 4:return At(n,n.stateNode.containerInfo),c=n.pendingProps,e===null?n.child=ra(n,null,c,s):kt(e,n,c,s),n.child;case 11:return Nm(e,n,n.type,n.pendingProps,s);case 7:return kt(e,n,n.pendingProps,s),n.child;case 8:return kt(e,n,n.pendingProps.children,s),n.child;case 12:return kt(e,n,n.pendingProps.children,s),n.child;case 10:return c=n.pendingProps,pi(n,n.type,c.value),kt(e,n,c.children,s),n.child;case 9:return d=n.type._context,c=n.pendingProps.children,na(n),d=Ct(d),c=c(d),n.flags|=1,kt(e,n,c,s),n.child;case 14:return Pm(e,n,n.type,n.pendingProps,s);case 15:return Um(e,n,n.type,n.pendingProps,s);case 19:return Fm(e,n,s);case 31:return Qb(e,n,s);case 22:return Lm(e,n,s,n.pendingProps);case 24:return na(n),c=Ct(ct),e===null?(d=El(),d===null&&(d=Fe,h=Cl(),d.pooledCache=h,h.refCount++,h!==null&&(d.pooledCacheLanes|=s),d=h),n.memoizedState={parent:c,cache:d},Rl(n),pi(n,ct,d)):((e.lanes&s)!==0&&(Ol(e,n),zs(n,null,null,s),Bs()),d=e.memoizedState,h=n.memoizedState,d.parent!==c?(d={parent:c,cache:c},n.memoizedState=d,n.lanes===0&&(n.memoizedState=n.updateQueue.baseState=d),pi(n,ct,c)):(c=h.cache,pi(n,ct,c),c!==d.cache&&Tl(n,[ct],s,!0))),kt(e,n,n.pendingProps.children,s),n.child;case 29:throw n.pendingProps}throw Error(a(156,n.tag))}function Qn(e){e.flags|=4}function cu(e,n,s,c,d){if((n=(e.mode&32)!==0)&&(n=!1),n){if(e.flags|=16777216,(d&335544128)===d)if(e.stateNode.complete)e.flags|=8192;else if(yp())e.flags|=8192;else throw sa=no,_l}else e.flags&=-16777217}function Km(e,n){if(n.type!=="stylesheet"||(n.state.loading&4)!==0)e.flags&=-16777217;else if(e.flags|=16777216,!og(n))if(yp())e.flags|=8192;else throw sa=no,_l}function So(e,n){n!==null&&(e.flags|=4),e.flags&16384&&(n=e.tag!==22?_f():536870912,e.lanes|=n,Ka|=n)}function Ks(e,n){if(!Ae)switch(e.tailMode){case"hidden":n=e.tail;for(var s=null;n!==null;)n.alternate!==null&&(s=n),n=n.sibling;s===null?e.tail=null:s.sibling=null;break;case"collapsed":s=e.tail;for(var c=null;s!==null;)s.alternate!==null&&(c=s),s=s.sibling;c===null?n||e.tail===null?e.tail=null:e.tail.sibling=null:c.sibling=null}}function Qe(e){var n=e.alternate!==null&&e.alternate.child===e.child,s=0,c=0;if(n)for(var d=e.child;d!==null;)s|=d.lanes|d.childLanes,c|=d.subtreeFlags&65011712,c|=d.flags&65011712,d.return=e,d=d.sibling;else for(d=e.child;d!==null;)s|=d.lanes|d.childLanes,c|=d.subtreeFlags,c|=d.flags,d.return=e,d=d.sibling;return e.subtreeFlags|=c,e.childLanes=s,n}function Xb(e,n,s){var c=n.pendingProps;switch(gl(n),n.tag){case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Qe(n),null;case 1:return Qe(n),null;case 3:return s=n.stateNode,c=null,e!==null&&(c=e.memoizedState.cache),n.memoizedState.cache!==c&&(n.flags|=2048),Fn(ct),it(),s.pendingContext&&(s.context=s.pendingContext,s.pendingContext=null),(e===null||e.child===null)&&(Na(n)?Qn(n):e===null||e.memoizedState.isDehydrated&&(n.flags&256)===0||(n.flags|=1024,yl())),Qe(n),null;case 26:var d=n.type,h=n.memoizedState;return e===null?(Qn(n),h!==null?(Qe(n),Km(n,h)):(Qe(n),cu(n,d,null,c,s))):h?h!==e.memoizedState?(Qn(n),Qe(n),Km(n,h)):(Qe(n),n.flags&=-16777217):(e=e.memoizedProps,e!==c&&Qn(n),Qe(n),cu(n,d,e,c,s)),null;case 27:if(Mr(n),s=ye.current,d=n.type,e!==null&&n.stateNode!=null)e.memoizedProps!==c&&Qn(n);else{if(!c){if(n.stateNode===null)throw Error(a(166));return Qe(n),null}e=oe.current,Na(n)?_h(n):(e=$p(d,c,s),n.stateNode=e,Qn(n))}return Qe(n),null;case 5:if(Mr(n),d=n.type,e!==null&&n.stateNode!=null)e.memoizedProps!==c&&Qn(n);else{if(!c){if(n.stateNode===null)throw Error(a(166));return Qe(n),null}if(h=oe.current,Na(n))_h(n);else{var y=Uo(ye.current);switch(h){case 1:h=y.createElementNS("http://www.w3.org/2000/svg",d);break;case 2:h=y.createElementNS("http://www.w3.org/1998/Math/MathML",d);break;default:switch(d){case"svg":h=y.createElementNS("http://www.w3.org/2000/svg",d);break;case"math":h=y.createElementNS("http://www.w3.org/1998/Math/MathML",d);break;case"script":h=y.createElement("div"),h.innerHTML="<script><\/script>",h=h.removeChild(h.firstChild);break;case"select":h=typeof c.is=="string"?y.createElement("select",{is:c.is}):y.createElement("select"),c.multiple?h.multiple=!0:c.size&&(h.size=c.size);break;default:h=typeof c.is=="string"?y.createElement(d,{is:c.is}):y.createElement(d)}}h[St]=n,h[Ut]=c;e:for(y=n.child;y!==null;){if(y.tag===5||y.tag===6)h.appendChild(y.stateNode);else if(y.tag!==4&&y.tag!==27&&y.child!==null){y.child.return=y,y=y.child;continue}if(y===n)break e;for(;y.sibling===null;){if(y.return===null||y.return===n)break e;y=y.return}y.sibling.return=y.return,y=y.sibling}n.stateNode=h;e:switch(Et(h,d,c),d){case"button":case"input":case"select":case"textarea":c=!!c.autoFocus;break e;case"img":c=!0;break e;default:c=!1}c&&Qn(n)}}return Qe(n),cu(n,n.type,e===null?null:e.memoizedProps,n.pendingProps,s),null;case 6:if(e&&n.stateNode!=null)e.memoizedProps!==c&&Qn(n);else{if(typeof c!="string"&&n.stateNode===null)throw Error(a(166));if(e=ye.current,Na(n)){if(e=n.stateNode,s=n.memoizedProps,c=null,d=Tt,d!==null)switch(d.tag){case 27:case 5:c=d.memoizedProps}e[St]=n,e=!!(e.nodeValue===s||c!==null&&c.suppressHydrationWarning===!0||Vp(e.nodeValue,s)),e||mi(n,!0)}else e=Uo(e).createTextNode(c),e[St]=n,n.stateNode=e}return Qe(n),null;case 31:if(s=n.memoizedState,e===null||e.memoizedState!==null){if(c=Na(n),s!==null){if(e===null){if(!c)throw Error(a(318));if(e=n.memoizedState,e=e!==null?e.dehydrated:null,!e)throw Error(a(557));e[St]=n}else ea(),(n.flags&128)===0&&(n.memoizedState=null),n.flags|=4;Qe(n),e=!1}else s=yl(),e!==null&&e.memoizedState!==null&&(e.memoizedState.hydrationErrors=s),e=!0;if(!e)return n.flags&256?(Wt(n),n):(Wt(n),null);if((n.flags&128)!==0)throw Error(a(558))}return Qe(n),null;case 13:if(c=n.memoizedState,e===null||e.memoizedState!==null&&e.memoizedState.dehydrated!==null){if(d=Na(n),c!==null&&c.dehydrated!==null){if(e===null){if(!d)throw Error(a(318));if(d=n.memoizedState,d=d!==null?d.dehydrated:null,!d)throw Error(a(317));d[St]=n}else ea(),(n.flags&128)===0&&(n.memoizedState=null),n.flags|=4;Qe(n),d=!1}else d=yl(),e!==null&&e.memoizedState!==null&&(e.memoizedState.hydrationErrors=d),d=!0;if(!d)return n.flags&256?(Wt(n),n):(Wt(n),null)}return Wt(n),(n.flags&128)!==0?(n.lanes=s,n):(s=c!==null,e=e!==null&&e.memoizedState!==null,s&&(c=n.child,d=null,c.alternate!==null&&c.alternate.memoizedState!==null&&c.alternate.memoizedState.cachePool!==null&&(d=c.alternate.memoizedState.cachePool.pool),h=null,c.memoizedState!==null&&c.memoizedState.cachePool!==null&&(h=c.memoizedState.cachePool.pool),h!==d&&(c.flags|=2048)),s!==e&&s&&(n.child.flags|=8192),So(n,n.updateQueue),Qe(n),null);case 4:return it(),e===null&&Mu(n.stateNode.containerInfo),Qe(n),null;case 10:return Fn(n.type),Qe(n),null;case 19:if(V(at),c=n.memoizedState,c===null)return Qe(n),null;if(d=(n.flags&128)!==0,h=c.rendering,h===null)if(d)Ks(c,!1);else{if($e!==0||e!==null&&(e.flags&128)!==0)for(e=n.child;e!==null;){if(h=ro(e),h!==null){for(n.flags|=128,Ks(c,!1),e=h.updateQueue,n.updateQueue=e,So(n,e),n.subtreeFlags=0,e=s,s=n.child;s!==null;)Sh(s,e),s=s.sibling;return te(at,at.current&1|2),Ae&&Vn(n,c.treeForkCount),n.child}e=e.sibling}c.tail!==null&&Kt()>_o&&(n.flags|=128,d=!0,Ks(c,!1),n.lanes=4194304)}else{if(!d)if(e=ro(h),e!==null){if(n.flags|=128,d=!0,e=e.updateQueue,n.updateQueue=e,So(n,e),Ks(c,!0),c.tail===null&&c.tailMode==="hidden"&&!h.alternate&&!Ae)return Qe(n),null}else 2*Kt()-c.renderingStartTime>_o&&s!==536870912&&(n.flags|=128,d=!0,Ks(c,!1),n.lanes=4194304);c.isBackwards?(h.sibling=n.child,n.child=h):(e=c.last,e!==null?e.sibling=h:n.child=h,c.last=h)}return c.tail!==null?(e=c.tail,c.rendering=e,c.tail=e.sibling,c.renderingStartTime=Kt(),e.sibling=null,s=at.current,te(at,d?s&1|2:s&1),Ae&&Vn(n,c.treeForkCount),e):(Qe(n),null);case 22:case 23:return Wt(n),wl(),c=n.memoizedState!==null,e!==null?e.memoizedState!==null!==c&&(n.flags|=8192):c&&(n.flags|=8192),c?(s&536870912)!==0&&(n.flags&128)===0&&(Qe(n),n.subtreeFlags&6&&(n.flags|=8192)):Qe(n),s=n.updateQueue,s!==null&&So(n,s.retryQueue),s=null,e!==null&&e.memoizedState!==null&&e.memoizedState.cachePool!==null&&(s=e.memoizedState.cachePool.pool),c=null,n.memoizedState!==null&&n.memoizedState.cachePool!==null&&(c=n.memoizedState.cachePool.pool),c!==s&&(n.flags|=2048),e!==null&&V(ia),null;case 24:return s=null,e!==null&&(s=e.memoizedState.cache),n.memoizedState.cache!==s&&(n.flags|=2048),Fn(ct),Qe(n),null;case 25:return null;case 30:return null}throw Error(a(156,n.tag))}function Zb(e,n){switch(gl(n),n.tag){case 1:return e=n.flags,e&65536?(n.flags=e&-65537|128,n):null;case 3:return Fn(ct),it(),e=n.flags,(e&65536)!==0&&(e&128)===0?(n.flags=e&-65537|128,n):null;case 26:case 27:case 5:return Mr(n),null;case 31:if(n.memoizedState!==null){if(Wt(n),n.alternate===null)throw Error(a(340));ea()}return e=n.flags,e&65536?(n.flags=e&-65537|128,n):null;case 13:if(Wt(n),e=n.memoizedState,e!==null&&e.dehydrated!==null){if(n.alternate===null)throw Error(a(340));ea()}return e=n.flags,e&65536?(n.flags=e&-65537|128,n):null;case 19:return V(at),null;case 4:return it(),null;case 10:return Fn(n.type),null;case 22:case 23:return Wt(n),wl(),e!==null&&V(ia),e=n.flags,e&65536?(n.flags=e&-65537|128,n):null;case 24:return Fn(ct),null;case 25:return null;default:return null}}function Ym(e,n){switch(gl(n),n.tag){case 3:Fn(ct),it();break;case 26:case 27:case 5:Mr(n);break;case 4:it();break;case 31:n.memoizedState!==null&&Wt(n);break;case 13:Wt(n);break;case 19:V(at);break;case 10:Fn(n.type);break;case 22:case 23:Wt(n),wl(),e!==null&&V(ia);break;case 24:Fn(ct)}}function Ys(e,n){try{var s=n.updateQueue,c=s!==null?s.lastEffect:null;if(c!==null){var d=c.next;s=d;do{if((s.tag&e)===e){c=void 0;var h=s.create,y=s.inst;c=h(),y.destroy=c}s=s.next}while(s!==d)}}catch(b){Be(n,n.return,b)}}function Ti(e,n,s){try{var c=n.updateQueue,d=c!==null?c.lastEffect:null;if(d!==null){var h=d.next;c=h;do{if((c.tag&e)===e){var y=c.inst,b=y.destroy;if(b!==void 0){y.destroy=void 0,d=n;var C=s,w=b;try{w()}catch(B){Be(d,C,B)}}}c=c.next}while(c!==h)}}catch(B){Be(n,n.return,B)}}function Qm(e){var n=e.updateQueue;if(n!==null){var s=e.stateNode;try{jh(n,s)}catch(c){Be(e,e.return,c)}}}function Jm(e,n,s){s.props=ca(e.type,e.memoizedProps),s.state=e.memoizedState;try{s.componentWillUnmount()}catch(c){Be(e,n,c)}}function Qs(e,n){try{var s=e.ref;if(s!==null){switch(e.tag){case 26:case 27:case 5:var c=e.stateNode;break;case 30:c=e.stateNode;break;default:c=e.stateNode}typeof s=="function"?e.refCleanup=s(c):s.current=c}}catch(d){Be(e,n,d)}}function Dn(e,n){var s=e.ref,c=e.refCleanup;if(s!==null)if(typeof c=="function")try{c()}catch(d){Be(e,n,d)}finally{e.refCleanup=null,e=e.alternate,e!=null&&(e.refCleanup=null)}else if(typeof s=="function")try{s(null)}catch(d){Be(e,n,d)}else s.current=null}function Xm(e){var n=e.type,s=e.memoizedProps,c=e.stateNode;try{e:switch(n){case"button":case"input":case"select":case"textarea":s.autoFocus&&c.focus();break e;case"img":s.src?c.src=s.src:s.srcSet&&(c.srcset=s.srcSet)}}catch(d){Be(e,e.return,d)}}function lu(e,n,s){try{var c=e.stateNode;bS(c,e.type,s,n),c[Ut]=n}catch(d){Be(e,e.return,d)}}function Zm(e){return e.tag===5||e.tag===3||e.tag===26||e.tag===27&&Ai(e.type)||e.tag===4}function uu(e){e:for(;;){for(;e.sibling===null;){if(e.return===null||Zm(e.return))return null;e=e.return}for(e.sibling.return=e.return,e=e.sibling;e.tag!==5&&e.tag!==6&&e.tag!==18;){if(e.tag===27&&Ai(e.type)||e.flags&2||e.child===null||e.tag===4)continue e;e.child.return=e,e=e.child}if(!(e.flags&2))return e.stateNode}}function du(e,n,s){var c=e.tag;if(c===5||c===6)e=e.stateNode,n?(s.nodeType===9?s.body:s.nodeName==="HTML"?s.ownerDocument.body:s).insertBefore(e,n):(n=s.nodeType===9?s.body:s.nodeName==="HTML"?s.ownerDocument.body:s,n.appendChild(e),s=s._reactRootContainer,s!=null||n.onclick!==null||(n.onclick=Bn));else if(c!==4&&(c===27&&Ai(e.type)&&(s=e.stateNode,n=null),e=e.child,e!==null))for(du(e,n,s),e=e.sibling;e!==null;)du(e,n,s),e=e.sibling}function To(e,n,s){var c=e.tag;if(c===5||c===6)e=e.stateNode,n?s.insertBefore(e,n):s.appendChild(e);else if(c!==4&&(c===27&&Ai(e.type)&&(s=e.stateNode),e=e.child,e!==null))for(To(e,n,s),e=e.sibling;e!==null;)To(e,n,s),e=e.sibling}function Wm(e){var n=e.stateNode,s=e.memoizedProps;try{for(var c=e.type,d=n.attributes;d.length;)n.removeAttributeNode(d[0]);Et(n,c,s),n[St]=e,n[Ut]=s}catch(h){Be(e,e.return,h)}}var Jn=!1,dt=!1,fu=!1,$m=typeof WeakSet=="function"?WeakSet:Set,vt=null;function Wb(e,n){if(e=e.containerInfo,Nu=Vo,e=dh(e),sl(e)){if("selectionStart"in e)var s={start:e.selectionStart,end:e.selectionEnd};else e:{s=(s=e.ownerDocument)&&s.defaultView||window;var c=s.getSelection&&s.getSelection();if(c&&c.rangeCount!==0){s=c.anchorNode;var d=c.anchorOffset,h=c.focusNode;c=c.focusOffset;try{s.nodeType,h.nodeType}catch{s=null;break e}var y=0,b=-1,C=-1,w=0,B=0,H=e,P=null;t:for(;;){for(var L;H!==s||d!==0&&H.nodeType!==3||(b=y+d),H!==h||c!==0&&H.nodeType!==3||(C=y+c),H.nodeType===3&&(y+=H.nodeValue.length),(L=H.firstChild)!==null;)P=H,H=L;for(;;){if(H===e)break t;if(P===s&&++w===d&&(b=y),P===h&&++B===c&&(C=y),(L=H.nextSibling)!==null)break;H=P,P=H.parentNode}H=L}s=b===-1||C===-1?null:{start:b,end:C}}else s=null}s=s||{start:0,end:0}}else s=null;for(Pu={focusedElem:e,selectionRange:s},Vo=!1,vt=n;vt!==null;)if(n=vt,e=n.child,(n.subtreeFlags&1028)!==0&&e!==null)e.return=n,vt=e;else for(;vt!==null;){switch(n=vt,h=n.alternate,e=n.flags,n.tag){case 0:if((e&4)!==0&&(e=n.updateQueue,e=e!==null?e.events:null,e!==null))for(s=0;s<e.length;s++)d=e[s],d.ref.impl=d.nextImpl;break;case 11:case 15:break;case 1:if((e&1024)!==0&&h!==null){e=void 0,s=n,d=h.memoizedProps,h=h.memoizedState,c=s.stateNode;try{var re=ca(s.type,d);e=c.getSnapshotBeforeUpdate(re,h),c.__reactInternalSnapshotBeforeUpdate=e}catch(fe){Be(s,s.return,fe)}}break;case 3:if((e&1024)!==0){if(e=n.stateNode.containerInfo,s=e.nodeType,s===9)Iu(e);else if(s===1)switch(e.nodeName){case"HEAD":case"HTML":case"BODY":Iu(e);break;default:e.textContent=""}}break;case 5:case 26:case 27:case 6:case 4:case 17:break;default:if((e&1024)!==0)throw Error(a(163))}if(e=n.sibling,e!==null){e.return=n.return,vt=e;break}vt=n.return}}function ep(e,n,s){var c=s.flags;switch(s.tag){case 0:case 11:case 15:Zn(e,s),c&4&&Ys(5,s);break;case 1:if(Zn(e,s),c&4)if(e=s.stateNode,n===null)try{e.componentDidMount()}catch(y){Be(s,s.return,y)}else{var d=ca(s.type,n.memoizedProps);n=n.memoizedState;try{e.componentDidUpdate(d,n,e.__reactInternalSnapshotBeforeUpdate)}catch(y){Be(s,s.return,y)}}c&64&&Qm(s),c&512&&Qs(s,s.return);break;case 3:if(Zn(e,s),c&64&&(e=s.updateQueue,e!==null)){if(n=null,s.child!==null)switch(s.child.tag){case 27:case 5:n=s.child.stateNode;break;case 1:n=s.child.stateNode}try{jh(e,n)}catch(y){Be(s,s.return,y)}}break;case 27:n===null&&c&4&&Wm(s);case 26:case 5:Zn(e,s),n===null&&c&4&&Xm(s),c&512&&Qs(s,s.return);break;case 12:Zn(e,s);break;case 31:Zn(e,s),c&4&&ip(e,s);break;case 13:Zn(e,s),c&4&&ap(e,s),c&64&&(e=s.memoizedState,e!==null&&(e=e.dehydrated,e!==null&&(s=oS.bind(null,s),OS(e,s))));break;case 22:if(c=s.memoizedState!==null||Jn,!c){n=n!==null&&n.memoizedState!==null||dt,d=Jn;var h=dt;Jn=c,(dt=n)&&!h?Wn(e,s,(s.subtreeFlags&8772)!==0):Zn(e,s),Jn=d,dt=h}break;case 30:break;default:Zn(e,s)}}function tp(e){var n=e.alternate;n!==null&&(e.alternate=null,tp(n)),e.child=null,e.deletions=null,e.sibling=null,e.tag===5&&(n=e.stateNode,n!==null&&Vc(n)),e.stateNode=null,e.return=null,e.dependencies=null,e.memoizedProps=null,e.memoizedState=null,e.pendingProps=null,e.stateNode=null,e.updateQueue=null}var Je=null,It=!1;function Xn(e,n,s){for(s=s.child;s!==null;)np(e,n,s),s=s.sibling}function np(e,n,s){if(Yt&&typeof Yt.onCommitFiberUnmount=="function")try{Yt.onCommitFiberUnmount(ys,s)}catch{}switch(s.tag){case 26:dt||Dn(s,n),Xn(e,n,s),s.memoizedState?s.memoizedState.count--:s.stateNode&&(s=s.stateNode,s.parentNode.removeChild(s));break;case 27:dt||Dn(s,n);var c=Je,d=It;Ai(s.type)&&(Je=s.stateNode,It=!1),Xn(e,n,s),ir(s.stateNode),Je=c,It=d;break;case 5:dt||Dn(s,n);case 6:if(c=Je,d=It,Je=null,Xn(e,n,s),Je=c,It=d,Je!==null)if(It)try{(Je.nodeType===9?Je.body:Je.nodeName==="HTML"?Je.ownerDocument.body:Je).removeChild(s.stateNode)}catch(h){Be(s,n,h)}else try{Je.removeChild(s.stateNode)}catch(h){Be(s,n,h)}break;case 18:Je!==null&&(It?(e=Je,Qp(e.nodeType===9?e.body:e.nodeName==="HTML"?e.ownerDocument.body:e,s.stateNode),es(e)):Qp(Je,s.stateNode));break;case 4:c=Je,d=It,Je=s.stateNode.containerInfo,It=!0,Xn(e,n,s),Je=c,It=d;break;case 0:case 11:case 14:case 15:Ti(2,s,n),dt||Ti(4,s,n),Xn(e,n,s);break;case 1:dt||(Dn(s,n),c=s.stateNode,typeof c.componentWillUnmount=="function"&&Jm(s,n,c)),Xn(e,n,s);break;case 21:Xn(e,n,s);break;case 22:dt=(c=dt)||s.memoizedState!==null,Xn(e,n,s),dt=c;break;default:Xn(e,n,s)}}function ip(e,n){if(n.memoizedState===null&&(e=n.alternate,e!==null&&(e=e.memoizedState,e!==null))){e=e.dehydrated;try{es(e)}catch(s){Be(n,n.return,s)}}}function ap(e,n){if(n.memoizedState===null&&(e=n.alternate,e!==null&&(e=e.memoizedState,e!==null&&(e=e.dehydrated,e!==null))))try{es(e)}catch(s){Be(n,n.return,s)}}function $b(e){switch(e.tag){case 31:case 13:case 19:var n=e.stateNode;return n===null&&(n=e.stateNode=new $m),n;case 22:return e=e.stateNode,n=e._retryCache,n===null&&(n=e._retryCache=new $m),n;default:throw Error(a(435,e.tag))}}function Co(e,n){var s=$b(e);n.forEach(function(c){if(!s.has(c)){s.add(c);var d=cS.bind(null,e,c);c.then(d,d)}})}function jt(e,n){var s=n.deletions;if(s!==null)for(var c=0;c<s.length;c++){var d=s[c],h=e,y=n,b=y;e:for(;b!==null;){switch(b.tag){case 27:if(Ai(b.type)){Je=b.stateNode,It=!1;break e}break;case 5:Je=b.stateNode,It=!1;break e;case 3:case 4:Je=b.stateNode.containerInfo,It=!0;break e}b=b.return}if(Je===null)throw Error(a(160));np(h,y,d),Je=null,It=!1,h=d.alternate,h!==null&&(h.return=null),d.return=null}if(n.subtreeFlags&13886)for(n=n.child;n!==null;)sp(n,e),n=n.sibling}var yn=null;function sp(e,n){var s=e.alternate,c=e.flags;switch(e.tag){case 0:case 11:case 14:case 15:jt(n,e),Bt(e),c&4&&(Ti(3,e,e.return),Ys(3,e),Ti(5,e,e.return));break;case 1:jt(n,e),Bt(e),c&512&&(dt||s===null||Dn(s,s.return)),c&64&&Jn&&(e=e.updateQueue,e!==null&&(c=e.callbacks,c!==null&&(s=e.shared.hiddenCallbacks,e.shared.hiddenCallbacks=s===null?c:s.concat(c))));break;case 26:var d=yn;if(jt(n,e),Bt(e),c&512&&(dt||s===null||Dn(s,s.return)),c&4){var h=s!==null?s.memoizedState:null;if(c=e.memoizedState,s===null)if(c===null)if(e.stateNode===null){e:{c=e.type,s=e.memoizedProps,d=d.ownerDocument||d;t:switch(c){case"title":h=d.getElementsByTagName("title")[0],(!h||h[Ts]||h[St]||h.namespaceURI==="http://www.w3.org/2000/svg"||h.hasAttribute("itemprop"))&&(h=d.createElement(c),d.head.insertBefore(h,d.querySelector("head > title"))),Et(h,c,s),h[St]=e,gt(h),c=h;break e;case"link":var y=sg("link","href",d).get(c+(s.href||""));if(y){for(var b=0;b<y.length;b++)if(h=y[b],h.getAttribute("href")===(s.href==null||s.href===""?null:s.href)&&h.getAttribute("rel")===(s.rel==null?null:s.rel)&&h.getAttribute("title")===(s.title==null?null:s.title)&&h.getAttribute("crossorigin")===(s.crossOrigin==null?null:s.crossOrigin)){y.splice(b,1);break t}}h=d.createElement(c),Et(h,c,s),d.head.appendChild(h);break;case"meta":if(y=sg("meta","content",d).get(c+(s.content||""))){for(b=0;b<y.length;b++)if(h=y[b],h.getAttribute("content")===(s.content==null?null:""+s.content)&&h.getAttribute("name")===(s.name==null?null:s.name)&&h.getAttribute("property")===(s.property==null?null:s.property)&&h.getAttribute("http-equiv")===(s.httpEquiv==null?null:s.httpEquiv)&&h.getAttribute("charset")===(s.charSet==null?null:s.charSet)){y.splice(b,1);break t}}h=d.createElement(c),Et(h,c,s),d.head.appendChild(h);break;default:throw Error(a(468,c))}h[St]=e,gt(h),c=h}e.stateNode=c}else rg(d,e.type,e.stateNode);else e.stateNode=ag(d,c,e.memoizedProps);else h!==c?(h===null?s.stateNode!==null&&(s=s.stateNode,s.parentNode.removeChild(s)):h.count--,c===null?rg(d,e.type,e.stateNode):ag(d,c,e.memoizedProps)):c===null&&e.stateNode!==null&&lu(e,e.memoizedProps,s.memoizedProps)}break;case 27:jt(n,e),Bt(e),c&512&&(dt||s===null||Dn(s,s.return)),s!==null&&c&4&&lu(e,e.memoizedProps,s.memoizedProps);break;case 5:if(jt(n,e),Bt(e),c&512&&(dt||s===null||Dn(s,s.return)),e.flags&32){d=e.stateNode;try{ka(d,"")}catch(re){Be(e,e.return,re)}}c&4&&e.stateNode!=null&&(d=e.memoizedProps,lu(e,d,s!==null?s.memoizedProps:d)),c&1024&&(fu=!0);break;case 6:if(jt(n,e),Bt(e),c&4){if(e.stateNode===null)throw Error(a(162));c=e.memoizedProps,s=e.stateNode;try{s.nodeValue=c}catch(re){Be(e,e.return,re)}}break;case 3:if(jo=null,d=yn,yn=Lo(n.containerInfo),jt(n,e),yn=d,Bt(e),c&4&&s!==null&&s.memoizedState.isDehydrated)try{es(n.containerInfo)}catch(re){Be(e,e.return,re)}fu&&(fu=!1,rp(e));break;case 4:c=yn,yn=Lo(e.stateNode.containerInfo),jt(n,e),Bt(e),yn=c;break;case 12:jt(n,e),Bt(e);break;case 31:jt(n,e),Bt(e),c&4&&(c=e.updateQueue,c!==null&&(e.updateQueue=null,Co(e,c)));break;case 13:jt(n,e),Bt(e),e.child.flags&8192&&e.memoizedState!==null!=(s!==null&&s.memoizedState!==null)&&(Eo=Kt()),c&4&&(c=e.updateQueue,c!==null&&(e.updateQueue=null,Co(e,c)));break;case 22:d=e.memoizedState!==null;var C=s!==null&&s.memoizedState!==null,w=Jn,B=dt;if(Jn=w||d,dt=B||C,jt(n,e),dt=B,Jn=w,Bt(e),c&8192)e:for(n=e.stateNode,n._visibility=d?n._visibility&-2:n._visibility|1,d&&(s===null||C||Jn||dt||la(e)),s=null,n=e;;){if(n.tag===5||n.tag===26){if(s===null){C=s=n;try{if(h=C.stateNode,d)y=h.style,typeof y.setProperty=="function"?y.setProperty("display","none","important"):y.display="none";else{b=C.stateNode;var H=C.memoizedProps.style,P=H!=null&&H.hasOwnProperty("display")?H.display:null;b.style.display=P==null||typeof P=="boolean"?"":(""+P).trim()}}catch(re){Be(C,C.return,re)}}}else if(n.tag===6){if(s===null){C=n;try{C.stateNode.nodeValue=d?"":C.memoizedProps}catch(re){Be(C,C.return,re)}}}else if(n.tag===18){if(s===null){C=n;try{var L=C.stateNode;d?Jp(L,!0):Jp(C.stateNode,!1)}catch(re){Be(C,C.return,re)}}}else if((n.tag!==22&&n.tag!==23||n.memoizedState===null||n===e)&&n.child!==null){n.child.return=n,n=n.child;continue}if(n===e)break e;for(;n.sibling===null;){if(n.return===null||n.return===e)break e;s===n&&(s=null),n=n.return}s===n&&(s=null),n.sibling.return=n.return,n=n.sibling}c&4&&(c=e.updateQueue,c!==null&&(s=c.retryQueue,s!==null&&(c.retryQueue=null,Co(e,s))));break;case 19:jt(n,e),Bt(e),c&4&&(c=e.updateQueue,c!==null&&(e.updateQueue=null,Co(e,c)));break;case 30:break;case 21:break;default:jt(n,e),Bt(e)}}function Bt(e){var n=e.flags;if(n&2){try{for(var s,c=e.return;c!==null;){if(Zm(c)){s=c;break}c=c.return}if(s==null)throw Error(a(160));switch(s.tag){case 27:var d=s.stateNode,h=uu(e);To(e,h,d);break;case 5:var y=s.stateNode;s.flags&32&&(ka(y,""),s.flags&=-33);var b=uu(e);To(e,b,y);break;case 3:case 4:var C=s.stateNode.containerInfo,w=uu(e);du(e,w,C);break;default:throw Error(a(161))}}catch(B){Be(e,e.return,B)}e.flags&=-3}n&4096&&(e.flags&=-4097)}function rp(e){if(e.subtreeFlags&1024)for(e=e.child;e!==null;){var n=e;rp(n),n.tag===5&&n.flags&1024&&n.stateNode.reset(),e=e.sibling}}function Zn(e,n){if(n.subtreeFlags&8772)for(n=n.child;n!==null;)ep(e,n.alternate,n),n=n.sibling}function la(e){for(e=e.child;e!==null;){var n=e;switch(n.tag){case 0:case 11:case 14:case 15:Ti(4,n,n.return),la(n);break;case 1:Dn(n,n.return);var s=n.stateNode;typeof s.componentWillUnmount=="function"&&Jm(n,n.return,s),la(n);break;case 27:ir(n.stateNode);case 26:case 5:Dn(n,n.return),la(n);break;case 22:n.memoizedState===null&&la(n);break;case 30:la(n);break;default:la(n)}e=e.sibling}}function Wn(e,n,s){for(s=s&&(n.subtreeFlags&8772)!==0,n=n.child;n!==null;){var c=n.alternate,d=e,h=n,y=h.flags;switch(h.tag){case 0:case 11:case 15:Wn(d,h,s),Ys(4,h);break;case 1:if(Wn(d,h,s),c=h,d=c.stateNode,typeof d.componentDidMount=="function")try{d.componentDidMount()}catch(w){Be(c,c.return,w)}if(c=h,d=c.updateQueue,d!==null){var b=c.stateNode;try{var C=d.shared.hiddenCallbacks;if(C!==null)for(d.shared.hiddenCallbacks=null,d=0;d<C.length;d++)Ih(C[d],b)}catch(w){Be(c,c.return,w)}}s&&y&64&&Qm(h),Qs(h,h.return);break;case 27:Wm(h);case 26:case 5:Wn(d,h,s),s&&c===null&&y&4&&Xm(h),Qs(h,h.return);break;case 12:Wn(d,h,s);break;case 31:Wn(d,h,s),s&&y&4&&ip(d,h);break;case 13:Wn(d,h,s),s&&y&4&&ap(d,h);break;case 22:h.memoizedState===null&&Wn(d,h,s),Qs(h,h.return);break;case 30:break;default:Wn(d,h,s)}n=n.sibling}}function hu(e,n){var s=null;e!==null&&e.memoizedState!==null&&e.memoizedState.cachePool!==null&&(s=e.memoizedState.cachePool.pool),e=null,n.memoizedState!==null&&n.memoizedState.cachePool!==null&&(e=n.memoizedState.cachePool.pool),e!==s&&(e!=null&&e.refCount++,s!=null&&Ps(s))}function mu(e,n){e=null,n.alternate!==null&&(e=n.alternate.memoizedState.cache),n=n.memoizedState.cache,n!==e&&(n.refCount++,e!=null&&Ps(e))}function bn(e,n,s,c){if(n.subtreeFlags&10256)for(n=n.child;n!==null;)op(e,n,s,c),n=n.sibling}function op(e,n,s,c){var d=n.flags;switch(n.tag){case 0:case 11:case 15:bn(e,n,s,c),d&2048&&Ys(9,n);break;case 1:bn(e,n,s,c);break;case 3:bn(e,n,s,c),d&2048&&(e=null,n.alternate!==null&&(e=n.alternate.memoizedState.cache),n=n.memoizedState.cache,n!==e&&(n.refCount++,e!=null&&Ps(e)));break;case 12:if(d&2048){bn(e,n,s,c),e=n.stateNode;try{var h=n.memoizedProps,y=h.id,b=h.onPostCommit;typeof b=="function"&&b(y,n.alternate===null?"mount":"update",e.passiveEffectDuration,-0)}catch(C){Be(n,n.return,C)}}else bn(e,n,s,c);break;case 31:bn(e,n,s,c);break;case 13:bn(e,n,s,c);break;case 23:break;case 22:h=n.stateNode,y=n.alternate,n.memoizedState!==null?h._visibility&2?bn(e,n,s,c):Js(e,n):h._visibility&2?bn(e,n,s,c):(h._visibility|=2,Ha(e,n,s,c,(n.subtreeFlags&10256)!==0||!1)),d&2048&&hu(y,n);break;case 24:bn(e,n,s,c),d&2048&&mu(n.alternate,n);break;default:bn(e,n,s,c)}}function Ha(e,n,s,c,d){for(d=d&&((n.subtreeFlags&10256)!==0||!1),n=n.child;n!==null;){var h=e,y=n,b=s,C=c,w=y.flags;switch(y.tag){case 0:case 11:case 15:Ha(h,y,b,C,d),Ys(8,y);break;case 23:break;case 22:var B=y.stateNode;y.memoizedState!==null?B._visibility&2?Ha(h,y,b,C,d):Js(h,y):(B._visibility|=2,Ha(h,y,b,C,d)),d&&w&2048&&hu(y.alternate,y);break;case 24:Ha(h,y,b,C,d),d&&w&2048&&mu(y.alternate,y);break;default:Ha(h,y,b,C,d)}n=n.sibling}}function Js(e,n){if(n.subtreeFlags&10256)for(n=n.child;n!==null;){var s=e,c=n,d=c.flags;switch(c.tag){case 22:Js(s,c),d&2048&&hu(c.alternate,c);break;case 24:Js(s,c),d&2048&&mu(c.alternate,c);break;default:Js(s,c)}n=n.sibling}}var Xs=8192;function Fa(e,n,s){if(e.subtreeFlags&Xs)for(e=e.child;e!==null;)cp(e,n,s),e=e.sibling}function cp(e,n,s){switch(e.tag){case 26:Fa(e,n,s),e.flags&Xs&&e.memoizedState!==null&&BS(s,yn,e.memoizedState,e.memoizedProps);break;case 5:Fa(e,n,s);break;case 3:case 4:var c=yn;yn=Lo(e.stateNode.containerInfo),Fa(e,n,s),yn=c;break;case 22:e.memoizedState===null&&(c=e.alternate,c!==null&&c.memoizedState!==null?(c=Xs,Xs=16777216,Fa(e,n,s),Xs=c):Fa(e,n,s));break;default:Fa(e,n,s)}}function lp(e){var n=e.alternate;if(n!==null&&(e=n.child,e!==null)){n.child=null;do n=e.sibling,e.sibling=null,e=n;while(e!==null)}}function Zs(e){var n=e.deletions;if((e.flags&16)!==0){if(n!==null)for(var s=0;s<n.length;s++){var c=n[s];vt=c,dp(c,e)}lp(e)}if(e.subtreeFlags&10256)for(e=e.child;e!==null;)up(e),e=e.sibling}function up(e){switch(e.tag){case 0:case 11:case 15:Zs(e),e.flags&2048&&Ti(9,e,e.return);break;case 3:Zs(e);break;case 12:Zs(e);break;case 22:var n=e.stateNode;e.memoizedState!==null&&n._visibility&2&&(e.return===null||e.return.tag!==13)?(n._visibility&=-3,ko(e)):Zs(e);break;default:Zs(e)}}function ko(e){var n=e.deletions;if((e.flags&16)!==0){if(n!==null)for(var s=0;s<n.length;s++){var c=n[s];vt=c,dp(c,e)}lp(e)}for(e=e.child;e!==null;){switch(n=e,n.tag){case 0:case 11:case 15:Ti(8,n,n.return),ko(n);break;case 22:s=n.stateNode,s._visibility&2&&(s._visibility&=-3,ko(n));break;default:ko(n)}e=e.sibling}}function dp(e,n){for(;vt!==null;){var s=vt;switch(s.tag){case 0:case 11:case 15:Ti(8,s,n);break;case 23:case 22:if(s.memoizedState!==null&&s.memoizedState.cachePool!==null){var c=s.memoizedState.cachePool.pool;c!=null&&c.refCount++}break;case 24:Ps(s.memoizedState.cache)}if(c=s.child,c!==null)c.return=s,vt=c;else e:for(s=e;vt!==null;){c=vt;var d=c.sibling,h=c.return;if(tp(c),c===s){vt=null;break e}if(d!==null){d.return=h,vt=d;break e}vt=h}}}var eS={getCacheForType:function(e){var n=Ct(ct),s=n.data.get(e);return s===void 0&&(s=e(),n.data.set(e,s)),s},cacheSignal:function(){return Ct(ct).controller.signal}},tS=typeof WeakMap=="function"?WeakMap:Map,Ue=0,Fe=null,Ce=null,Re=0,je=0,$t=null,Ci=!1,Ga=!1,pu=!1,$n=0,$e=0,ki=0,ua=0,gu=0,en=0,Ka=0,Ws=null,zt=null,vu=!1,Eo=0,fp=0,_o=1/0,Ro=null,Ei=null,mt=0,_i=null,Ya=null,ei=0,yu=0,bu=null,hp=null,$s=0,Su=null;function tn(){return(Ue&2)!==0&&Re!==0?Re&-Re:I.T!==null?Ru():Df()}function mp(){if(en===0)if((Re&536870912)===0||Ae){var e=Nr;Nr<<=1,(Nr&3932160)===0&&(Nr=262144),en=e}else en=536870912;return e=Zt.current,e!==null&&(e.flags|=32),en}function qt(e,n,s){(e===Fe&&(je===2||je===9)||e.cancelPendingCommit!==null)&&(Qa(e,0),Ri(e,Re,en,!1)),Ss(e,s),((Ue&2)===0||e!==Fe)&&(e===Fe&&((Ue&2)===0&&(ua|=s),$e===4&&Ri(e,Re,en,!1)),Mn(e))}function pp(e,n,s){if((Ue&6)!==0)throw Error(a(327));var c=!s&&(n&127)===0&&(n&e.expiredLanes)===0||bs(e,n),d=c?aS(e,n):Cu(e,n,!0),h=c;do{if(d===0){Ga&&!c&&Ri(e,n,0,!1);break}else{if(s=e.current.alternate,h&&!nS(s)){d=Cu(e,n,!1),h=!1;continue}if(d===2){if(h=n,e.errorRecoveryDisabledLanes&h)var y=0;else y=e.pendingLanes&-536870913,y=y!==0?y:y&536870912?536870912:0;if(y!==0){n=y;e:{var b=e;d=Ws;var C=b.current.memoizedState.isDehydrated;if(C&&(Qa(b,y).flags|=256),y=Cu(b,y,!1),y!==2){if(pu&&!C){b.errorRecoveryDisabledLanes|=h,ua|=h,d=4;break e}h=zt,zt=d,h!==null&&(zt===null?zt=h:zt.push.apply(zt,h))}d=y}if(h=!1,d!==2)continue}}if(d===1){Qa(e,0),Ri(e,n,0,!0);break}e:{switch(c=e,h=d,h){case 0:case 1:throw Error(a(345));case 4:if((n&4194048)!==n)break;case 6:Ri(c,n,en,!Ci);break e;case 2:zt=null;break;case 3:case 5:break;default:throw Error(a(329))}if((n&62914560)===n&&(d=Eo+300-Kt(),10<d)){if(Ri(c,n,en,!Ci),Ur(c,0,!0)!==0)break e;ei=n,c.timeoutHandle=Kp(gp.bind(null,c,s,zt,Ro,vu,n,en,ua,Ka,Ci,h,"Throttled",-0,0),d);break e}gp(c,s,zt,Ro,vu,n,en,ua,Ka,Ci,h,null,-0,0)}}break}while(!0);Mn(e)}function gp(e,n,s,c,d,h,y,b,C,w,B,H,P,L){if(e.timeoutHandle=-1,H=n.subtreeFlags,H&8192||(H&16785408)===16785408){H={stylesheets:null,count:0,imgCount:0,imgBytes:0,suspenseyImages:[],waitingForImages:!0,waitingForViewTransition:!1,unsuspend:Bn},cp(n,h,H);var re=(h&62914560)===h?Eo-Kt():(h&4194048)===h?fp-Kt():0;if(re=zS(H,re),re!==null){ei=h,e.cancelPendingCommit=re(Ep.bind(null,e,n,h,s,c,d,y,b,C,B,H,null,P,L)),Ri(e,h,y,!w);return}}Ep(e,n,h,s,c,d,y,b,C)}function nS(e){for(var n=e;;){var s=n.tag;if((s===0||s===11||s===15)&&n.flags&16384&&(s=n.updateQueue,s!==null&&(s=s.stores,s!==null)))for(var c=0;c<s.length;c++){var d=s[c],h=d.getSnapshot;d=d.value;try{if(!Jt(h(),d))return!1}catch{return!1}}if(s=n.child,n.subtreeFlags&16384&&s!==null)s.return=n,n=s;else{if(n===e)break;for(;n.sibling===null;){if(n.return===null||n.return===e)return!0;n=n.return}n.sibling.return=n.return,n=n.sibling}}return!0}function Ri(e,n,s,c){n&=~gu,n&=~ua,e.suspendedLanes|=n,e.pingedLanes&=~n,c&&(e.warmLanes|=n),c=e.expirationTimes;for(var d=n;0<d;){var h=31-Qt(d),y=1<<h;c[h]=-1,d&=~y}s!==0&&Rf(e,s,n)}function Oo(){return(Ue&6)===0?(er(0),!1):!0}function Tu(){if(Ce!==null){if(je===0)var e=Ce.return;else e=Ce,Hn=ta=null,Il(e),ja=null,Ls=0,e=Ce;for(;e!==null;)Ym(e.alternate,e),e=e.return;Ce=null}}function Qa(e,n){var s=e.timeoutHandle;s!==-1&&(e.timeoutHandle=-1,CS(s)),s=e.cancelPendingCommit,s!==null&&(e.cancelPendingCommit=null,s()),ei=0,Tu(),Fe=e,Ce=s=qn(e.current,null),Re=n,je=0,$t=null,Ci=!1,Ga=bs(e,n),pu=!1,Ka=en=gu=ua=ki=$e=0,zt=Ws=null,vu=!1,(n&8)!==0&&(n|=n&32);var c=e.entangledLanes;if(c!==0)for(e=e.entanglements,c&=n;0<c;){var d=31-Qt(c),h=1<<d;n|=e[d],c&=~h}return $n=n,Yr(),s}function vp(e,n){ve=null,I.H=Fs,n===Ia||n===to?(n=Nh(),je=3):n===_l?(n=Nh(),je=4):je=n===$l?8:n!==null&&typeof n=="object"&&typeof n.then=="function"?6:1,$t=n,Ce===null&&($e=1,go(e,on(n,e.current)))}function yp(){var e=Zt.current;return e===null?!0:(Re&4194048)===Re?dn===null:(Re&62914560)===Re||(Re&536870912)!==0?e===dn:!1}function bp(){var e=I.H;return I.H=Fs,e===null?Fs:e}function Sp(){var e=I.A;return I.A=eS,e}function Ao(){$e=4,Ci||(Re&4194048)!==Re&&Zt.current!==null||(Ga=!0),(ki&134217727)===0&&(ua&134217727)===0||Fe===null||Ri(Fe,Re,en,!1)}function Cu(e,n,s){var c=Ue;Ue|=2;var d=bp(),h=Sp();(Fe!==e||Re!==n)&&(Ro=null,Qa(e,n)),n=!1;var y=$e;e:do try{if(je!==0&&Ce!==null){var b=Ce,C=$t;switch(je){case 8:Tu(),y=6;break e;case 3:case 2:case 9:case 6:Zt.current===null&&(n=!0);var w=je;if(je=0,$t=null,Ja(e,b,C,w),s&&Ga){y=0;break e}break;default:w=je,je=0,$t=null,Ja(e,b,C,w)}}iS(),y=$e;break}catch(B){vp(e,B)}while(!0);return n&&e.shellSuspendCounter++,Hn=ta=null,Ue=c,I.H=d,I.A=h,Ce===null&&(Fe=null,Re=0,Yr()),y}function iS(){for(;Ce!==null;)Tp(Ce)}function aS(e,n){var s=Ue;Ue|=2;var c=bp(),d=Sp();Fe!==e||Re!==n?(Ro=null,_o=Kt()+500,Qa(e,n)):Ga=bs(e,n);e:do try{if(je!==0&&Ce!==null){n=Ce;var h=$t;t:switch(je){case 1:je=0,$t=null,Ja(e,n,h,1);break;case 2:case 9:if(wh(h)){je=0,$t=null,Cp(n);break}n=function(){je!==2&&je!==9||Fe!==e||(je=7),Mn(e)},h.then(n,n);break e;case 3:je=7;break e;case 4:je=5;break e;case 7:wh(h)?(je=0,$t=null,Cp(n)):(je=0,$t=null,Ja(e,n,h,7));break;case 5:var y=null;switch(Ce.tag){case 26:y=Ce.memoizedState;case 5:case 27:var b=Ce;if(y?og(y):b.stateNode.complete){je=0,$t=null;var C=b.sibling;if(C!==null)Ce=C;else{var w=b.return;w!==null?(Ce=w,Do(w)):Ce=null}break t}}je=0,$t=null,Ja(e,n,h,5);break;case 6:je=0,$t=null,Ja(e,n,h,6);break;case 8:Tu(),$e=6;break e;default:throw Error(a(462))}}sS();break}catch(B){vp(e,B)}while(!0);return Hn=ta=null,I.H=c,I.A=d,Ue=s,Ce!==null?0:(Fe=null,Re=0,Yr(),$e)}function sS(){for(;Ce!==null&&!Ay();)Tp(Ce)}function Tp(e){var n=Gm(e.alternate,e,$n);e.memoizedProps=e.pendingProps,n===null?Do(e):Ce=n}function Cp(e){var n=e,s=n.alternate;switch(n.tag){case 15:case 0:n=Bm(s,n,n.pendingProps,n.type,void 0,Re);break;case 11:n=Bm(s,n,n.pendingProps,n.type.render,n.ref,Re);break;case 5:Il(n);default:Ym(s,n),n=Ce=Sh(n,$n),n=Gm(s,n,$n)}e.memoizedProps=e.pendingProps,n===null?Do(e):Ce=n}function Ja(e,n,s,c){Hn=ta=null,Il(n),ja=null,Ls=0;var d=n.return;try{if(Yb(e,d,n,s,Re)){$e=1,go(e,on(s,e.current)),Ce=null;return}}catch(h){if(d!==null)throw Ce=d,h;$e=1,go(e,on(s,e.current)),Ce=null;return}n.flags&32768?(Ae||c===1?e=!0:Ga||(Re&536870912)!==0?e=!1:(Ci=e=!0,(c===2||c===9||c===3||c===6)&&(c=Zt.current,c!==null&&c.tag===13&&(c.flags|=16384))),kp(n,e)):Do(n)}function Do(e){var n=e;do{if((n.flags&32768)!==0){kp(n,Ci);return}e=n.return;var s=Xb(n.alternate,n,$n);if(s!==null){Ce=s;return}if(n=n.sibling,n!==null){Ce=n;return}Ce=n=e}while(n!==null);$e===0&&($e=5)}function kp(e,n){do{var s=Zb(e.alternate,e);if(s!==null){s.flags&=32767,Ce=s;return}if(s=e.return,s!==null&&(s.flags|=32768,s.subtreeFlags=0,s.deletions=null),!n&&(e=e.sibling,e!==null)){Ce=e;return}Ce=e=s}while(e!==null);$e=6,Ce=null}function Ep(e,n,s,c,d,h,y,b,C){e.cancelPendingCommit=null;do Mo();while(mt!==0);if((Ue&6)!==0)throw Error(a(327));if(n!==null){if(n===e.current)throw Error(a(177));if(h=n.lanes|n.childLanes,h|=ul,jy(e,s,h,y,b,C),e===Fe&&(Ce=Fe=null,Re=0),Ya=n,_i=e,ei=s,yu=h,bu=d,hp=c,(n.subtreeFlags&10256)!==0||(n.flags&10256)!==0?(e.callbackNode=null,e.callbackPriority=0,lS(wr,function(){return Dp(),null})):(e.callbackNode=null,e.callbackPriority=0),c=(n.flags&13878)!==0,(n.subtreeFlags&13878)!==0||c){c=I.T,I.T=null,d=W.p,W.p=2,y=Ue,Ue|=4;try{Wb(e,n,s)}finally{Ue=y,W.p=d,I.T=c}}mt=1,_p(),Rp(),Op()}}function _p(){if(mt===1){mt=0;var e=_i,n=Ya,s=(n.flags&13878)!==0;if((n.subtreeFlags&13878)!==0||s){s=I.T,I.T=null;var c=W.p;W.p=2;var d=Ue;Ue|=4;try{sp(n,e);var h=Pu,y=dh(e.containerInfo),b=h.focusedElem,C=h.selectionRange;if(y!==b&&b&&b.ownerDocument&&uh(b.ownerDocument.documentElement,b)){if(C!==null&&sl(b)){var w=C.start,B=C.end;if(B===void 0&&(B=w),"selectionStart"in b)b.selectionStart=w,b.selectionEnd=Math.min(B,b.value.length);else{var H=b.ownerDocument||document,P=H&&H.defaultView||window;if(P.getSelection){var L=P.getSelection(),re=b.textContent.length,fe=Math.min(C.start,re),Ve=C.end===void 0?fe:Math.min(C.end,re);!L.extend&&fe>Ve&&(y=Ve,Ve=fe,fe=y);var A=lh(b,fe),_=lh(b,Ve);if(A&&_&&(L.rangeCount!==1||L.anchorNode!==A.node||L.anchorOffset!==A.offset||L.focusNode!==_.node||L.focusOffset!==_.offset)){var D=H.createRange();D.setStart(A.node,A.offset),L.removeAllRanges(),fe>Ve?(L.addRange(D),L.extend(_.node,_.offset)):(D.setEnd(_.node,_.offset),L.addRange(D))}}}}for(H=[],L=b;L=L.parentNode;)L.nodeType===1&&H.push({element:L,left:L.scrollLeft,top:L.scrollTop});for(typeof b.focus=="function"&&b.focus(),b=0;b<H.length;b++){var z=H[b];z.element.scrollLeft=z.left,z.element.scrollTop=z.top}}Vo=!!Nu,Pu=Nu=null}finally{Ue=d,W.p=c,I.T=s}}e.current=n,mt=2}}function Rp(){if(mt===2){mt=0;var e=_i,n=Ya,s=(n.flags&8772)!==0;if((n.subtreeFlags&8772)!==0||s){s=I.T,I.T=null;var c=W.p;W.p=2;var d=Ue;Ue|=4;try{ep(e,n.alternate,n)}finally{Ue=d,W.p=c,I.T=s}}mt=3}}function Op(){if(mt===4||mt===3){mt=0,Dy();var e=_i,n=Ya,s=ei,c=hp;(n.subtreeFlags&10256)!==0||(n.flags&10256)!==0?mt=5:(mt=0,Ya=_i=null,Ap(e,e.pendingLanes));var d=e.pendingLanes;if(d===0&&(Ei=null),zc(s),n=n.stateNode,Yt&&typeof Yt.onCommitFiberRoot=="function")try{Yt.onCommitFiberRoot(ys,n,void 0,(n.current.flags&128)===128)}catch{}if(c!==null){n=I.T,d=W.p,W.p=2,I.T=null;try{for(var h=e.onRecoverableError,y=0;y<c.length;y++){var b=c[y];h(b.value,{componentStack:b.stack})}}finally{I.T=n,W.p=d}}(ei&3)!==0&&Mo(),Mn(e),d=e.pendingLanes,(s&261930)!==0&&(d&42)!==0?e===Su?$s++:($s=0,Su=e):$s=0,er(0)}}function Ap(e,n){(e.pooledCacheLanes&=n)===0&&(n=e.pooledCache,n!=null&&(e.pooledCache=null,Ps(n)))}function Mo(){return _p(),Rp(),Op(),Dp()}function Dp(){if(mt!==5)return!1;var e=_i,n=yu;yu=0;var s=zc(ei),c=I.T,d=W.p;try{W.p=32>s?32:s,I.T=null,s=bu,bu=null;var h=_i,y=ei;if(mt=0,Ya=_i=null,ei=0,(Ue&6)!==0)throw Error(a(331));var b=Ue;if(Ue|=4,up(h.current),op(h,h.current,y,s),Ue=b,er(0,!1),Yt&&typeof Yt.onPostCommitFiberRoot=="function")try{Yt.onPostCommitFiberRoot(ys,h)}catch{}return!0}finally{W.p=d,I.T=c,Ap(e,n)}}function Mp(e,n,s){n=on(s,n),n=Wl(e.stateNode,n,2),e=yi(e,n,2),e!==null&&(Ss(e,2),Mn(e))}function Be(e,n,s){if(e.tag===3)Mp(e,e,s);else for(;n!==null;){if(n.tag===3){Mp(n,e,s);break}else if(n.tag===1){var c=n.stateNode;if(typeof n.type.getDerivedStateFromError=="function"||typeof c.componentDidCatch=="function"&&(Ei===null||!Ei.has(c))){e=on(s,e),s=wm(2),c=yi(n,s,2),c!==null&&(xm(s,c,n,e),Ss(c,2),Mn(c));break}}n=n.return}}function ku(e,n,s){var c=e.pingCache;if(c===null){c=e.pingCache=new tS;var d=new Set;c.set(n,d)}else d=c.get(n),d===void 0&&(d=new Set,c.set(n,d));d.has(s)||(pu=!0,d.add(s),e=rS.bind(null,e,n,s),n.then(e,e))}function rS(e,n,s){var c=e.pingCache;c!==null&&c.delete(n),e.pingedLanes|=e.suspendedLanes&s,e.warmLanes&=~s,Fe===e&&(Re&s)===s&&($e===4||$e===3&&(Re&62914560)===Re&&300>Kt()-Eo?(Ue&2)===0&&Qa(e,0):gu|=s,Ka===Re&&(Ka=0)),Mn(e)}function wp(e,n){n===0&&(n=_f()),e=Wi(e,n),e!==null&&(Ss(e,n),Mn(e))}function oS(e){var n=e.memoizedState,s=0;n!==null&&(s=n.retryLane),wp(e,s)}function cS(e,n){var s=0;switch(e.tag){case 31:case 13:var c=e.stateNode,d=e.memoizedState;d!==null&&(s=d.retryLane);break;case 19:c=e.stateNode;break;case 22:c=e.stateNode._retryCache;break;default:throw Error(a(314))}c!==null&&c.delete(n),wp(e,s)}function lS(e,n){return Lc(e,n)}var wo=null,Xa=null,Eu=!1,xo=!1,_u=!1,Oi=0;function Mn(e){e!==Xa&&e.next===null&&(Xa===null?wo=Xa=e:Xa=Xa.next=e),xo=!0,Eu||(Eu=!0,dS())}function er(e,n){if(!_u&&xo){_u=!0;do for(var s=!1,c=wo;c!==null;){if(e!==0){var d=c.pendingLanes;if(d===0)var h=0;else{var y=c.suspendedLanes,b=c.pingedLanes;h=(1<<31-Qt(42|e)+1)-1,h&=d&~(y&~b),h=h&201326741?h&201326741|1:h?h|2:0}h!==0&&(s=!0,Up(c,h))}else h=Re,h=Ur(c,c===Fe?h:0,c.cancelPendingCommit!==null||c.timeoutHandle!==-1),(h&3)===0||bs(c,h)||(s=!0,Up(c,h));c=c.next}while(s);_u=!1}}function uS(){xp()}function xp(){xo=Eu=!1;var e=0;Oi!==0&&TS()&&(e=Oi);for(var n=Kt(),s=null,c=wo;c!==null;){var d=c.next,h=Np(c,n);h===0?(c.next=null,s===null?wo=d:s.next=d,d===null&&(Xa=s)):(s=c,(e!==0||(h&3)!==0)&&(xo=!0)),c=d}mt!==0&&mt!==5||er(e),Oi!==0&&(Oi=0)}function Np(e,n){for(var s=e.suspendedLanes,c=e.pingedLanes,d=e.expirationTimes,h=e.pendingLanes&-62914561;0<h;){var y=31-Qt(h),b=1<<y,C=d[y];C===-1?((b&s)===0||(b&c)!==0)&&(d[y]=Iy(b,n)):C<=n&&(e.expiredLanes|=b),h&=~b}if(n=Fe,s=Re,s=Ur(e,e===n?s:0,e.cancelPendingCommit!==null||e.timeoutHandle!==-1),c=e.callbackNode,s===0||e===n&&(je===2||je===9)||e.cancelPendingCommit!==null)return c!==null&&c!==null&&Ic(c),e.callbackNode=null,e.callbackPriority=0;if((s&3)===0||bs(e,s)){if(n=s&-s,n===e.callbackPriority)return n;switch(c!==null&&Ic(c),zc(s)){case 2:case 8:s=kf;break;case 32:s=wr;break;case 268435456:s=Ef;break;default:s=wr}return c=Pp.bind(null,e),s=Lc(s,c),e.callbackPriority=n,e.callbackNode=s,n}return c!==null&&c!==null&&Ic(c),e.callbackPriority=2,e.callbackNode=null,2}function Pp(e,n){if(mt!==0&&mt!==5)return e.callbackNode=null,e.callbackPriority=0,null;var s=e.callbackNode;if(Mo()&&e.callbackNode!==s)return null;var c=Re;return c=Ur(e,e===Fe?c:0,e.cancelPendingCommit!==null||e.timeoutHandle!==-1),c===0?null:(pp(e,c,n),Np(e,Kt()),e.callbackNode!=null&&e.callbackNode===s?Pp.bind(null,e):null)}function Up(e,n){if(Mo())return null;pp(e,n,!0)}function dS(){kS(function(){(Ue&6)!==0?Lc(Cf,uS):xp()})}function Ru(){if(Oi===0){var e=Ua;e===0&&(e=xr,xr<<=1,(xr&261888)===0&&(xr=256)),Oi=e}return Oi}function Lp(e){return e==null||typeof e=="symbol"||typeof e=="boolean"?null:typeof e=="function"?e:Br(""+e)}function Ip(e,n){var s=n.ownerDocument.createElement("input");return s.name=n.name,s.value=n.value,e.id&&s.setAttribute("form",e.id),n.parentNode.insertBefore(s,n),e=new FormData(e),s.parentNode.removeChild(s),e}function fS(e,n,s,c,d){if(n==="submit"&&s&&s.stateNode===d){var h=Lp((d[Ut]||null).action),y=c.submitter;y&&(n=(n=y[Ut]||null)?Lp(n.formAction):y.getAttribute("formAction"),n!==null&&(h=n,y=null));var b=new Hr("action","action",null,c,d);e.push({event:b,listeners:[{instance:null,listener:function(){if(c.defaultPrevented){if(Oi!==0){var C=y?Ip(d,y):new FormData(d);Kl(s,{pending:!0,data:C,method:d.method,action:h},null,C)}}else typeof h=="function"&&(b.preventDefault(),C=y?Ip(d,y):new FormData(d),Kl(s,{pending:!0,data:C,method:d.method,action:h},h,C))},currentTarget:d}]})}}for(var Ou=0;Ou<ll.length;Ou++){var Au=ll[Ou],hS=Au.toLowerCase(),mS=Au[0].toUpperCase()+Au.slice(1);vn(hS,"on"+mS)}vn(mh,"onAnimationEnd"),vn(ph,"onAnimationIteration"),vn(gh,"onAnimationStart"),vn("dblclick","onDoubleClick"),vn("focusin","onFocus"),vn("focusout","onBlur"),vn(Mb,"onTransitionRun"),vn(wb,"onTransitionStart"),vn(xb,"onTransitionCancel"),vn(vh,"onTransitionEnd"),Ta("onMouseEnter",["mouseout","mouseover"]),Ta("onMouseLeave",["mouseout","mouseover"]),Ta("onPointerEnter",["pointerout","pointerover"]),Ta("onPointerLeave",["pointerout","pointerover"]),Qi("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),Qi("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),Qi("onBeforeInput",["compositionend","keypress","textInput","paste"]),Qi("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),Qi("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),Qi("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var tr="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),pS=new Set("beforetoggle cancel close invalid load scroll scrollend toggle".split(" ").concat(tr));function jp(e,n){n=(n&4)!==0;for(var s=0;s<e.length;s++){var c=e[s],d=c.event;c=c.listeners;e:{var h=void 0;if(n)for(var y=c.length-1;0<=y;y--){var b=c[y],C=b.instance,w=b.currentTarget;if(b=b.listener,C!==h&&d.isPropagationStopped())break e;h=b,d.currentTarget=w;try{h(d)}catch(B){Kr(B)}d.currentTarget=null,h=C}else for(y=0;y<c.length;y++){if(b=c[y],C=b.instance,w=b.currentTarget,b=b.listener,C!==h&&d.isPropagationStopped())break e;h=b,d.currentTarget=w;try{h(d)}catch(B){Kr(B)}d.currentTarget=null,h=C}}}}function ke(e,n){var s=n[qc];s===void 0&&(s=n[qc]=new Set);var c=e+"__bubble";s.has(c)||(Bp(n,e,2,!1),s.add(c))}function Du(e,n,s){var c=0;n&&(c|=4),Bp(s,e,c,n)}var No="_reactListening"+Math.random().toString(36).slice(2);function Mu(e){if(!e[No]){e[No]=!0,xf.forEach(function(s){s!=="selectionchange"&&(pS.has(s)||Du(s,!1,e),Du(s,!0,e))});var n=e.nodeType===9?e:e.ownerDocument;n===null||n[No]||(n[No]=!0,Du("selectionchange",!1,n))}}function Bp(e,n,s,c){switch(mg(n)){case 2:var d=HS;break;case 8:d=FS;break;default:d=Gu}s=d.bind(null,n,s,e),d=void 0,!Xc||n!=="touchstart"&&n!=="touchmove"&&n!=="wheel"||(d=!0),c?d!==void 0?e.addEventListener(n,s,{capture:!0,passive:d}):e.addEventListener(n,s,!0):d!==void 0?e.addEventListener(n,s,{passive:d}):e.addEventListener(n,s,!1)}function wu(e,n,s,c,d){var h=c;if((n&1)===0&&(n&2)===0&&c!==null)e:for(;;){if(c===null)return;var y=c.tag;if(y===3||y===4){var b=c.stateNode.containerInfo;if(b===d)break;if(y===4)for(y=c.return;y!==null;){var C=y.tag;if((C===3||C===4)&&y.stateNode.containerInfo===d)return;y=y.return}for(;b!==null;){if(y=ya(b),y===null)return;if(C=y.tag,C===5||C===6||C===26||C===27){c=h=y;continue e}b=b.parentNode}}c=c.return}Ff(function(){var w=h,B=Qc(s),H=[];e:{var P=yh.get(e);if(P!==void 0){var L=Hr,re=e;switch(e){case"keypress":if(qr(s)===0)break e;case"keydown":case"keyup":L=cb;break;case"focusin":re="focus",L=el;break;case"focusout":re="blur",L=el;break;case"beforeblur":case"afterblur":L=el;break;case"click":if(s.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":L=Yf;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":L=Xy;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":L=db;break;case mh:case ph:case gh:L=$y;break;case vh:L=hb;break;case"scroll":case"scrollend":L=Qy;break;case"wheel":L=pb;break;case"copy":case"cut":case"paste":L=tb;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":L=Jf;break;case"toggle":case"beforetoggle":L=vb}var fe=(n&4)!==0,Ve=!fe&&(e==="scroll"||e==="scrollend"),A=fe?P!==null?P+"Capture":null:P;fe=[];for(var _=w,D;_!==null;){var z=_;if(D=z.stateNode,z=z.tag,z!==5&&z!==26&&z!==27||D===null||A===null||(z=ks(_,A),z!=null&&fe.push(nr(_,z,D))),Ve)break;_=_.return}0<fe.length&&(P=new L(P,re,null,s,B),H.push({event:P,listeners:fe}))}}if((n&7)===0){e:{if(P=e==="mouseover"||e==="pointerover",L=e==="mouseout"||e==="pointerout",P&&s!==Yc&&(re=s.relatedTarget||s.fromElement)&&(ya(re)||re[va]))break e;if((L||P)&&(P=B.window===B?B:(P=B.ownerDocument)?P.defaultView||P.parentWindow:window,L?(re=s.relatedTarget||s.toElement,L=w,re=re?ya(re):null,re!==null&&(Ve=l(re),fe=re.tag,re!==Ve||fe!==5&&fe!==27&&fe!==6)&&(re=null)):(L=null,re=w),L!==re)){if(fe=Yf,z="onMouseLeave",A="onMouseEnter",_="mouse",(e==="pointerout"||e==="pointerover")&&(fe=Jf,z="onPointerLeave",A="onPointerEnter",_="pointer"),Ve=L==null?P:Cs(L),D=re==null?P:Cs(re),P=new fe(z,_+"leave",L,s,B),P.target=Ve,P.relatedTarget=D,z=null,ya(B)===w&&(fe=new fe(A,_+"enter",re,s,B),fe.target=D,fe.relatedTarget=Ve,z=fe),Ve=z,L&&re)t:{for(fe=gS,A=L,_=re,D=0,z=A;z;z=fe(z))D++;z=0;for(var le=_;le;le=fe(le))z++;for(;0<D-z;)A=fe(A),D--;for(;0<z-D;)_=fe(_),z--;for(;D--;){if(A===_||_!==null&&A===_.alternate){fe=A;break t}A=fe(A),_=fe(_)}fe=null}else fe=null;L!==null&&zp(H,P,L,fe,!1),re!==null&&Ve!==null&&zp(H,Ve,re,fe,!0)}}e:{if(P=w?Cs(w):window,L=P.nodeName&&P.nodeName.toLowerCase(),L==="select"||L==="input"&&P.type==="file")var we=ih;else if(th(P))if(ah)we=Ob;else{we=_b;var ce=Eb}else L=P.nodeName,!L||L.toLowerCase()!=="input"||P.type!=="checkbox"&&P.type!=="radio"?w&&Kc(w.elementType)&&(we=ih):we=Rb;if(we&&(we=we(e,w))){nh(H,we,s,B);break e}ce&&ce(e,P,w),e==="focusout"&&w&&P.type==="number"&&w.memoizedProps.value!=null&&Gc(P,"number",P.value)}switch(ce=w?Cs(w):window,e){case"focusin":(th(ce)||ce.contentEditable==="true")&&(Oa=ce,rl=w,ws=null);break;case"focusout":ws=rl=Oa=null;break;case"mousedown":ol=!0;break;case"contextmenu":case"mouseup":case"dragend":ol=!1,fh(H,s,B);break;case"selectionchange":if(Db)break;case"keydown":case"keyup":fh(H,s,B)}var be;if(nl)e:{switch(e){case"compositionstart":var Oe="onCompositionStart";break e;case"compositionend":Oe="onCompositionEnd";break e;case"compositionupdate":Oe="onCompositionUpdate";break e}Oe=void 0}else Ra?$f(e,s)&&(Oe="onCompositionEnd"):e==="keydown"&&s.keyCode===229&&(Oe="onCompositionStart");Oe&&(Xf&&s.locale!=="ko"&&(Ra||Oe!=="onCompositionStart"?Oe==="onCompositionEnd"&&Ra&&(be=Gf()):(di=B,Zc="value"in di?di.value:di.textContent,Ra=!0)),ce=Po(w,Oe),0<ce.length&&(Oe=new Qf(Oe,e,null,s,B),H.push({event:Oe,listeners:ce}),be?Oe.data=be:(be=eh(s),be!==null&&(Oe.data=be)))),(be=bb?Sb(e,s):Tb(e,s))&&(Oe=Po(w,"onBeforeInput"),0<Oe.length&&(ce=new Qf("onBeforeInput","beforeinput",null,s,B),H.push({event:ce,listeners:Oe}),ce.data=be)),fS(H,e,w,s,B)}jp(H,n)})}function nr(e,n,s){return{instance:e,listener:n,currentTarget:s}}function Po(e,n){for(var s=n+"Capture",c=[];e!==null;){var d=e,h=d.stateNode;if(d=d.tag,d!==5&&d!==26&&d!==27||h===null||(d=ks(e,s),d!=null&&c.unshift(nr(e,d,h)),d=ks(e,n),d!=null&&c.push(nr(e,d,h))),e.tag===3)return c;e=e.return}return[]}function gS(e){if(e===null)return null;do e=e.return;while(e&&e.tag!==5&&e.tag!==27);return e||null}function zp(e,n,s,c,d){for(var h=n._reactName,y=[];s!==null&&s!==c;){var b=s,C=b.alternate,w=b.stateNode;if(b=b.tag,C!==null&&C===c)break;b!==5&&b!==26&&b!==27||w===null||(C=w,d?(w=ks(s,h),w!=null&&y.unshift(nr(s,w,C))):d||(w=ks(s,h),w!=null&&y.push(nr(s,w,C)))),s=s.return}y.length!==0&&e.push({event:n,listeners:y})}var vS=/\r\n?/g,yS=/\u0000|\uFFFD/g;function qp(e){return(typeof e=="string"?e:""+e).replace(vS,`
`).replace(yS,"")}function Vp(e,n){return n=qp(n),qp(e)===n}function qe(e,n,s,c,d,h){switch(s){case"children":typeof c=="string"?n==="body"||n==="textarea"&&c===""||ka(e,c):(typeof c=="number"||typeof c=="bigint")&&n!=="body"&&ka(e,""+c);break;case"className":Ir(e,"class",c);break;case"tabIndex":Ir(e,"tabindex",c);break;case"dir":case"role":case"viewBox":case"width":case"height":Ir(e,s,c);break;case"style":Vf(e,c,h);break;case"data":if(n!=="object"){Ir(e,"data",c);break}case"src":case"href":if(c===""&&(n!=="a"||s!=="href")){e.removeAttribute(s);break}if(c==null||typeof c=="function"||typeof c=="symbol"||typeof c=="boolean"){e.removeAttribute(s);break}c=Br(""+c),e.setAttribute(s,c);break;case"action":case"formAction":if(typeof c=="function"){e.setAttribute(s,"javascript:throw new Error('A React form was unexpectedly submitted. If you called form.submit() manually, consider using form.requestSubmit() instead. If you\\'re trying to use event.stopPropagation() in a submit event handler, consider also calling event.preventDefault().')");break}else typeof h=="function"&&(s==="formAction"?(n!=="input"&&qe(e,n,"name",d.name,d,null),qe(e,n,"formEncType",d.formEncType,d,null),qe(e,n,"formMethod",d.formMethod,d,null),qe(e,n,"formTarget",d.formTarget,d,null)):(qe(e,n,"encType",d.encType,d,null),qe(e,n,"method",d.method,d,null),qe(e,n,"target",d.target,d,null)));if(c==null||typeof c=="symbol"||typeof c=="boolean"){e.removeAttribute(s);break}c=Br(""+c),e.setAttribute(s,c);break;case"onClick":c!=null&&(e.onclick=Bn);break;case"onScroll":c!=null&&ke("scroll",e);break;case"onScrollEnd":c!=null&&ke("scrollend",e);break;case"dangerouslySetInnerHTML":if(c!=null){if(typeof c!="object"||!("__html"in c))throw Error(a(61));if(s=c.__html,s!=null){if(d.children!=null)throw Error(a(60));e.innerHTML=s}}break;case"multiple":e.multiple=c&&typeof c!="function"&&typeof c!="symbol";break;case"muted":e.muted=c&&typeof c!="function"&&typeof c!="symbol";break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"defaultValue":case"defaultChecked":case"innerHTML":case"ref":break;case"autoFocus":break;case"xlinkHref":if(c==null||typeof c=="function"||typeof c=="boolean"||typeof c=="symbol"){e.removeAttribute("xlink:href");break}s=Br(""+c),e.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",s);break;case"contentEditable":case"spellCheck":case"draggable":case"value":case"autoReverse":case"externalResourcesRequired":case"focusable":case"preserveAlpha":c!=null&&typeof c!="function"&&typeof c!="symbol"?e.setAttribute(s,""+c):e.removeAttribute(s);break;case"inert":case"allowFullScreen":case"async":case"autoPlay":case"controls":case"default":case"defer":case"disabled":case"disablePictureInPicture":case"disableRemotePlayback":case"formNoValidate":case"hidden":case"loop":case"noModule":case"noValidate":case"open":case"playsInline":case"readOnly":case"required":case"reversed":case"scoped":case"seamless":case"itemScope":c&&typeof c!="function"&&typeof c!="symbol"?e.setAttribute(s,""):e.removeAttribute(s);break;case"capture":case"download":c===!0?e.setAttribute(s,""):c!==!1&&c!=null&&typeof c!="function"&&typeof c!="symbol"?e.setAttribute(s,c):e.removeAttribute(s);break;case"cols":case"rows":case"size":case"span":c!=null&&typeof c!="function"&&typeof c!="symbol"&&!isNaN(c)&&1<=c?e.setAttribute(s,c):e.removeAttribute(s);break;case"rowSpan":case"start":c==null||typeof c=="function"||typeof c=="symbol"||isNaN(c)?e.removeAttribute(s):e.setAttribute(s,c);break;case"popover":ke("beforetoggle",e),ke("toggle",e),Lr(e,"popover",c);break;case"xlinkActuate":jn(e,"http://www.w3.org/1999/xlink","xlink:actuate",c);break;case"xlinkArcrole":jn(e,"http://www.w3.org/1999/xlink","xlink:arcrole",c);break;case"xlinkRole":jn(e,"http://www.w3.org/1999/xlink","xlink:role",c);break;case"xlinkShow":jn(e,"http://www.w3.org/1999/xlink","xlink:show",c);break;case"xlinkTitle":jn(e,"http://www.w3.org/1999/xlink","xlink:title",c);break;case"xlinkType":jn(e,"http://www.w3.org/1999/xlink","xlink:type",c);break;case"xmlBase":jn(e,"http://www.w3.org/XML/1998/namespace","xml:base",c);break;case"xmlLang":jn(e,"http://www.w3.org/XML/1998/namespace","xml:lang",c);break;case"xmlSpace":jn(e,"http://www.w3.org/XML/1998/namespace","xml:space",c);break;case"is":Lr(e,"is",c);break;case"innerText":case"textContent":break;default:(!(2<s.length)||s[0]!=="o"&&s[0]!=="O"||s[1]!=="n"&&s[1]!=="N")&&(s=Ky.get(s)||s,Lr(e,s,c))}}function xu(e,n,s,c,d,h){switch(s){case"style":Vf(e,c,h);break;case"dangerouslySetInnerHTML":if(c!=null){if(typeof c!="object"||!("__html"in c))throw Error(a(61));if(s=c.__html,s!=null){if(d.children!=null)throw Error(a(60));e.innerHTML=s}}break;case"children":typeof c=="string"?ka(e,c):(typeof c=="number"||typeof c=="bigint")&&ka(e,""+c);break;case"onScroll":c!=null&&ke("scroll",e);break;case"onScrollEnd":c!=null&&ke("scrollend",e);break;case"onClick":c!=null&&(e.onclick=Bn);break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"innerHTML":case"ref":break;case"innerText":case"textContent":break;default:if(!Nf.hasOwnProperty(s))e:{if(s[0]==="o"&&s[1]==="n"&&(d=s.endsWith("Capture"),n=s.slice(2,d?s.length-7:void 0),h=e[Ut]||null,h=h!=null?h[s]:null,typeof h=="function"&&e.removeEventListener(n,h,d),typeof c=="function")){typeof h!="function"&&h!==null&&(s in e?e[s]=null:e.hasAttribute(s)&&e.removeAttribute(s)),e.addEventListener(n,c,d);break e}s in e?e[s]=c:c===!0?e.setAttribute(s,""):Lr(e,s,c)}}}function Et(e,n,s){switch(n){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"img":ke("error",e),ke("load",e);var c=!1,d=!1,h;for(h in s)if(s.hasOwnProperty(h)){var y=s[h];if(y!=null)switch(h){case"src":c=!0;break;case"srcSet":d=!0;break;case"children":case"dangerouslySetInnerHTML":throw Error(a(137,n));default:qe(e,n,h,y,s,null)}}d&&qe(e,n,"srcSet",s.srcSet,s,null),c&&qe(e,n,"src",s.src,s,null);return;case"input":ke("invalid",e);var b=h=y=d=null,C=null,w=null;for(c in s)if(s.hasOwnProperty(c)){var B=s[c];if(B!=null)switch(c){case"name":d=B;break;case"type":y=B;break;case"checked":C=B;break;case"defaultChecked":w=B;break;case"value":h=B;break;case"defaultValue":b=B;break;case"children":case"dangerouslySetInnerHTML":if(B!=null)throw Error(a(137,n));break;default:qe(e,n,c,B,s,null)}}jf(e,h,b,C,w,y,d,!1);return;case"select":ke("invalid",e),c=y=h=null;for(d in s)if(s.hasOwnProperty(d)&&(b=s[d],b!=null))switch(d){case"value":h=b;break;case"defaultValue":y=b;break;case"multiple":c=b;default:qe(e,n,d,b,s,null)}n=h,s=y,e.multiple=!!c,n!=null?Ca(e,!!c,n,!1):s!=null&&Ca(e,!!c,s,!0);return;case"textarea":ke("invalid",e),h=d=c=null;for(y in s)if(s.hasOwnProperty(y)&&(b=s[y],b!=null))switch(y){case"value":c=b;break;case"defaultValue":d=b;break;case"children":h=b;break;case"dangerouslySetInnerHTML":if(b!=null)throw Error(a(91));break;default:qe(e,n,y,b,s,null)}zf(e,c,d,h);return;case"option":for(C in s)if(s.hasOwnProperty(C)&&(c=s[C],c!=null))switch(C){case"selected":e.selected=c&&typeof c!="function"&&typeof c!="symbol";break;default:qe(e,n,C,c,s,null)}return;case"dialog":ke("beforetoggle",e),ke("toggle",e),ke("cancel",e),ke("close",e);break;case"iframe":case"object":ke("load",e);break;case"video":case"audio":for(c=0;c<tr.length;c++)ke(tr[c],e);break;case"image":ke("error",e),ke("load",e);break;case"details":ke("toggle",e);break;case"embed":case"source":case"link":ke("error",e),ke("load",e);case"area":case"base":case"br":case"col":case"hr":case"keygen":case"meta":case"param":case"track":case"wbr":case"menuitem":for(w in s)if(s.hasOwnProperty(w)&&(c=s[w],c!=null))switch(w){case"children":case"dangerouslySetInnerHTML":throw Error(a(137,n));default:qe(e,n,w,c,s,null)}return;default:if(Kc(n)){for(B in s)s.hasOwnProperty(B)&&(c=s[B],c!==void 0&&xu(e,n,B,c,s,void 0));return}}for(b in s)s.hasOwnProperty(b)&&(c=s[b],c!=null&&qe(e,n,b,c,s,null))}function bS(e,n,s,c){switch(n){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"input":var d=null,h=null,y=null,b=null,C=null,w=null,B=null;for(L in s){var H=s[L];if(s.hasOwnProperty(L)&&H!=null)switch(L){case"checked":break;case"value":break;case"defaultValue":C=H;default:c.hasOwnProperty(L)||qe(e,n,L,null,c,H)}}for(var P in c){var L=c[P];if(H=s[P],c.hasOwnProperty(P)&&(L!=null||H!=null))switch(P){case"type":h=L;break;case"name":d=L;break;case"checked":w=L;break;case"defaultChecked":B=L;break;case"value":y=L;break;case"defaultValue":b=L;break;case"children":case"dangerouslySetInnerHTML":if(L!=null)throw Error(a(137,n));break;default:L!==H&&qe(e,n,P,L,c,H)}}Fc(e,y,b,C,w,B,h,d);return;case"select":L=y=b=P=null;for(h in s)if(C=s[h],s.hasOwnProperty(h)&&C!=null)switch(h){case"value":break;case"multiple":L=C;default:c.hasOwnProperty(h)||qe(e,n,h,null,c,C)}for(d in c)if(h=c[d],C=s[d],c.hasOwnProperty(d)&&(h!=null||C!=null))switch(d){case"value":P=h;break;case"defaultValue":b=h;break;case"multiple":y=h;default:h!==C&&qe(e,n,d,h,c,C)}n=b,s=y,c=L,P!=null?Ca(e,!!s,P,!1):!!c!=!!s&&(n!=null?Ca(e,!!s,n,!0):Ca(e,!!s,s?[]:"",!1));return;case"textarea":L=P=null;for(b in s)if(d=s[b],s.hasOwnProperty(b)&&d!=null&&!c.hasOwnProperty(b))switch(b){case"value":break;case"children":break;default:qe(e,n,b,null,c,d)}for(y in c)if(d=c[y],h=s[y],c.hasOwnProperty(y)&&(d!=null||h!=null))switch(y){case"value":P=d;break;case"defaultValue":L=d;break;case"children":break;case"dangerouslySetInnerHTML":if(d!=null)throw Error(a(91));break;default:d!==h&&qe(e,n,y,d,c,h)}Bf(e,P,L);return;case"option":for(var re in s)if(P=s[re],s.hasOwnProperty(re)&&P!=null&&!c.hasOwnProperty(re))switch(re){case"selected":e.selected=!1;break;default:qe(e,n,re,null,c,P)}for(C in c)if(P=c[C],L=s[C],c.hasOwnProperty(C)&&P!==L&&(P!=null||L!=null))switch(C){case"selected":e.selected=P&&typeof P!="function"&&typeof P!="symbol";break;default:qe(e,n,C,P,c,L)}return;case"img":case"link":case"area":case"base":case"br":case"col":case"embed":case"hr":case"keygen":case"meta":case"param":case"source":case"track":case"wbr":case"menuitem":for(var fe in s)P=s[fe],s.hasOwnProperty(fe)&&P!=null&&!c.hasOwnProperty(fe)&&qe(e,n,fe,null,c,P);for(w in c)if(P=c[w],L=s[w],c.hasOwnProperty(w)&&P!==L&&(P!=null||L!=null))switch(w){case"children":case"dangerouslySetInnerHTML":if(P!=null)throw Error(a(137,n));break;default:qe(e,n,w,P,c,L)}return;default:if(Kc(n)){for(var Ve in s)P=s[Ve],s.hasOwnProperty(Ve)&&P!==void 0&&!c.hasOwnProperty(Ve)&&xu(e,n,Ve,void 0,c,P);for(B in c)P=c[B],L=s[B],!c.hasOwnProperty(B)||P===L||P===void 0&&L===void 0||xu(e,n,B,P,c,L);return}}for(var A in s)P=s[A],s.hasOwnProperty(A)&&P!=null&&!c.hasOwnProperty(A)&&qe(e,n,A,null,c,P);for(H in c)P=c[H],L=s[H],!c.hasOwnProperty(H)||P===L||P==null&&L==null||qe(e,n,H,P,c,L)}function Hp(e){switch(e){case"css":case"script":case"font":case"img":case"image":case"input":case"link":return!0;default:return!1}}function SS(){if(typeof performance.getEntriesByType=="function"){for(var e=0,n=0,s=performance.getEntriesByType("resource"),c=0;c<s.length;c++){var d=s[c],h=d.transferSize,y=d.initiatorType,b=d.duration;if(h&&b&&Hp(y)){for(y=0,b=d.responseEnd,c+=1;c<s.length;c++){var C=s[c],w=C.startTime;if(w>b)break;var B=C.transferSize,H=C.initiatorType;B&&Hp(H)&&(C=C.responseEnd,y+=B*(C<b?1:(b-w)/(C-w)))}if(--c,n+=8*(h+y)/(d.duration/1e3),e++,10<e)break}}if(0<e)return n/e/1e6}return navigator.connection&&(e=navigator.connection.downlink,typeof e=="number")?e:5}var Nu=null,Pu=null;function Uo(e){return e.nodeType===9?e:e.ownerDocument}function Fp(e){switch(e){case"http://www.w3.org/2000/svg":return 1;case"http://www.w3.org/1998/Math/MathML":return 2;default:return 0}}function Gp(e,n){if(e===0)switch(n){case"svg":return 1;case"math":return 2;default:return 0}return e===1&&n==="foreignObject"?0:e}function Uu(e,n){return e==="textarea"||e==="noscript"||typeof n.children=="string"||typeof n.children=="number"||typeof n.children=="bigint"||typeof n.dangerouslySetInnerHTML=="object"&&n.dangerouslySetInnerHTML!==null&&n.dangerouslySetInnerHTML.__html!=null}var Lu=null;function TS(){var e=window.event;return e&&e.type==="popstate"?e===Lu?!1:(Lu=e,!0):(Lu=null,!1)}var Kp=typeof setTimeout=="function"?setTimeout:void 0,CS=typeof clearTimeout=="function"?clearTimeout:void 0,Yp=typeof Promise=="function"?Promise:void 0,kS=typeof queueMicrotask=="function"?queueMicrotask:typeof Yp<"u"?function(e){return Yp.resolve(null).then(e).catch(ES)}:Kp;function ES(e){setTimeout(function(){throw e})}function Ai(e){return e==="head"}function Qp(e,n){var s=n,c=0;do{var d=s.nextSibling;if(e.removeChild(s),d&&d.nodeType===8)if(s=d.data,s==="/$"||s==="/&"){if(c===0){e.removeChild(d),es(n);return}c--}else if(s==="$"||s==="$?"||s==="$~"||s==="$!"||s==="&")c++;else if(s==="html")ir(e.ownerDocument.documentElement);else if(s==="head"){s=e.ownerDocument.head,ir(s);for(var h=s.firstChild;h;){var y=h.nextSibling,b=h.nodeName;h[Ts]||b==="SCRIPT"||b==="STYLE"||b==="LINK"&&h.rel.toLowerCase()==="stylesheet"||s.removeChild(h),h=y}}else s==="body"&&ir(e.ownerDocument.body);s=d}while(s);es(n)}function Jp(e,n){var s=e;e=0;do{var c=s.nextSibling;if(s.nodeType===1?n?(s._stashedDisplay=s.style.display,s.style.display="none"):(s.style.display=s._stashedDisplay||"",s.getAttribute("style")===""&&s.removeAttribute("style")):s.nodeType===3&&(n?(s._stashedText=s.nodeValue,s.nodeValue=""):s.nodeValue=s._stashedText||""),c&&c.nodeType===8)if(s=c.data,s==="/$"){if(e===0)break;e--}else s!=="$"&&s!=="$?"&&s!=="$~"&&s!=="$!"||e++;s=c}while(s)}function Iu(e){var n=e.firstChild;for(n&&n.nodeType===10&&(n=n.nextSibling);n;){var s=n;switch(n=n.nextSibling,s.nodeName){case"HTML":case"HEAD":case"BODY":Iu(s),Vc(s);continue;case"SCRIPT":case"STYLE":continue;case"LINK":if(s.rel.toLowerCase()==="stylesheet")continue}e.removeChild(s)}}function _S(e,n,s,c){for(;e.nodeType===1;){var d=s;if(e.nodeName.toLowerCase()!==n.toLowerCase()){if(!c&&(e.nodeName!=="INPUT"||e.type!=="hidden"))break}else if(c){if(!e[Ts])switch(n){case"meta":if(!e.hasAttribute("itemprop"))break;return e;case"link":if(h=e.getAttribute("rel"),h==="stylesheet"&&e.hasAttribute("data-precedence"))break;if(h!==d.rel||e.getAttribute("href")!==(d.href==null||d.href===""?null:d.href)||e.getAttribute("crossorigin")!==(d.crossOrigin==null?null:d.crossOrigin)||e.getAttribute("title")!==(d.title==null?null:d.title))break;return e;case"style":if(e.hasAttribute("data-precedence"))break;return e;case"script":if(h=e.getAttribute("src"),(h!==(d.src==null?null:d.src)||e.getAttribute("type")!==(d.type==null?null:d.type)||e.getAttribute("crossorigin")!==(d.crossOrigin==null?null:d.crossOrigin))&&h&&e.hasAttribute("async")&&!e.hasAttribute("itemprop"))break;return e;default:return e}}else if(n==="input"&&e.type==="hidden"){var h=d.name==null?null:""+d.name;if(d.type==="hidden"&&e.getAttribute("name")===h)return e}else return e;if(e=fn(e.nextSibling),e===null)break}return null}function RS(e,n,s){if(n==="")return null;for(;e.nodeType!==3;)if((e.nodeType!==1||e.nodeName!=="INPUT"||e.type!=="hidden")&&!s||(e=fn(e.nextSibling),e===null))return null;return e}function Xp(e,n){for(;e.nodeType!==8;)if((e.nodeType!==1||e.nodeName!=="INPUT"||e.type!=="hidden")&&!n||(e=fn(e.nextSibling),e===null))return null;return e}function ju(e){return e.data==="$?"||e.data==="$~"}function Bu(e){return e.data==="$!"||e.data==="$?"&&e.ownerDocument.readyState!=="loading"}function OS(e,n){var s=e.ownerDocument;if(e.data==="$~")e._reactRetry=n;else if(e.data!=="$?"||s.readyState!=="loading")n();else{var c=function(){n(),s.removeEventListener("DOMContentLoaded",c)};s.addEventListener("DOMContentLoaded",c),e._reactRetry=c}}function fn(e){for(;e!=null;e=e.nextSibling){var n=e.nodeType;if(n===1||n===3)break;if(n===8){if(n=e.data,n==="$"||n==="$!"||n==="$?"||n==="$~"||n==="&"||n==="F!"||n==="F")break;if(n==="/$"||n==="/&")return null}}return e}var zu=null;function Zp(e){e=e.nextSibling;for(var n=0;e;){if(e.nodeType===8){var s=e.data;if(s==="/$"||s==="/&"){if(n===0)return fn(e.nextSibling);n--}else s!=="$"&&s!=="$!"&&s!=="$?"&&s!=="$~"&&s!=="&"||n++}e=e.nextSibling}return null}function Wp(e){e=e.previousSibling;for(var n=0;e;){if(e.nodeType===8){var s=e.data;if(s==="$"||s==="$!"||s==="$?"||s==="$~"||s==="&"){if(n===0)return e;n--}else s!=="/$"&&s!=="/&"||n++}e=e.previousSibling}return null}function $p(e,n,s){switch(n=Uo(s),e){case"html":if(e=n.documentElement,!e)throw Error(a(452));return e;case"head":if(e=n.head,!e)throw Error(a(453));return e;case"body":if(e=n.body,!e)throw Error(a(454));return e;default:throw Error(a(451))}}function ir(e){for(var n=e.attributes;n.length;)e.removeAttributeNode(n[0]);Vc(e)}var hn=new Map,eg=new Set;function Lo(e){return typeof e.getRootNode=="function"?e.getRootNode():e.nodeType===9?e:e.ownerDocument}var ti=W.d;W.d={f:AS,r:DS,D:MS,C:wS,L:xS,m:NS,X:US,S:PS,M:LS};function AS(){var e=ti.f(),n=Oo();return e||n}function DS(e){var n=ba(e);n!==null&&n.tag===5&&n.type==="form"?vm(n):ti.r(e)}var Za=typeof document>"u"?null:document;function tg(e,n,s){var c=Za;if(c&&typeof n=="string"&&n){var d=sn(n);d='link[rel="'+e+'"][href="'+d+'"]',typeof s=="string"&&(d+='[crossorigin="'+s+'"]'),eg.has(d)||(eg.add(d),e={rel:e,crossOrigin:s,href:n},c.querySelector(d)===null&&(n=c.createElement("link"),Et(n,"link",e),gt(n),c.head.appendChild(n)))}}function MS(e){ti.D(e),tg("dns-prefetch",e,null)}function wS(e,n){ti.C(e,n),tg("preconnect",e,n)}function xS(e,n,s){ti.L(e,n,s);var c=Za;if(c&&e&&n){var d='link[rel="preload"][as="'+sn(n)+'"]';n==="image"&&s&&s.imageSrcSet?(d+='[imagesrcset="'+sn(s.imageSrcSet)+'"]',typeof s.imageSizes=="string"&&(d+='[imagesizes="'+sn(s.imageSizes)+'"]')):d+='[href="'+sn(e)+'"]';var h=d;switch(n){case"style":h=Wa(e);break;case"script":h=$a(e)}hn.has(h)||(e=v({rel:"preload",href:n==="image"&&s&&s.imageSrcSet?void 0:e,as:n},s),hn.set(h,e),c.querySelector(d)!==null||n==="style"&&c.querySelector(ar(h))||n==="script"&&c.querySelector(sr(h))||(n=c.createElement("link"),Et(n,"link",e),gt(n),c.head.appendChild(n)))}}function NS(e,n){ti.m(e,n);var s=Za;if(s&&e){var c=n&&typeof n.as=="string"?n.as:"script",d='link[rel="modulepreload"][as="'+sn(c)+'"][href="'+sn(e)+'"]',h=d;switch(c){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":h=$a(e)}if(!hn.has(h)&&(e=v({rel:"modulepreload",href:e},n),hn.set(h,e),s.querySelector(d)===null)){switch(c){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":if(s.querySelector(sr(h)))return}c=s.createElement("link"),Et(c,"link",e),gt(c),s.head.appendChild(c)}}}function PS(e,n,s){ti.S(e,n,s);var c=Za;if(c&&e){var d=Sa(c).hoistableStyles,h=Wa(e);n=n||"default";var y=d.get(h);if(!y){var b={loading:0,preload:null};if(y=c.querySelector(ar(h)))b.loading=5;else{e=v({rel:"stylesheet",href:e,"data-precedence":n},s),(s=hn.get(h))&&qu(e,s);var C=y=c.createElement("link");gt(C),Et(C,"link",e),C._p=new Promise(function(w,B){C.onload=w,C.onerror=B}),C.addEventListener("load",function(){b.loading|=1}),C.addEventListener("error",function(){b.loading|=2}),b.loading|=4,Io(y,n,c)}y={type:"stylesheet",instance:y,count:1,state:b},d.set(h,y)}}}function US(e,n){ti.X(e,n);var s=Za;if(s&&e){var c=Sa(s).hoistableScripts,d=$a(e),h=c.get(d);h||(h=s.querySelector(sr(d)),h||(e=v({src:e,async:!0},n),(n=hn.get(d))&&Vu(e,n),h=s.createElement("script"),gt(h),Et(h,"link",e),s.head.appendChild(h)),h={type:"script",instance:h,count:1,state:null},c.set(d,h))}}function LS(e,n){ti.M(e,n);var s=Za;if(s&&e){var c=Sa(s).hoistableScripts,d=$a(e),h=c.get(d);h||(h=s.querySelector(sr(d)),h||(e=v({src:e,async:!0,type:"module"},n),(n=hn.get(d))&&Vu(e,n),h=s.createElement("script"),gt(h),Et(h,"link",e),s.head.appendChild(h)),h={type:"script",instance:h,count:1,state:null},c.set(d,h))}}function ng(e,n,s,c){var d=(d=ye.current)?Lo(d):null;if(!d)throw Error(a(446));switch(e){case"meta":case"title":return null;case"style":return typeof s.precedence=="string"&&typeof s.href=="string"?(n=Wa(s.href),s=Sa(d).hoistableStyles,c=s.get(n),c||(c={type:"style",instance:null,count:0,state:null},s.set(n,c)),c):{type:"void",instance:null,count:0,state:null};case"link":if(s.rel==="stylesheet"&&typeof s.href=="string"&&typeof s.precedence=="string"){e=Wa(s.href);var h=Sa(d).hoistableStyles,y=h.get(e);if(y||(d=d.ownerDocument||d,y={type:"stylesheet",instance:null,count:0,state:{loading:0,preload:null}},h.set(e,y),(h=d.querySelector(ar(e)))&&!h._p&&(y.instance=h,y.state.loading=5),hn.has(e)||(s={rel:"preload",as:"style",href:s.href,crossOrigin:s.crossOrigin,integrity:s.integrity,media:s.media,hrefLang:s.hrefLang,referrerPolicy:s.referrerPolicy},hn.set(e,s),h||IS(d,e,s,y.state))),n&&c===null)throw Error(a(528,""));return y}if(n&&c!==null)throw Error(a(529,""));return null;case"script":return n=s.async,s=s.src,typeof s=="string"&&n&&typeof n!="function"&&typeof n!="symbol"?(n=$a(s),s=Sa(d).hoistableScripts,c=s.get(n),c||(c={type:"script",instance:null,count:0,state:null},s.set(n,c)),c):{type:"void",instance:null,count:0,state:null};default:throw Error(a(444,e))}}function Wa(e){return'href="'+sn(e)+'"'}function ar(e){return'link[rel="stylesheet"]['+e+"]"}function ig(e){return v({},e,{"data-precedence":e.precedence,precedence:null})}function IS(e,n,s,c){e.querySelector('link[rel="preload"][as="style"]['+n+"]")?c.loading=1:(n=e.createElement("link"),c.preload=n,n.addEventListener("load",function(){return c.loading|=1}),n.addEventListener("error",function(){return c.loading|=2}),Et(n,"link",s),gt(n),e.head.appendChild(n))}function $a(e){return'[src="'+sn(e)+'"]'}function sr(e){return"script[async]"+e}function ag(e,n,s){if(n.count++,n.instance===null)switch(n.type){case"style":var c=e.querySelector('style[data-href~="'+sn(s.href)+'"]');if(c)return n.instance=c,gt(c),c;var d=v({},s,{"data-href":s.href,"data-precedence":s.precedence,href:null,precedence:null});return c=(e.ownerDocument||e).createElement("style"),gt(c),Et(c,"style",d),Io(c,s.precedence,e),n.instance=c;case"stylesheet":d=Wa(s.href);var h=e.querySelector(ar(d));if(h)return n.state.loading|=4,n.instance=h,gt(h),h;c=ig(s),(d=hn.get(d))&&qu(c,d),h=(e.ownerDocument||e).createElement("link"),gt(h);var y=h;return y._p=new Promise(function(b,C){y.onload=b,y.onerror=C}),Et(h,"link",c),n.state.loading|=4,Io(h,s.precedence,e),n.instance=h;case"script":return h=$a(s.src),(d=e.querySelector(sr(h)))?(n.instance=d,gt(d),d):(c=s,(d=hn.get(h))&&(c=v({},s),Vu(c,d)),e=e.ownerDocument||e,d=e.createElement("script"),gt(d),Et(d,"link",c),e.head.appendChild(d),n.instance=d);case"void":return null;default:throw Error(a(443,n.type))}else n.type==="stylesheet"&&(n.state.loading&4)===0&&(c=n.instance,n.state.loading|=4,Io(c,s.precedence,e));return n.instance}function Io(e,n,s){for(var c=s.querySelectorAll('link[rel="stylesheet"][data-precedence],style[data-precedence]'),d=c.length?c[c.length-1]:null,h=d,y=0;y<c.length;y++){var b=c[y];if(b.dataset.precedence===n)h=b;else if(h!==d)break}h?h.parentNode.insertBefore(e,h.nextSibling):(n=s.nodeType===9?s.head:s,n.insertBefore(e,n.firstChild))}function qu(e,n){e.crossOrigin==null&&(e.crossOrigin=n.crossOrigin),e.referrerPolicy==null&&(e.referrerPolicy=n.referrerPolicy),e.title==null&&(e.title=n.title)}function Vu(e,n){e.crossOrigin==null&&(e.crossOrigin=n.crossOrigin),e.referrerPolicy==null&&(e.referrerPolicy=n.referrerPolicy),e.integrity==null&&(e.integrity=n.integrity)}var jo=null;function sg(e,n,s){if(jo===null){var c=new Map,d=jo=new Map;d.set(s,c)}else d=jo,c=d.get(s),c||(c=new Map,d.set(s,c));if(c.has(e))return c;for(c.set(e,null),s=s.getElementsByTagName(e),d=0;d<s.length;d++){var h=s[d];if(!(h[Ts]||h[St]||e==="link"&&h.getAttribute("rel")==="stylesheet")&&h.namespaceURI!=="http://www.w3.org/2000/svg"){var y=h.getAttribute(n)||"";y=e+y;var b=c.get(y);b?b.push(h):c.set(y,[h])}}return c}function rg(e,n,s){e=e.ownerDocument||e,e.head.insertBefore(s,n==="title"?e.querySelector("head > title"):null)}function jS(e,n,s){if(s===1||n.itemProp!=null)return!1;switch(e){case"meta":case"title":return!0;case"style":if(typeof n.precedence!="string"||typeof n.href!="string"||n.href==="")break;return!0;case"link":if(typeof n.rel!="string"||typeof n.href!="string"||n.href===""||n.onLoad||n.onError)break;switch(n.rel){case"stylesheet":return e=n.disabled,typeof n.precedence=="string"&&e==null;default:return!0}case"script":if(n.async&&typeof n.async!="function"&&typeof n.async!="symbol"&&!n.onLoad&&!n.onError&&n.src&&typeof n.src=="string")return!0}return!1}function og(e){return!(e.type==="stylesheet"&&(e.state.loading&3)===0)}function BS(e,n,s,c){if(s.type==="stylesheet"&&(typeof c.media!="string"||matchMedia(c.media).matches!==!1)&&(s.state.loading&4)===0){if(s.instance===null){var d=Wa(c.href),h=n.querySelector(ar(d));if(h){n=h._p,n!==null&&typeof n=="object"&&typeof n.then=="function"&&(e.count++,e=Bo.bind(e),n.then(e,e)),s.state.loading|=4,s.instance=h,gt(h);return}h=n.ownerDocument||n,c=ig(c),(d=hn.get(d))&&qu(c,d),h=h.createElement("link"),gt(h);var y=h;y._p=new Promise(function(b,C){y.onload=b,y.onerror=C}),Et(h,"link",c),s.instance=h}e.stylesheets===null&&(e.stylesheets=new Map),e.stylesheets.set(s,n),(n=s.state.preload)&&(s.state.loading&3)===0&&(e.count++,s=Bo.bind(e),n.addEventListener("load",s),n.addEventListener("error",s))}}var Hu=0;function zS(e,n){return e.stylesheets&&e.count===0&&qo(e,e.stylesheets),0<e.count||0<e.imgCount?function(s){var c=setTimeout(function(){if(e.stylesheets&&qo(e,e.stylesheets),e.unsuspend){var h=e.unsuspend;e.unsuspend=null,h()}},6e4+n);0<e.imgBytes&&Hu===0&&(Hu=62500*SS());var d=setTimeout(function(){if(e.waitingForImages=!1,e.count===0&&(e.stylesheets&&qo(e,e.stylesheets),e.unsuspend)){var h=e.unsuspend;e.unsuspend=null,h()}},(e.imgBytes>Hu?50:800)+n);return e.unsuspend=s,function(){e.unsuspend=null,clearTimeout(c),clearTimeout(d)}}:null}function Bo(){if(this.count--,this.count===0&&(this.imgCount===0||!this.waitingForImages)){if(this.stylesheets)qo(this,this.stylesheets);else if(this.unsuspend){var e=this.unsuspend;this.unsuspend=null,e()}}}var zo=null;function qo(e,n){e.stylesheets=null,e.unsuspend!==null&&(e.count++,zo=new Map,n.forEach(qS,e),zo=null,Bo.call(e))}function qS(e,n){if(!(n.state.loading&4)){var s=zo.get(e);if(s)var c=s.get(null);else{s=new Map,zo.set(e,s);for(var d=e.querySelectorAll("link[data-precedence],style[data-precedence]"),h=0;h<d.length;h++){var y=d[h];(y.nodeName==="LINK"||y.getAttribute("media")!=="not all")&&(s.set(y.dataset.precedence,y),c=y)}c&&s.set(null,c)}d=n.instance,y=d.getAttribute("data-precedence"),h=s.get(y)||c,h===c&&s.set(null,d),s.set(y,d),this.count++,c=Bo.bind(this),d.addEventListener("load",c),d.addEventListener("error",c),h?h.parentNode.insertBefore(d,h.nextSibling):(e=e.nodeType===9?e.head:e,e.insertBefore(d,e.firstChild)),n.state.loading|=4}}var rr={$$typeof:Z,Provider:null,Consumer:null,_currentValue:de,_currentValue2:de,_threadCount:0};function VS(e,n,s,c,d,h,y,b,C){this.tag=1,this.containerInfo=e,this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.next=this.pendingContext=this.context=this.cancelPendingCommit=null,this.callbackPriority=0,this.expirationTimes=jc(-1),this.entangledLanes=this.shellSuspendCounter=this.errorRecoveryDisabledLanes=this.expiredLanes=this.warmLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=jc(0),this.hiddenUpdates=jc(null),this.identifierPrefix=c,this.onUncaughtError=d,this.onCaughtError=h,this.onRecoverableError=y,this.pooledCache=null,this.pooledCacheLanes=0,this.formState=C,this.incompleteTransitions=new Map}function cg(e,n,s,c,d,h,y,b,C,w,B,H){return e=new VS(e,n,s,y,C,w,B,H,b),n=1,h===!0&&(n|=24),h=Xt(3,null,null,n),e.current=h,h.stateNode=e,n=Cl(),n.refCount++,e.pooledCache=n,n.refCount++,h.memoizedState={element:c,isDehydrated:s,cache:n},Rl(h),e}function lg(e){return e?(e=Ma,e):Ma}function ug(e,n,s,c,d,h){d=lg(d),c.context===null?c.context=d:c.pendingContext=d,c=vi(n),c.payload={element:s},h=h===void 0?null:h,h!==null&&(c.callback=h),s=yi(e,c,n),s!==null&&(qt(s,e,n),js(s,e,n))}function dg(e,n){if(e=e.memoizedState,e!==null&&e.dehydrated!==null){var s=e.retryLane;e.retryLane=s!==0&&s<n?s:n}}function Fu(e,n){dg(e,n),(e=e.alternate)&&dg(e,n)}function fg(e){if(e.tag===13||e.tag===31){var n=Wi(e,67108864);n!==null&&qt(n,e,67108864),Fu(e,67108864)}}function hg(e){if(e.tag===13||e.tag===31){var n=tn();n=Bc(n);var s=Wi(e,n);s!==null&&qt(s,e,n),Fu(e,n)}}var Vo=!0;function HS(e,n,s,c){var d=I.T;I.T=null;var h=W.p;try{W.p=2,Gu(e,n,s,c)}finally{W.p=h,I.T=d}}function FS(e,n,s,c){var d=I.T;I.T=null;var h=W.p;try{W.p=8,Gu(e,n,s,c)}finally{W.p=h,I.T=d}}function Gu(e,n,s,c){if(Vo){var d=Ku(c);if(d===null)wu(e,n,c,Ho,s),pg(e,c);else if(KS(d,e,n,s,c))c.stopPropagation();else if(pg(e,c),n&4&&-1<GS.indexOf(e)){for(;d!==null;){var h=ba(d);if(h!==null)switch(h.tag){case 3:if(h=h.stateNode,h.current.memoizedState.isDehydrated){var y=Yi(h.pendingLanes);if(y!==0){var b=h;for(b.pendingLanes|=2,b.entangledLanes|=2;y;){var C=1<<31-Qt(y);b.entanglements[1]|=C,y&=~C}Mn(h),(Ue&6)===0&&(_o=Kt()+500,er(0))}}break;case 31:case 13:b=Wi(h,2),b!==null&&qt(b,h,2),Oo(),Fu(h,2)}if(h=Ku(c),h===null&&wu(e,n,c,Ho,s),h===d)break;d=h}d!==null&&c.stopPropagation()}else wu(e,n,c,null,s)}}function Ku(e){return e=Qc(e),Yu(e)}var Ho=null;function Yu(e){if(Ho=null,e=ya(e),e!==null){var n=l(e);if(n===null)e=null;else{var s=n.tag;if(s===13){if(e=f(n),e!==null)return e;e=null}else if(s===31){if(e=u(n),e!==null)return e;e=null}else if(s===3){if(n.stateNode.current.memoizedState.isDehydrated)return n.tag===3?n.stateNode.containerInfo:null;e=null}else n!==e&&(e=null)}}return Ho=e,null}function mg(e){switch(e){case"beforetoggle":case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"toggle":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 2;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 8;case"message":switch(My()){case Cf:return 2;case kf:return 8;case wr:case wy:return 32;case Ef:return 268435456;default:return 32}default:return 32}}var Qu=!1,Di=null,Mi=null,wi=null,or=new Map,cr=new Map,xi=[],GS="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset".split(" ");function pg(e,n){switch(e){case"focusin":case"focusout":Di=null;break;case"dragenter":case"dragleave":Mi=null;break;case"mouseover":case"mouseout":wi=null;break;case"pointerover":case"pointerout":or.delete(n.pointerId);break;case"gotpointercapture":case"lostpointercapture":cr.delete(n.pointerId)}}function lr(e,n,s,c,d,h){return e===null||e.nativeEvent!==h?(e={blockedOn:n,domEventName:s,eventSystemFlags:c,nativeEvent:h,targetContainers:[d]},n!==null&&(n=ba(n),n!==null&&fg(n)),e):(e.eventSystemFlags|=c,n=e.targetContainers,d!==null&&n.indexOf(d)===-1&&n.push(d),e)}function KS(e,n,s,c,d){switch(n){case"focusin":return Di=lr(Di,e,n,s,c,d),!0;case"dragenter":return Mi=lr(Mi,e,n,s,c,d),!0;case"mouseover":return wi=lr(wi,e,n,s,c,d),!0;case"pointerover":var h=d.pointerId;return or.set(h,lr(or.get(h)||null,e,n,s,c,d)),!0;case"gotpointercapture":return h=d.pointerId,cr.set(h,lr(cr.get(h)||null,e,n,s,c,d)),!0}return!1}function gg(e){var n=ya(e.target);if(n!==null){var s=l(n);if(s!==null){if(n=s.tag,n===13){if(n=f(s),n!==null){e.blockedOn=n,Mf(e.priority,function(){hg(s)});return}}else if(n===31){if(n=u(s),n!==null){e.blockedOn=n,Mf(e.priority,function(){hg(s)});return}}else if(n===3&&s.stateNode.current.memoizedState.isDehydrated){e.blockedOn=s.tag===3?s.stateNode.containerInfo:null;return}}}e.blockedOn=null}function Fo(e){if(e.blockedOn!==null)return!1;for(var n=e.targetContainers;0<n.length;){var s=Ku(e.nativeEvent);if(s===null){s=e.nativeEvent;var c=new s.constructor(s.type,s);Yc=c,s.target.dispatchEvent(c),Yc=null}else return n=ba(s),n!==null&&fg(n),e.blockedOn=s,!1;n.shift()}return!0}function vg(e,n,s){Fo(e)&&s.delete(n)}function YS(){Qu=!1,Di!==null&&Fo(Di)&&(Di=null),Mi!==null&&Fo(Mi)&&(Mi=null),wi!==null&&Fo(wi)&&(wi=null),or.forEach(vg),cr.forEach(vg)}function Go(e,n){e.blockedOn===n&&(e.blockedOn=null,Qu||(Qu=!0,r.unstable_scheduleCallback(r.unstable_NormalPriority,YS)))}var Ko=null;function yg(e){Ko!==e&&(Ko=e,r.unstable_scheduleCallback(r.unstable_NormalPriority,function(){Ko===e&&(Ko=null);for(var n=0;n<e.length;n+=3){var s=e[n],c=e[n+1],d=e[n+2];if(typeof c!="function"){if(Yu(c||s)===null)continue;break}var h=ba(s);h!==null&&(e.splice(n,3),n-=3,Kl(h,{pending:!0,data:d,method:s.method,action:c},c,d))}}))}function es(e){function n(C){return Go(C,e)}Di!==null&&Go(Di,e),Mi!==null&&Go(Mi,e),wi!==null&&Go(wi,e),or.forEach(n),cr.forEach(n);for(var s=0;s<xi.length;s++){var c=xi[s];c.blockedOn===e&&(c.blockedOn=null)}for(;0<xi.length&&(s=xi[0],s.blockedOn===null);)gg(s),s.blockedOn===null&&xi.shift();if(s=(e.ownerDocument||e).$$reactFormReplay,s!=null)for(c=0;c<s.length;c+=3){var d=s[c],h=s[c+1],y=d[Ut]||null;if(typeof h=="function")y||yg(s);else if(y){var b=null;if(h&&h.hasAttribute("formAction")){if(d=h,y=h[Ut]||null)b=y.formAction;else if(Yu(d)!==null)continue}else b=y.action;typeof b=="function"?s[c+1]=b:(s.splice(c,3),c-=3),yg(s)}}}function bg(){function e(h){h.canIntercept&&h.info==="react-transition"&&h.intercept({handler:function(){return new Promise(function(y){return d=y})},focusReset:"manual",scroll:"manual"})}function n(){d!==null&&(d(),d=null),c||setTimeout(s,20)}function s(){if(!c&&!navigation.transition){var h=navigation.currentEntry;h&&h.url!=null&&navigation.navigate(h.url,{state:h.getState(),info:"react-transition",history:"replace"})}}if(typeof navigation=="object"){var c=!1,d=null;return navigation.addEventListener("navigate",e),navigation.addEventListener("navigatesuccess",n),navigation.addEventListener("navigateerror",n),setTimeout(s,100),function(){c=!0,navigation.removeEventListener("navigate",e),navigation.removeEventListener("navigatesuccess",n),navigation.removeEventListener("navigateerror",n),d!==null&&(d(),d=null)}}}function Ju(e){this._internalRoot=e}Yo.prototype.render=Ju.prototype.render=function(e){var n=this._internalRoot;if(n===null)throw Error(a(409));var s=n.current,c=tn();ug(s,c,e,n,null,null)},Yo.prototype.unmount=Ju.prototype.unmount=function(){var e=this._internalRoot;if(e!==null){this._internalRoot=null;var n=e.containerInfo;ug(e.current,2,null,e,null,null),Oo(),n[va]=null}};function Yo(e){this._internalRoot=e}Yo.prototype.unstable_scheduleHydration=function(e){if(e){var n=Df();e={blockedOn:null,target:e,priority:n};for(var s=0;s<xi.length&&n!==0&&n<xi[s].priority;s++);xi.splice(s,0,e),s===0&&gg(e)}};var Sg=t.version;if(Sg!=="19.2.3")throw Error(a(527,Sg,"19.2.3"));W.findDOMNode=function(e){var n=e._reactInternals;if(n===void 0)throw typeof e.render=="function"?Error(a(188)):(e=Object.keys(e).join(","),Error(a(268,e)));return e=p(n),e=e!==null?g(e):null,e=e===null?null:e.stateNode,e};var QS={bundleType:0,version:"19.2.3",rendererPackageName:"react-dom",currentDispatcherRef:I,reconcilerVersion:"19.2.3"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var Qo=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!Qo.isDisabled&&Qo.supportsFiber)try{ys=Qo.inject(QS),Yt=Qo}catch{}}return dr.createRoot=function(e,n){if(!o(e))throw Error(a(299));var s=!1,c="",d=Om,h=Am,y=Dm;return n!=null&&(n.unstable_strictMode===!0&&(s=!0),n.identifierPrefix!==void 0&&(c=n.identifierPrefix),n.onUncaughtError!==void 0&&(d=n.onUncaughtError),n.onCaughtError!==void 0&&(h=n.onCaughtError),n.onRecoverableError!==void 0&&(y=n.onRecoverableError)),n=cg(e,1,!1,null,null,s,c,null,d,h,y,bg),e[va]=n.current,Mu(e),new Ju(n)},dr.hydrateRoot=function(e,n,s){if(!o(e))throw Error(a(299));var c=!1,d="",h=Om,y=Am,b=Dm,C=null;return s!=null&&(s.unstable_strictMode===!0&&(c=!0),s.identifierPrefix!==void 0&&(d=s.identifierPrefix),s.onUncaughtError!==void 0&&(h=s.onUncaughtError),s.onCaughtError!==void 0&&(y=s.onCaughtError),s.onRecoverableError!==void 0&&(b=s.onRecoverableError),s.formState!==void 0&&(C=s.formState)),n=cg(e,1,!0,n,s??null,c,d,C,h,y,b,bg),n.context=lg(null),s=n.current,c=tn(),c=Bc(c),d=vi(c),d.callback=null,yi(s,d,c),s=c,n.current.lanes=s,Ss(n,s),Mn(n),e[va]=n.current,Mu(e),new Yo(n)},dr.version="19.2.3",dr}var Mg;function aT(){if(Mg)return Wu.exports;Mg=1;function r(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(r)}catch(t){console.error(t)}}return r(),Wu.exports=iT(),Wu.exports}var sT=aT();const rT=me.forwardRef(function({onCameraStateChange:t},i){const a=me.useRef(null),[o,l]=me.useState(null);return me.useImperativeHandle(i,()=>({getVideoElement:()=>a.current})),me.useEffect(()=>{let f=null;async function u(){try{f=await navigator.mediaDevices.getUserMedia({video:{facingMode:"environment",width:{ideal:1920},height:{ideal:1080}},audio:!1}),a.current&&(a.current.srcObject=f,t(!0))}catch(m){console.error("Camera access error:",m),l("Unable to access camera. Please grant permission."),t(!1)}}return u(),()=>{f&&f.getTracks().forEach(m=>m.stop()),t(!1)}},[t]),F.jsx("div",{className:"fixed inset-0 z-0 bg-black",children:o?F.jsx("div",{className:"flex h-full w-full items-center justify-center",children:F.jsxs("div",{className:"rounded-2xl bg-black/60 p-8 text-center backdrop-blur-lg",children:[F.jsx("p",{className:"text-lg text-white/80",children:o}),F.jsx("p",{className:"mt-2 text-sm text-white/50",children:"Check your browser settings to enable camera access"})]})}):F.jsx("video",{ref:a,autoPlay:!0,muted:!0,playsInline:!0,className:"h-full w-full object-cover"})})});/**
 * @license lucide-react v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const oT=r=>r.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),jv=(...r)=>r.filter((t,i,a)=>!!t&&t.trim()!==""&&a.indexOf(t)===i).join(" ").trim();/**
 * @license lucide-react v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */var cT={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};/**
 * @license lucide-react v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const lT=me.forwardRef(({color:r="currentColor",size:t=24,strokeWidth:i=2,absoluteStrokeWidth:a,className:o="",children:l,iconNode:f,...u},m)=>me.createElement("svg",{ref:m,...cT,width:t,height:t,stroke:r,strokeWidth:a?Number(i)*24/Number(t):i,className:jv("lucide",o),...u},[...f.map(([p,g])=>me.createElement(p,g)),...Array.isArray(l)?l:[l]]));/**
 * @license lucide-react v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Nt=(r,t)=>{const i=me.forwardRef(({className:a,...o},l)=>me.createElement(lT,{ref:l,iconNode:t,className:jv(`lucide-${oT(r)}`,a),...o}));return i.displayName=`${r}`,i};/**
 * @license lucide-react v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const uT=Nt("CameraOff",[["line",{x1:"2",x2:"22",y1:"2",y2:"22",key:"a6p6uj"}],["path",{d:"M7 7H4a2 2 0 0 0-2 2v9a2 2 0 0 0 2 2h16",key:"qmtpty"}],["path",{d:"M9.5 4h5L17 7h3a2 2 0 0 1 2 2v7.5",key:"1ufyfc"}],["path",{d:"M14.121 15.121A3 3 0 1 1 9.88 10.88",key:"11zox6"}]]);/**
 * @license lucide-react v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const dT=Nt("Camera",[["path",{d:"M14.5 4h-5L7 7H4a2 2 0 0 0-2 2v9a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2h-3l-2.5-3z",key:"1tc9qg"}],["circle",{cx:"12",cy:"13",r:"3",key:"1vg3eu"}]]);/**
 * @license lucide-react v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const fT=Nt("CircleCheck",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]]);/**
 * @license lucide-react v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const hT=Nt("CircleX",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]]);/**
 * @license lucide-react v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const mT=Nt("ExternalLink",[["path",{d:"M15 3h6v6",key:"1q9fwt"}],["path",{d:"M10 14 21 3",key:"gplh6r"}],["path",{d:"M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6",key:"a6xqqp"}]]);/**
 * @license lucide-react v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const pT=Nt("LoaderCircle",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]]);/**
 * @license lucide-react v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const gT=Nt("MicOff",[["line",{x1:"2",x2:"22",y1:"2",y2:"22",key:"a6p6uj"}],["path",{d:"M18.89 13.23A7.12 7.12 0 0 0 19 12v-2",key:"80xlxr"}],["path",{d:"M5 10v2a7 7 0 0 0 12 5",key:"p2k8kg"}],["path",{d:"M15 9.34V5a3 3 0 0 0-5.68-1.33",key:"1gzdoj"}],["path",{d:"M9 9v3a3 3 0 0 0 5.12 2.12",key:"r2i35w"}],["line",{x1:"12",x2:"12",y1:"19",y2:"22",key:"x3vr5v"}]]);/**
 * @license lucide-react v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const vT=Nt("Mic",[["path",{d:"M12 2a3 3 0 0 0-3 3v7a3 3 0 0 0 6 0V5a3 3 0 0 0-3-3Z",key:"131961"}],["path",{d:"M19 10v2a7 7 0 0 1-14 0v-2",key:"1vc78b"}],["line",{x1:"12",x2:"12",y1:"19",y2:"22",key:"x3vr5v"}]]);/**
 * @license lucide-react v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const yT=Nt("PhoneOff",[["path",{d:"M10.68 13.31a16 16 0 0 0 3.41 2.6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7 2 2 0 0 1 1.72 2v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.42 19.42 0 0 1-3.33-2.67m-2.67-3.34a19.79 19.79 0 0 1-3.07-8.63A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91",key:"z86iuo"}],["line",{x1:"22",x2:"2",y1:"2",y2:"22",key:"11kh81"}]]);/**
 * @license lucide-react v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const bT=Nt("Phone",[["path",{d:"M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z",key:"foiqr5"}]]);/**
 * @license lucide-react v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ST=Nt("Scan",[["path",{d:"M3 7V5a2 2 0 0 1 2-2h2",key:"aa7l1z"}],["path",{d:"M17 3h2a2 2 0 0 1 2 2v2",key:"4qcy5o"}],["path",{d:"M21 17v2a2 2 0 0 1-2 2h-2",key:"6vwrx8"}],["path",{d:"M7 21H5a2 2 0 0 1-2-2v-2",key:"ioqczr"}]]);/**
 * @license lucide-react v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const TT=Nt("ShoppingBag",[["path",{d:"M6 2 3 6v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V6l-3-4Z",key:"hou9p0"}],["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M16 10a4 4 0 0 1-8 0",key:"1ltviw"}]]);/**
 * @license lucide-react v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const CT=Nt("Sparkles",[["path",{d:"M9.937 15.5A2 2 0 0 0 8.5 14.063l-6.135-1.582a.5.5 0 0 1 0-.962L8.5 9.936A2 2 0 0 0 9.937 8.5l1.582-6.135a.5.5 0 0 1 .963 0L14.063 8.5A2 2 0 0 0 15.5 9.937l6.135 1.581a.5.5 0 0 1 0 .964L15.5 14.063a2 2 0 0 0-1.437 1.437l-1.582 6.135a.5.5 0 0 1-.963 0z",key:"4pj2yx"}],["path",{d:"M20 3v4",key:"1olli1"}],["path",{d:"M22 5h-4",key:"1gvqau"}],["path",{d:"M4 17v2",key:"vumght"}],["path",{d:"M5 18H3",key:"zchphs"}]]);/**
 * @license lucide-react v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const kT=Nt("TrendingDown",[["polyline",{points:"22 17 13.5 8.5 8.5 13.5 2 7",key:"1r2t7k"}],["polyline",{points:"16 17 22 17 22 11",key:"11uiuu"}]]);/**
 * @license lucide-react v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ET=Nt("TrendingUp",[["polyline",{points:"22 7 13.5 15.5 8.5 10.5 2 17",key:"126l90"}],["polyline",{points:"16 7 22 7 22 13",key:"kwv8wd"}]]);function _T({data:r,isLoading:t}){if(t)return F.jsx("div",{className:"absolute right-6 top-6 z-10 w-1/3 max-w-sm rounded-xl text-white border border-white/20 transition-all duration-500 isolate glass-fade overflow-hidden",style:{padding:"12px"},children:F.jsxs("div",{className:"flex flex-col items-center justify-center py-8 text-center",children:[F.jsx("div",{className:"relative mb-4",children:F.jsx("div",{className:"h-12 w-12 rounded-full border-2 border-blue-400/30 border-t-blue-400 animate-spin"})}),F.jsx("p",{className:"text-base font-medium text-white",children:"Searching prices..."}),F.jsx("p",{className:"mt-1 text-xs text-white/60",children:"Analyzing product and comparing deals"})]})});if(!r)return F.jsx("div",{className:"absolute right-6 top-6 z-10 w-1/3 max-w-sm rounded-xl text-white border border-white/20 transition-all duration-500 isolate glass-fade overflow-hidden",style:{padding:"7px"},children:F.jsxs("div",{className:"flex flex-col items-center justify-center py-8 text-center",children:[F.jsx(TT,{className:"mb-4 h-10 w-10 text-white"}),F.jsx("p",{className:"text-base font-medium text-white",children:"Hold a product"}),F.jsx("p",{className:"mt-1 text-xs text-white",children:"To identify and analyze it"})]})});const i=r.competitors.map(u=>parseFloat(u.price.replace(/[^0-9.]/g,""))).filter(u=>!isNaN(u)&&u>0),a=i.length>0?Math.min(...i):0,o=parseFloat(r.detectedPrice.replace(/[^0-9.]/g,""))||0,l=a>0&&o>a?o-a:0,f=()=>F.jsxs("div",{style:{padding:"7px"},children:[F.jsxs("div",{className:"mb-5",children:[F.jsx("h2",{className:"text-lg font-bold text-white truncate",children:r.productName}),F.jsx("p",{className:"text-sm text-white mt-1 truncate",children:r.brand})]}),F.jsx("div",{className:"mb-5 rounded-2xl bg-white/5 border border-white/10 overflow-hidden",style:{padding:"12px"},children:F.jsxs("div",{className:"flex items-center justify-between",children:[F.jsx("span",{className:"text-sm text-white",children:"Detected Price"}),F.jsx("span",{className:"text-2xl font-bold text-white",children:r.detectedPrice})]})}),F.jsxs("div",{className:"mb-5",children:[F.jsx("h3",{className:"mb-3 text-sm font-medium text-white uppercase tracking-wider",children:"Price Comparison"}),F.jsx("div",{className:"space-y-2",children:r.competitors.map((u,m)=>{const p=parseFloat(u.price.replace("$","")),g=p<o,v=p===a;return F.jsxs("div",{className:`flex items-center justify-between rounded-xl transition-colors overflow-hidden ${v?"bg-green-400/10 border border-green-400/30":"bg-white/5 border border-white/10"}`,style:{padding:"10px"},children:[F.jsxs("div",{className:"flex items-center gap-2 min-w-0",children:[F.jsx("span",{className:"font-medium text-white text-sm truncate",children:u.site}),v&&F.jsx("span",{className:"rounded-full border border-green-400/50 px-1.5 py-0.5 text-xs font-medium text-green-400 flex-shrink-0",children:"Best"})]}),F.jsxs("div",{className:"flex items-center gap-2 flex-shrink-0",children:[F.jsx("span",{className:`font-semibold text-sm ${g?"text-green-400":"text-white"}`,children:u.price}),g?F.jsx(kT,{className:"h-3 w-3 text-green-400"}):F.jsx(ET,{className:"h-3 w-3 text-red-400"}),F.jsx(mT,{className:"h-3 w-3 text-white"})]})]},m)})}),l>0&&F.jsxs("p",{className:"mt-3 text-center text-xs text-green-400",children:["Save up to $",l.toFixed(2)," elsewhere"]})]}),F.jsx("div",{className:"mb-5 rounded-2xl bg-white/5 border border-white/10 overflow-hidden",style:{padding:"12px"},children:F.jsxs("div",{className:"flex items-start gap-3",children:[r.isCompatible?F.jsx(fT,{className:"h-4 w-4 flex-shrink-0 text-green-400 mt-0.5"}):F.jsx(hT,{className:"h-4 w-4 flex-shrink-0 text-red-400 mt-0.5"}),F.jsxs("div",{className:"min-w-0",children:[F.jsx("p",{className:`font-medium text-sm ${r.isCompatible?"text-green-400":"text-red-400"}`,children:r.isCompatible?"Compatible":"Incompatible"}),F.jsx("p",{className:"mt-1 text-xs text-white leading-relaxed",children:r.compatibilityNote})]})]})}),F.jsx("div",{className:"mb-5",children:F.jsxs("div",{className:`rounded-2xl text-center overflow-hidden ${r.valueScore==="buy"?"bg-green-400/10 border border-green-400/30":"bg-yellow-400/10 border border-yellow-400/30"}`,style:{padding:"12px"},children:[F.jsx("p",{className:"text-xs font-medium text-white mb-1",children:"AI Recommendation"}),F.jsx("p",{className:`text-lg font-bold ${r.valueScore==="buy"?"text-green-400":"text-yellow-400"}`,children:r.valueScore==="buy"?" Buy Now":" Wait"})]})}),F.jsxs("div",{className:"mb-5 rounded-2xl bg-blue-400/10 border border-blue-400/20 overflow-hidden",style:{padding:"12px"},children:[F.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[F.jsx(CT,{className:"h-3 w-3 text-blue-400 flex-shrink-0"}),F.jsx("span",{className:"text-xs font-medium text-blue-400",children:"AI Insight"})]}),F.jsx("p",{className:"text-xs text-white leading-relaxed",children:r.aiInsight})]})]});return F.jsx("div",{className:"absolute right-6 top-6 z-10 w-1/3 max-w-sm rounded-xl text-white border border-white/20 transition-all duration-500 isolate glass-fade overflow-hidden",style:{height:"50vh"},children:F.jsxs("div",{className:"auto-scroll",children:[F.jsx(f,{}),F.jsx(f,{})]})})}function RT({isConnected:r,isConnecting:t,isMuted:i,onConnect:a,onDisconnect:o,onToggleMute:l,error:f}){return F.jsxs("div",{className:"absolute left-6 top-6 z-20 flex flex-col gap-3",children:[r?F.jsxs("div",{className:"flex gap-2",children:[F.jsx("button",{onClick:l,className:`flex items-center gap-2 rounded-full px-4 py-2 text-white text-sm font-medium backdrop-blur-lg border transition-colors ${i?"bg-red-500/80 border-red-400/30 hover:bg-red-500":"bg-white/10 border-white/20 hover:bg-white/20"}`,children:i?F.jsxs(F.Fragment,{children:[F.jsx(gT,{className:"h-4 w-4"}),F.jsx("span",{children:"Unmute"})]}):F.jsxs(F.Fragment,{children:[F.jsx(vT,{className:"h-4 w-4"}),F.jsx("span",{children:"Mute"})]})}),F.jsxs("button",{onClick:o,className:"flex items-center gap-2 rounded-full bg-red-500/80 px-4 py-2 text-white text-sm font-medium backdrop-blur-lg border border-red-400/30 hover:bg-red-500 transition-colors",children:[F.jsx(yT,{className:"h-4 w-4"}),F.jsx("span",{children:"End"})]})]}):F.jsx("button",{onClick:a,disabled:t,className:"flex items-center gap-2 rounded-full bg-green-500/80 px-4 py-2 text-white text-sm font-medium backdrop-blur-lg border border-green-400/30 hover:bg-green-500 transition-colors disabled:opacity-50",children:t?F.jsxs(F.Fragment,{children:[F.jsx(pT,{className:"h-4 w-4 animate-spin"}),F.jsx("span",{children:"Connecting..."})]}):F.jsxs(F.Fragment,{children:[F.jsx(bT,{className:"h-4 w-4"}),F.jsx("span",{children:"Start Voice"})]})}),r&&F.jsxs("div",{className:"flex items-center gap-2 rounded-full bg-green-500/20 px-3 py-1.5 text-xs text-green-400",children:[F.jsx("span",{className:"h-2 w-2 rounded-full bg-green-400 animate-pulse"}),"Voice Active"]}),f&&F.jsx("div",{className:"rounded-lg bg-red-500/20 px-3 py-2 text-xs text-red-400 max-w-[200px]",children:f})]})}const Wo="http://localhost:8080",wg=Wo.replace(/^http/,"ws");function OT(r){const t=me.useRef(null),[i,a]=me.useState(!1),[o,l]=me.useState(null),[f,u]=me.useState(null),[m,p]=me.useState(!1),[g,v]=me.useState(null);me.useEffect(()=>{if(!r)return;console.log(`%c[WS] Connecting to ${wg}/ws?sessionId=${r}`,"color: blue; font-weight: bold");const O=new WebSocket(`${wg}/ws?sessionId=${r}`);return t.current=O,O.onopen=()=>{console.log("%c[WS] Connected!","color: green; font-weight: bold"),a(!0),v(null)},O.onmessage=E=>{var j,U;try{const Y=JSON.parse(E.data);console.log(`%c[WS] Received ${Y.type}:`,"color: purple; font-weight: bold",Y),Y.type==="ShoppingSummary"?(console.log("%c[WS] Setting shopping data!","color: green; font-weight: bold"),l(Y),p(!1)):Y.type==="Info"?(console.log(`%c[WS] Info: ${Y.message}`,"color: gray"),u(Y),Y.message.includes("Starting research")&&p(!0)):Y.type==="ResearchResults"&&(console.log("%c[WS] Research results received","color: orange; font-weight: bold"),console.log("  Top match:",(j=Y.top_match)==null?void 0:j.title),console.log("  Alternatives:",(U=Y.alternatives)==null?void 0:U.length))}catch(Y){console.error("%c[WS] Parse error:","color: red",Y)}},O.onerror=E=>{console.error("%c[WS] Connection error:","color: red; font-weight: bold",E),v("WebSocket connection error")},O.onclose=E=>{console.log(`%c[WS] Disconnected (code: ${E.code})`,"color: orange; font-weight: bold"),a(!1)},()=>{O.close()}},[r]);const S=me.useCallback(async O=>{console.log("%c[PICKUP] Triggering pickup event...","color: blue; font-weight: bold"),console.log("  Search seed:",O),p(!0),v(null),l(null);const E={event_id:crypto.randomUUID(),event_type:"PICKUP_DETECTED",confidence:.95,frame_ref:`frame-${Date.now()}`,search_seed:O};console.log("%c[PICKUP] Sending to backend:","color: blue",`${Wo}/sessions/${r}/overshoot`),console.log("  Payload:",E);try{const j=await fetch(`${Wo}/sessions/${r}/overshoot`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(E)});if(!j.ok){const Y=await j.text();throw console.error("%c[PICKUP] Backend error:","color: red",j.status,Y),new Error(`HTTP ${j.status}: ${Y}`)}const U=await j.json();console.log("%c[PICKUP] Backend accepted:","color: green; font-weight: bold",U)}catch(j){console.error("%c[PICKUP] Failed:","color: red; font-weight: bold",j),v("Failed to send pickup event"),p(!1)}},[r]),k=me.useCallback(async O=>{p(!0),v(null);try{const E=await fetch(`${Wo}/sessions/${r}/question`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({question:O})});if(!E.ok)throw new Error(`HTTP ${E.status}`);console.log("Question sent:",await E.json())}catch(E){console.error("Failed to send question:",E),v("Failed to send question"),p(!1)}},[r]);return{isConnected:i,shoppingData:o,lastInfo:f,isLoading:m,error:g,triggerPickup:S,askQuestion:k}}var xg={};function AT(r,t){return t.forEach(function(i){i&&typeof i!="string"&&!Array.isArray(i)&&Object.keys(i).forEach(function(a){if(a!=="default"&&!(a in r)){var o=Object.getOwnPropertyDescriptor(i,a);Object.defineProperty(r,a,o.get?o:{enumerable:!0,get:function(){return i[a]}})}})}),Object.freeze(r)}var DT=Object.defineProperty,MT=(r,t,i)=>t in r?DT(r,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):r[t]=i,Ng=(r,t,i)=>MT(r,typeof t!="symbol"?t+"":t,i);class xt{constructor(){Ng(this,"_locking"),Ng(this,"_locks"),this._locking=Promise.resolve(),this._locks=0}isLocked(){return this._locks>0}lock(){this._locks+=1;let t;const i=new Promise(o=>t=()=>{this._locks-=1,o()}),a=this._locking.then(()=>t);return this._locking=this._locking.then(()=>i),a}}function tt(r,t){if(!r)throw new Error(t)}const wT=34028234663852886e22,xT=-34028234663852886e22,NT=4294967295,PT=2147483647,UT=-2147483648;function $o(r){if(typeof r!="number")throw new Error("invalid int 32: "+typeof r);if(!Number.isInteger(r)||r>PT||r<UT)throw new Error("invalid int 32: "+r)}function Td(r){if(typeof r!="number")throw new Error("invalid uint 32: "+typeof r);if(!Number.isInteger(r)||r>NT||r<0)throw new Error("invalid uint 32: "+r)}function Bv(r){if(typeof r!="number")throw new Error("invalid float 32: "+typeof r);if(Number.isFinite(r)&&(r>wT||r<xT))throw new Error("invalid float 32: "+r)}const zv=Symbol("@bufbuild/protobuf/enum-type");function LT(r){const t=r[zv];return tt(t,"missing enum type on enum object"),t}function qv(r,t,i,a){r[zv]=Vv(t,i.map(o=>({no:o.no,name:o.name,localName:r[o.no]})))}function Vv(r,t,i){const a=Object.create(null),o=Object.create(null),l=[];for(const f of t){const u=Hv(f);l.push(u),a[f.name]=u,o[f.no]=u}return{typeName:r,values:l,findName(f){return a[f]},findNumber(f){return o[f]}}}function IT(r,t,i){const a={};for(const o of t){const l=Hv(o);a[l.localName]=l.no,a[l.no]=l.localName}return qv(a,r,t),a}function Hv(r){return"localName"in r?r:Object.assign(Object.assign({},r),{localName:r.name})}class Yd{equals(t){return this.getType().runtime.util.equals(this.getType(),this,t)}clone(){return this.getType().runtime.util.clone(this)}fromBinary(t,i){const a=this.getType(),o=a.runtime.bin,l=o.makeReadOptions(i);return o.readMessage(this,l.readerFactory(t),t.byteLength,l),this}fromJson(t,i){const a=this.getType(),o=a.runtime.json,l=o.makeReadOptions(i);return o.readMessage(a,t,l,this),this}fromJsonString(t,i){let a;try{a=JSON.parse(t)}catch(o){throw new Error("cannot decode ".concat(this.getType().typeName," from JSON: ").concat(o instanceof Error?o.message:String(o)))}return this.fromJson(a,i)}toBinary(t){const i=this.getType(),a=i.runtime.bin,o=a.makeWriteOptions(t),l=o.writerFactory();return a.writeMessage(this,l,o),l.finish()}toJson(t){const i=this.getType(),a=i.runtime.json,o=a.makeWriteOptions(t);return a.writeMessage(this,o)}toJsonString(t){var i;const a=this.toJson(t);return JSON.stringify(a,null,(i=t==null?void 0:t.prettySpaces)!==null&&i!==void 0?i:0)}toJSON(){return this.toJson({emitDefaultValues:!0})}getType(){return Object.getPrototypeOf(this).constructor}}function jT(r,t,i,a){var o;const l=(o=a==null?void 0:a.localName)!==null&&o!==void 0?o:t.substring(t.lastIndexOf(".")+1),f={[l]:function(u){r.util.initFields(this),r.util.initPartial(u,this)}}[l];return Object.setPrototypeOf(f.prototype,new Yd),Object.assign(f,{runtime:r,typeName:t,fields:r.util.newFieldList(i),fromBinary(u,m){return new f().fromBinary(u,m)},fromJson(u,m){return new f().fromJson(u,m)},fromJsonString(u,m){return new f().fromJsonString(u,m)},equals(u,m){return r.util.equals(f,u,m)}}),f}function BT(){let r=0,t=0;for(let a=0;a<28;a+=7){let o=this.buf[this.pos++];if(r|=(o&127)<<a,(o&128)==0)return this.assertBounds(),[r,t]}let i=this.buf[this.pos++];if(r|=(i&15)<<28,t=(i&112)>>4,(i&128)==0)return this.assertBounds(),[r,t];for(let a=3;a<=31;a+=7){let o=this.buf[this.pos++];if(t|=(o&127)<<a,(o&128)==0)return this.assertBounds(),[r,t]}throw new Error("invalid varint")}function nd(r,t,i){for(let l=0;l<28;l=l+7){const f=r>>>l,u=!(!(f>>>7)&&t==0),m=(u?f|128:f)&255;if(i.push(m),!u)return}const a=r>>>28&15|(t&7)<<4,o=t>>3!=0;if(i.push((o?a|128:a)&255),!!o){for(let l=3;l<31;l=l+7){const f=t>>>l,u=!!(f>>>7),m=(u?f|128:f)&255;if(i.push(m),!u)return}i.push(t>>>31&1)}}const ec=4294967296;function Pg(r){const t=r[0]==="-";t&&(r=r.slice(1));const i=1e6;let a=0,o=0;function l(f,u){const m=Number(r.slice(f,u));o*=i,a=a*i+m,a>=ec&&(o=o+(a/ec|0),a=a%ec)}return l(-24,-18),l(-18,-12),l(-12,-6),l(-6),t?Gv(a,o):Qd(a,o)}function zT(r,t){let i=Qd(r,t);const a=i.hi&2147483648;a&&(i=Gv(i.lo,i.hi));const o=Fv(i.lo,i.hi);return a?"-"+o:o}function Fv(r,t){if({lo:r,hi:t}=qT(r,t),t<=2097151)return String(ec*t+r);const i=r&16777215,a=(r>>>24|t<<8)&16777215,o=t>>16&65535;let l=i+a*6777216+o*6710656,f=a+o*8147497,u=o*2;const m=1e7;return l>=m&&(f+=Math.floor(l/m),l%=m),f>=m&&(u+=Math.floor(f/m),f%=m),u.toString()+Ug(f)+Ug(l)}function qT(r,t){return{lo:r>>>0,hi:t>>>0}}function Qd(r,t){return{lo:r|0,hi:t|0}}function Gv(r,t){return t=~t,r?r=~r+1:t+=1,Qd(r,t)}const Ug=r=>{const t=String(r);return"0000000".slice(t.length)+t};function Lg(r,t){if(r>=0){for(;r>127;)t.push(r&127|128),r=r>>>7;t.push(r)}else{for(let i=0;i<9;i++)t.push(r&127|128),r=r>>7;t.push(1)}}function VT(){let r=this.buf[this.pos++],t=r&127;if((r&128)==0)return this.assertBounds(),t;if(r=this.buf[this.pos++],t|=(r&127)<<7,(r&128)==0)return this.assertBounds(),t;if(r=this.buf[this.pos++],t|=(r&127)<<14,(r&128)==0)return this.assertBounds(),t;if(r=this.buf[this.pos++],t|=(r&127)<<21,(r&128)==0)return this.assertBounds(),t;r=this.buf[this.pos++],t|=(r&15)<<28;for(let i=5;(r&128)!==0&&i<10;i++)r=this.buf[this.pos++];if((r&128)!=0)throw new Error("invalid varint");return this.assertBounds(),t>>>0}function HT(){const r=new DataView(new ArrayBuffer(8));if(typeof BigInt=="function"&&typeof r.getBigInt64=="function"&&typeof r.getBigUint64=="function"&&typeof r.setBigInt64=="function"&&typeof r.setBigUint64=="function"&&(typeof process!="object"||typeof xg!="object"||xg.BUF_BIGINT_DISABLE!=="1")){const o=BigInt("-9223372036854775808"),l=BigInt("9223372036854775807"),f=BigInt("0"),u=BigInt("18446744073709551615");return{zero:BigInt(0),supported:!0,parse(m){const p=typeof m=="bigint"?m:BigInt(m);if(p>l||p<o)throw new Error("int64 invalid: ".concat(m));return p},uParse(m){const p=typeof m=="bigint"?m:BigInt(m);if(p>u||p<f)throw new Error("uint64 invalid: ".concat(m));return p},enc(m){return r.setBigInt64(0,this.parse(m),!0),{lo:r.getInt32(0,!0),hi:r.getInt32(4,!0)}},uEnc(m){return r.setBigInt64(0,this.uParse(m),!0),{lo:r.getInt32(0,!0),hi:r.getInt32(4,!0)}},dec(m,p){return r.setInt32(0,m,!0),r.setInt32(4,p,!0),r.getBigInt64(0,!0)},uDec(m,p){return r.setInt32(0,m,!0),r.setInt32(4,p,!0),r.getBigUint64(0,!0)}}}const i=o=>tt(/^-?[0-9]+$/.test(o),"int64 invalid: ".concat(o)),a=o=>tt(/^[0-9]+$/.test(o),"uint64 invalid: ".concat(o));return{zero:"0",supported:!1,parse(o){return typeof o!="string"&&(o=o.toString()),i(o),o},uParse(o){return typeof o!="string"&&(o=o.toString()),a(o),o},enc(o){return typeof o!="string"&&(o=o.toString()),i(o),Pg(o)},uEnc(o){return typeof o!="string"&&(o=o.toString()),a(o),Pg(o)},dec(o,l){return zT(o,l)},uDec(o,l){return Fv(o,l)}}}const Xe=HT();var K;(function(r){r[r.DOUBLE=1]="DOUBLE",r[r.FLOAT=2]="FLOAT",r[r.INT64=3]="INT64",r[r.UINT64=4]="UINT64",r[r.INT32=5]="INT32",r[r.FIXED64=6]="FIXED64",r[r.FIXED32=7]="FIXED32",r[r.BOOL=8]="BOOL",r[r.STRING=9]="STRING",r[r.BYTES=12]="BYTES",r[r.UINT32=13]="UINT32",r[r.SFIXED32=15]="SFIXED32",r[r.SFIXED64=16]="SFIXED64",r[r.SINT32=17]="SINT32",r[r.SINT64=18]="SINT64"})(K||(K={}));var Vi;(function(r){r[r.BIGINT=0]="BIGINT",r[r.STRING=1]="STRING"})(Vi||(Vi={}));function Pi(r,t,i){if(t===i)return!0;if(r==K.BYTES){if(!(t instanceof Uint8Array)||!(i instanceof Uint8Array)||t.length!==i.length)return!1;for(let a=0;a<t.length;a++)if(t[a]!==i[a])return!1;return!0}switch(r){case K.UINT64:case K.FIXED64:case K.INT64:case K.SFIXED64:case K.SINT64:return t==i}return!1}function ms(r,t){switch(r){case K.BOOL:return!1;case K.UINT64:case K.FIXED64:case K.INT64:case K.SFIXED64:case K.SINT64:return t==0?Xe.zero:"0";case K.DOUBLE:case K.FLOAT:return 0;case K.BYTES:return new Uint8Array(0);case K.STRING:return"";default:return 0}}function Kv(r,t){switch(r){case K.BOOL:return t===!1;case K.STRING:return t==="";case K.BYTES:return t instanceof Uint8Array&&!t.byteLength;default:return t==0}}var ot;(function(r){r[r.Varint=0]="Varint",r[r.Bit64=1]="Bit64",r[r.LengthDelimited=2]="LengthDelimited",r[r.StartGroup=3]="StartGroup",r[r.EndGroup=4]="EndGroup",r[r.Bit32=5]="Bit32"})(ot||(ot={}));class FT{constructor(t){this.stack=[],this.textEncoder=t??new TextEncoder,this.chunks=[],this.buf=[]}finish(){this.chunks.push(new Uint8Array(this.buf));let t=0;for(let o=0;o<this.chunks.length;o++)t+=this.chunks[o].length;let i=new Uint8Array(t),a=0;for(let o=0;o<this.chunks.length;o++)i.set(this.chunks[o],a),a+=this.chunks[o].length;return this.chunks=[],i}fork(){return this.stack.push({chunks:this.chunks,buf:this.buf}),this.chunks=[],this.buf=[],this}join(){let t=this.finish(),i=this.stack.pop();if(!i)throw new Error("invalid state, fork stack empty");return this.chunks=i.chunks,this.buf=i.buf,this.uint32(t.byteLength),this.raw(t)}tag(t,i){return this.uint32((t<<3|i)>>>0)}raw(t){return this.buf.length&&(this.chunks.push(new Uint8Array(this.buf)),this.buf=[]),this.chunks.push(t),this}uint32(t){for(Td(t);t>127;)this.buf.push(t&127|128),t=t>>>7;return this.buf.push(t),this}int32(t){return $o(t),Lg(t,this.buf),this}bool(t){return this.buf.push(t?1:0),this}bytes(t){return this.uint32(t.byteLength),this.raw(t)}string(t){let i=this.textEncoder.encode(t);return this.uint32(i.byteLength),this.raw(i)}float(t){Bv(t);let i=new Uint8Array(4);return new DataView(i.buffer).setFloat32(0,t,!0),this.raw(i)}double(t){let i=new Uint8Array(8);return new DataView(i.buffer).setFloat64(0,t,!0),this.raw(i)}fixed32(t){Td(t);let i=new Uint8Array(4);return new DataView(i.buffer).setUint32(0,t,!0),this.raw(i)}sfixed32(t){$o(t);let i=new Uint8Array(4);return new DataView(i.buffer).setInt32(0,t,!0),this.raw(i)}sint32(t){return $o(t),t=(t<<1^t>>31)>>>0,Lg(t,this.buf),this}sfixed64(t){let i=new Uint8Array(8),a=new DataView(i.buffer),o=Xe.enc(t);return a.setInt32(0,o.lo,!0),a.setInt32(4,o.hi,!0),this.raw(i)}fixed64(t){let i=new Uint8Array(8),a=new DataView(i.buffer),o=Xe.uEnc(t);return a.setInt32(0,o.lo,!0),a.setInt32(4,o.hi,!0),this.raw(i)}int64(t){let i=Xe.enc(t);return nd(i.lo,i.hi,this.buf),this}sint64(t){let i=Xe.enc(t),a=i.hi>>31,o=i.lo<<1^a,l=(i.hi<<1|i.lo>>>31)^a;return nd(o,l,this.buf),this}uint64(t){let i=Xe.uEnc(t);return nd(i.lo,i.hi,this.buf),this}}class GT{constructor(t,i){this.varint64=BT,this.uint32=VT,this.buf=t,this.len=t.length,this.pos=0,this.view=new DataView(t.buffer,t.byteOffset,t.byteLength),this.textDecoder=i??new TextDecoder}tag(){let t=this.uint32(),i=t>>>3,a=t&7;if(i<=0||a<0||a>5)throw new Error("illegal tag: field no "+i+" wire type "+a);return[i,a]}skip(t,i){let a=this.pos;switch(t){case ot.Varint:for(;this.buf[this.pos++]&128;);break;case ot.Bit64:this.pos+=4;case ot.Bit32:this.pos+=4;break;case ot.LengthDelimited:let o=this.uint32();this.pos+=o;break;case ot.StartGroup:for(;;){const[l,f]=this.tag();if(f===ot.EndGroup){if(i!==void 0&&l!==i)throw new Error("invalid end group tag");break}this.skip(f,l)}break;default:throw new Error("cant skip wire type "+t)}return this.assertBounds(),this.buf.subarray(a,this.pos)}assertBounds(){if(this.pos>this.len)throw new RangeError("premature EOF")}int32(){return this.uint32()|0}sint32(){let t=this.uint32();return t>>>1^-(t&1)}int64(){return Xe.dec(...this.varint64())}uint64(){return Xe.uDec(...this.varint64())}sint64(){let[t,i]=this.varint64(),a=-(t&1);return t=(t>>>1|(i&1)<<31)^a,i=i>>>1^a,Xe.dec(t,i)}bool(){let[t,i]=this.varint64();return t!==0||i!==0}fixed32(){return this.view.getUint32((this.pos+=4)-4,!0)}sfixed32(){return this.view.getInt32((this.pos+=4)-4,!0)}fixed64(){return Xe.uDec(this.sfixed32(),this.sfixed32())}sfixed64(){return Xe.dec(this.sfixed32(),this.sfixed32())}float(){return this.view.getFloat32((this.pos+=4)-4,!0)}double(){return this.view.getFloat64((this.pos+=8)-8,!0)}bytes(){let t=this.uint32(),i=this.pos;return this.pos+=t,this.assertBounds(),this.buf.subarray(i,i+t)}string(){return this.textDecoder.decode(this.bytes())}}function KT(r,t,i,a){let o;return{typeName:t,extendee:i,get field(){if(!o){const l=typeof a=="function"?a():a;l.name=t.split(".").pop(),l.jsonName="[".concat(t,"]"),o=r.util.newFieldList([l]).list()[0]}return o},runtime:r}}function Yv(r){const t=r.field.localName,i=Object.create(null);return i[t]=YT(r),[i,()=>i[t]]}function YT(r){const t=r.field;if(t.repeated)return[];if(t.default!==void 0)return t.default;switch(t.kind){case"enum":return t.T.values[0].no;case"scalar":return ms(t.T,t.L);case"message":const i=t.T,a=new i;return i.fieldWrapper?i.fieldWrapper.unwrapField(a):a;case"map":throw"map fields are not allowed to be extensions"}}function QT(r,t){if(!t.repeated&&(t.kind=="enum"||t.kind=="scalar")){for(let i=r.length-1;i>=0;--i)if(r[i].no==t.no)return[r[i]];return[]}return r.filter(i=>i.no===t.no)}let ai="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".split(""),kc=[];for(let r=0;r<ai.length;r++)kc[ai[r].charCodeAt(0)]=r;kc[45]=ai.indexOf("+");kc[95]=ai.indexOf("/");const Qv={dec(r){let t=r.length*3/4;r[r.length-2]=="="?t-=2:r[r.length-1]=="="&&(t-=1);let i=new Uint8Array(t),a=0,o=0,l,f=0;for(let u=0;u<r.length;u++){if(l=kc[r.charCodeAt(u)],l===void 0)switch(r[u]){case"=":o=0;case`
`:case"\r":case"	":case" ":continue;default:throw Error("invalid base64 string.")}switch(o){case 0:f=l,o=1;break;case 1:i[a++]=f<<2|(l&48)>>4,f=l,o=2;break;case 2:i[a++]=(f&15)<<4|(l&60)>>2,f=l,o=3;break;case 3:i[a++]=(f&3)<<6|l,o=0;break}}if(o==1)throw Error("invalid base64 string.");return i.subarray(0,a)},enc(r){let t="",i=0,a,o=0;for(let l=0;l<r.length;l++)switch(a=r[l],i){case 0:t+=ai[a>>2],o=(a&3)<<4,i=1;break;case 1:t+=ai[o|a>>4],o=(a&15)<<2,i=2;break;case 2:t+=ai[o|a>>6],t+=ai[a&63],i=0;break}return i&&(t+=ai[o],t+="=",i==1&&(t+="=")),t}};function JT(r,t,i){Xv(t,r);const a=t.runtime.bin.makeReadOptions(i),o=QT(r.getType().runtime.bin.listUnknownFields(r),t.field),[l,f]=Yv(t);for(const u of o)t.runtime.bin.readField(l,a.readerFactory(u.data),t.field,u.wireType,a);return f()}function XT(r,t,i,a){Xv(t,r);const o=t.runtime.bin.makeReadOptions(a),l=t.runtime.bin.makeWriteOptions(a);if(Jv(r,t)){const p=r.getType().runtime.bin.listUnknownFields(r).filter(g=>g.no!=t.field.no);r.getType().runtime.bin.discardUnknownFields(r);for(const g of p)r.getType().runtime.bin.onUnknownField(r,g.no,g.wireType,g.data)}const f=l.writerFactory();let u=t.field;!u.opt&&!u.repeated&&(u.kind=="enum"||u.kind=="scalar")&&(u=Object.assign(Object.assign({},t.field),{opt:!0})),t.runtime.bin.writeField(u,i,f,l);const m=o.readerFactory(f.finish());for(;m.pos<m.len;){const[p,g]=m.tag(),v=m.skip(g,p);r.getType().runtime.bin.onUnknownField(r,p,g,v)}}function Jv(r,t){const i=r.getType();return t.extendee.typeName===i.typeName&&!!i.runtime.bin.listUnknownFields(r).find(a=>a.no==t.field.no)}function Xv(r,t){tt(r.extendee.typeName==t.getType().typeName,"extension ".concat(r.typeName," can only be applied to message ").concat(r.extendee.typeName))}function Zv(r,t){const i=r.localName;if(r.repeated)return t[i].length>0;if(r.oneof)return t[r.oneof.localName].case===i;switch(r.kind){case"enum":case"scalar":return r.opt||r.req?t[i]!==void 0:r.kind=="enum"?t[i]!==r.T.values[0].no:!Kv(r.T,t[i]);case"message":return t[i]!==void 0;case"map":return Object.keys(t[i]).length>0}}function Ig(r,t){const i=r.localName,a=!r.opt&&!r.req;if(r.repeated)t[i]=[];else if(r.oneof)t[r.oneof.localName]={case:void 0};else switch(r.kind){case"map":t[i]={};break;case"enum":t[i]=a?r.T.values[0].no:void 0;break;case"scalar":t[i]=a?ms(r.T,r.L):void 0;break;case"message":t[i]=void 0;break}}function si(r,t){if(r===null||typeof r!="object"||!Object.getOwnPropertyNames(Yd.prototype).every(a=>a in r&&typeof r[a]=="function"))return!1;const i=r.getType();return i===null||typeof i!="function"||!("typeName"in i)||typeof i.typeName!="string"?!1:t===void 0?!0:i.typeName==t.typeName}function Wv(r,t){return si(t)||!r.fieldWrapper?t:r.fieldWrapper.wrapField(t)}K.DOUBLE,K.FLOAT,K.INT64,K.UINT64,K.INT32,K.UINT32,K.BOOL,K.STRING,K.BYTES;const jg={ignoreUnknownFields:!1},Bg={emitDefaultValues:!1,enumAsInteger:!1,useProtoFieldName:!1,prettySpaces:0};function ZT(r){return r?Object.assign(Object.assign({},jg),r):jg}function WT(r){return r?Object.assign(Object.assign({},Bg),r):Bg}const fc=Symbol(),tc=Symbol();function $T(){return{makeReadOptions:ZT,makeWriteOptions:WT,readMessage(r,t,i,a){if(t==null||Array.isArray(t)||typeof t!="object")throw new Error("cannot decode message ".concat(r.typeName," from JSON: ").concat(xn(t)));a=a??new r;const o=new Map,l=i.typeRegistry;for(const[f,u]of Object.entries(t)){const m=r.fields.findJsonName(f);if(m){if(m.oneof){if(u===null&&m.kind=="scalar")continue;const p=o.get(m.oneof);if(p!==void 0)throw new Error("cannot decode message ".concat(r.typeName,' from JSON: multiple keys for oneof "').concat(m.oneof.name,'" present: "').concat(p,'", "').concat(f,'"'));o.set(m.oneof,f)}zg(a,u,m,i,r)}else{let p=!1;if(l!=null&&l.findExtension&&f.startsWith("[")&&f.endsWith("]")){const g=l.findExtension(f.substring(1,f.length-1));if(g&&g.extendee.typeName==r.typeName){p=!0;const[v,S]=Yv(g);zg(v,u,g.field,i,g),XT(a,g,S(),i)}}if(!p&&!i.ignoreUnknownFields)throw new Error("cannot decode message ".concat(r.typeName,' from JSON: key "').concat(f,'" is unknown'))}}return a},writeMessage(r,t){const i=r.getType(),a={};let o;try{for(o of i.fields.byNumber()){if(!Zv(o,r)){if(o.req)throw"required field not set";if(!t.emitDefaultValues||!tC(o))continue}const f=o.oneof?r[o.oneof.localName].value:r[o.localName],u=qg(o,f,t);u!==void 0&&(a[t.useProtoFieldName?o.name:o.jsonName]=u)}const l=t.typeRegistry;if(l!=null&&l.findExtensionFor)for(const f of i.runtime.bin.listUnknownFields(r)){const u=l.findExtensionFor(i.typeName,f.no);if(u&&Jv(r,u)){const m=JT(r,u,t),p=qg(u.field,m,t);p!==void 0&&(a[u.field.jsonName]=p)}}}catch(l){const f=o?"cannot encode field ".concat(i.typeName,".").concat(o.name," to JSON"):"cannot encode message ".concat(i.typeName," to JSON"),u=l instanceof Error?l.message:String(l);throw new Error(f+(u.length>0?": ".concat(u):""))}return a},readScalar(r,t,i){return Sr(r,t,i??Vi.BIGINT,!0)},writeScalar(r,t,i){if(t!==void 0&&(i||Kv(r,t)))return nc(r,t)},debug:xn}}function xn(r){if(r===null)return"null";switch(typeof r){case"object":return Array.isArray(r)?"array":"object";case"string":return r.length>100?"string":'"'.concat(r.split('"').join('\\"'),'"');default:return String(r)}}function zg(r,t,i,a,o){let l=i.localName;if(i.repeated){if(tt(i.kind!="map"),t===null)return;if(!Array.isArray(t))throw new Error("cannot decode field ".concat(o.typeName,".").concat(i.name," from JSON: ").concat(xn(t)));const f=r[l];for(const u of t){if(u===null)throw new Error("cannot decode field ".concat(o.typeName,".").concat(i.name," from JSON: ").concat(xn(u)));switch(i.kind){case"message":f.push(i.T.fromJson(u,a));break;case"enum":const m=id(i.T,u,a.ignoreUnknownFields,!0);m!==tc&&f.push(m);break;case"scalar":try{f.push(Sr(i.T,u,i.L,!0))}catch(p){let g="cannot decode field ".concat(o.typeName,".").concat(i.name," from JSON: ").concat(xn(u));throw p instanceof Error&&p.message.length>0&&(g+=": ".concat(p.message)),new Error(g)}break}}}else if(i.kind=="map"){if(t===null)return;if(typeof t!="object"||Array.isArray(t))throw new Error("cannot decode field ".concat(o.typeName,".").concat(i.name," from JSON: ").concat(xn(t)));const f=r[l];for(const[u,m]of Object.entries(t)){if(m===null)throw new Error("cannot decode field ".concat(o.typeName,".").concat(i.name," from JSON: map value null"));let p;try{p=eC(i.K,u)}catch(g){let v="cannot decode map key for field ".concat(o.typeName,".").concat(i.name," from JSON: ").concat(xn(t));throw g instanceof Error&&g.message.length>0&&(v+=": ".concat(g.message)),new Error(v)}switch(i.V.kind){case"message":f[p]=i.V.T.fromJson(m,a);break;case"enum":const g=id(i.V.T,m,a.ignoreUnknownFields,!0);g!==tc&&(f[p]=g);break;case"scalar":try{f[p]=Sr(i.V.T,m,Vi.BIGINT,!0)}catch(v){let S="cannot decode map value for field ".concat(o.typeName,".").concat(i.name," from JSON: ").concat(xn(t));throw v instanceof Error&&v.message.length>0&&(S+=": ".concat(v.message)),new Error(S)}break}}}else switch(i.oneof&&(r=r[i.oneof.localName]={case:l},l="value"),i.kind){case"message":const f=i.T;if(t===null&&f.typeName!="google.protobuf.Value")return;let u=r[l];si(u)?u.fromJson(t,a):(r[l]=u=f.fromJson(t,a),f.fieldWrapper&&!i.oneof&&(r[l]=f.fieldWrapper.unwrapField(u)));break;case"enum":const m=id(i.T,t,a.ignoreUnknownFields,!1);switch(m){case fc:Ig(i,r);break;case tc:break;default:r[l]=m;break}break;case"scalar":try{const p=Sr(i.T,t,i.L,!1);switch(p){case fc:Ig(i,r);break;default:r[l]=p;break}}catch(p){let g="cannot decode field ".concat(o.typeName,".").concat(i.name," from JSON: ").concat(xn(t));throw p instanceof Error&&p.message.length>0&&(g+=": ".concat(p.message)),new Error(g)}break}}function eC(r,t){if(r===K.BOOL)switch(t){case"true":t=!0;break;case"false":t=!1;break}return Sr(r,t,Vi.BIGINT,!0).toString()}function Sr(r,t,i,a){if(t===null)return a?ms(r,i):fc;switch(r){case K.DOUBLE:case K.FLOAT:if(t==="NaN")return Number.NaN;if(t==="Infinity")return Number.POSITIVE_INFINITY;if(t==="-Infinity")return Number.NEGATIVE_INFINITY;if(t===""||typeof t=="string"&&t.trim().length!==t.length||typeof t!="string"&&typeof t!="number")break;const o=Number(t);if(Number.isNaN(o)||!Number.isFinite(o))break;return r==K.FLOAT&&Bv(o),o;case K.INT32:case K.FIXED32:case K.SFIXED32:case K.SINT32:case K.UINT32:let l;if(typeof t=="number"?l=t:typeof t=="string"&&t.length>0&&t.trim().length===t.length&&(l=Number(t)),l===void 0)break;return r==K.UINT32||r==K.FIXED32?Td(l):$o(l),l;case K.INT64:case K.SFIXED64:case K.SINT64:if(typeof t!="number"&&typeof t!="string")break;const f=Xe.parse(t);return i?f.toString():f;case K.FIXED64:case K.UINT64:if(typeof t!="number"&&typeof t!="string")break;const u=Xe.uParse(t);return i?u.toString():u;case K.BOOL:if(typeof t!="boolean")break;return t;case K.STRING:if(typeof t!="string")break;try{encodeURIComponent(t)}catch{throw new Error("invalid UTF8")}return t;case K.BYTES:if(t==="")return new Uint8Array(0);if(typeof t!="string")break;return Qv.dec(t)}throw new Error}function id(r,t,i,a){if(t===null)return r.typeName=="google.protobuf.NullValue"?0:a?r.values[0].no:fc;switch(typeof t){case"number":if(Number.isInteger(t))return t;break;case"string":const o=r.findName(t);if(o!==void 0)return o.no;if(i)return tc;break}throw new Error("cannot decode enum ".concat(r.typeName," from JSON: ").concat(xn(t)))}function tC(r){return r.repeated||r.kind=="map"?!0:!(r.oneof||r.kind=="message"||r.opt||r.req)}function qg(r,t,i){if(r.kind=="map"){tt(typeof t=="object"&&t!=null);const a={},o=Object.entries(t);switch(r.V.kind){case"scalar":for(const[f,u]of o)a[f.toString()]=nc(r.V.T,u);break;case"message":for(const[f,u]of o)a[f.toString()]=u.toJson(i);break;case"enum":const l=r.V.T;for(const[f,u]of o)a[f.toString()]=ad(l,u,i.enumAsInteger);break}return i.emitDefaultValues||o.length>0?a:void 0}if(r.repeated){tt(Array.isArray(t));const a=[];switch(r.kind){case"scalar":for(let o=0;o<t.length;o++)a.push(nc(r.T,t[o]));break;case"enum":for(let o=0;o<t.length;o++)a.push(ad(r.T,t[o],i.enumAsInteger));break;case"message":for(let o=0;o<t.length;o++)a.push(t[o].toJson(i));break}return i.emitDefaultValues||a.length>0?a:void 0}switch(r.kind){case"scalar":return nc(r.T,t);case"enum":return ad(r.T,t,i.enumAsInteger);case"message":return Wv(r.T,t).toJson(i)}}function ad(r,t,i){var a;if(tt(typeof t=="number"),r.typeName=="google.protobuf.NullValue")return null;if(i)return t;const o=r.findNumber(t);return(a=o==null?void 0:o.name)!==null&&a!==void 0?a:t}function nc(r,t){switch(r){case K.INT32:case K.SFIXED32:case K.SINT32:case K.FIXED32:case K.UINT32:return tt(typeof t=="number"),t;case K.FLOAT:case K.DOUBLE:return tt(typeof t=="number"),Number.isNaN(t)?"NaN":t===Number.POSITIVE_INFINITY?"Infinity":t===Number.NEGATIVE_INFINITY?"-Infinity":t;case K.STRING:return tt(typeof t=="string"),t;case K.BOOL:return tt(typeof t=="boolean"),t;case K.UINT64:case K.FIXED64:case K.INT64:case K.SFIXED64:case K.SINT64:return tt(typeof t=="bigint"||typeof t=="string"||typeof t=="number"),t.toString();case K.BYTES:return tt(t instanceof Uint8Array),Qv.enc(t)}}const ts=Symbol("@bufbuild/protobuf/unknown-fields"),Vg={readUnknownFields:!0,readerFactory:r=>new GT(r)},Hg={writeUnknownFields:!0,writerFactory:()=>new FT};function nC(r){return r?Object.assign(Object.assign({},Vg),r):Vg}function iC(r){return r?Object.assign(Object.assign({},Hg),r):Hg}function aC(){return{makeReadOptions:nC,makeWriteOptions:iC,listUnknownFields(r){var t;return(t=r[ts])!==null&&t!==void 0?t:[]},discardUnknownFields(r){delete r[ts]},writeUnknownFields(r,t){const a=r[ts];if(a)for(const o of a)t.tag(o.no,o.wireType).raw(o.data)},onUnknownField(r,t,i,a){const o=r;Array.isArray(o[ts])||(o[ts]=[]),o[ts].push({no:t,wireType:i,data:a})},readMessage(r,t,i,a,o){const l=r.getType(),f=o?t.len:t.pos+i;let u,m;for(;t.pos<f&&([u,m]=t.tag(),!(o===!0&&m==ot.EndGroup));){const p=l.fields.find(u);if(!p){const g=t.skip(m,u);a.readUnknownFields&&this.onUnknownField(r,u,m,g);continue}Fg(r,t,p,m,a)}if(o&&(m!=ot.EndGroup||u!==i))throw new Error("invalid end group tag")},readField:Fg,writeMessage(r,t,i){const a=r.getType();for(const o of a.fields.byNumber()){if(!Zv(o,r)){if(o.req)throw new Error("cannot encode field ".concat(a.typeName,".").concat(o.name," to binary: required field not set"));continue}const l=o.oneof?r[o.oneof.localName].value:r[o.localName];Gg(o,l,t,i)}return i.writeUnknownFields&&this.writeUnknownFields(r,t),t},writeField(r,t,i,a){t!==void 0&&Gg(r,t,i,a)}}}function Fg(r,t,i,a,o){let{repeated:l,localName:f}=i;switch(i.oneof&&(r=r[i.oneof.localName],r.case!=f&&delete r.value,r.case=f,f="value"),i.kind){case"scalar":case"enum":const u=i.kind=="enum"?K.INT32:i.T;let m=hc;if(i.kind=="scalar"&&i.L>0&&(m=rC),l){let S=r[f];if(a==ot.LengthDelimited&&u!=K.STRING&&u!=K.BYTES){let O=t.uint32()+t.pos;for(;t.pos<O;)S.push(m(t,u))}else S.push(m(t,u))}else r[f]=m(t,u);break;case"message":const p=i.T;l?r[f].push(ic(t,new p,o,i)):si(r[f])?ic(t,r[f],o,i):(r[f]=ic(t,new p,o,i),p.fieldWrapper&&!i.oneof&&!i.repeated&&(r[f]=p.fieldWrapper.unwrapField(r[f])));break;case"map":let[g,v]=sC(i,t,o);r[f][g]=v;break}}function ic(r,t,i,a){const o=t.getType().runtime.bin,l=a==null?void 0:a.delimited;return o.readMessage(t,r,l?a.no:r.uint32(),i,l),t}function sC(r,t,i){const a=t.uint32(),o=t.pos+a;let l,f;for(;t.pos<o;){const[u]=t.tag();switch(u){case 1:l=hc(t,r.K);break;case 2:switch(r.V.kind){case"scalar":f=hc(t,r.V.T);break;case"enum":f=t.int32();break;case"message":f=ic(t,new r.V.T,i,void 0);break}break}}if(l===void 0&&(l=ms(r.K,Vi.BIGINT)),typeof l!="string"&&typeof l!="number"&&(l=l.toString()),f===void 0)switch(r.V.kind){case"scalar":f=ms(r.V.T,Vi.BIGINT);break;case"enum":f=r.V.T.values[0].no;break;case"message":f=new r.V.T;break}return[l,f]}function rC(r,t){const i=hc(r,t);return typeof i=="bigint"?i.toString():i}function hc(r,t){switch(t){case K.STRING:return r.string();case K.BOOL:return r.bool();case K.DOUBLE:return r.double();case K.FLOAT:return r.float();case K.INT32:return r.int32();case K.INT64:return r.int64();case K.UINT64:return r.uint64();case K.FIXED64:return r.fixed64();case K.BYTES:return r.bytes();case K.FIXED32:return r.fixed32();case K.SFIXED32:return r.sfixed32();case K.SFIXED64:return r.sfixed64();case K.SINT64:return r.sint64();case K.UINT32:return r.uint32();case K.SINT32:return r.sint32()}}function Gg(r,t,i,a){tt(t!==void 0);const o=r.repeated;switch(r.kind){case"scalar":case"enum":let l=r.kind=="enum"?K.INT32:r.T;if(o)if(tt(Array.isArray(t)),r.packed)cC(i,l,r.no,t);else for(const f of t)Tr(i,l,r.no,f);else Tr(i,l,r.no,t);break;case"message":if(o){tt(Array.isArray(t));for(const f of t)Kg(i,a,r,f)}else Kg(i,a,r,t);break;case"map":tt(typeof t=="object"&&t!=null);for(const[f,u]of Object.entries(t))oC(i,a,r,f,u);break}}function oC(r,t,i,a,o){r.tag(i.no,ot.LengthDelimited),r.fork();let l=a;switch(i.K){case K.INT32:case K.FIXED32:case K.UINT32:case K.SFIXED32:case K.SINT32:l=Number.parseInt(a);break;case K.BOOL:tt(a=="true"||a=="false"),l=a=="true";break}switch(Tr(r,i.K,1,l),i.V.kind){case"scalar":Tr(r,i.V.T,2,o);break;case"enum":Tr(r,K.INT32,2,o);break;case"message":tt(o!==void 0),r.tag(2,ot.LengthDelimited).bytes(o.toBinary(t));break}r.join()}function Kg(r,t,i,a){const o=Wv(i.T,a);i.delimited?r.tag(i.no,ot.StartGroup).raw(o.toBinary(t)).tag(i.no,ot.EndGroup):r.tag(i.no,ot.LengthDelimited).bytes(o.toBinary(t))}function Tr(r,t,i,a){tt(a!==void 0);let[o,l]=$v(t);r.tag(i,o)[l](a)}function cC(r,t,i,a){if(!a.length)return;r.tag(i,ot.LengthDelimited).fork();let[,o]=$v(t);for(let l=0;l<a.length;l++)r[o](a[l]);r.join()}function $v(r){let t=ot.Varint;switch(r){case K.BYTES:case K.STRING:t=ot.LengthDelimited;break;case K.DOUBLE:case K.FIXED64:case K.SFIXED64:t=ot.Bit64;break;case K.FIXED32:case K.SFIXED32:case K.FLOAT:t=ot.Bit32;break}const i=K[r].toLowerCase();return[t,i]}function lC(){return{setEnumType:qv,initPartial(r,t){if(r===void 0)return;const i=t.getType();for(const a of i.fields.byMember()){const o=a.localName,l=t,f=r;if(f[o]!=null)switch(a.kind){case"oneof":const u=f[o].case;if(u===void 0)continue;const m=a.findField(u);let p=f[o].value;m&&m.kind=="message"&&!si(p,m.T)?p=new m.T(p):m&&m.kind==="scalar"&&m.T===K.BYTES&&(p=fr(p)),l[o]={case:u,value:p};break;case"scalar":case"enum":let g=f[o];a.T===K.BYTES&&(g=a.repeated?g.map(fr):fr(g)),l[o]=g;break;case"map":switch(a.V.kind){case"scalar":case"enum":if(a.V.T===K.BYTES)for(const[k,O]of Object.entries(f[o]))l[o][k]=fr(O);else Object.assign(l[o],f[o]);break;case"message":const S=a.V.T;for(const k of Object.keys(f[o])){let O=f[o][k];S.fieldWrapper||(O=new S(O)),l[o][k]=O}break}break;case"message":const v=a.T;if(a.repeated)l[o]=f[o].map(S=>si(S,v)?S:new v(S));else{const S=f[o];v.fieldWrapper?v.typeName==="google.protobuf.BytesValue"?l[o]=fr(S):l[o]=S:l[o]=si(S,v)?S:new v(S)}break}}},equals(r,t,i){return t===i?!0:!t||!i?!1:r.fields.byMember().every(a=>{const o=t[a.localName],l=i[a.localName];if(a.repeated){if(o.length!==l.length)return!1;switch(a.kind){case"message":return o.every((f,u)=>a.T.equals(f,l[u]));case"scalar":return o.every((f,u)=>Pi(a.T,f,l[u]));case"enum":return o.every((f,u)=>Pi(K.INT32,f,l[u]))}throw new Error("repeated cannot contain ".concat(a.kind))}switch(a.kind){case"message":let f=o,u=l;return a.T.fieldWrapper&&(f!==void 0&&!si(f)&&(f=a.T.fieldWrapper.wrapField(f)),u!==void 0&&!si(u)&&(u=a.T.fieldWrapper.wrapField(u))),a.T.equals(f,u);case"enum":return Pi(K.INT32,o,l);case"scalar":return Pi(a.T,o,l);case"oneof":if(o.case!==l.case)return!1;const m=a.findField(o.case);if(m===void 0)return!0;switch(m.kind){case"message":return m.T.equals(o.value,l.value);case"enum":return Pi(K.INT32,o.value,l.value);case"scalar":return Pi(m.T,o.value,l.value)}throw new Error("oneof cannot contain ".concat(m.kind));case"map":const p=Object.keys(o).concat(Object.keys(l));switch(a.V.kind){case"message":const g=a.V.T;return p.every(S=>g.equals(o[S],l[S]));case"enum":return p.every(S=>Pi(K.INT32,o[S],l[S]));case"scalar":const v=a.V.T;return p.every(S=>Pi(v,o[S],l[S]))}break}})},clone(r){const t=r.getType(),i=new t,a=i;for(const o of t.fields.byMember()){const l=r[o.localName];let f;if(o.repeated)f=l.map(Jo);else if(o.kind=="map"){f=a[o.localName];for(const[u,m]of Object.entries(l))f[u]=Jo(m)}else o.kind=="oneof"?f=o.findField(l.case)?{case:l.case,value:Jo(l.value)}:{case:void 0}:f=Jo(l);a[o.localName]=f}for(const o of t.runtime.bin.listUnknownFields(r))t.runtime.bin.onUnknownField(a,o.no,o.wireType,o.data);return i}}}function Jo(r){if(r===void 0)return r;if(si(r))return r.clone();if(r instanceof Uint8Array){const t=new Uint8Array(r.byteLength);return t.set(r),t}return r}function fr(r){return r instanceof Uint8Array?r:new Uint8Array(r)}function uC(r,t,i){return{syntax:r,json:$T(),bin:aC(),util:Object.assign(Object.assign({},lC()),{newFieldList:t,initFields:i}),makeMessageType(a,o,l){return jT(this,a,o,l)},makeEnum:IT,makeEnumType:Vv,getEnumType:LT,makeExtension(a,o,l){return KT(this,a,o,l)}}}class dC{constructor(t,i){this._fields=t,this._normalizer=i}findJsonName(t){if(!this.jsonNames){const i={};for(const a of this.list())i[a.jsonName]=i[a.name]=a;this.jsonNames=i}return this.jsonNames[t]}find(t){if(!this.numbers){const i={};for(const a of this.list())i[a.no]=a;this.numbers=i}return this.numbers[t]}list(){return this.all||(this.all=this._normalizer(this._fields)),this.all}byNumber(){return this.numbersAsc||(this.numbersAsc=this.list().concat().sort((t,i)=>t.no-i.no)),this.numbersAsc}byMember(){if(!this.members){this.members=[];const t=this.members;let i;for(const a of this.list())a.oneof?a.oneof!==i&&(i=a.oneof,t.push(i)):t.push(a)}return this.members}}function e0(r,t){const i=t0(r);return t?i:vC(gC(i))}function fC(r){return e0(r,!1)}const hC=t0;function t0(r){let t=!1;const i=[];for(let a=0;a<r.length;a++){let o=r.charAt(a);switch(o){case"_":t=!0;break;case"0":case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":i.push(o),t=!1;break;default:t&&(t=!1,o=o.toUpperCase()),i.push(o);break}}return i.join("")}const mC=new Set(["constructor","toString","toJSON","valueOf"]),pC=new Set(["getType","clone","equals","fromBinary","fromJson","fromJsonString","toBinary","toJson","toJsonString","toObject"]),n0=r=>"".concat(r,"$"),gC=r=>pC.has(r)?n0(r):r,vC=r=>mC.has(r)?n0(r):r;class yC{constructor(t){this.kind="oneof",this.repeated=!1,this.packed=!1,this.opt=!1,this.req=!1,this.default=void 0,this.fields=[],this.name=t,this.localName=fC(t)}addField(t){tt(t.oneof===this,"field ".concat(t.name," not one of ").concat(this.name)),this.fields.push(t)}findField(t){if(!this._lookup){this._lookup=Object.create(null);for(let i=0;i<this.fields.length;i++)this._lookup[this.fields[i].localName]=this.fields[i]}return this._lookup[t]}}function bC(r,t){var i,a,o,l,f,u;const m=[];let p;for(const g of typeof r=="function"?r():r){const v=g;if(v.localName=e0(g.name,g.oneof!==void 0),v.jsonName=(i=g.jsonName)!==null&&i!==void 0?i:hC(g.name),v.repeated=(a=g.repeated)!==null&&a!==void 0?a:!1,g.kind=="scalar"&&(v.L=(o=g.L)!==null&&o!==void 0?o:Vi.BIGINT),v.delimited=(l=g.delimited)!==null&&l!==void 0?l:!1,v.req=(f=g.req)!==null&&f!==void 0?f:!1,v.opt=(u=g.opt)!==null&&u!==void 0?u:!1,g.packed===void 0&&(v.packed=g.kind=="enum"||g.kind=="scalar"&&g.T!=K.BYTES&&g.T!=K.STRING),g.oneof!==void 0){const S=typeof g.oneof=="string"?g.oneof:g.oneof.name;(!p||p.name!=S)&&(p=new yC(S)),v.oneof=p,p.addField(v)}m.push(v)}return m}const x=uC("proto3",r=>new dC(r,t=>bC(t)),r=>{for(const t of r.getType().fields.byMember()){if(t.opt)continue;const i=t.localName,a=r;if(t.repeated){a[i]=[];continue}switch(t.kind){case"oneof":a[i]={case:void 0};break;case"enum":a[i]=0;break;case"map":a[i]={};break;case"scalar":a[i]=ms(t.T,t.L);break}}});class Vt extends Yd{constructor(t){super(),this.seconds=Xe.zero,this.nanos=0,x.util.initPartial(t,this)}fromJson(t,i){if(typeof t!="string")throw new Error("cannot decode google.protobuf.Timestamp from JSON: ".concat(x.json.debug(t)));const a=t.match(/^([0-9]{4})-([0-9]{2})-([0-9]{2})T([0-9]{2}):([0-9]{2}):([0-9]{2})(?:Z|\.([0-9]{3,9})Z|([+-][0-9][0-9]:[0-9][0-9]))$/);if(!a)throw new Error("cannot decode google.protobuf.Timestamp from JSON: invalid RFC 3339 string");const o=Date.parse(a[1]+"-"+a[2]+"-"+a[3]+"T"+a[4]+":"+a[5]+":"+a[6]+(a[8]?a[8]:"Z"));if(Number.isNaN(o))throw new Error("cannot decode google.protobuf.Timestamp from JSON: invalid RFC 3339 string");if(o<Date.parse("0001-01-01T00:00:00Z")||o>Date.parse("9999-12-31T23:59:59Z"))throw new Error("cannot decode message google.protobuf.Timestamp from JSON: must be from 0001-01-01T00:00:00Z to 9999-12-31T23:59:59Z inclusive");return this.seconds=Xe.parse(o/1e3),this.nanos=0,a[7]&&(this.nanos=parseInt("1"+a[7]+"0".repeat(9-a[7].length))-1e9),this}toJson(t){const i=Number(this.seconds)*1e3;if(i<Date.parse("0001-01-01T00:00:00Z")||i>Date.parse("9999-12-31T23:59:59Z"))throw new Error("cannot encode google.protobuf.Timestamp to JSON: must be from 0001-01-01T00:00:00Z to 9999-12-31T23:59:59Z inclusive");if(this.nanos<0)throw new Error("cannot encode google.protobuf.Timestamp to JSON: nanos must not be negative");let a="Z";if(this.nanos>0){const o=(this.nanos+1e9).toString().substring(1);o.substring(3)==="000000"?a="."+o.substring(0,3)+"Z":o.substring(6)==="000"?a="."+o.substring(0,6)+"Z":a="."+o+"Z"}return new Date(i).toISOString().replace(".000Z",a)}toDate(){return new Date(Number(this.seconds)*1e3+Math.ceil(this.nanos/1e6))}static now(){return Vt.fromDate(new Date)}static fromDate(t){const i=t.getTime();return new Vt({seconds:Xe.parse(Math.floor(i/1e3)),nanos:i%1e3*1e6})}static fromBinary(t,i){return new Vt().fromBinary(t,i)}static fromJson(t,i){return new Vt().fromJson(t,i)}static fromJsonString(t,i){return new Vt().fromJsonString(t,i)}static equals(t,i){return x.util.equals(Vt,t,i)}}Vt.runtime=x;Vt.typeName="google.protobuf.Timestamp";Vt.fields=x.util.newFieldList(()=>[{no:1,name:"seconds",kind:"scalar",T:3},{no:2,name:"nanos",kind:"scalar",T:5}]);const SC=x.makeMessageType("livekit.MetricsBatch",()=>[{no:1,name:"timestamp_ms",kind:"scalar",T:3},{no:2,name:"normalized_timestamp",kind:"message",T:Vt},{no:3,name:"str_data",kind:"scalar",T:9,repeated:!0},{no:4,name:"time_series",kind:"message",T:TC,repeated:!0},{no:5,name:"events",kind:"message",T:kC,repeated:!0}]),TC=x.makeMessageType("livekit.TimeSeriesMetric",()=>[{no:1,name:"label",kind:"scalar",T:13},{no:2,name:"participant_identity",kind:"scalar",T:13},{no:3,name:"track_sid",kind:"scalar",T:13},{no:4,name:"samples",kind:"message",T:CC,repeated:!0},{no:5,name:"rid",kind:"scalar",T:13}]),CC=x.makeMessageType("livekit.MetricSample",()=>[{no:1,name:"timestamp_ms",kind:"scalar",T:3},{no:2,name:"normalized_timestamp",kind:"message",T:Vt},{no:3,name:"value",kind:"scalar",T:2}]),kC=x.makeMessageType("livekit.EventMetric",()=>[{no:1,name:"label",kind:"scalar",T:13},{no:2,name:"participant_identity",kind:"scalar",T:13},{no:3,name:"track_sid",kind:"scalar",T:13},{no:4,name:"start_timestamp_ms",kind:"scalar",T:3},{no:5,name:"end_timestamp_ms",kind:"scalar",T:3,opt:!0},{no:6,name:"normalized_start_timestamp",kind:"message",T:Vt},{no:7,name:"normalized_end_timestamp",kind:"message",T:Vt,opt:!0},{no:8,name:"metadata",kind:"scalar",T:9},{no:9,name:"rid",kind:"scalar",T:13}]),i0=x.makeEnum("livekit.BackupCodecPolicy",[{no:0,name:"PREFER_REGRESSION"},{no:1,name:"SIMULCAST"},{no:2,name:"REGRESSION"}]),Cn=x.makeEnum("livekit.TrackType",[{no:0,name:"AUDIO"},{no:1,name:"VIDEO"},{no:2,name:"DATA"}]),ft=x.makeEnum("livekit.TrackSource",[{no:0,name:"UNKNOWN"},{no:1,name:"CAMERA"},{no:2,name:"MICROPHONE"},{no:3,name:"SCREEN_SHARE"},{no:4,name:"SCREEN_SHARE_AUDIO"}]),Jd=x.makeEnum("livekit.VideoQuality",[{no:0,name:"LOW"},{no:1,name:"MEDIUM"},{no:2,name:"HIGH"},{no:3,name:"OFF"}]),yr=x.makeEnum("livekit.ConnectionQuality",[{no:0,name:"POOR"},{no:1,name:"GOOD"},{no:2,name:"EXCELLENT"},{no:3,name:"LOST"}]),Er=x.makeEnum("livekit.ClientConfigSetting",[{no:0,name:"UNSET"},{no:1,name:"DISABLED"},{no:2,name:"ENABLED"}]),_n=x.makeEnum("livekit.DisconnectReason",[{no:0,name:"UNKNOWN_REASON"},{no:1,name:"CLIENT_INITIATED"},{no:2,name:"DUPLICATE_IDENTITY"},{no:3,name:"SERVER_SHUTDOWN"},{no:4,name:"PARTICIPANT_REMOVED"},{no:5,name:"ROOM_DELETED"},{no:6,name:"STATE_MISMATCH"},{no:7,name:"JOIN_FAILURE"},{no:8,name:"MIGRATION"},{no:9,name:"SIGNAL_CLOSE"},{no:10,name:"ROOM_CLOSED"},{no:11,name:"USER_UNAVAILABLE"},{no:12,name:"USER_REJECTED"},{no:13,name:"SIP_TRUNK_FAILURE"},{no:14,name:"CONNECTION_TIMEOUT"},{no:15,name:"MEDIA_FAILURE"}]),da=x.makeEnum("livekit.ReconnectReason",[{no:0,name:"RR_UNKNOWN"},{no:1,name:"RR_SIGNAL_DISCONNECTED"},{no:2,name:"RR_PUBLISHER_FAILED"},{no:3,name:"RR_SUBSCRIBER_FAILED"},{no:4,name:"RR_SWITCH_CANDIDATE"}]),EC=x.makeEnum("livekit.SubscriptionError",[{no:0,name:"SE_UNKNOWN"},{no:1,name:"SE_CODEC_UNSUPPORTED"},{no:2,name:"SE_TRACK_NOTFOUND"}]),yt=x.makeEnum("livekit.AudioTrackFeature",[{no:0,name:"TF_STEREO"},{no:1,name:"TF_NO_DTX"},{no:2,name:"TF_AUTO_GAIN_CONTROL"},{no:3,name:"TF_ECHO_CANCELLATION"},{no:4,name:"TF_NOISE_SUPPRESSION"},{no:5,name:"TF_ENHANCED_NOISE_CANCELLATION"},{no:6,name:"TF_PRECONNECT_BUFFER"}]),Ec=x.makeMessageType("livekit.Room",()=>[{no:1,name:"sid",kind:"scalar",T:9},{no:2,name:"name",kind:"scalar",T:9},{no:3,name:"empty_timeout",kind:"scalar",T:13},{no:14,name:"departure_timeout",kind:"scalar",T:13},{no:4,name:"max_participants",kind:"scalar",T:13},{no:5,name:"creation_time",kind:"scalar",T:3},{no:15,name:"creation_time_ms",kind:"scalar",T:3},{no:6,name:"turn_password",kind:"scalar",T:9},{no:7,name:"enabled_codecs",kind:"message",T:mc,repeated:!0},{no:8,name:"metadata",kind:"scalar",T:9},{no:9,name:"num_participants",kind:"scalar",T:13},{no:11,name:"num_publishers",kind:"scalar",T:13},{no:10,name:"active_recording",kind:"scalar",T:8},{no:13,name:"version",kind:"message",T:g0}]),mc=x.makeMessageType("livekit.Codec",()=>[{no:1,name:"mime",kind:"scalar",T:9},{no:2,name:"fmtp_line",kind:"scalar",T:9}]),_C=x.makeMessageType("livekit.ParticipantPermission",()=>[{no:1,name:"can_subscribe",kind:"scalar",T:8},{no:2,name:"can_publish",kind:"scalar",T:8},{no:3,name:"can_publish_data",kind:"scalar",T:8},{no:9,name:"can_publish_sources",kind:"enum",T:x.getEnumType(ft),repeated:!0},{no:7,name:"hidden",kind:"scalar",T:8},{no:8,name:"recorder",kind:"scalar",T:8},{no:10,name:"can_update_metadata",kind:"scalar",T:8},{no:11,name:"agent",kind:"scalar",T:8},{no:12,name:"can_subscribe_metrics",kind:"scalar",T:8}]),ha=x.makeMessageType("livekit.ParticipantInfo",()=>[{no:1,name:"sid",kind:"scalar",T:9},{no:2,name:"identity",kind:"scalar",T:9},{no:3,name:"state",kind:"enum",T:x.getEnumType(rs)},{no:4,name:"tracks",kind:"message",T:is,repeated:!0},{no:5,name:"metadata",kind:"scalar",T:9},{no:6,name:"joined_at",kind:"scalar",T:3},{no:17,name:"joined_at_ms",kind:"scalar",T:3},{no:9,name:"name",kind:"scalar",T:9},{no:10,name:"version",kind:"scalar",T:13},{no:11,name:"permission",kind:"message",T:_C},{no:12,name:"region",kind:"scalar",T:9},{no:13,name:"is_publisher",kind:"scalar",T:8},{no:14,name:"kind",kind:"enum",T:x.getEnumType(_r)},{no:15,name:"attributes",kind:"map",K:9,V:{kind:"scalar",T:9}},{no:16,name:"disconnect_reason",kind:"enum",T:x.getEnumType(_n)},{no:18,name:"kind_details",kind:"enum",T:x.getEnumType(RC),repeated:!0}]),rs=x.makeEnum("livekit.ParticipantInfo.State",[{no:0,name:"JOINING"},{no:1,name:"JOINED"},{no:2,name:"ACTIVE"},{no:3,name:"DISCONNECTED"}]),_r=x.makeEnum("livekit.ParticipantInfo.Kind",[{no:0,name:"STANDARD"},{no:1,name:"INGRESS"},{no:2,name:"EGRESS"},{no:3,name:"SIP"},{no:4,name:"AGENT"},{no:7,name:"CONNECTOR"}]),RC=x.makeEnum("livekit.ParticipantInfo.KindDetail",[{no:0,name:"CLOUD_AGENT"},{no:1,name:"FORWARDED"}]),pt=x.makeEnum("livekit.Encryption.Type",[{no:0,name:"NONE"},{no:1,name:"GCM"},{no:2,name:"CUSTOM"}]),OC=x.makeMessageType("livekit.SimulcastCodecInfo",()=>[{no:1,name:"mime_type",kind:"scalar",T:9},{no:2,name:"mid",kind:"scalar",T:9},{no:3,name:"cid",kind:"scalar",T:9},{no:4,name:"layers",kind:"message",T:Bi,repeated:!0},{no:5,name:"video_layer_mode",kind:"enum",T:x.getEnumType(a0)},{no:6,name:"sdp_cid",kind:"scalar",T:9}]),is=x.makeMessageType("livekit.TrackInfo",()=>[{no:1,name:"sid",kind:"scalar",T:9},{no:2,name:"type",kind:"enum",T:x.getEnumType(Cn)},{no:3,name:"name",kind:"scalar",T:9},{no:4,name:"muted",kind:"scalar",T:8},{no:5,name:"width",kind:"scalar",T:13},{no:6,name:"height",kind:"scalar",T:13},{no:7,name:"simulcast",kind:"scalar",T:8},{no:8,name:"disable_dtx",kind:"scalar",T:8},{no:9,name:"source",kind:"enum",T:x.getEnumType(ft)},{no:10,name:"layers",kind:"message",T:Bi,repeated:!0},{no:11,name:"mime_type",kind:"scalar",T:9},{no:12,name:"mid",kind:"scalar",T:9},{no:13,name:"codecs",kind:"message",T:OC,repeated:!0},{no:14,name:"stereo",kind:"scalar",T:8},{no:15,name:"disable_red",kind:"scalar",T:8},{no:16,name:"encryption",kind:"enum",T:x.getEnumType(pt)},{no:17,name:"stream",kind:"scalar",T:9},{no:18,name:"version",kind:"message",T:g0},{no:19,name:"audio_features",kind:"enum",T:x.getEnumType(yt),repeated:!0},{no:20,name:"backup_codec_policy",kind:"enum",T:x.getEnumType(i0)}]),Bi=x.makeMessageType("livekit.VideoLayer",()=>[{no:1,name:"quality",kind:"enum",T:x.getEnumType(Jd)},{no:2,name:"width",kind:"scalar",T:13},{no:3,name:"height",kind:"scalar",T:13},{no:4,name:"bitrate",kind:"scalar",T:13},{no:5,name:"ssrc",kind:"scalar",T:13},{no:6,name:"spatial_layer",kind:"scalar",T:5},{no:7,name:"rid",kind:"scalar",T:9}]),a0=x.makeEnum("livekit.VideoLayer.Mode",[{no:0,name:"MODE_UNUSED"},{no:1,name:"ONE_SPATIAL_LAYER_PER_STREAM"},{no:2,name:"MULTIPLE_SPATIAL_LAYERS_PER_STREAM"},{no:3,name:"ONE_SPATIAL_LAYER_PER_STREAM_INCOMPLETE_RTCP_SR"}]),wt=x.makeMessageType("livekit.DataPacket",()=>[{no:1,name:"kind",kind:"enum",T:x.getEnumType(Te)},{no:4,name:"participant_identity",kind:"scalar",T:9},{no:5,name:"destination_identities",kind:"scalar",T:9,repeated:!0},{no:2,name:"user",kind:"message",T:Xd,oneof:"value"},{no:3,name:"speaker",kind:"message",T:AC,oneof:"value"},{no:6,name:"sip_dtmf",kind:"message",T:c0,oneof:"value"},{no:7,name:"transcription",kind:"message",T:DC,oneof:"value"},{no:8,name:"metrics",kind:"message",T:SC,oneof:"value"},{no:9,name:"chat_message",kind:"message",T:pc,oneof:"value"},{no:10,name:"rpc_request",kind:"message",T:Zd,oneof:"value"},{no:11,name:"rpc_ack",kind:"message",T:Wd,oneof:"value"},{no:12,name:"rpc_response",kind:"message",T:$d,oneof:"value"},{no:13,name:"stream_header",kind:"message",T:gc,oneof:"value"},{no:14,name:"stream_chunk",kind:"message",T:vc,oneof:"value"},{no:15,name:"stream_trailer",kind:"message",T:yc,oneof:"value"},{no:18,name:"encrypted_packet",kind:"message",T:s0,oneof:"value"},{no:16,name:"sequence",kind:"scalar",T:13},{no:17,name:"participant_sid",kind:"scalar",T:9}]),Te=x.makeEnum("livekit.DataPacket.Kind",[{no:0,name:"RELIABLE"},{no:1,name:"LOSSY"}]),s0=x.makeMessageType("livekit.EncryptedPacket",()=>[{no:1,name:"encryption_type",kind:"enum",T:x.getEnumType(pt)},{no:2,name:"iv",kind:"scalar",T:12},{no:3,name:"key_index",kind:"scalar",T:13},{no:4,name:"encrypted_value",kind:"scalar",T:12}]),r0=x.makeMessageType("livekit.EncryptedPacketPayload",()=>[{no:1,name:"user",kind:"message",T:Xd,oneof:"value"},{no:3,name:"chat_message",kind:"message",T:pc,oneof:"value"},{no:4,name:"rpc_request",kind:"message",T:Zd,oneof:"value"},{no:5,name:"rpc_ack",kind:"message",T:Wd,oneof:"value"},{no:6,name:"rpc_response",kind:"message",T:$d,oneof:"value"},{no:7,name:"stream_header",kind:"message",T:gc,oneof:"value"},{no:8,name:"stream_chunk",kind:"message",T:vc,oneof:"value"},{no:9,name:"stream_trailer",kind:"message",T:yc,oneof:"value"}]),AC=x.makeMessageType("livekit.ActiveSpeakerUpdate",()=>[{no:1,name:"speakers",kind:"message",T:o0,repeated:!0}]),o0=x.makeMessageType("livekit.SpeakerInfo",()=>[{no:1,name:"sid",kind:"scalar",T:9},{no:2,name:"level",kind:"scalar",T:2},{no:3,name:"active",kind:"scalar",T:8}]),Xd=x.makeMessageType("livekit.UserPacket",()=>[{no:1,name:"participant_sid",kind:"scalar",T:9},{no:5,name:"participant_identity",kind:"scalar",T:9},{no:2,name:"payload",kind:"scalar",T:12},{no:3,name:"destination_sids",kind:"scalar",T:9,repeated:!0},{no:6,name:"destination_identities",kind:"scalar",T:9,repeated:!0},{no:4,name:"topic",kind:"scalar",T:9,opt:!0},{no:8,name:"id",kind:"scalar",T:9,opt:!0},{no:9,name:"start_time",kind:"scalar",T:4,opt:!0},{no:10,name:"end_time",kind:"scalar",T:4,opt:!0},{no:11,name:"nonce",kind:"scalar",T:12}]),c0=x.makeMessageType("livekit.SipDTMF",()=>[{no:3,name:"code",kind:"scalar",T:13},{no:4,name:"digit",kind:"scalar",T:9}]),DC=x.makeMessageType("livekit.Transcription",()=>[{no:2,name:"transcribed_participant_identity",kind:"scalar",T:9},{no:3,name:"track_id",kind:"scalar",T:9},{no:4,name:"segments",kind:"message",T:MC,repeated:!0}]),MC=x.makeMessageType("livekit.TranscriptionSegment",()=>[{no:1,name:"id",kind:"scalar",T:9},{no:2,name:"text",kind:"scalar",T:9},{no:3,name:"start_time",kind:"scalar",T:4},{no:4,name:"end_time",kind:"scalar",T:4},{no:5,name:"final",kind:"scalar",T:8},{no:6,name:"language",kind:"scalar",T:9}]),pc=x.makeMessageType("livekit.ChatMessage",()=>[{no:1,name:"id",kind:"scalar",T:9},{no:2,name:"timestamp",kind:"scalar",T:3},{no:3,name:"edit_timestamp",kind:"scalar",T:3,opt:!0},{no:4,name:"message",kind:"scalar",T:9},{no:5,name:"deleted",kind:"scalar",T:8},{no:6,name:"generated",kind:"scalar",T:8}]),Zd=x.makeMessageType("livekit.RpcRequest",()=>[{no:1,name:"id",kind:"scalar",T:9},{no:2,name:"method",kind:"scalar",T:9},{no:3,name:"payload",kind:"scalar",T:9},{no:4,name:"response_timeout_ms",kind:"scalar",T:13},{no:5,name:"version",kind:"scalar",T:13}]),Wd=x.makeMessageType("livekit.RpcAck",()=>[{no:1,name:"request_id",kind:"scalar",T:9}]),$d=x.makeMessageType("livekit.RpcResponse",()=>[{no:1,name:"request_id",kind:"scalar",T:9},{no:2,name:"payload",kind:"scalar",T:9,oneof:"value"},{no:3,name:"error",kind:"message",T:l0,oneof:"value"}]),l0=x.makeMessageType("livekit.RpcError",()=>[{no:1,name:"code",kind:"scalar",T:13},{no:2,name:"message",kind:"scalar",T:9},{no:3,name:"data",kind:"scalar",T:9}]),u0=x.makeMessageType("livekit.ParticipantTracks",()=>[{no:1,name:"participant_sid",kind:"scalar",T:9},{no:2,name:"track_sids",kind:"scalar",T:9,repeated:!0}]),d0=x.makeMessageType("livekit.ServerInfo",()=>[{no:1,name:"edition",kind:"enum",T:x.getEnumType(f0)},{no:2,name:"version",kind:"scalar",T:9},{no:3,name:"protocol",kind:"scalar",T:5},{no:4,name:"region",kind:"scalar",T:9},{no:5,name:"node_id",kind:"scalar",T:9},{no:6,name:"debug_info",kind:"scalar",T:9},{no:7,name:"agent_protocol",kind:"scalar",T:5}]),f0=x.makeEnum("livekit.ServerInfo.Edition",[{no:0,name:"Standard"},{no:1,name:"Cloud"}]),h0=x.makeMessageType("livekit.ClientInfo",()=>[{no:1,name:"sdk",kind:"enum",T:x.getEnumType(m0)},{no:2,name:"version",kind:"scalar",T:9},{no:3,name:"protocol",kind:"scalar",T:5},{no:4,name:"os",kind:"scalar",T:9},{no:5,name:"os_version",kind:"scalar",T:9},{no:6,name:"device_model",kind:"scalar",T:9},{no:7,name:"browser",kind:"scalar",T:9},{no:8,name:"browser_version",kind:"scalar",T:9},{no:9,name:"address",kind:"scalar",T:9},{no:10,name:"network",kind:"scalar",T:9},{no:11,name:"other_sdks",kind:"scalar",T:9}]),m0=x.makeEnum("livekit.ClientInfo.SDK",[{no:0,name:"UNKNOWN"},{no:1,name:"JS"},{no:2,name:"SWIFT"},{no:3,name:"ANDROID"},{no:4,name:"FLUTTER"},{no:5,name:"GO"},{no:6,name:"UNITY"},{no:7,name:"REACT_NATIVE"},{no:8,name:"RUST"},{no:9,name:"PYTHON"},{no:10,name:"CPP"},{no:11,name:"UNITY_WEB"},{no:12,name:"NODE"},{no:13,name:"UNREAL"},{no:14,name:"ESP32"}]),p0=x.makeMessageType("livekit.ClientConfiguration",()=>[{no:1,name:"video",kind:"message",T:Yg},{no:2,name:"screen",kind:"message",T:Yg},{no:3,name:"resume_connection",kind:"enum",T:x.getEnumType(Er)},{no:4,name:"disabled_codecs",kind:"message",T:wC},{no:5,name:"force_relay",kind:"enum",T:x.getEnumType(Er)}]),Yg=x.makeMessageType("livekit.VideoConfiguration",()=>[{no:1,name:"hardware_encoder",kind:"enum",T:x.getEnumType(Er)}]),wC=x.makeMessageType("livekit.DisabledCodecs",()=>[{no:1,name:"codecs",kind:"message",T:mc,repeated:!0},{no:2,name:"publish",kind:"message",T:mc,repeated:!0}]),g0=x.makeMessageType("livekit.TimedVersion",()=>[{no:1,name:"unix_micro",kind:"scalar",T:3},{no:2,name:"ticks",kind:"scalar",T:5}]),Cd=x.makeEnum("livekit.DataStream.OperationType",[{no:0,name:"CREATE"},{no:1,name:"UPDATE"},{no:2,name:"DELETE"},{no:3,name:"REACTION"}]),v0=x.makeMessageType("livekit.DataStream.TextHeader",()=>[{no:1,name:"operation_type",kind:"enum",T:x.getEnumType(Cd)},{no:2,name:"version",kind:"scalar",T:5},{no:3,name:"reply_to_stream_id",kind:"scalar",T:9},{no:4,name:"attached_stream_ids",kind:"scalar",T:9,repeated:!0},{no:5,name:"generated",kind:"scalar",T:8}],{localName:"DataStream_TextHeader"}),y0=x.makeMessageType("livekit.DataStream.ByteHeader",()=>[{no:1,name:"name",kind:"scalar",T:9}],{localName:"DataStream_ByteHeader"}),gc=x.makeMessageType("livekit.DataStream.Header",()=>[{no:1,name:"stream_id",kind:"scalar",T:9},{no:2,name:"timestamp",kind:"scalar",T:3},{no:3,name:"topic",kind:"scalar",T:9},{no:4,name:"mime_type",kind:"scalar",T:9},{no:5,name:"total_length",kind:"scalar",T:4,opt:!0},{no:7,name:"encryption_type",kind:"enum",T:x.getEnumType(pt)},{no:8,name:"attributes",kind:"map",K:9,V:{kind:"scalar",T:9}},{no:9,name:"text_header",kind:"message",T:v0,oneof:"content_header"},{no:10,name:"byte_header",kind:"message",T:y0,oneof:"content_header"}],{localName:"DataStream_Header"}),vc=x.makeMessageType("livekit.DataStream.Chunk",()=>[{no:1,name:"stream_id",kind:"scalar",T:9},{no:2,name:"chunk_index",kind:"scalar",T:4},{no:3,name:"content",kind:"scalar",T:12},{no:4,name:"version",kind:"scalar",T:5},{no:5,name:"iv",kind:"scalar",T:12,opt:!0}],{localName:"DataStream_Chunk"}),yc=x.makeMessageType("livekit.DataStream.Trailer",()=>[{no:1,name:"stream_id",kind:"scalar",T:9},{no:2,name:"reason",kind:"scalar",T:9},{no:3,name:"attributes",kind:"map",K:9,V:{kind:"scalar",T:9}}],{localName:"DataStream_Trailer"}),xC=x.makeMessageType("livekit.SubscribedAudioCodec",()=>[{no:1,name:"codec",kind:"scalar",T:9},{no:2,name:"enabled",kind:"scalar",T:8}]),kn=x.makeEnum("livekit.SignalTarget",[{no:0,name:"PUBLISHER"},{no:1,name:"SUBSCRIBER"}]),kd=x.makeEnum("livekit.StreamState",[{no:0,name:"ACTIVE"},{no:1,name:"PAUSED"}]),NC=x.makeEnum("livekit.CandidateProtocol",[{no:0,name:"UDP"},{no:1,name:"TCP"},{no:2,name:"TLS"}]),PC=x.makeMessageType("livekit.SignalRequest",()=>[{no:1,name:"offer",kind:"message",T:Hi,oneof:"message"},{no:2,name:"answer",kind:"message",T:Hi,oneof:"message"},{no:3,name:"trickle",kind:"message",T:_c,oneof:"message"},{no:4,name:"add_track",kind:"message",T:Rr,oneof:"message"},{no:5,name:"mute",kind:"message",T:Rc,oneof:"message"},{no:6,name:"subscription",kind:"message",T:Oc,oneof:"message"},{no:7,name:"track_setting",kind:"message",T:b0,oneof:"message"},{no:8,name:"leave",kind:"message",T:Ac,oneof:"message"},{no:10,name:"update_layers",kind:"message",T:T0,oneof:"message"},{no:11,name:"subscription_permission",kind:"message",T:E0,oneof:"message"},{no:12,name:"sync_state",kind:"message",T:sf,oneof:"message"},{no:13,name:"simulate",kind:"message",T:wn,oneof:"message"},{no:14,name:"ping",kind:"scalar",T:3,oneof:"message"},{no:15,name:"update_metadata",kind:"message",T:nf,oneof:"message"},{no:16,name:"ping_req",kind:"message",T:O0,oneof:"message"},{no:17,name:"update_audio_track",kind:"message",T:tf,oneof:"message"},{no:18,name:"update_video_track",kind:"message",T:S0,oneof:"message"}]),Qg=x.makeMessageType("livekit.SignalResponse",()=>[{no:1,name:"join",kind:"message",T:UC,oneof:"message"},{no:2,name:"answer",kind:"message",T:Hi,oneof:"message"},{no:3,name:"offer",kind:"message",T:Hi,oneof:"message"},{no:4,name:"trickle",kind:"message",T:_c,oneof:"message"},{no:5,name:"update",kind:"message",T:jC,oneof:"message"},{no:6,name:"track_published",kind:"message",T:ef,oneof:"message"},{no:8,name:"leave",kind:"message",T:Ac,oneof:"message"},{no:9,name:"mute",kind:"message",T:Rc,oneof:"message"},{no:10,name:"speakers_changed",kind:"message",T:BC,oneof:"message"},{no:11,name:"room_update",kind:"message",T:zC,oneof:"message"},{no:12,name:"connection_quality",kind:"message",T:VC,oneof:"message"},{no:13,name:"stream_state_update",kind:"message",T:FC,oneof:"message"},{no:14,name:"subscribed_quality_update",kind:"message",T:KC,oneof:"message"},{no:15,name:"subscription_permission_update",kind:"message",T:QC,oneof:"message"},{no:16,name:"refresh_token",kind:"scalar",T:9,oneof:"message"},{no:17,name:"track_unpublished",kind:"message",T:IC,oneof:"message"},{no:18,name:"pong",kind:"scalar",T:3,oneof:"message"},{no:19,name:"reconnect",kind:"message",T:LC,oneof:"message"},{no:20,name:"pong_resp",kind:"message",T:XC,oneof:"message"},{no:21,name:"subscription_response",kind:"message",T:$C,oneof:"message"},{no:22,name:"request_response",kind:"message",T:ek,oneof:"message"},{no:23,name:"track_subscribed",kind:"message",T:tk,oneof:"message"},{no:24,name:"room_moved",kind:"message",T:JC,oneof:"message"},{no:25,name:"media_sections_requirement",kind:"message",T:sk,oneof:"message"},{no:26,name:"subscribed_audio_codec_update",kind:"message",T:YC,oneof:"message"}]),Ed=x.makeMessageType("livekit.SimulcastCodec",()=>[{no:1,name:"codec",kind:"scalar",T:9},{no:2,name:"cid",kind:"scalar",T:9},{no:4,name:"layers",kind:"message",T:Bi,repeated:!0},{no:5,name:"video_layer_mode",kind:"enum",T:x.getEnumType(a0)}]),Rr=x.makeMessageType("livekit.AddTrackRequest",()=>[{no:1,name:"cid",kind:"scalar",T:9},{no:2,name:"name",kind:"scalar",T:9},{no:3,name:"type",kind:"enum",T:x.getEnumType(Cn)},{no:4,name:"width",kind:"scalar",T:13},{no:5,name:"height",kind:"scalar",T:13},{no:6,name:"muted",kind:"scalar",T:8},{no:7,name:"disable_dtx",kind:"scalar",T:8},{no:8,name:"source",kind:"enum",T:x.getEnumType(ft)},{no:9,name:"layers",kind:"message",T:Bi,repeated:!0},{no:10,name:"simulcast_codecs",kind:"message",T:Ed,repeated:!0},{no:11,name:"sid",kind:"scalar",T:9},{no:12,name:"stereo",kind:"scalar",T:8},{no:13,name:"disable_red",kind:"scalar",T:8},{no:14,name:"encryption",kind:"enum",T:x.getEnumType(pt)},{no:15,name:"stream",kind:"scalar",T:9},{no:16,name:"backup_codec_policy",kind:"enum",T:x.getEnumType(i0)},{no:17,name:"audio_features",kind:"enum",T:x.getEnumType(yt),repeated:!0}]),_c=x.makeMessageType("livekit.TrickleRequest",()=>[{no:1,name:"candidateInit",kind:"scalar",T:9},{no:2,name:"target",kind:"enum",T:x.getEnumType(kn)},{no:3,name:"final",kind:"scalar",T:8}]),Rc=x.makeMessageType("livekit.MuteTrackRequest",()=>[{no:1,name:"sid",kind:"scalar",T:9},{no:2,name:"muted",kind:"scalar",T:8}]),UC=x.makeMessageType("livekit.JoinResponse",()=>[{no:1,name:"room",kind:"message",T:Ec},{no:2,name:"participant",kind:"message",T:ha},{no:3,name:"other_participants",kind:"message",T:ha,repeated:!0},{no:4,name:"server_version",kind:"scalar",T:9},{no:5,name:"ice_servers",kind:"message",T:C0,repeated:!0},{no:6,name:"subscriber_primary",kind:"scalar",T:8},{no:7,name:"alternative_url",kind:"scalar",T:9},{no:8,name:"client_configuration",kind:"message",T:p0},{no:9,name:"server_region",kind:"scalar",T:9},{no:10,name:"ping_timeout",kind:"scalar",T:5},{no:11,name:"ping_interval",kind:"scalar",T:5},{no:12,name:"server_info",kind:"message",T:d0},{no:13,name:"sif_trailer",kind:"scalar",T:12},{no:14,name:"enabled_publish_codecs",kind:"message",T:mc,repeated:!0},{no:15,name:"fast_publish",kind:"scalar",T:8}]),LC=x.makeMessageType("livekit.ReconnectResponse",()=>[{no:1,name:"ice_servers",kind:"message",T:C0,repeated:!0},{no:2,name:"client_configuration",kind:"message",T:p0},{no:3,name:"server_info",kind:"message",T:d0},{no:4,name:"last_message_seq",kind:"scalar",T:13}]),ef=x.makeMessageType("livekit.TrackPublishedResponse",()=>[{no:1,name:"cid",kind:"scalar",T:9},{no:2,name:"track",kind:"message",T:is}]),IC=x.makeMessageType("livekit.TrackUnpublishedResponse",()=>[{no:1,name:"track_sid",kind:"scalar",T:9}]),Hi=x.makeMessageType("livekit.SessionDescription",()=>[{no:1,name:"type",kind:"scalar",T:9},{no:2,name:"sdp",kind:"scalar",T:9},{no:3,name:"id",kind:"scalar",T:13},{no:4,name:"mid_to_track_id",kind:"map",K:9,V:{kind:"scalar",T:9}}]),jC=x.makeMessageType("livekit.ParticipantUpdate",()=>[{no:1,name:"participants",kind:"message",T:ha,repeated:!0}]),Oc=x.makeMessageType("livekit.UpdateSubscription",()=>[{no:1,name:"track_sids",kind:"scalar",T:9,repeated:!0},{no:2,name:"subscribe",kind:"scalar",T:8},{no:3,name:"participant_tracks",kind:"message",T:u0,repeated:!0}]),b0=x.makeMessageType("livekit.UpdateTrackSettings",()=>[{no:1,name:"track_sids",kind:"scalar",T:9,repeated:!0},{no:3,name:"disabled",kind:"scalar",T:8},{no:4,name:"quality",kind:"enum",T:x.getEnumType(Jd)},{no:5,name:"width",kind:"scalar",T:13},{no:6,name:"height",kind:"scalar",T:13},{no:7,name:"fps",kind:"scalar",T:13},{no:8,name:"priority",kind:"scalar",T:13}]),tf=x.makeMessageType("livekit.UpdateLocalAudioTrack",()=>[{no:1,name:"track_sid",kind:"scalar",T:9},{no:2,name:"features",kind:"enum",T:x.getEnumType(yt),repeated:!0}]),S0=x.makeMessageType("livekit.UpdateLocalVideoTrack",()=>[{no:1,name:"track_sid",kind:"scalar",T:9},{no:2,name:"width",kind:"scalar",T:13},{no:3,name:"height",kind:"scalar",T:13}]),Ac=x.makeMessageType("livekit.LeaveRequest",()=>[{no:1,name:"can_reconnect",kind:"scalar",T:8},{no:2,name:"reason",kind:"enum",T:x.getEnumType(_n)},{no:3,name:"action",kind:"enum",T:x.getEnumType(os)},{no:4,name:"regions",kind:"message",T:ZC}]),os=x.makeEnum("livekit.LeaveRequest.Action",[{no:0,name:"DISCONNECT"},{no:1,name:"RESUME"},{no:2,name:"RECONNECT"}]),T0=x.makeMessageType("livekit.UpdateVideoLayers",()=>[{no:1,name:"track_sid",kind:"scalar",T:9},{no:2,name:"layers",kind:"message",T:Bi,repeated:!0}]),nf=x.makeMessageType("livekit.UpdateParticipantMetadata",()=>[{no:1,name:"metadata",kind:"scalar",T:9},{no:2,name:"name",kind:"scalar",T:9},{no:3,name:"attributes",kind:"map",K:9,V:{kind:"scalar",T:9}},{no:4,name:"request_id",kind:"scalar",T:13}]),C0=x.makeMessageType("livekit.ICEServer",()=>[{no:1,name:"urls",kind:"scalar",T:9,repeated:!0},{no:2,name:"username",kind:"scalar",T:9},{no:3,name:"credential",kind:"scalar",T:9}]),BC=x.makeMessageType("livekit.SpeakersChanged",()=>[{no:1,name:"speakers",kind:"message",T:o0,repeated:!0}]),zC=x.makeMessageType("livekit.RoomUpdate",()=>[{no:1,name:"room",kind:"message",T:Ec}]),qC=x.makeMessageType("livekit.ConnectionQualityInfo",()=>[{no:1,name:"participant_sid",kind:"scalar",T:9},{no:2,name:"quality",kind:"enum",T:x.getEnumType(yr)},{no:3,name:"score",kind:"scalar",T:2}]),VC=x.makeMessageType("livekit.ConnectionQualityUpdate",()=>[{no:1,name:"updates",kind:"message",T:qC,repeated:!0}]),HC=x.makeMessageType("livekit.StreamStateInfo",()=>[{no:1,name:"participant_sid",kind:"scalar",T:9},{no:2,name:"track_sid",kind:"scalar",T:9},{no:3,name:"state",kind:"enum",T:x.getEnumType(kd)}]),FC=x.makeMessageType("livekit.StreamStateUpdate",()=>[{no:1,name:"stream_states",kind:"message",T:HC,repeated:!0}]),af=x.makeMessageType("livekit.SubscribedQuality",()=>[{no:1,name:"quality",kind:"enum",T:x.getEnumType(Jd)},{no:2,name:"enabled",kind:"scalar",T:8}]),GC=x.makeMessageType("livekit.SubscribedCodec",()=>[{no:1,name:"codec",kind:"scalar",T:9},{no:2,name:"qualities",kind:"message",T:af,repeated:!0}]),KC=x.makeMessageType("livekit.SubscribedQualityUpdate",()=>[{no:1,name:"track_sid",kind:"scalar",T:9},{no:2,name:"subscribed_qualities",kind:"message",T:af,repeated:!0},{no:3,name:"subscribed_codecs",kind:"message",T:GC,repeated:!0}]),YC=x.makeMessageType("livekit.SubscribedAudioCodecUpdate",()=>[{no:1,name:"track_sid",kind:"scalar",T:9},{no:2,name:"subscribed_audio_codecs",kind:"message",T:xC,repeated:!0}]),k0=x.makeMessageType("livekit.TrackPermission",()=>[{no:1,name:"participant_sid",kind:"scalar",T:9},{no:2,name:"all_tracks",kind:"scalar",T:8},{no:3,name:"track_sids",kind:"scalar",T:9,repeated:!0},{no:4,name:"participant_identity",kind:"scalar",T:9}]),E0=x.makeMessageType("livekit.SubscriptionPermission",()=>[{no:1,name:"all_participants",kind:"scalar",T:8},{no:2,name:"track_permissions",kind:"message",T:k0,repeated:!0}]),QC=x.makeMessageType("livekit.SubscriptionPermissionUpdate",()=>[{no:1,name:"participant_sid",kind:"scalar",T:9},{no:2,name:"track_sid",kind:"scalar",T:9},{no:3,name:"allowed",kind:"scalar",T:8}]),JC=x.makeMessageType("livekit.RoomMovedResponse",()=>[{no:1,name:"room",kind:"message",T:Ec},{no:2,name:"token",kind:"scalar",T:9},{no:3,name:"participant",kind:"message",T:ha},{no:4,name:"other_participants",kind:"message",T:ha,repeated:!0}]),sf=x.makeMessageType("livekit.SyncState",()=>[{no:1,name:"answer",kind:"message",T:Hi},{no:2,name:"subscription",kind:"message",T:Oc},{no:3,name:"publish_tracks",kind:"message",T:ef,repeated:!0},{no:4,name:"data_channels",kind:"message",T:R0,repeated:!0},{no:5,name:"offer",kind:"message",T:Hi},{no:6,name:"track_sids_disabled",kind:"scalar",T:9,repeated:!0},{no:7,name:"datachannel_receive_states",kind:"message",T:_0,repeated:!0}]),_0=x.makeMessageType("livekit.DataChannelReceiveState",()=>[{no:1,name:"publisher_sid",kind:"scalar",T:9},{no:2,name:"last_seq",kind:"scalar",T:13}]),R0=x.makeMessageType("livekit.DataChannelInfo",()=>[{no:1,name:"label",kind:"scalar",T:9},{no:2,name:"id",kind:"scalar",T:13},{no:3,name:"target",kind:"enum",T:x.getEnumType(kn)}]),wn=x.makeMessageType("livekit.SimulateScenario",()=>[{no:1,name:"speaker_update",kind:"scalar",T:5,oneof:"scenario"},{no:2,name:"node_failure",kind:"scalar",T:8,oneof:"scenario"},{no:3,name:"migration",kind:"scalar",T:8,oneof:"scenario"},{no:4,name:"server_leave",kind:"scalar",T:8,oneof:"scenario"},{no:5,name:"switch_candidate_protocol",kind:"enum",T:x.getEnumType(NC),oneof:"scenario"},{no:6,name:"subscriber_bandwidth",kind:"scalar",T:3,oneof:"scenario"},{no:7,name:"disconnect_signal_on_resume",kind:"scalar",T:8,oneof:"scenario"},{no:8,name:"disconnect_signal_on_resume_no_messages",kind:"scalar",T:8,oneof:"scenario"},{no:9,name:"leave_request_full_reconnect",kind:"scalar",T:8,oneof:"scenario"}]),O0=x.makeMessageType("livekit.Ping",()=>[{no:1,name:"timestamp",kind:"scalar",T:3},{no:2,name:"rtt",kind:"scalar",T:3}]),XC=x.makeMessageType("livekit.Pong",()=>[{no:1,name:"last_ping_timestamp",kind:"scalar",T:3},{no:2,name:"timestamp",kind:"scalar",T:3}]),ZC=x.makeMessageType("livekit.RegionSettings",()=>[{no:1,name:"regions",kind:"message",T:WC,repeated:!0}]),WC=x.makeMessageType("livekit.RegionInfo",()=>[{no:1,name:"region",kind:"scalar",T:9},{no:2,name:"url",kind:"scalar",T:9},{no:3,name:"distance",kind:"scalar",T:3}]),$C=x.makeMessageType("livekit.SubscriptionResponse",()=>[{no:1,name:"track_sid",kind:"scalar",T:9},{no:2,name:"err",kind:"enum",T:x.getEnumType(EC)}]),ek=x.makeMessageType("livekit.RequestResponse",()=>[{no:1,name:"request_id",kind:"scalar",T:13},{no:2,name:"reason",kind:"enum",T:x.getEnumType(rf)},{no:3,name:"message",kind:"scalar",T:9},{no:4,name:"trickle",kind:"message",T:_c,oneof:"request"},{no:5,name:"add_track",kind:"message",T:Rr,oneof:"request"},{no:6,name:"mute",kind:"message",T:Rc,oneof:"request"},{no:7,name:"update_metadata",kind:"message",T:nf,oneof:"request"},{no:8,name:"update_audio_track",kind:"message",T:tf,oneof:"request"},{no:9,name:"update_video_track",kind:"message",T:S0,oneof:"request"}]),rf=x.makeEnum("livekit.RequestResponse.Reason",[{no:0,name:"OK"},{no:1,name:"NOT_FOUND"},{no:2,name:"NOT_ALLOWED"},{no:3,name:"LIMIT_EXCEEDED"},{no:4,name:"QUEUED"},{no:5,name:"UNSUPPORTED_TYPE"},{no:6,name:"UNCLASSIFIED_ERROR"}]),tk=x.makeMessageType("livekit.TrackSubscribed",()=>[{no:1,name:"track_sid",kind:"scalar",T:9}]),A0=x.makeMessageType("livekit.ConnectionSettings",()=>[{no:1,name:"auto_subscribe",kind:"scalar",T:8},{no:2,name:"adaptive_stream",kind:"scalar",T:8},{no:3,name:"subscriber_allow_pause",kind:"scalar",T:8,opt:!0},{no:4,name:"disable_ice_lite",kind:"scalar",T:8}]),nk=x.makeMessageType("livekit.JoinRequest",()=>[{no:1,name:"client_info",kind:"message",T:h0},{no:2,name:"connection_settings",kind:"message",T:A0},{no:3,name:"metadata",kind:"scalar",T:9},{no:4,name:"participant_attributes",kind:"map",K:9,V:{kind:"scalar",T:9}},{no:5,name:"add_track_requests",kind:"message",T:Rr,repeated:!0},{no:6,name:"publisher_offer",kind:"message",T:Hi},{no:7,name:"reconnect",kind:"scalar",T:8},{no:8,name:"reconnect_reason",kind:"enum",T:x.getEnumType(da)},{no:9,name:"participant_sid",kind:"scalar",T:9},{no:10,name:"sync_state",kind:"message",T:sf}]),ik=x.makeMessageType("livekit.WrappedJoinRequest",()=>[{no:1,name:"compression",kind:"enum",T:x.getEnumType(ak)},{no:2,name:"join_request",kind:"scalar",T:12}]),ak=x.makeEnum("livekit.WrappedJoinRequest.Compression",[{no:0,name:"NONE"},{no:1,name:"GZIP"}]),sk=x.makeMessageType("livekit.MediaSectionsRequirement",()=>[{no:1,name:"num_audios",kind:"scalar",T:13},{no:2,name:"num_videos",kind:"scalar",T:13}]);function rk(r){return r&&r.__esModule&&Object.prototype.hasOwnProperty.call(r,"default")?r.default:r}var ac={exports:{}},ok=ac.exports,Jg;function ck(){return Jg||(Jg=1,(function(r){(function(t,i){r.exports?r.exports=i():t.log=i()})(ok,function(){var t=function(){},i="undefined",a=typeof window!==i&&typeof window.navigator!==i&&/Trident\/|MSIE /.test(window.navigator.userAgent),o=["trace","debug","info","warn","error"],l={},f=null;function u(E,j){var U=E[j];if(typeof U.bind=="function")return U.bind(E);try{return Function.prototype.bind.call(U,E)}catch{return function(){return Function.prototype.apply.apply(U,[E,arguments])}}}function m(){console.log&&(console.log.apply?console.log.apply(console,arguments):Function.prototype.apply.apply(console.log,[console,arguments])),console.trace&&console.trace()}function p(E){return E==="debug"&&(E="log"),typeof console===i?!1:E==="trace"&&a?m:console[E]!==void 0?u(console,E):console.log!==void 0?u(console,"log"):t}function g(){for(var E=this.getLevel(),j=0;j<o.length;j++){var U=o[j];this[U]=j<E?t:this.methodFactory(U,E,this.name)}if(this.log=this.debug,typeof console===i&&E<this.levels.SILENT)return"No console available for logging"}function v(E){return function(){typeof console!==i&&(g.call(this),this[E].apply(this,arguments))}}function S(E,j,U){return p(E)||v.apply(this,arguments)}function k(E,j){var U=this,Y,Z,M,N="loglevel";typeof E=="string"?N+=":"+E:typeof E=="symbol"&&(N=void 0);function q(se){var ue=(o[se]||"silent").toUpperCase();if(!(typeof window===i||!N)){try{window.localStorage[N]=ue;return}catch{}try{window.document.cookie=encodeURIComponent(N)+"="+ue+";"}catch{}}}function Q(){var se;if(!(typeof window===i||!N)){try{se=window.localStorage[N]}catch{}if(typeof se===i)try{var ue=window.document.cookie,Ne=encodeURIComponent(N),Ze=ue.indexOf(Ne+"=");Ze!==-1&&(se=/^([^;]+)/.exec(ue.slice(Ze+Ne.length+1))[1])}catch{}return U.levels[se]===void 0&&(se=void 0),se}}function ae(){if(!(typeof window===i||!N)){try{window.localStorage.removeItem(N)}catch{}try{window.document.cookie=encodeURIComponent(N)+"=; expires=Thu, 01 Jan 1970 00:00:00 UTC"}catch{}}}function ne(se){var ue=se;if(typeof ue=="string"&&U.levels[ue.toUpperCase()]!==void 0&&(ue=U.levels[ue.toUpperCase()]),typeof ue=="number"&&ue>=0&&ue<=U.levels.SILENT)return ue;throw new TypeError("log.setLevel() called with invalid level: "+se)}U.name=E,U.levels={TRACE:0,DEBUG:1,INFO:2,WARN:3,ERROR:4,SILENT:5},U.methodFactory=j||S,U.getLevel=function(){return M??Z??Y},U.setLevel=function(se,ue){return M=ne(se),ue!==!1&&q(M),g.call(U)},U.setDefaultLevel=function(se){Z=ne(se),Q()||U.setLevel(se,!1)},U.resetLevel=function(){M=null,ae(),g.call(U)},U.enableAll=function(se){U.setLevel(U.levels.TRACE,se)},U.disableAll=function(se){U.setLevel(U.levels.SILENT,se)},U.rebuild=function(){if(f!==U&&(Y=ne(f.getLevel())),g.call(U),f===U)for(var se in l)l[se].rebuild()},Y=ne(f?f.getLevel():"WARN");var ie=Q();ie!=null&&(M=ne(ie)),g.call(U)}f=new k,f.getLogger=function(j){if(typeof j!="symbol"&&typeof j!="string"||j==="")throw new TypeError("You must supply a name when creating a logger.");var U=l[j];return U||(U=l[j]=new k(j,f.methodFactory)),U};var O=typeof window!==i?window.log:void 0;return f.noConflict=function(){return typeof window!==i&&window.log===f&&(window.log=O),f},f.getLoggers=function(){return l},f.default=f,f})})(ac)),ac.exports}var Dc=ck(),_d;(function(r){r[r.trace=0]="trace",r[r.debug=1]="debug",r[r.info=2]="info",r[r.warn=3]="warn",r[r.error=4]="error",r[r.silent=5]="silent"})(_d||(_d={}));var Rn;(function(r){r.Default="livekit",r.Room="livekit-room",r.TokenSource="livekit-token-source",r.Participant="livekit-participant",r.Track="livekit-track",r.Publication="livekit-track-publication",r.Engine="livekit-engine",r.Signal="livekit-signal",r.PCManager="livekit-pc-manager",r.PCTransport="livekit-pc-transport",r.E2EE="lk-e2ee"})(Rn||(Rn={}));let Se=Dc.getLogger("livekit");Object.values(Rn).map(r=>Dc.getLogger(r));Se.setDefaultLevel(_d.info);function ci(r){const t=Dc.getLogger(r);return t.setDefaultLevel(Se.getLevel()),t}const lk=Dc.getLogger("lk-e2ee"),hr=7e3,uk=[0,300,4*300,9*300,16*300,hr,hr,hr,hr,hr];class dk{constructor(t){this._retryDelays=t!==void 0?[...t]:uk}nextRetryDelayInMs(t){if(t.retryCount>=this._retryDelays.length)return null;const i=this._retryDelays[t.retryCount];return t.retryCount<=1?i:i+Math.random()*1e3}}function fk(r,t){var i={};for(var a in r)Object.prototype.hasOwnProperty.call(r,a)&&t.indexOf(a)<0&&(i[a]=r[a]);if(r!=null&&typeof Object.getOwnPropertySymbols=="function")for(var o=0,a=Object.getOwnPropertySymbols(r);o<a.length;o++)t.indexOf(a[o])<0&&Object.prototype.propertyIsEnumerable.call(r,a[o])&&(i[a[o]]=r[a[o]]);return i}function T(r,t,i,a){function o(l){return l instanceof i?l:new i(function(f){f(l)})}return new(i||(i=Promise))(function(l,f){function u(g){try{p(a.next(g))}catch(v){f(v)}}function m(g){try{p(a.throw(g))}catch(v){f(v)}}function p(g){g.done?l(g.value):o(g.value).then(u,m)}p((a=a.apply(r,t||[])).next())})}function Xg(r){var t=typeof Symbol=="function"&&Symbol.iterator,i=t&&r[t],a=0;if(i)return i.call(r);if(r&&typeof r.length=="number")return{next:function(){return r&&a>=r.length&&(r=void 0),{value:r&&r[a++],done:!r}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function ri(r){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var t=r[Symbol.asyncIterator],i;return t?t.call(r):(r=typeof Xg=="function"?Xg(r):r[Symbol.iterator](),i={},a("next"),a("throw"),a("return"),i[Symbol.asyncIterator]=function(){return this},i);function a(l){i[l]=r[l]&&function(f){return new Promise(function(u,m){f=r[l](f),o(u,m,f.done,f.value)})}}function o(l,f,u,m){Promise.resolve(m).then(function(p){l({value:p,done:u})},f)}}var Xo={exports:{}},Zg;function hk(){if(Zg)return Xo.exports;Zg=1;var r=typeof Reflect=="object"?Reflect:null,t=r&&typeof r.apply=="function"?r.apply:function(N,q,Q){return Function.prototype.apply.call(N,q,Q)},i;r&&typeof r.ownKeys=="function"?i=r.ownKeys:Object.getOwnPropertySymbols?i=function(N){return Object.getOwnPropertyNames(N).concat(Object.getOwnPropertySymbols(N))}:i=function(N){return Object.getOwnPropertyNames(N)};function a(M){console&&console.warn&&console.warn(M)}var o=Number.isNaN||function(N){return N!==N};function l(){l.init.call(this)}Xo.exports=l,Xo.exports.once=U,l.EventEmitter=l,l.prototype._events=void 0,l.prototype._eventsCount=0,l.prototype._maxListeners=void 0;var f=10;function u(M){if(typeof M!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof M)}Object.defineProperty(l,"defaultMaxListeners",{enumerable:!0,get:function(){return f},set:function(M){if(typeof M!="number"||M<0||o(M))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+M+".");f=M}}),l.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},l.prototype.setMaxListeners=function(N){if(typeof N!="number"||N<0||o(N))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+N+".");return this._maxListeners=N,this};function m(M){return M._maxListeners===void 0?l.defaultMaxListeners:M._maxListeners}l.prototype.getMaxListeners=function(){return m(this)},l.prototype.emit=function(N){for(var q=[],Q=1;Q<arguments.length;Q++)q.push(arguments[Q]);var ae=N==="error",ne=this._events;if(ne!==void 0)ae=ae&&ne.error===void 0;else if(!ae)return!1;if(ae){var ie;if(q.length>0&&(ie=q[0]),ie instanceof Error)throw ie;var se=new Error("Unhandled error."+(ie?" ("+ie.message+")":""));throw se.context=ie,se}var ue=ne[N];if(ue===void 0)return!1;if(typeof ue=="function")t(ue,this,q);else for(var Ne=ue.length,Ze=O(ue,Ne),Q=0;Q<Ne;++Q)t(Ze[Q],this,q);return!0};function p(M,N,q,Q){var ae,ne,ie;if(u(q),ne=M._events,ne===void 0?(ne=M._events=Object.create(null),M._eventsCount=0):(ne.newListener!==void 0&&(M.emit("newListener",N,q.listener?q.listener:q),ne=M._events),ie=ne[N]),ie===void 0)ie=ne[N]=q,++M._eventsCount;else if(typeof ie=="function"?ie=ne[N]=Q?[q,ie]:[ie,q]:Q?ie.unshift(q):ie.push(q),ae=m(M),ae>0&&ie.length>ae&&!ie.warned){ie.warned=!0;var se=new Error("Possible EventEmitter memory leak detected. "+ie.length+" "+String(N)+" listeners added. Use emitter.setMaxListeners() to increase limit");se.name="MaxListenersExceededWarning",se.emitter=M,se.type=N,se.count=ie.length,a(se)}return M}l.prototype.addListener=function(N,q){return p(this,N,q,!1)},l.prototype.on=l.prototype.addListener,l.prototype.prependListener=function(N,q){return p(this,N,q,!0)};function g(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function v(M,N,q){var Q={fired:!1,wrapFn:void 0,target:M,type:N,listener:q},ae=g.bind(Q);return ae.listener=q,Q.wrapFn=ae,ae}l.prototype.once=function(N,q){return u(q),this.on(N,v(this,N,q)),this},l.prototype.prependOnceListener=function(N,q){return u(q),this.prependListener(N,v(this,N,q)),this},l.prototype.removeListener=function(N,q){var Q,ae,ne,ie,se;if(u(q),ae=this._events,ae===void 0)return this;if(Q=ae[N],Q===void 0)return this;if(Q===q||Q.listener===q)--this._eventsCount===0?this._events=Object.create(null):(delete ae[N],ae.removeListener&&this.emit("removeListener",N,Q.listener||q));else if(typeof Q!="function"){for(ne=-1,ie=Q.length-1;ie>=0;ie--)if(Q[ie]===q||Q[ie].listener===q){se=Q[ie].listener,ne=ie;break}if(ne<0)return this;ne===0?Q.shift():E(Q,ne),Q.length===1&&(ae[N]=Q[0]),ae.removeListener!==void 0&&this.emit("removeListener",N,se||q)}return this},l.prototype.off=l.prototype.removeListener,l.prototype.removeAllListeners=function(N){var q,Q,ae;if(Q=this._events,Q===void 0)return this;if(Q.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):Q[N]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete Q[N]),this;if(arguments.length===0){var ne=Object.keys(Q),ie;for(ae=0;ae<ne.length;++ae)ie=ne[ae],ie!=="removeListener"&&this.removeAllListeners(ie);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(q=Q[N],typeof q=="function")this.removeListener(N,q);else if(q!==void 0)for(ae=q.length-1;ae>=0;ae--)this.removeListener(N,q[ae]);return this};function S(M,N,q){var Q=M._events;if(Q===void 0)return[];var ae=Q[N];return ae===void 0?[]:typeof ae=="function"?q?[ae.listener||ae]:[ae]:q?j(ae):O(ae,ae.length)}l.prototype.listeners=function(N){return S(this,N,!0)},l.prototype.rawListeners=function(N){return S(this,N,!1)},l.listenerCount=function(M,N){return typeof M.listenerCount=="function"?M.listenerCount(N):k.call(M,N)},l.prototype.listenerCount=k;function k(M){var N=this._events;if(N!==void 0){var q=N[M];if(typeof q=="function")return 1;if(q!==void 0)return q.length}return 0}l.prototype.eventNames=function(){return this._eventsCount>0?i(this._events):[]};function O(M,N){for(var q=new Array(N),Q=0;Q<N;++Q)q[Q]=M[Q];return q}function E(M,N){for(;N+1<M.length;N++)M[N]=M[N+1];M.pop()}function j(M){for(var N=new Array(M.length),q=0;q<N.length;++q)N[q]=M[q].listener||M[q];return N}function U(M,N){return new Promise(function(q,Q){function ae(ie){M.removeListener(N,ne),Q(ie)}function ne(){typeof M.removeListener=="function"&&M.removeListener("error",ae),q([].slice.call(arguments))}Z(M,N,ne,{once:!0}),N!=="error"&&Y(M,ae,{once:!0})})}function Y(M,N,q){typeof M.on=="function"&&Z(M,"error",N,q)}function Z(M,N,q,Q){if(typeof M.on=="function")Q.once?M.once(N,q):M.on(N,q);else if(typeof M.addEventListener=="function")M.addEventListener(N,function ae(ne){Q.once&&M.removeEventListener(N,ae),q(ne)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof M)}return Xo.exports}var Ln=hk();let D0=!0,M0=!0;function br(r,t,i){const a=r.match(t);return a&&a.length>=i&&parseFloat(a[i],10)}function ga(r,t,i){if(!r.RTCPeerConnection)return;const a=r.RTCPeerConnection.prototype,o=a.addEventListener;a.addEventListener=function(f,u){if(f!==t)return o.apply(this,arguments);const m=p=>{const g=i(p);g&&(u.handleEvent?u.handleEvent(g):u(g))};return this._eventMap=this._eventMap||{},this._eventMap[t]||(this._eventMap[t]=new Map),this._eventMap[t].set(u,m),o.apply(this,[f,m])};const l=a.removeEventListener;a.removeEventListener=function(f,u){if(f!==t||!this._eventMap||!this._eventMap[t])return l.apply(this,arguments);if(!this._eventMap[t].has(u))return l.apply(this,arguments);const m=this._eventMap[t].get(u);return this._eventMap[t].delete(u),this._eventMap[t].size===0&&delete this._eventMap[t],Object.keys(this._eventMap).length===0&&delete this._eventMap,l.apply(this,[f,m])},Object.defineProperty(a,"on"+t,{get(){return this["_on"+t]},set(f){this["_on"+t]&&(this.removeEventListener(t,this["_on"+t]),delete this["_on"+t]),f&&this.addEventListener(t,this["_on"+t]=f)},enumerable:!0,configurable:!0})}function mk(r){return typeof r!="boolean"?new Error("Argument type: "+typeof r+". Please use a boolean."):(D0=r,r?"adapter.js logging disabled":"adapter.js logging enabled")}function pk(r){return typeof r!="boolean"?new Error("Argument type: "+typeof r+". Please use a boolean."):(M0=!r,"adapter.js deprecation warnings "+(r?"disabled":"enabled"))}function w0(){if(typeof window=="object"){if(D0)return;typeof console<"u"&&typeof console.log=="function"&&console.log.apply(console,arguments)}}function of(r,t){M0&&console.warn(r+" is deprecated, please use "+t+" instead.")}function gk(r){const t={browser:null,version:null};if(typeof r>"u"||!r.navigator||!r.navigator.userAgent)return t.browser="Not a browser.",t;const{navigator:i}=r;if(i.userAgentData&&i.userAgentData.brands){const a=i.userAgentData.brands.find(o=>o.brand==="Chromium");if(a)return{browser:"chrome",version:parseInt(a.version,10)}}if(i.mozGetUserMedia)t.browser="firefox",t.version=parseInt(br(i.userAgent,/Firefox\/(\d+)\./,1));else if(i.webkitGetUserMedia||r.isSecureContext===!1&&r.webkitRTCPeerConnection)t.browser="chrome",t.version=parseInt(br(i.userAgent,/Chrom(e|ium)\/(\d+)\./,2));else if(r.RTCPeerConnection&&i.userAgent.match(/AppleWebKit\/(\d+)\./))t.browser="safari",t.version=parseInt(br(i.userAgent,/AppleWebKit\/(\d+)\./,1)),t.supportsUnifiedPlan=r.RTCRtpTransceiver&&"currentDirection"in r.RTCRtpTransceiver.prototype,t._safariVersion=br(i.userAgent,/Version\/(\d+(\.?\d+))/,1);else return t.browser="Not a supported browser.",t;return t}function Wg(r){return Object.prototype.toString.call(r)==="[object Object]"}function x0(r){return Wg(r)?Object.keys(r).reduce(function(t,i){const a=Wg(r[i]),o=a?x0(r[i]):r[i],l=a&&!Object.keys(o).length;return o===void 0||l?t:Object.assign(t,{[i]:o})},{}):r}function Rd(r,t,i){!t||i.has(t.id)||(i.set(t.id,t),Object.keys(t).forEach(a=>{a.endsWith("Id")?Rd(r,r.get(t[a]),i):a.endsWith("Ids")&&t[a].forEach(o=>{Rd(r,r.get(o),i)})}))}function $g(r,t,i){const a=i?"outbound-rtp":"inbound-rtp",o=new Map;if(t===null)return o;const l=[];return r.forEach(f=>{f.type==="track"&&f.trackIdentifier===t.id&&l.push(f)}),l.forEach(f=>{r.forEach(u=>{u.type===a&&u.trackId===f.id&&Rd(r,u,o)})}),o}const ev=w0;function N0(r,t){const i=r&&r.navigator;if(!i.mediaDevices)return;const a=function(u){if(typeof u!="object"||u.mandatory||u.optional)return u;const m={};return Object.keys(u).forEach(p=>{if(p==="require"||p==="advanced"||p==="mediaSource")return;const g=typeof u[p]=="object"?u[p]:{ideal:u[p]};g.exact!==void 0&&typeof g.exact=="number"&&(g.min=g.max=g.exact);const v=function(S,k){return S?S+k.charAt(0).toUpperCase()+k.slice(1):k==="deviceId"?"sourceId":k};if(g.ideal!==void 0){m.optional=m.optional||[];let S={};typeof g.ideal=="number"?(S[v("min",p)]=g.ideal,m.optional.push(S),S={},S[v("max",p)]=g.ideal,m.optional.push(S)):(S[v("",p)]=g.ideal,m.optional.push(S))}g.exact!==void 0&&typeof g.exact!="number"?(m.mandatory=m.mandatory||{},m.mandatory[v("",p)]=g.exact):["min","max"].forEach(S=>{g[S]!==void 0&&(m.mandatory=m.mandatory||{},m.mandatory[v(S,p)]=g[S])})}),u.advanced&&(m.optional=(m.optional||[]).concat(u.advanced)),m},o=function(u,m){if(t.version>=61)return m(u);if(u=JSON.parse(JSON.stringify(u)),u&&typeof u.audio=="object"){const p=function(g,v,S){v in g&&!(S in g)&&(g[S]=g[v],delete g[v])};u=JSON.parse(JSON.stringify(u)),p(u.audio,"autoGainControl","googAutoGainControl"),p(u.audio,"noiseSuppression","googNoiseSuppression"),u.audio=a(u.audio)}if(u&&typeof u.video=="object"){let p=u.video.facingMode;p=p&&(typeof p=="object"?p:{ideal:p});const g=t.version<66;if(p&&(p.exact==="user"||p.exact==="environment"||p.ideal==="user"||p.ideal==="environment")&&!(i.mediaDevices.getSupportedConstraints&&i.mediaDevices.getSupportedConstraints().facingMode&&!g)){delete u.video.facingMode;let v;if(p.exact==="environment"||p.ideal==="environment"?v=["back","rear"]:(p.exact==="user"||p.ideal==="user")&&(v=["front"]),v)return i.mediaDevices.enumerateDevices().then(S=>{S=S.filter(O=>O.kind==="videoinput");let k=S.find(O=>v.some(E=>O.label.toLowerCase().includes(E)));return!k&&S.length&&v.includes("back")&&(k=S[S.length-1]),k&&(u.video.deviceId=p.exact?{exact:k.deviceId}:{ideal:k.deviceId}),u.video=a(u.video),ev("chrome: "+JSON.stringify(u)),m(u)})}u.video=a(u.video)}return ev("chrome: "+JSON.stringify(u)),m(u)},l=function(u){return t.version>=64?u:{name:{PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"}[u.name]||u.name,message:u.message,constraint:u.constraint||u.constraintName,toString(){return this.name+(this.message&&": ")+this.message}}},f=function(u,m,p){o(u,g=>{i.webkitGetUserMedia(g,m,v=>{p&&p(l(v))})})};if(i.getUserMedia=f.bind(i),i.mediaDevices.getUserMedia){const u=i.mediaDevices.getUserMedia.bind(i.mediaDevices);i.mediaDevices.getUserMedia=function(m){return o(m,p=>u(p).then(g=>{if(p.audio&&!g.getAudioTracks().length||p.video&&!g.getVideoTracks().length)throw g.getTracks().forEach(v=>{v.stop()}),new DOMException("","NotFoundError");return g},g=>Promise.reject(l(g))))}}}function P0(r){r.MediaStream=r.MediaStream||r.webkitMediaStream}function U0(r){if(typeof r=="object"&&r.RTCPeerConnection&&!("ontrack"in r.RTCPeerConnection.prototype)){Object.defineProperty(r.RTCPeerConnection.prototype,"ontrack",{get(){return this._ontrack},set(i){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=i)},enumerable:!0,configurable:!0});const t=r.RTCPeerConnection.prototype.setRemoteDescription;r.RTCPeerConnection.prototype.setRemoteDescription=function(){return this._ontrackpoly||(this._ontrackpoly=a=>{a.stream.addEventListener("addtrack",o=>{let l;r.RTCPeerConnection.prototype.getReceivers?l=this.getReceivers().find(u=>u.track&&u.track.id===o.track.id):l={track:o.track};const f=new Event("track");f.track=o.track,f.receiver=l,f.transceiver={receiver:l},f.streams=[a.stream],this.dispatchEvent(f)}),a.stream.getTracks().forEach(o=>{let l;r.RTCPeerConnection.prototype.getReceivers?l=this.getReceivers().find(u=>u.track&&u.track.id===o.id):l={track:o};const f=new Event("track");f.track=o,f.receiver=l,f.transceiver={receiver:l},f.streams=[a.stream],this.dispatchEvent(f)})},this.addEventListener("addstream",this._ontrackpoly)),t.apply(this,arguments)}}else ga(r,"track",t=>(t.transceiver||Object.defineProperty(t,"transceiver",{value:{receiver:t.receiver}}),t))}function L0(r){if(typeof r=="object"&&r.RTCPeerConnection&&!("getSenders"in r.RTCPeerConnection.prototype)&&"createDTMFSender"in r.RTCPeerConnection.prototype){const t=function(o,l){return{track:l,get dtmf(){return this._dtmf===void 0&&(l.kind==="audio"?this._dtmf=o.createDTMFSender(l):this._dtmf=null),this._dtmf},_pc:o}};if(!r.RTCPeerConnection.prototype.getSenders){r.RTCPeerConnection.prototype.getSenders=function(){return this._senders=this._senders||[],this._senders.slice()};const o=r.RTCPeerConnection.prototype.addTrack;r.RTCPeerConnection.prototype.addTrack=function(u,m){let p=o.apply(this,arguments);return p||(p=t(this,u),this._senders.push(p)),p};const l=r.RTCPeerConnection.prototype.removeTrack;r.RTCPeerConnection.prototype.removeTrack=function(u){l.apply(this,arguments);const m=this._senders.indexOf(u);m!==-1&&this._senders.splice(m,1)}}const i=r.RTCPeerConnection.prototype.addStream;r.RTCPeerConnection.prototype.addStream=function(l){this._senders=this._senders||[],i.apply(this,[l]),l.getTracks().forEach(f=>{this._senders.push(t(this,f))})};const a=r.RTCPeerConnection.prototype.removeStream;r.RTCPeerConnection.prototype.removeStream=function(l){this._senders=this._senders||[],a.apply(this,[l]),l.getTracks().forEach(f=>{const u=this._senders.find(m=>m.track===f);u&&this._senders.splice(this._senders.indexOf(u),1)})}}else if(typeof r=="object"&&r.RTCPeerConnection&&"getSenders"in r.RTCPeerConnection.prototype&&"createDTMFSender"in r.RTCPeerConnection.prototype&&r.RTCRtpSender&&!("dtmf"in r.RTCRtpSender.prototype)){const t=r.RTCPeerConnection.prototype.getSenders;r.RTCPeerConnection.prototype.getSenders=function(){const a=t.apply(this,[]);return a.forEach(o=>o._pc=this),a},Object.defineProperty(r.RTCRtpSender.prototype,"dtmf",{get(){return this._dtmf===void 0&&(this.track.kind==="audio"?this._dtmf=this._pc.createDTMFSender(this.track):this._dtmf=null),this._dtmf}})}}function I0(r){if(!(typeof r=="object"&&r.RTCPeerConnection&&r.RTCRtpSender&&r.RTCRtpReceiver))return;if(!("getStats"in r.RTCRtpSender.prototype)){const i=r.RTCPeerConnection.prototype.getSenders;i&&(r.RTCPeerConnection.prototype.getSenders=function(){const l=i.apply(this,[]);return l.forEach(f=>f._pc=this),l});const a=r.RTCPeerConnection.prototype.addTrack;a&&(r.RTCPeerConnection.prototype.addTrack=function(){const l=a.apply(this,arguments);return l._pc=this,l}),r.RTCRtpSender.prototype.getStats=function(){const l=this;return this._pc.getStats().then(f=>$g(f,l.track,!0))}}if(!("getStats"in r.RTCRtpReceiver.prototype)){const i=r.RTCPeerConnection.prototype.getReceivers;i&&(r.RTCPeerConnection.prototype.getReceivers=function(){const o=i.apply(this,[]);return o.forEach(l=>l._pc=this),o}),ga(r,"track",a=>(a.receiver._pc=a.srcElement,a)),r.RTCRtpReceiver.prototype.getStats=function(){const o=this;return this._pc.getStats().then(l=>$g(l,o.track,!1))}}if(!("getStats"in r.RTCRtpSender.prototype&&"getStats"in r.RTCRtpReceiver.prototype))return;const t=r.RTCPeerConnection.prototype.getStats;r.RTCPeerConnection.prototype.getStats=function(){if(arguments.length>0&&arguments[0]instanceof r.MediaStreamTrack){const a=arguments[0];let o,l,f;return this.getSenders().forEach(u=>{u.track===a&&(o?f=!0:o=u)}),this.getReceivers().forEach(u=>(u.track===a&&(l?f=!0:l=u),u.track===a)),f||o&&l?Promise.reject(new DOMException("There are more than one sender or receiver for the track.","InvalidAccessError")):o?o.getStats():l?l.getStats():Promise.reject(new DOMException("There is no sender or receiver for the track.","InvalidAccessError"))}return t.apply(this,arguments)}}function j0(r){r.RTCPeerConnection.prototype.getLocalStreams=function(){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},Object.keys(this._shimmedLocalStreams).map(f=>this._shimmedLocalStreams[f][0])};const t=r.RTCPeerConnection.prototype.addTrack;r.RTCPeerConnection.prototype.addTrack=function(f,u){if(!u)return t.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};const m=t.apply(this,arguments);return this._shimmedLocalStreams[u.id]?this._shimmedLocalStreams[u.id].indexOf(m)===-1&&this._shimmedLocalStreams[u.id].push(m):this._shimmedLocalStreams[u.id]=[u,m],m};const i=r.RTCPeerConnection.prototype.addStream;r.RTCPeerConnection.prototype.addStream=function(f){this._shimmedLocalStreams=this._shimmedLocalStreams||{},f.getTracks().forEach(p=>{if(this.getSenders().find(v=>v.track===p))throw new DOMException("Track already exists.","InvalidAccessError")});const u=this.getSenders();i.apply(this,arguments);const m=this.getSenders().filter(p=>u.indexOf(p)===-1);this._shimmedLocalStreams[f.id]=[f].concat(m)};const a=r.RTCPeerConnection.prototype.removeStream;r.RTCPeerConnection.prototype.removeStream=function(f){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[f.id],a.apply(this,arguments)};const o=r.RTCPeerConnection.prototype.removeTrack;r.RTCPeerConnection.prototype.removeTrack=function(f){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},f&&Object.keys(this._shimmedLocalStreams).forEach(u=>{const m=this._shimmedLocalStreams[u].indexOf(f);m!==-1&&this._shimmedLocalStreams[u].splice(m,1),this._shimmedLocalStreams[u].length===1&&delete this._shimmedLocalStreams[u]}),o.apply(this,arguments)}}function B0(r,t){if(!r.RTCPeerConnection)return;if(r.RTCPeerConnection.prototype.addTrack&&t.version>=65)return j0(r);const i=r.RTCPeerConnection.prototype.getLocalStreams;r.RTCPeerConnection.prototype.getLocalStreams=function(){const g=i.apply(this);return this._reverseStreams=this._reverseStreams||{},g.map(v=>this._reverseStreams[v.id])};const a=r.RTCPeerConnection.prototype.addStream;r.RTCPeerConnection.prototype.addStream=function(g){if(this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},g.getTracks().forEach(v=>{if(this.getSenders().find(k=>k.track===v))throw new DOMException("Track already exists.","InvalidAccessError")}),!this._reverseStreams[g.id]){const v=new r.MediaStream(g.getTracks());this._streams[g.id]=v,this._reverseStreams[v.id]=g,g=v}a.apply(this,[g])};const o=r.RTCPeerConnection.prototype.removeStream;r.RTCPeerConnection.prototype.removeStream=function(g){this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},o.apply(this,[this._streams[g.id]||g]),delete this._reverseStreams[this._streams[g.id]?this._streams[g.id].id:g.id],delete this._streams[g.id]},r.RTCPeerConnection.prototype.addTrack=function(g,v){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");const S=[].slice.call(arguments,1);if(S.length!==1||!S[0].getTracks().find(E=>E===g))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");if(this.getSenders().find(E=>E.track===g))throw new DOMException("Track already exists.","InvalidAccessError");this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{};const O=this._streams[v.id];if(O)O.addTrack(g),Promise.resolve().then(()=>{this.dispatchEvent(new Event("negotiationneeded"))});else{const E=new r.MediaStream([g]);this._streams[v.id]=E,this._reverseStreams[E.id]=v,this.addStream(E)}return this.getSenders().find(E=>E.track===g)};function l(p,g){let v=g.sdp;return Object.keys(p._reverseStreams||[]).forEach(S=>{const k=p._reverseStreams[S],O=p._streams[k.id];v=v.replace(new RegExp(O.id,"g"),k.id)}),new RTCSessionDescription({type:g.type,sdp:v})}function f(p,g){let v=g.sdp;return Object.keys(p._reverseStreams||[]).forEach(S=>{const k=p._reverseStreams[S],O=p._streams[k.id];v=v.replace(new RegExp(k.id,"g"),O.id)}),new RTCSessionDescription({type:g.type,sdp:v})}["createOffer","createAnswer"].forEach(function(p){const g=r.RTCPeerConnection.prototype[p],v={[p](){const S=arguments;return arguments.length&&typeof arguments[0]=="function"?g.apply(this,[O=>{const E=l(this,O);S[0].apply(null,[E])},O=>{S[1]&&S[1].apply(null,O)},arguments[2]]):g.apply(this,arguments).then(O=>l(this,O))}};r.RTCPeerConnection.prototype[p]=v[p]});const u=r.RTCPeerConnection.prototype.setLocalDescription;r.RTCPeerConnection.prototype.setLocalDescription=function(){return!arguments.length||!arguments[0].type?u.apply(this,arguments):(arguments[0]=f(this,arguments[0]),u.apply(this,arguments))};const m=Object.getOwnPropertyDescriptor(r.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(r.RTCPeerConnection.prototype,"localDescription",{get(){const p=m.get.apply(this);return p.type===""?p:l(this,p)}}),r.RTCPeerConnection.prototype.removeTrack=function(g){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!g._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(!(g._pc===this))throw new DOMException("Sender was not created by this connection.","InvalidAccessError");this._streams=this._streams||{};let S;Object.keys(this._streams).forEach(k=>{this._streams[k].getTracks().find(E=>g.track===E)&&(S=this._streams[k])}),S&&(S.getTracks().length===1?this.removeStream(this._reverseStreams[S.id]):S.removeTrack(g.track),this.dispatchEvent(new Event("negotiationneeded")))}}function Od(r,t){!r.RTCPeerConnection&&r.webkitRTCPeerConnection&&(r.RTCPeerConnection=r.webkitRTCPeerConnection),r.RTCPeerConnection&&t.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(i){const a=r.RTCPeerConnection.prototype[i],o={[i](){return arguments[0]=new(i==="addIceCandidate"?r.RTCIceCandidate:r.RTCSessionDescription)(arguments[0]),a.apply(this,arguments)}};r.RTCPeerConnection.prototype[i]=o[i]})}function z0(r,t){ga(r,"negotiationneeded",i=>{const a=i.target;if(!((t.version<72||a.getConfiguration&&a.getConfiguration().sdpSemantics==="plan-b")&&a.signalingState!=="stable"))return i})}var tv=Object.freeze({__proto__:null,fixNegotiationNeeded:z0,shimAddTrackRemoveTrack:B0,shimAddTrackRemoveTrackWithNative:j0,shimGetSendersWithDtmf:L0,shimGetUserMedia:N0,shimMediaStream:P0,shimOnTrack:U0,shimPeerConnection:Od,shimSenderReceiverGetStats:I0});function q0(r,t){const i=r&&r.navigator,a=r&&r.MediaStreamTrack;if(i.getUserMedia=function(o,l,f){of("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),i.mediaDevices.getUserMedia(o).then(l,f)},!(t.version>55&&"autoGainControl"in i.mediaDevices.getSupportedConstraints())){const o=function(f,u,m){u in f&&!(m in f)&&(f[m]=f[u],delete f[u])},l=i.mediaDevices.getUserMedia.bind(i.mediaDevices);if(i.mediaDevices.getUserMedia=function(f){return typeof f=="object"&&typeof f.audio=="object"&&(f=JSON.parse(JSON.stringify(f)),o(f.audio,"autoGainControl","mozAutoGainControl"),o(f.audio,"noiseSuppression","mozNoiseSuppression")),l(f)},a&&a.prototype.getSettings){const f=a.prototype.getSettings;a.prototype.getSettings=function(){const u=f.apply(this,arguments);return o(u,"mozAutoGainControl","autoGainControl"),o(u,"mozNoiseSuppression","noiseSuppression"),u}}if(a&&a.prototype.applyConstraints){const f=a.prototype.applyConstraints;a.prototype.applyConstraints=function(u){return this.kind==="audio"&&typeof u=="object"&&(u=JSON.parse(JSON.stringify(u)),o(u,"autoGainControl","mozAutoGainControl"),o(u,"noiseSuppression","mozNoiseSuppression")),f.apply(this,[u])}}}}function vk(r,t){r.navigator.mediaDevices&&"getDisplayMedia"in r.navigator.mediaDevices||r.navigator.mediaDevices&&(r.navigator.mediaDevices.getDisplayMedia=function(a){if(!(a&&a.video)){const o=new DOMException("getDisplayMedia without video constraints is undefined");return o.name="NotFoundError",o.code=8,Promise.reject(o)}return a.video===!0?a.video={mediaSource:t}:a.video.mediaSource=t,r.navigator.mediaDevices.getUserMedia(a)})}function V0(r){typeof r=="object"&&r.RTCTrackEvent&&"receiver"in r.RTCTrackEvent.prototype&&!("transceiver"in r.RTCTrackEvent.prototype)&&Object.defineProperty(r.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function Ad(r,t){if(typeof r!="object"||!(r.RTCPeerConnection||r.mozRTCPeerConnection))return;!r.RTCPeerConnection&&r.mozRTCPeerConnection&&(r.RTCPeerConnection=r.mozRTCPeerConnection),t.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(o){const l=r.RTCPeerConnection.prototype[o],f={[o](){return arguments[0]=new(o==="addIceCandidate"?r.RTCIceCandidate:r.RTCSessionDescription)(arguments[0]),l.apply(this,arguments)}};r.RTCPeerConnection.prototype[o]=f[o]});const i={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},a=r.RTCPeerConnection.prototype.getStats;r.RTCPeerConnection.prototype.getStats=function(){const[l,f,u]=arguments;return a.apply(this,[l||null]).then(m=>{if(t.version<53&&!f)try{m.forEach(p=>{p.type=i[p.type]||p.type})}catch(p){if(p.name!=="TypeError")throw p;m.forEach((g,v)=>{m.set(v,Object.assign({},g,{type:i[g.type]||g.type}))})}return m}).then(f,u)}}function H0(r){if(!(typeof r=="object"&&r.RTCPeerConnection&&r.RTCRtpSender)||r.RTCRtpSender&&"getStats"in r.RTCRtpSender.prototype)return;const t=r.RTCPeerConnection.prototype.getSenders;t&&(r.RTCPeerConnection.prototype.getSenders=function(){const o=t.apply(this,[]);return o.forEach(l=>l._pc=this),o});const i=r.RTCPeerConnection.prototype.addTrack;i&&(r.RTCPeerConnection.prototype.addTrack=function(){const o=i.apply(this,arguments);return o._pc=this,o}),r.RTCRtpSender.prototype.getStats=function(){return this.track?this._pc.getStats(this.track):Promise.resolve(new Map)}}function F0(r){if(!(typeof r=="object"&&r.RTCPeerConnection&&r.RTCRtpSender)||r.RTCRtpSender&&"getStats"in r.RTCRtpReceiver.prototype)return;const t=r.RTCPeerConnection.prototype.getReceivers;t&&(r.RTCPeerConnection.prototype.getReceivers=function(){const a=t.apply(this,[]);return a.forEach(o=>o._pc=this),a}),ga(r,"track",i=>(i.receiver._pc=i.srcElement,i)),r.RTCRtpReceiver.prototype.getStats=function(){return this._pc.getStats(this.track)}}function G0(r){!r.RTCPeerConnection||"removeStream"in r.RTCPeerConnection.prototype||(r.RTCPeerConnection.prototype.removeStream=function(i){of("removeStream","removeTrack"),this.getSenders().forEach(a=>{a.track&&i.getTracks().includes(a.track)&&this.removeTrack(a)})})}function K0(r){r.DataChannel&&!r.RTCDataChannel&&(r.RTCDataChannel=r.DataChannel)}function Y0(r){if(!(typeof r=="object"&&r.RTCPeerConnection))return;const t=r.RTCPeerConnection.prototype.addTransceiver;t&&(r.RTCPeerConnection.prototype.addTransceiver=function(){this.setParametersPromises=[];let a=arguments[1]&&arguments[1].sendEncodings;a===void 0&&(a=[]),a=[...a];const o=a.length>0;o&&a.forEach(f=>{if("rid"in f&&!/^[a-z0-9]{0,16}$/i.test(f.rid))throw new TypeError("Invalid RID value provided.");if("scaleResolutionDownBy"in f&&!(parseFloat(f.scaleResolutionDownBy)>=1))throw new RangeError("scale_resolution_down_by must be >= 1.0");if("maxFramerate"in f&&!(parseFloat(f.maxFramerate)>=0))throw new RangeError("max_framerate must be >= 0.0")});const l=t.apply(this,arguments);if(o){const{sender:f}=l,u=f.getParameters();(!("encodings"in u)||u.encodings.length===1&&Object.keys(u.encodings[0]).length===0)&&(u.encodings=a,f.sendEncodings=a,this.setParametersPromises.push(f.setParameters(u).then(()=>{delete f.sendEncodings}).catch(()=>{delete f.sendEncodings})))}return l})}function Q0(r){if(!(typeof r=="object"&&r.RTCRtpSender))return;const t=r.RTCRtpSender.prototype.getParameters;t&&(r.RTCRtpSender.prototype.getParameters=function(){const a=t.apply(this,arguments);return"encodings"in a||(a.encodings=[].concat(this.sendEncodings||[{}])),a})}function J0(r){if(!(typeof r=="object"&&r.RTCPeerConnection))return;const t=r.RTCPeerConnection.prototype.createOffer;r.RTCPeerConnection.prototype.createOffer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then(()=>t.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):t.apply(this,arguments)}}function X0(r){if(!(typeof r=="object"&&r.RTCPeerConnection))return;const t=r.RTCPeerConnection.prototype.createAnswer;r.RTCPeerConnection.prototype.createAnswer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then(()=>t.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):t.apply(this,arguments)}}var nv=Object.freeze({__proto__:null,shimAddTransceiver:Y0,shimCreateAnswer:X0,shimCreateOffer:J0,shimGetDisplayMedia:vk,shimGetParameters:Q0,shimGetUserMedia:q0,shimOnTrack:V0,shimPeerConnection:Ad,shimRTCDataChannel:K0,shimReceiverGetStats:F0,shimRemoveStream:G0,shimSenderGetStats:H0});function Z0(r){if(!(typeof r!="object"||!r.RTCPeerConnection)){if("getLocalStreams"in r.RTCPeerConnection.prototype||(r.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),!("addStream"in r.RTCPeerConnection.prototype)){const t=r.RTCPeerConnection.prototype.addTrack;r.RTCPeerConnection.prototype.addStream=function(a){this._localStreams||(this._localStreams=[]),this._localStreams.includes(a)||this._localStreams.push(a),a.getAudioTracks().forEach(o=>t.call(this,o,a)),a.getVideoTracks().forEach(o=>t.call(this,o,a))},r.RTCPeerConnection.prototype.addTrack=function(a){for(var o=arguments.length,l=new Array(o>1?o-1:0),f=1;f<o;f++)l[f-1]=arguments[f];return l&&l.forEach(u=>{this._localStreams?this._localStreams.includes(u)||this._localStreams.push(u):this._localStreams=[u]}),t.apply(this,arguments)}}"removeStream"in r.RTCPeerConnection.prototype||(r.RTCPeerConnection.prototype.removeStream=function(i){this._localStreams||(this._localStreams=[]);const a=this._localStreams.indexOf(i);if(a===-1)return;this._localStreams.splice(a,1);const o=i.getTracks();this.getSenders().forEach(l=>{o.includes(l.track)&&this.removeTrack(l)})})}}function W0(r){if(!(typeof r!="object"||!r.RTCPeerConnection)&&("getRemoteStreams"in r.RTCPeerConnection.prototype||(r.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),!("onaddstream"in r.RTCPeerConnection.prototype))){Object.defineProperty(r.RTCPeerConnection.prototype,"onaddstream",{get(){return this._onaddstream},set(i){this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly)),this.addEventListener("addstream",this._onaddstream=i),this.addEventListener("track",this._onaddstreampoly=a=>{a.streams.forEach(o=>{if(this._remoteStreams||(this._remoteStreams=[]),this._remoteStreams.includes(o))return;this._remoteStreams.push(o);const l=new Event("addstream");l.stream=o,this.dispatchEvent(l)})})}});const t=r.RTCPeerConnection.prototype.setRemoteDescription;r.RTCPeerConnection.prototype.setRemoteDescription=function(){const a=this;return this._onaddstreampoly||this.addEventListener("track",this._onaddstreampoly=function(o){o.streams.forEach(l=>{if(a._remoteStreams||(a._remoteStreams=[]),a._remoteStreams.indexOf(l)>=0)return;a._remoteStreams.push(l);const f=new Event("addstream");f.stream=l,a.dispatchEvent(f)})}),t.apply(a,arguments)}}}function $0(r){if(typeof r!="object"||!r.RTCPeerConnection)return;const t=r.RTCPeerConnection.prototype,i=t.createOffer,a=t.createAnswer,o=t.setLocalDescription,l=t.setRemoteDescription,f=t.addIceCandidate;t.createOffer=function(p,g){const v=arguments.length>=2?arguments[2]:arguments[0],S=i.apply(this,[v]);return g?(S.then(p,g),Promise.resolve()):S},t.createAnswer=function(p,g){const v=arguments.length>=2?arguments[2]:arguments[0],S=a.apply(this,[v]);return g?(S.then(p,g),Promise.resolve()):S};let u=function(m,p,g){const v=o.apply(this,[m]);return g?(v.then(p,g),Promise.resolve()):v};t.setLocalDescription=u,u=function(m,p,g){const v=l.apply(this,[m]);return g?(v.then(p,g),Promise.resolve()):v},t.setRemoteDescription=u,u=function(m,p,g){const v=f.apply(this,[m]);return g?(v.then(p,g),Promise.resolve()):v},t.addIceCandidate=u}function ey(r){const t=r&&r.navigator;if(t.mediaDevices&&t.mediaDevices.getUserMedia){const i=t.mediaDevices,a=i.getUserMedia.bind(i);t.mediaDevices.getUserMedia=o=>a(ty(o))}!t.getUserMedia&&t.mediaDevices&&t.mediaDevices.getUserMedia&&(t.getUserMedia=(function(a,o,l){t.mediaDevices.getUserMedia(a).then(o,l)}).bind(t))}function ty(r){return r&&r.video!==void 0?Object.assign({},r,{video:x0(r.video)}):r}function ny(r){if(!r.RTCPeerConnection)return;const t=r.RTCPeerConnection;r.RTCPeerConnection=function(a,o){if(a&&a.iceServers){const l=[];for(let f=0;f<a.iceServers.length;f++){let u=a.iceServers[f];u.urls===void 0&&u.url?(of("RTCIceServer.url","RTCIceServer.urls"),u=JSON.parse(JSON.stringify(u)),u.urls=u.url,delete u.url,l.push(u)):l.push(a.iceServers[f])}a.iceServers=l}return new t(a,o)},r.RTCPeerConnection.prototype=t.prototype,"generateCertificate"in t&&Object.defineProperty(r.RTCPeerConnection,"generateCertificate",{get(){return t.generateCertificate}})}function iy(r){typeof r=="object"&&r.RTCTrackEvent&&"receiver"in r.RTCTrackEvent.prototype&&!("transceiver"in r.RTCTrackEvent.prototype)&&Object.defineProperty(r.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function ay(r){const t=r.RTCPeerConnection.prototype.createOffer;r.RTCPeerConnection.prototype.createOffer=function(a){if(a){typeof a.offerToReceiveAudio<"u"&&(a.offerToReceiveAudio=!!a.offerToReceiveAudio);const o=this.getTransceivers().find(f=>f.receiver.track.kind==="audio");a.offerToReceiveAudio===!1&&o?o.direction==="sendrecv"?o.setDirection?o.setDirection("sendonly"):o.direction="sendonly":o.direction==="recvonly"&&(o.setDirection?o.setDirection("inactive"):o.direction="inactive"):a.offerToReceiveAudio===!0&&!o&&this.addTransceiver("audio",{direction:"recvonly"}),typeof a.offerToReceiveVideo<"u"&&(a.offerToReceiveVideo=!!a.offerToReceiveVideo);const l=this.getTransceivers().find(f=>f.receiver.track.kind==="video");a.offerToReceiveVideo===!1&&l?l.direction==="sendrecv"?l.setDirection?l.setDirection("sendonly"):l.direction="sendonly":l.direction==="recvonly"&&(l.setDirection?l.setDirection("inactive"):l.direction="inactive"):a.offerToReceiveVideo===!0&&!l&&this.addTransceiver("video",{direction:"recvonly"})}return t.apply(this,arguments)}}function sy(r){typeof r!="object"||r.AudioContext||(r.AudioContext=r.webkitAudioContext)}var iv=Object.freeze({__proto__:null,shimAudioContext:sy,shimCallbacksAPI:$0,shimConstraints:ty,shimCreateOfferLegacy:ay,shimGetUserMedia:ey,shimLocalStreamsAPI:Z0,shimRTCIceServerUrls:ny,shimRemoteStreamsAPI:W0,shimTrackEventTransceiver:iy}),sd={exports:{}},av;function yk(){return av||(av=1,(function(r){const t={};t.generateIdentifier=function(){return Math.random().toString(36).substring(2,12)},t.localCName=t.generateIdentifier(),t.splitLines=function(i){return i.trim().split(`
`).map(a=>a.trim())},t.splitSections=function(i){return i.split(`
m=`).map((o,l)=>(l>0?"m="+o:o).trim()+`\r
`)},t.getDescription=function(i){const a=t.splitSections(i);return a&&a[0]},t.getMediaSections=function(i){const a=t.splitSections(i);return a.shift(),a},t.matchPrefix=function(i,a){return t.splitLines(i).filter(o=>o.indexOf(a)===0)},t.parseCandidate=function(i){let a;i.indexOf("a=candidate:")===0?a=i.substring(12).split(" "):a=i.substring(10).split(" ");const o={foundation:a[0],component:{1:"rtp",2:"rtcp"}[a[1]]||a[1],protocol:a[2].toLowerCase(),priority:parseInt(a[3],10),ip:a[4],address:a[4],port:parseInt(a[5],10),type:a[7]};for(let l=8;l<a.length;l+=2)switch(a[l]){case"raddr":o.relatedAddress=a[l+1];break;case"rport":o.relatedPort=parseInt(a[l+1],10);break;case"tcptype":o.tcpType=a[l+1];break;case"ufrag":o.ufrag=a[l+1],o.usernameFragment=a[l+1];break;default:o[a[l]]===void 0&&(o[a[l]]=a[l+1]);break}return o},t.writeCandidate=function(i){const a=[];a.push(i.foundation);const o=i.component;o==="rtp"?a.push(1):o==="rtcp"?a.push(2):a.push(o),a.push(i.protocol.toUpperCase()),a.push(i.priority),a.push(i.address||i.ip),a.push(i.port);const l=i.type;return a.push("typ"),a.push(l),l!=="host"&&i.relatedAddress&&i.relatedPort&&(a.push("raddr"),a.push(i.relatedAddress),a.push("rport"),a.push(i.relatedPort)),i.tcpType&&i.protocol.toLowerCase()==="tcp"&&(a.push("tcptype"),a.push(i.tcpType)),(i.usernameFragment||i.ufrag)&&(a.push("ufrag"),a.push(i.usernameFragment||i.ufrag)),"candidate:"+a.join(" ")},t.parseIceOptions=function(i){return i.substring(14).split(" ")},t.parseRtpMap=function(i){let a=i.substring(9).split(" ");const o={payloadType:parseInt(a.shift(),10)};return a=a[0].split("/"),o.name=a[0],o.clockRate=parseInt(a[1],10),o.channels=a.length===3?parseInt(a[2],10):1,o.numChannels=o.channels,o},t.writeRtpMap=function(i){let a=i.payloadType;i.preferredPayloadType!==void 0&&(a=i.preferredPayloadType);const o=i.channels||i.numChannels||1;return"a=rtpmap:"+a+" "+i.name+"/"+i.clockRate+(o!==1?"/"+o:"")+`\r
`},t.parseExtmap=function(i){const a=i.substring(9).split(" ");return{id:parseInt(a[0],10),direction:a[0].indexOf("/")>0?a[0].split("/")[1]:"sendrecv",uri:a[1],attributes:a.slice(2).join(" ")}},t.writeExtmap=function(i){return"a=extmap:"+(i.id||i.preferredId)+(i.direction&&i.direction!=="sendrecv"?"/"+i.direction:"")+" "+i.uri+(i.attributes?" "+i.attributes:"")+`\r
`},t.parseFmtp=function(i){const a={};let o;const l=i.substring(i.indexOf(" ")+1).split(";");for(let f=0;f<l.length;f++)o=l[f].trim().split("="),a[o[0].trim()]=o[1];return a},t.writeFmtp=function(i){let a="",o=i.payloadType;if(i.preferredPayloadType!==void 0&&(o=i.preferredPayloadType),i.parameters&&Object.keys(i.parameters).length){const l=[];Object.keys(i.parameters).forEach(f=>{i.parameters[f]!==void 0?l.push(f+"="+i.parameters[f]):l.push(f)}),a+="a=fmtp:"+o+" "+l.join(";")+`\r
`}return a},t.parseRtcpFb=function(i){const a=i.substring(i.indexOf(" ")+1).split(" ");return{type:a.shift(),parameter:a.join(" ")}},t.writeRtcpFb=function(i){let a="",o=i.payloadType;return i.preferredPayloadType!==void 0&&(o=i.preferredPayloadType),i.rtcpFeedback&&i.rtcpFeedback.length&&i.rtcpFeedback.forEach(l=>{a+="a=rtcp-fb:"+o+" "+l.type+(l.parameter&&l.parameter.length?" "+l.parameter:"")+`\r
`}),a},t.parseSsrcMedia=function(i){const a=i.indexOf(" "),o={ssrc:parseInt(i.substring(7,a),10)},l=i.indexOf(":",a);return l>-1?(o.attribute=i.substring(a+1,l),o.value=i.substring(l+1)):o.attribute=i.substring(a+1),o},t.parseSsrcGroup=function(i){const a=i.substring(13).split(" ");return{semantics:a.shift(),ssrcs:a.map(o=>parseInt(o,10))}},t.getMid=function(i){const a=t.matchPrefix(i,"a=mid:")[0];if(a)return a.substring(6)},t.parseFingerprint=function(i){const a=i.substring(14).split(" ");return{algorithm:a[0].toLowerCase(),value:a[1].toUpperCase()}},t.getDtlsParameters=function(i,a){return{role:"auto",fingerprints:t.matchPrefix(i+a,"a=fingerprint:").map(t.parseFingerprint)}},t.writeDtlsParameters=function(i,a){let o="a=setup:"+a+`\r
`;return i.fingerprints.forEach(l=>{o+="a=fingerprint:"+l.algorithm+" "+l.value+`\r
`}),o},t.parseCryptoLine=function(i){const a=i.substring(9).split(" ");return{tag:parseInt(a[0],10),cryptoSuite:a[1],keyParams:a[2],sessionParams:a.slice(3)}},t.writeCryptoLine=function(i){return"a=crypto:"+i.tag+" "+i.cryptoSuite+" "+(typeof i.keyParams=="object"?t.writeCryptoKeyParams(i.keyParams):i.keyParams)+(i.sessionParams?" "+i.sessionParams.join(" "):"")+`\r
`},t.parseCryptoKeyParams=function(i){if(i.indexOf("inline:")!==0)return null;const a=i.substring(7).split("|");return{keyMethod:"inline",keySalt:a[0],lifeTime:a[1],mkiValue:a[2]?a[2].split(":")[0]:void 0,mkiLength:a[2]?a[2].split(":")[1]:void 0}},t.writeCryptoKeyParams=function(i){return i.keyMethod+":"+i.keySalt+(i.lifeTime?"|"+i.lifeTime:"")+(i.mkiValue&&i.mkiLength?"|"+i.mkiValue+":"+i.mkiLength:"")},t.getCryptoParameters=function(i,a){return t.matchPrefix(i+a,"a=crypto:").map(t.parseCryptoLine)},t.getIceParameters=function(i,a){const o=t.matchPrefix(i+a,"a=ice-ufrag:")[0],l=t.matchPrefix(i+a,"a=ice-pwd:")[0];return o&&l?{usernameFragment:o.substring(12),password:l.substring(10)}:null},t.writeIceParameters=function(i){let a="a=ice-ufrag:"+i.usernameFragment+`\r
a=ice-pwd:`+i.password+`\r
`;return i.iceLite&&(a+=`a=ice-lite\r
`),a},t.parseRtpParameters=function(i){const a={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},l=t.splitLines(i)[0].split(" ");a.profile=l[2];for(let u=3;u<l.length;u++){const m=l[u],p=t.matchPrefix(i,"a=rtpmap:"+m+" ")[0];if(p){const g=t.parseRtpMap(p),v=t.matchPrefix(i,"a=fmtp:"+m+" ");switch(g.parameters=v.length?t.parseFmtp(v[0]):{},g.rtcpFeedback=t.matchPrefix(i,"a=rtcp-fb:"+m+" ").map(t.parseRtcpFb),a.codecs.push(g),g.name.toUpperCase()){case"RED":case"ULPFEC":a.fecMechanisms.push(g.name.toUpperCase());break}}}t.matchPrefix(i,"a=extmap:").forEach(u=>{a.headerExtensions.push(t.parseExtmap(u))});const f=t.matchPrefix(i,"a=rtcp-fb:* ").map(t.parseRtcpFb);return a.codecs.forEach(u=>{f.forEach(m=>{u.rtcpFeedback.find(g=>g.type===m.type&&g.parameter===m.parameter)||u.rtcpFeedback.push(m)})}),a},t.writeRtpDescription=function(i,a){let o="";o+="m="+i+" ",o+=a.codecs.length>0?"9":"0",o+=" "+(a.profile||"UDP/TLS/RTP/SAVPF")+" ",o+=a.codecs.map(f=>f.preferredPayloadType!==void 0?f.preferredPayloadType:f.payloadType).join(" ")+`\r
`,o+=`c=IN IP4 0.0.0.0\r
`,o+=`a=rtcp:9 IN IP4 0.0.0.0\r
`,a.codecs.forEach(f=>{o+=t.writeRtpMap(f),o+=t.writeFmtp(f),o+=t.writeRtcpFb(f)});let l=0;return a.codecs.forEach(f=>{f.maxptime>l&&(l=f.maxptime)}),l>0&&(o+="a=maxptime:"+l+`\r
`),a.headerExtensions&&a.headerExtensions.forEach(f=>{o+=t.writeExtmap(f)}),o},t.parseRtpEncodingParameters=function(i){const a=[],o=t.parseRtpParameters(i),l=o.fecMechanisms.indexOf("RED")!==-1,f=o.fecMechanisms.indexOf("ULPFEC")!==-1,u=t.matchPrefix(i,"a=ssrc:").map(S=>t.parseSsrcMedia(S)).filter(S=>S.attribute==="cname"),m=u.length>0&&u[0].ssrc;let p;const g=t.matchPrefix(i,"a=ssrc-group:FID").map(S=>S.substring(17).split(" ").map(O=>parseInt(O,10)));g.length>0&&g[0].length>1&&g[0][0]===m&&(p=g[0][1]),o.codecs.forEach(S=>{if(S.name.toUpperCase()==="RTX"&&S.parameters.apt){let k={ssrc:m,codecPayloadType:parseInt(S.parameters.apt,10)};m&&p&&(k.rtx={ssrc:p}),a.push(k),l&&(k=JSON.parse(JSON.stringify(k)),k.fec={ssrc:m,mechanism:f?"red+ulpfec":"red"},a.push(k))}}),a.length===0&&m&&a.push({ssrc:m});let v=t.matchPrefix(i,"b=");return v.length&&(v[0].indexOf("b=TIAS:")===0?v=parseInt(v[0].substring(7),10):v[0].indexOf("b=AS:")===0?v=parseInt(v[0].substring(5),10)*1e3*.95-2e3*8:v=void 0,a.forEach(S=>{S.maxBitrate=v})),a},t.parseRtcpParameters=function(i){const a={},o=t.matchPrefix(i,"a=ssrc:").map(u=>t.parseSsrcMedia(u)).filter(u=>u.attribute==="cname")[0];o&&(a.cname=o.value,a.ssrc=o.ssrc);const l=t.matchPrefix(i,"a=rtcp-rsize");a.reducedSize=l.length>0,a.compound=l.length===0;const f=t.matchPrefix(i,"a=rtcp-mux");return a.mux=f.length>0,a},t.writeRtcpParameters=function(i){let a="";return i.reducedSize&&(a+=`a=rtcp-rsize\r
`),i.mux&&(a+=`a=rtcp-mux\r
`),i.ssrc!==void 0&&i.cname&&(a+="a=ssrc:"+i.ssrc+" cname:"+i.cname+`\r
`),a},t.parseMsid=function(i){let a;const o=t.matchPrefix(i,"a=msid:");if(o.length===1)return a=o[0].substring(7).split(" "),{stream:a[0],track:a[1]};const l=t.matchPrefix(i,"a=ssrc:").map(f=>t.parseSsrcMedia(f)).filter(f=>f.attribute==="msid");if(l.length>0)return a=l[0].value.split(" "),{stream:a[0],track:a[1]}},t.parseSctpDescription=function(i){const a=t.parseMLine(i),o=t.matchPrefix(i,"a=max-message-size:");let l;o.length>0&&(l=parseInt(o[0].substring(19),10)),isNaN(l)&&(l=65536);const f=t.matchPrefix(i,"a=sctp-port:");if(f.length>0)return{port:parseInt(f[0].substring(12),10),protocol:a.fmt,maxMessageSize:l};const u=t.matchPrefix(i,"a=sctpmap:");if(u.length>0){const m=u[0].substring(10).split(" ");return{port:parseInt(m[0],10),protocol:m[1],maxMessageSize:l}}},t.writeSctpDescription=function(i,a){let o=[];return i.protocol!=="DTLS/SCTP"?o=["m="+i.kind+" 9 "+i.protocol+" "+a.protocol+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctp-port:"+a.port+`\r
`]:o=["m="+i.kind+" 9 "+i.protocol+" "+a.port+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctpmap:"+a.port+" "+a.protocol+` 65535\r
`],a.maxMessageSize!==void 0&&o.push("a=max-message-size:"+a.maxMessageSize+`\r
`),o.join("")},t.generateSessionId=function(){return Math.random().toString().substr(2,22)},t.writeSessionBoilerplate=function(i,a,o){let l;const f=a!==void 0?a:2;return i?l=i:l=t.generateSessionId(),`v=0\r
o=`+(o||"thisisadapterortc")+" "+l+" "+f+` IN IP4 127.0.0.1\r
s=-\r
t=0 0\r
`},t.getDirection=function(i,a){const o=t.splitLines(i);for(let l=0;l<o.length;l++)switch(o[l]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return o[l].substring(2)}return a?t.getDirection(a):"sendrecv"},t.getKind=function(i){return t.splitLines(i)[0].split(" ")[0].substring(2)},t.isRejected=function(i){return i.split(" ",2)[1]==="0"},t.parseMLine=function(i){const o=t.splitLines(i)[0].substring(2).split(" ");return{kind:o[0],port:parseInt(o[1],10),protocol:o[2],fmt:o.slice(3).join(" ")}},t.parseOLine=function(i){const o=t.matchPrefix(i,"o=")[0].substring(2).split(" ");return{username:o[0],sessionId:o[1],sessionVersion:parseInt(o[2],10),netType:o[3],addressType:o[4],address:o[5]}},t.isValidSDP=function(i){if(typeof i!="string"||i.length===0)return!1;const a=t.splitLines(i);for(let o=0;o<a.length;o++)if(a[o].length<2||a[o].charAt(1)!=="=")return!1;return!0},r.exports=t})(sd)),sd.exports}var ry=yk(),cs=rk(ry),bk=AT({__proto__:null,default:cs},[ry]);function sc(r){if(!r.RTCIceCandidate||r.RTCIceCandidate&&"foundation"in r.RTCIceCandidate.prototype)return;const t=r.RTCIceCandidate;r.RTCIceCandidate=function(a){if(typeof a=="object"&&a.candidate&&a.candidate.indexOf("a=")===0&&(a=JSON.parse(JSON.stringify(a)),a.candidate=a.candidate.substring(2)),a.candidate&&a.candidate.length){const o=new t(a),l=cs.parseCandidate(a.candidate);for(const f in l)f in o||Object.defineProperty(o,f,{value:l[f]});return o.toJSON=function(){return{candidate:o.candidate,sdpMid:o.sdpMid,sdpMLineIndex:o.sdpMLineIndex,usernameFragment:o.usernameFragment}},o}return new t(a)},r.RTCIceCandidate.prototype=t.prototype,ga(r,"icecandidate",i=>(i.candidate&&Object.defineProperty(i,"candidate",{value:new r.RTCIceCandidate(i.candidate),writable:"false"}),i))}function Dd(r){!r.RTCIceCandidate||r.RTCIceCandidate&&"relayProtocol"in r.RTCIceCandidate.prototype||ga(r,"icecandidate",t=>{if(t.candidate){const i=cs.parseCandidate(t.candidate.candidate);i.type==="relay"&&(t.candidate.relayProtocol={0:"tls",1:"tcp",2:"udp"}[i.priority>>24])}return t})}function rc(r,t){if(!r.RTCPeerConnection)return;"sctp"in r.RTCPeerConnection.prototype||Object.defineProperty(r.RTCPeerConnection.prototype,"sctp",{get(){return typeof this._sctp>"u"?null:this._sctp}});const i=function(u){if(!u||!u.sdp)return!1;const m=cs.splitSections(u.sdp);return m.shift(),m.some(p=>{const g=cs.parseMLine(p);return g&&g.kind==="application"&&g.protocol.indexOf("SCTP")!==-1})},a=function(u){const m=u.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);if(m===null||m.length<2)return-1;const p=parseInt(m[1],10);return p!==p?-1:p},o=function(u){let m=65536;return t.browser==="firefox"&&(t.version<57?u===-1?m=16384:m=2147483637:t.version<60?m=t.version===57?65535:65536:m=2147483637),m},l=function(u,m){let p=65536;t.browser==="firefox"&&t.version===57&&(p=65535);const g=cs.matchPrefix(u.sdp,"a=max-message-size:");return g.length>0?p=parseInt(g[0].substring(19),10):t.browser==="firefox"&&m!==-1&&(p=2147483637),p},f=r.RTCPeerConnection.prototype.setRemoteDescription;r.RTCPeerConnection.prototype.setRemoteDescription=function(){if(this._sctp=null,t.browser==="chrome"&&t.version>=76){const{sdpSemantics:m}=this.getConfiguration();m==="plan-b"&&Object.defineProperty(this,"sctp",{get(){return typeof this._sctp>"u"?null:this._sctp},enumerable:!0,configurable:!0})}if(i(arguments[0])){const m=a(arguments[0]),p=o(m),g=l(arguments[0],m);let v;p===0&&g===0?v=Number.POSITIVE_INFINITY:p===0||g===0?v=Math.max(p,g):v=Math.min(p,g);const S={};Object.defineProperty(S,"maxMessageSize",{get(){return v}}),this._sctp=S}return f.apply(this,arguments)}}function oc(r){if(!(r.RTCPeerConnection&&"createDataChannel"in r.RTCPeerConnection.prototype))return;function t(a,o){const l=a.send;a.send=function(){const u=arguments[0],m=u.length||u.size||u.byteLength;if(a.readyState==="open"&&o.sctp&&m>o.sctp.maxMessageSize)throw new TypeError("Message too large (can send a maximum of "+o.sctp.maxMessageSize+" bytes)");return l.apply(a,arguments)}}const i=r.RTCPeerConnection.prototype.createDataChannel;r.RTCPeerConnection.prototype.createDataChannel=function(){const o=i.apply(this,arguments);return t(o,this),o},ga(r,"datachannel",a=>(t(a.channel,a.target),a))}function Md(r){if(!r.RTCPeerConnection||"connectionState"in r.RTCPeerConnection.prototype)return;const t=r.RTCPeerConnection.prototype;Object.defineProperty(t,"connectionState",{get(){return{completed:"connected",checking:"connecting"}[this.iceConnectionState]||this.iceConnectionState},enumerable:!0,configurable:!0}),Object.defineProperty(t,"onconnectionstatechange",{get(){return this._onconnectionstatechange||null},set(i){this._onconnectionstatechange&&(this.removeEventListener("connectionstatechange",this._onconnectionstatechange),delete this._onconnectionstatechange),i&&this.addEventListener("connectionstatechange",this._onconnectionstatechange=i)},enumerable:!0,configurable:!0}),["setLocalDescription","setRemoteDescription"].forEach(i=>{const a=t[i];t[i]=function(){return this._connectionstatechangepoly||(this._connectionstatechangepoly=o=>{const l=o.target;if(l._lastConnectionState!==l.connectionState){l._lastConnectionState=l.connectionState;const f=new Event("connectionstatechange",o);l.dispatchEvent(f)}return o},this.addEventListener("iceconnectionstatechange",this._connectionstatechangepoly)),a.apply(this,arguments)}})}function wd(r,t){if(!r.RTCPeerConnection||t.browser==="chrome"&&t.version>=71||t.browser==="safari"&&t._safariVersion>=13.1)return;const i=r.RTCPeerConnection.prototype.setRemoteDescription;r.RTCPeerConnection.prototype.setRemoteDescription=function(o){if(o&&o.sdp&&o.sdp.indexOf(`
a=extmap-allow-mixed`)!==-1){const l=o.sdp.split(`
`).filter(f=>f.trim()!=="a=extmap-allow-mixed").join(`
`);r.RTCSessionDescription&&o instanceof r.RTCSessionDescription?arguments[0]=new r.RTCSessionDescription({type:o.type,sdp:l}):o.sdp=l}return i.apply(this,arguments)}}function cc(r,t){if(!(r.RTCPeerConnection&&r.RTCPeerConnection.prototype))return;const i=r.RTCPeerConnection.prototype.addIceCandidate;!i||i.length===0||(r.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?(t.browser==="chrome"&&t.version<78||t.browser==="firefox"&&t.version<68||t.browser==="safari")&&arguments[0]&&arguments[0].candidate===""?Promise.resolve():i.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Promise.resolve())})}function lc(r,t){if(!(r.RTCPeerConnection&&r.RTCPeerConnection.prototype))return;const i=r.RTCPeerConnection.prototype.setLocalDescription;!i||i.length===0||(r.RTCPeerConnection.prototype.setLocalDescription=function(){let o=arguments[0]||{};if(typeof o!="object"||o.type&&o.sdp)return i.apply(this,arguments);if(o={type:o.type,sdp:o.sdp},!o.type)switch(this.signalingState){case"stable":case"have-local-offer":case"have-remote-pranswer":o.type="offer";break;default:o.type="answer";break}return o.sdp||o.type!=="offer"&&o.type!=="answer"?i.apply(this,[o]):(o.type==="offer"?this.createOffer:this.createAnswer).apply(this).then(f=>i.apply(this,[f]))})}var Sk=Object.freeze({__proto__:null,removeExtmapAllowMixed:wd,shimAddIceCandidateNullOrEmpty:cc,shimConnectionState:Md,shimMaxMessageSize:rc,shimParameterlessSetLocalDescription:lc,shimRTCIceCandidate:sc,shimRTCIceCandidateRelayProtocol:Dd,shimSendThrowTypeError:oc});function Tk(){let{window:r}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{shimChrome:!0,shimFirefox:!0,shimSafari:!0};const i=w0,a=gk(r),o={browserDetails:a,commonShim:Sk,extractVersion:br,disableLog:mk,disableWarnings:pk,sdp:bk};switch(a.browser){case"chrome":if(!tv||!Od||!t.shimChrome)return i("Chrome shim is not included in this adapter release."),o;if(a.version===null)return i("Chrome shim can not determine version, not shimming."),o;i("adapter.js shimming chrome."),o.browserShim=tv,cc(r,a),lc(r),N0(r,a),P0(r),Od(r,a),U0(r),B0(r,a),L0(r),I0(r),z0(r,a),sc(r),Dd(r),Md(r),rc(r,a),oc(r),wd(r,a);break;case"firefox":if(!nv||!Ad||!t.shimFirefox)return i("Firefox shim is not included in this adapter release."),o;i("adapter.js shimming firefox."),o.browserShim=nv,cc(r,a),lc(r),q0(r,a),Ad(r,a),V0(r),G0(r),H0(r),F0(r),K0(r),Y0(r),Q0(r),J0(r),X0(r),sc(r),Md(r),rc(r,a),oc(r);break;case"safari":if(!iv||!t.shimSafari)return i("Safari shim is not included in this adapter release."),o;i("adapter.js shimming safari."),o.browserShim=iv,cc(r,a),lc(r),ny(r),ay(r),$0(r),Z0(r),W0(r),iy(r),ey(r),sy(r),sc(r),Dd(r),rc(r,a),oc(r),wd(r,a);break;default:i("Unsupported browser!");break}return o}Tk({window:typeof window>"u"?void 0:window});class Ht extends Promise{constructor(t){super(t)}catch(t){return super.catch(t)}static reject(t){return super.reject(t)}static all(t){return super.all(t)}static race(t){return super.race(t)}}const Ck=/version\/(\d+(\.?_?\d+)+)/i;let rd;function Gt(r){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;if(typeof navigator>"u")return;const i=navigator.userAgent.toLowerCase();if(rd===void 0||t){const a=kk.find(o=>{let{test:l}=o;return l.test(i)});rd=a==null?void 0:a.describe(i)}return rd}const kk=[{test:/firefox|iceweasel|fxios/i,describe(r){return{name:"Firefox",version:uc(/(?:firefox|iceweasel|fxios)[\s/](\d+(\.?_?\d+)+)/i,r),os:r.toLowerCase().includes("fxios")?"iOS":void 0,osVersion:od(r)}}},{test:/chrom|crios|crmo/i,describe(r){return{name:"Chrome",version:uc(/(?:chrome|chromium|crios|crmo)\/(\d+(\.?_?\d+)+)/i,r),os:r.toLowerCase().includes("crios")?"iOS":void 0,osVersion:od(r)}}},{test:/safari|applewebkit/i,describe(r){return{name:"Safari",version:uc(Ck,r),os:r.includes("mobile/")?"iOS":"macOS",osVersion:od(r)}}}];function uc(r,t){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1;const a=t.match(r);return a&&a.length>=i&&a[i]||""}function od(r){return r.includes("mac os")?uc(/\(.+?(\d+_\d+(:?_\d+)?)/,r,1).replace(/_/g,"."):void 0}var Ek="2.17.0";const _k=Ek,Rk=16;class In extends Error{constructor(t,i){super(i||"an error has occured"),this.name="LiveKitError",this.code=t}}var Ke;(function(r){r[r.NotAllowed=0]="NotAllowed",r[r.ServerUnreachable=1]="ServerUnreachable",r[r.InternalError=2]="InternalError",r[r.Cancelled=3]="Cancelled",r[r.LeaveRequest=4]="LeaveRequest",r[r.Timeout=5]="Timeout",r[r.WebSocket=6]="WebSocket",r[r.ServiceNotFound=7]="ServiceNotFound"})(Ke||(Ke={}));class he extends In{constructor(t,i,a,o){super(1,t),this.name="ConnectionError",this.status=a,this.reason=i,this.context=o,this.reasonName=Ke[i]}static notAllowed(t,i,a){return new he(t,Ke.NotAllowed,i,a)}static timeout(t){return new he(t,Ke.Timeout)}static leaveRequest(t,i){return new he(t,Ke.LeaveRequest,void 0,i)}static internal(t,i){return new he(t,Ke.InternalError,void 0,i)}static cancelled(t){return new he(t,Ke.Cancelled)}static serverUnreachable(t,i){return new he(t,Ke.ServerUnreachable,i)}static websocket(t,i,a){return new he(t,Ke.WebSocket,i,a)}static serviceNotFound(t,i){return new he(t,Ke.ServiceNotFound,void 0,i)}}class cf extends In{constructor(t){super(21,t??"device is unsupported"),this.name="DeviceUnsupportedError"}}class oi extends In{constructor(t){super(20,t??"track is invalid"),this.name="TrackInvalidError"}}class Ok extends In{constructor(t){super(10,t??"unsupported server"),this.name="UnsupportedServer"}}class rt extends In{constructor(t){super(12,t??"unexpected connection state"),this.name="UnexpectedConnectionState"}}class ls extends In{constructor(t){super(13,t??"unable to negotiate"),this.name="NegotiationError"}}class sv extends In{constructor(t,i){super(15,t),this.name="PublishTrackError",this.status=i}}class rv extends In{constructor(t,i){super(15,t),this.name="SignalRequestError",this.reason=i,this.reasonName=typeof i=="string"?i:rf[i]}}var Mt;(function(r){r[r.AlreadyOpened=0]="AlreadyOpened",r[r.AbnormalEnd=1]="AbnormalEnd",r[r.DecodeFailed=2]="DecodeFailed",r[r.LengthExceeded=3]="LengthExceeded",r[r.Incomplete=4]="Incomplete",r[r.HandlerAlreadyRegistered=7]="HandlerAlreadyRegistered",r[r.EncryptionTypeMismatch=8]="EncryptionTypeMismatch"})(Mt||(Mt={}));class pn extends In{constructor(t,i){super(16,t),this.name="DataStreamError",this.reason=i,this.reasonName=Mt[i]}}class ns extends In{constructor(t){super(18,t),this.name="SignalReconnectError"}}var bc;(function(r){r.PermissionDenied="PermissionDenied",r.NotFound="NotFound",r.DeviceInUse="DeviceInUse",r.Other="Other"})(bc||(bc={}));(function(r){function t(i){if(i&&"name"in i)return i.name==="NotFoundError"||i.name==="DevicesNotFoundError"?r.NotFound:i.name==="NotAllowedError"||i.name==="PermissionDeniedError"?r.PermissionDenied:i.name==="NotReadableError"||i.name==="TrackStartError"?r.DeviceInUse:r.Other}r.getFailure=t})(bc||(bc={}));class _t{}_t.setTimeout=function(){return setTimeout(...arguments)};_t.setInterval=function(){return setInterval(...arguments)};_t.clearTimeout=function(){return clearTimeout(...arguments)};_t.clearInterval=function(){return clearInterval(...arguments)};var J;(function(r){r.Connected="connected",r.Reconnecting="reconnecting",r.SignalReconnecting="signalReconnecting",r.Reconnected="reconnected",r.Disconnected="disconnected",r.ConnectionStateChanged="connectionStateChanged",r.Moved="moved",r.MediaDevicesChanged="mediaDevicesChanged",r.ParticipantConnected="participantConnected",r.ParticipantDisconnected="participantDisconnected",r.TrackPublished="trackPublished",r.TrackSubscribed="trackSubscribed",r.TrackSubscriptionFailed="trackSubscriptionFailed",r.TrackUnpublished="trackUnpublished",r.TrackUnsubscribed="trackUnsubscribed",r.TrackMuted="trackMuted",r.TrackUnmuted="trackUnmuted",r.LocalTrackPublished="localTrackPublished",r.LocalTrackUnpublished="localTrackUnpublished",r.LocalAudioSilenceDetected="localAudioSilenceDetected",r.ActiveSpeakersChanged="activeSpeakersChanged",r.ParticipantMetadataChanged="participantMetadataChanged",r.ParticipantNameChanged="participantNameChanged",r.ParticipantAttributesChanged="participantAttributesChanged",r.ParticipantActive="participantActive",r.RoomMetadataChanged="roomMetadataChanged",r.DataReceived="dataReceived",r.SipDTMFReceived="sipDTMFReceived",r.TranscriptionReceived="transcriptionReceived",r.ConnectionQualityChanged="connectionQualityChanged",r.TrackStreamStateChanged="trackStreamStateChanged",r.TrackSubscriptionPermissionChanged="trackSubscriptionPermissionChanged",r.TrackSubscriptionStatusChanged="trackSubscriptionStatusChanged",r.AudioPlaybackStatusChanged="audioPlaybackChanged",r.VideoPlaybackStatusChanged="videoPlaybackChanged",r.MediaDevicesError="mediaDevicesError",r.ParticipantPermissionsChanged="participantPermissionsChanged",r.SignalConnected="signalConnected",r.RecordingStatusChanged="recordingStatusChanged",r.ParticipantEncryptionStatusChanged="participantEncryptionStatusChanged",r.EncryptionError="encryptionError",r.DCBufferStatusChanged="dcBufferStatusChanged",r.ActiveDeviceChanged="activeDeviceChanged",r.ChatMessage="chatMessage",r.LocalTrackSubscribed="localTrackSubscribed",r.MetricsReceived="metricsReceived"})(J||(J={}));var ee;(function(r){r.TrackPublished="trackPublished",r.TrackSubscribed="trackSubscribed",r.TrackSubscriptionFailed="trackSubscriptionFailed",r.TrackUnpublished="trackUnpublished",r.TrackUnsubscribed="trackUnsubscribed",r.TrackMuted="trackMuted",r.TrackUnmuted="trackUnmuted",r.LocalTrackPublished="localTrackPublished",r.LocalTrackUnpublished="localTrackUnpublished",r.LocalTrackCpuConstrained="localTrackCpuConstrained",r.LocalSenderCreated="localSenderCreated",r.ParticipantMetadataChanged="participantMetadataChanged",r.ParticipantNameChanged="participantNameChanged",r.DataReceived="dataReceived",r.SipDTMFReceived="sipDTMFReceived",r.TranscriptionReceived="transcriptionReceived",r.IsSpeakingChanged="isSpeakingChanged",r.ConnectionQualityChanged="connectionQualityChanged",r.TrackStreamStateChanged="trackStreamStateChanged",r.TrackSubscriptionPermissionChanged="trackSubscriptionPermissionChanged",r.TrackSubscriptionStatusChanged="trackSubscriptionStatusChanged",r.TrackCpuConstrained="trackCpuConstrained",r.MediaDevicesError="mediaDevicesError",r.AudioStreamAcquired="audioStreamAcquired",r.ParticipantPermissionsChanged="participantPermissionsChanged",r.PCTrackAdded="pcTrackAdded",r.AttributesChanged="attributesChanged",r.LocalTrackSubscribed="localTrackSubscribed",r.ChatMessage="chatMessage",r.Active="active"})(ee||(ee={}));var $;(function(r){r.TransportsCreated="transportsCreated",r.Connected="connected",r.Disconnected="disconnected",r.Resuming="resuming",r.Resumed="resumed",r.Restarting="restarting",r.Restarted="restarted",r.SignalResumed="signalResumed",r.SignalRestarted="signalRestarted",r.Closing="closing",r.MediaTrackAdded="mediaTrackAdded",r.ActiveSpeakersUpdate="activeSpeakersUpdate",r.DataPacketReceived="dataPacketReceived",r.RTPVideoMapUpdate="rtpVideoMapUpdate",r.DCBufferStatusChanged="dcBufferStatusChanged",r.ParticipantUpdate="participantUpdate",r.RoomUpdate="roomUpdate",r.SpeakersChanged="speakersChanged",r.StreamStateChanged="streamStateChanged",r.ConnectionQualityUpdate="connectionQualityUpdate",r.SubscriptionError="subscriptionError",r.SubscriptionPermissionUpdate="subscriptionPermissionUpdate",r.RemoteMute="remoteMute",r.SubscribedQualityUpdate="subscribedQualityUpdate",r.LocalTrackUnpublished="localTrackUnpublished",r.LocalTrackSubscribed="localTrackSubscribed",r.Offline="offline",r.SignalRequestResponse="signalRequestResponse",r.SignalConnected="signalConnected",r.RoomMoved="roomMoved"})($||($={}));var X;(function(r){r.Message="message",r.Muted="muted",r.Unmuted="unmuted",r.Restarted="restarted",r.Ended="ended",r.Subscribed="subscribed",r.Unsubscribed="unsubscribed",r.CpuConstrained="cpuConstrained",r.UpdateSettings="updateSettings",r.UpdateSubscription="updateSubscription",r.AudioPlaybackStarted="audioPlaybackStarted",r.AudioPlaybackFailed="audioPlaybackFailed",r.AudioSilenceDetected="audioSilenceDetected",r.VisibilityChanged="visibilityChanged",r.VideoDimensionsChanged="videoDimensionsChanged",r.VideoPlaybackStarted="videoPlaybackStarted",r.VideoPlaybackFailed="videoPlaybackFailed",r.ElementAttached="elementAttached",r.ElementDetached="elementDetached",r.UpstreamPaused="upstreamPaused",r.UpstreamResumed="upstreamResumed",r.SubscriptionPermissionChanged="subscriptionPermissionChanged",r.SubscriptionStatusChanged="subscriptionStatusChanged",r.SubscriptionFailed="subscriptionFailed",r.TrackProcessorUpdate="trackProcessorUpdate",r.AudioTrackFeatureUpdate="audioTrackFeatureUpdate",r.TranscriptionReceived="transcriptionReceived",r.TimeSyncUpdate="timeSyncUpdate",r.PreConnectBufferFlushed="preConnectBufferFlushed"})(X||(X={}));function Ak(r){return typeof r>"u"?r:typeof structuredClone=="function"?typeof r=="object"&&r!==null?structuredClone(Object.assign({},r)):structuredClone(r):JSON.parse(JSON.stringify(r))}class He{constructor(t,i,a,o,l){if(typeof t=="object")this.width=t.width,this.height=t.height,this.aspectRatio=t.aspectRatio,this.encoding={maxBitrate:t.maxBitrate,maxFramerate:t.maxFramerate,priority:t.priority};else if(i!==void 0&&a!==void 0)this.width=t,this.height=i,this.aspectRatio=t/i,this.encoding={maxBitrate:a,maxFramerate:o,priority:l};else throw new TypeError("Unsupported options: provide at least width, height and maxBitrate")}get resolution(){return{width:this.width,height:this.height,frameRate:this.encoding.maxFramerate,aspectRatio:this.aspectRatio}}}const Dk=["vp8","h264"],Mk=["vp8","h264","vp9","av1","h265"];function wk(r){return!!Dk.find(t=>t===r)}const xk=wk;var ov;(function(r){r[r.PREFER_REGRESSION=0]="PREFER_REGRESSION",r[r.SIMULCAST=1]="SIMULCAST",r[r.REGRESSION=2]="REGRESSION"})(ov||(ov={}));var xd;(function(r){r.telephone={maxBitrate:12e3},r.speech={maxBitrate:24e3},r.music={maxBitrate:48e3},r.musicStereo={maxBitrate:64e3},r.musicHighQuality={maxBitrate:96e3},r.musicHighQualityStereo={maxBitrate:128e3}})(xd||(xd={}));const Or={h90:new He(160,90,9e4,20),h180:new He(320,180,16e4,20),h216:new He(384,216,18e4,20),h360:new He(640,360,45e4,20),h540:new He(960,540,8e5,25),h720:new He(1280,720,17e5,30),h1080:new He(1920,1080,3e6,30),h1440:new He(2560,1440,5e6,30),h2160:new He(3840,2160,8e6,30)},Nd={h120:new He(160,120,7e4,20),h180:new He(240,180,125e3,20),h240:new He(320,240,14e4,20),h360:new He(480,360,33e4,20),h480:new He(640,480,5e5,20),h540:new He(720,540,6e5,25),h720:new He(960,720,13e5,30),h1080:new He(1440,1080,23e5,30),h1440:new He(1920,1440,38e5,30)},lf={h360fps3:new He(640,360,2e5,3,"medium"),h360fps15:new He(640,360,4e5,15,"medium"),h720fps5:new He(1280,720,8e5,5,"medium"),h720fps15:new He(1280,720,15e5,15,"medium"),h720fps30:new He(1280,720,2e6,30,"medium"),h1080fps15:new He(1920,1080,25e5,15,"medium"),h1080fps30:new He(1920,1080,5e6,30,"medium"),original:new He(0,0,7e6,30,"medium")};function oy(r,t,i){var a,o,l,f;const{optionsWithoutProcessor:u,audioProcessor:m,videoProcessor:p}=uy(r??{}),g=t==null?void 0:t.processor,v=i==null?void 0:i.processor,S=u??{};return S.audio===!0&&(S.audio={}),S.video===!0&&(S.video={}),S.audio&&(Pd(S.audio,t),(a=(l=S.audio).deviceId)!==null&&a!==void 0||(l.deviceId={ideal:"default"}),(m||g)&&(S.audio.processor=m??g)),S.video&&(Pd(S.video,i),(o=(f=S.video).deviceId)!==null&&o!==void 0||(f.deviceId={ideal:"default"}),(p||v)&&(S.video.processor=p??v)),S}function Pd(r,t){return Object.keys(t).forEach(i=>{r[i]===void 0&&(r[i]=t[i])}),r}function uf(r){var t,i,a,o;const l={};if(r.video)if(typeof r.video=="object"){const f={},u=f,m=r.video;Object.keys(m).forEach(p=>{switch(p){case"resolution":Pd(u,m.resolution);break;default:u[p]=m[p]}}),l.video=f,(t=(a=l.video).deviceId)!==null&&t!==void 0||(a.deviceId={ideal:"default"})}else l.video=r.video?{deviceId:{ideal:"default"}}:!1;else l.video=!1;return r.audio?typeof r.audio=="object"?(l.audio=r.audio,(i=(o=l.audio).deviceId)!==null&&i!==void 0||(o.deviceId={ideal:"default"})):l.audio={deviceId:{ideal:"default"}}:l.audio=!1,l}function cy(r){return T(this,arguments,void 0,function(t){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:200;return(function*(){const a=ly();if(a){const o=a.createAnalyser();o.fftSize=2048;const l=o.frequencyBinCount,f=new Uint8Array(l);a.createMediaStreamSource(new MediaStream([t.mediaStreamTrack])).connect(o),yield Rt(i),o.getByteTimeDomainData(f);const m=f.some(p=>p!==128&&p!==0);return a.close(),!m}return!1})()})}function ly(){var r;const t=typeof window<"u"&&(window.AudioContext||window.webkitAudioContext);if(t){const i=new t({latencyHint:"interactive"});if(i.state==="suspended"&&typeof window<"u"&&(!((r=window.document)===null||r===void 0)&&r.body)){const a=()=>T(this,void 0,void 0,function*(){var o;try{i.state==="suspended"&&(yield i.resume())}catch(l){console.warn("Error trying to auto-resume audio context",l)}finally{(o=window.document.body)===null||o===void 0||o.removeEventListener("click",a)}});i.addEventListener("statechange",()=>{var o;i.state==="closed"&&((o=window.document.body)===null||o===void 0||o.removeEventListener("click",a))}),window.document.body.addEventListener("click",a)}return i}}function Nk(r){return r==="audioinput"?G.Source.Microphone:r==="videoinput"?G.Source.Camera:G.Source.Unknown}function Ud(r){return r===G.Source.Microphone?"audioinput":r===G.Source.Camera?"videoinput":void 0}function Pk(r){var t,i;let a=(t=r.video)!==null&&t!==void 0?t:!0;return r.resolution&&r.resolution.width>0&&r.resolution.height>0&&(a=typeof a=="boolean"?{}:a,pa()?a=Object.assign(Object.assign({},a),{width:{max:r.resolution.width},height:{max:r.resolution.height},frameRate:r.resolution.frameRate}):a=Object.assign(Object.assign({},a),{width:{ideal:r.resolution.width},height:{ideal:r.resolution.height},frameRate:r.resolution.frameRate})),{audio:(i=r.audio)!==null&&i!==void 0?i:!1,video:a,controller:r.controller,selfBrowserSurface:r.selfBrowserSurface,surfaceSwitching:r.surfaceSwitching,systemAudio:r.systemAudio,preferCurrentTab:r.preferCurrentTab}}function Cr(r){return r.split("/")[1].toLowerCase()}function Uk(r){const t=[];return r.forEach(i=>{i.track!==void 0&&t.push(new ef({cid:i.track.mediaStreamID,track:i.trackInfo}))}),t}function Ee(r){return"mediaStreamTrack"in r?{trackID:r.sid,source:r.source,muted:r.isMuted,enabled:r.mediaStreamTrack.enabled,kind:r.kind,streamID:r.mediaStreamID,streamTrackID:r.mediaStreamTrack.id}:{trackID:r.trackSid,enabled:r.isEnabled,muted:r.isMuted,trackInfo:Object.assign({mimeType:r.mimeType,name:r.trackName,encrypted:r.isEncrypted,kind:r.kind,source:r.source},r.track?Ee(r.track):{})}}function Lk(){return typeof RTCRtpReceiver<"u"&&"getSynchronizationSources"in RTCRtpReceiver}function Ik(r,t){var i;r===void 0&&(r={}),t===void 0&&(t={});const a=[...Object.keys(t),...Object.keys(r)],o={};for(const l of a)r[l]!==t[l]&&(o[l]=(i=t[l])!==null&&i!==void 0?i:"");return o}function uy(r){const t=Object.assign({},r);let i,a;return typeof t.audio=="object"&&t.audio.processor&&(i=t.audio.processor,t.audio=Object.assign(Object.assign({},t.audio),{processor:void 0})),typeof t.video=="object"&&t.video.processor&&(a=t.video.processor,t.video=Object.assign(Object.assign({},t.video),{processor:void 0})),{audioProcessor:i,videoProcessor:a,optionsWithoutProcessor:Ak(t)}}function jk(r){switch(r){case ft.CAMERA:return G.Source.Camera;case ft.MICROPHONE:return G.Source.Microphone;case ft.SCREEN_SHARE:return G.Source.ScreenShare;case ft.SCREEN_SHARE_AUDIO:return G.Source.ScreenShareAudio;default:return G.Source.Unknown}}function cv(r,t){return r.width*r.height<t.width*t.height}function Bk(r,t){var i;return(i=r.layers)===null||i===void 0?void 0:i.find(a=>a.quality===t)}const zk=5e3,mr=[];var nn;(function(r){r[r.LOW=0]="LOW",r[r.MEDIUM=1]="MEDIUM",r[r.HIGH=2]="HIGH"})(nn||(nn={}));class G extends Ln.EventEmitter{get streamState(){return this._streamState}setStreamState(t){this._streamState=t}constructor(t,i){let a=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};var o;super(),this.attachedElements=[],this.isMuted=!1,this._streamState=G.StreamState.Active,this.isInBackground=!1,this._currentBitrate=0,this.log=Se,this.appVisibilityChangedListener=()=>{this.backgroundTimeout&&clearTimeout(this.backgroundTimeout),document.visibilityState==="hidden"?this.backgroundTimeout=setTimeout(()=>this.handleAppVisibilityChanged(),zk):this.handleAppVisibilityChanged()},this.log=ci((o=a.loggerName)!==null&&o!==void 0?o:Rn.Track),this.loggerContextCb=a.loggerContextCb,this.setMaxListeners(100),this.kind=i,this._mediaStreamTrack=t,this._mediaStreamID=t.id,this.source=G.Source.Unknown}get logContext(){var t;return Object.assign(Object.assign({},(t=this.loggerContextCb)===null||t===void 0?void 0:t.call(this)),Ee(this))}get currentBitrate(){return this._currentBitrate}get mediaStreamTrack(){return this._mediaStreamTrack}get mediaStreamID(){return this._mediaStreamID}attach(t){let i="audio";this.kind===G.Kind.Video&&(i="video"),this.attachedElements.length===0&&this.kind===G.Kind.Video&&this.addAppVisibilityListener(),t||(i==="audio"&&(mr.forEach(l=>{l.parentElement===null&&!t&&(t=l)}),t&&mr.splice(mr.indexOf(t),1)),t||(t=document.createElement(i))),this.attachedElements.includes(t)||this.attachedElements.push(t),as(this.mediaStreamTrack,t);const a=t.srcObject.getTracks(),o=a.some(l=>l.kind==="audio");return t.play().then(()=>{this.emit(o?X.AudioPlaybackStarted:X.VideoPlaybackStarted)}).catch(l=>{l.name==="NotAllowedError"?this.emit(o?X.AudioPlaybackFailed:X.VideoPlaybackFailed,l):l.name==="AbortError"?Se.debug("".concat(o?"audio":"video"," playback aborted, likely due to new play request")):Se.warn("could not playback ".concat(o?"audio":"video"),l),o&&t&&a.some(f=>f.kind==="video")&&l.name==="NotAllowedError"&&(t.muted=!0,t.play().catch(()=>{}))}),this.emit(X.ElementAttached,t),t}detach(t){try{if(t){us(this.mediaStreamTrack,t);const a=this.attachedElements.indexOf(t);return a>=0&&(this.attachedElements.splice(a,1),this.recycleElement(t),this.emit(X.ElementDetached,t)),t}const i=[];return this.attachedElements.forEach(a=>{us(this.mediaStreamTrack,a),i.push(a),this.recycleElement(a),this.emit(X.ElementDetached,a)}),this.attachedElements=[],i}finally{this.attachedElements.length===0&&this.removeAppVisibilityListener()}}stop(){this.stopMonitor(),this._mediaStreamTrack.stop()}enable(){this._mediaStreamTrack.enabled=!0}disable(){this._mediaStreamTrack.enabled=!1}stopMonitor(){this.monitorInterval&&clearInterval(this.monitorInterval),this.timeSyncHandle&&cancelAnimationFrame(this.timeSyncHandle)}updateLoggerOptions(t){t.loggerName&&(this.log=ci(t.loggerName)),t.loggerContextCb&&(this.loggerContextCb=t.loggerContextCb)}recycleElement(t){if(t instanceof HTMLAudioElement){let i=!0;t.pause(),mr.forEach(a=>{a.parentElement||(i=!1)}),i&&mr.push(t)}}handleAppVisibilityChanged(){return T(this,void 0,void 0,function*(){this.isInBackground=document.visibilityState==="hidden",!this.isInBackground&&this.kind===G.Kind.Video&&setTimeout(()=>this.attachedElements.forEach(t=>t.play().catch(()=>{})),0)})}addAppVisibilityListener(){Ft()?(this.isInBackground=document.visibilityState==="hidden",document.addEventListener("visibilitychange",this.appVisibilityChangedListener)):this.isInBackground=!1}removeAppVisibilityListener(){Ft()&&document.removeEventListener("visibilitychange",this.appVisibilityChangedListener)}}function as(r,t){let i;t.srcObject instanceof MediaStream?i=t.srcObject:i=new MediaStream;let a;r.kind==="audio"?a=i.getAudioTracks():a=i.getVideoTracks(),a.includes(r)||(a.forEach(o=>{i.removeTrack(o)}),i.addTrack(r)),(!pa()||!(t instanceof HTMLVideoElement))&&(t.autoplay=!0),t.muted=i.getAudioTracks().length===0,t instanceof HTMLVideoElement&&(t.playsInline=!0),t.srcObject!==i&&(t.srcObject=i,(pa()||ma())&&t instanceof HTMLVideoElement&&setTimeout(()=>{t.srcObject=i,t.play().catch(()=>{})},0))}function us(r,t){if(t.srcObject instanceof MediaStream){const i=t.srcObject;i.removeTrack(r),i.getTracks().length>0?t.srcObject=i:t.srcObject=null}}(function(r){let t;(function(p){p.Audio="audio",p.Video="video",p.Unknown="unknown"})(t=r.Kind||(r.Kind={}));let i;(function(p){p.Camera="camera",p.Microphone="microphone",p.ScreenShare="screen_share",p.ScreenShareAudio="screen_share_audio",p.Unknown="unknown"})(i=r.Source||(r.Source={}));let a;(function(p){p.Active="active",p.Paused="paused",p.Unknown="unknown"})(a=r.StreamState||(r.StreamState={}));function o(p){switch(p){case t.Audio:return Cn.AUDIO;case t.Video:return Cn.VIDEO;default:return Cn.DATA}}r.kindToProto=o;function l(p){switch(p){case Cn.AUDIO:return t.Audio;case Cn.VIDEO:return t.Video;default:return t.Unknown}}r.kindFromProto=l;function f(p){switch(p){case i.Camera:return ft.CAMERA;case i.Microphone:return ft.MICROPHONE;case i.ScreenShare:return ft.SCREEN_SHARE;case i.ScreenShareAudio:return ft.SCREEN_SHARE_AUDIO;default:return ft.UNKNOWN}}r.sourceToProto=f;function u(p){switch(p){case ft.CAMERA:return i.Camera;case ft.MICROPHONE:return i.Microphone;case ft.SCREEN_SHARE:return i.ScreenShare;case ft.SCREEN_SHARE_AUDIO:return i.ScreenShareAudio;default:return i.Unknown}}r.sourceFromProto=u;function m(p){switch(p){case kd.ACTIVE:return a.Active;case kd.PAUSED:return a.Paused;default:return a.Unknown}}r.streamStateFromProto=m})(G||(G={}));const qk="|",lv="https://aomediacodec.github.io/av1-rtp-spec/#dependency-descriptor-rtp-header-extension";function Vk(r){const t=r.split(qk);return t.length>1?[t[0],r.substr(t[0].length+1)]:[r,""]}function Rt(r){return new Ht(t=>_t.setTimeout(t,r))}function Ld(){return"addTransceiver"in RTCPeerConnection.prototype}function Id(){return"addTrack"in RTCPeerConnection.prototype}function Hk(){if(!("getCapabilities"in RTCRtpSender)||pa()||ma())return!1;const r=RTCRtpSender.getCapabilities("video");let t=!1;if(r){for(const i of r.codecs)if(i.mimeType.toLowerCase()==="video/av1"){t=!0;break}}return t}function Fk(){if(!("getCapabilities"in RTCRtpSender)||ma())return!1;if(pa()){const i=Gt();if(i!=null&&i.version&&Un(i.version,"16")<0||(i==null?void 0:i.os)==="iOS"&&(i!=null&&i.osVersion)&&Un(i.osVersion,"16")<0)return!1}const r=RTCRtpSender.getCapabilities("video");let t=!1;if(r){for(const i of r.codecs)if(i.mimeType.toLowerCase()==="video/vp9"){t=!0;break}}return t}function En(r){return r==="av1"||r==="vp9"}function jd(r){return!document||Ar()?!1:(r||(r=document.createElement("audio")),"setSinkId"in r)}function Gk(){return typeof RTCPeerConnection>"u"?!1:Ld()||Id()}function ma(){var r;return((r=Gt())===null||r===void 0?void 0:r.name)==="Firefox"}function uv(){const r=Gt();return!!r&&r.name==="Chrome"&&r.os!=="iOS"}function pa(){var r;return((r=Gt())===null||r===void 0?void 0:r.name)==="Safari"}function Ar(){const r=Gt();return(r==null?void 0:r.name)==="Safari"||(r==null?void 0:r.os)==="iOS"}function Kk(){const r=Gt();return(r==null?void 0:r.name)==="Safari"&&r.version.startsWith("17.")||(r==null?void 0:r.os)==="iOS"&&!!(r!=null&&r.osVersion)&&Un(r.osVersion,"17")>=0}function Yk(r){return r||(r=Gt()),(r==null?void 0:r.name)==="Safari"&&Un(r.version,"18.3")>0||(r==null?void 0:r.os)==="iOS"&&!!(r!=null&&r.osVersion)&&Un(r.osVersion,"18.3")>0}function dy(){var r,t;return Ft()?(t=(r=navigator.userAgentData)===null||r===void 0?void 0:r.mobile)!==null&&t!==void 0?t:/Tablet|iPad|Mobile|Android|BlackBerry/.test(navigator.userAgent):!1}function Qk(){const r=Gt(),t="17.2";if(r)return r.name!=="Safari"&&r.os!=="iOS"||r.os==="iOS"&&r.osVersion&&Un(r.osVersion,t)>=0?!0:r.name==="Safari"&&Un(r.version,t)>=0}function Ft(){return typeof document<"u"}function Pn(){return navigator.product=="ReactNative"}function ps(r){return r.hostname.endsWith(".livekit.cloud")||r.hostname.endsWith(".livekit.run")}function cd(r){return ps(r)?r.hostname.split(".")[0]:null}function fy(){if(global&&global.LiveKitReactNativeGlobal)return global.LiveKitReactNativeGlobal}function hy(){if(!Pn())return;let r=fy();if(r)return r.platform}function dv(){if(Ft())return window.devicePixelRatio;if(Pn()){let r=fy();if(r)return r.devicePixelRatio}return 1}function Un(r,t){const i=r.split("."),a=t.split("."),o=Math.min(i.length,a.length);for(let l=0;l<o;++l){const f=parseInt(i[l],10),u=parseInt(a[l],10);if(f>u)return 1;if(f<u)return-1;if(l===o-1&&f===u)return 0}return r===""&&t!==""?-1:t===""?1:i.length==a.length?0:i.length<a.length?-1:1}function Jk(r){for(const t of r)t.target.handleResize(t)}function Xk(r){for(const t of r)t.target.handleVisibilityChanged(t)}let ld=null;const fv=()=>(ld||(ld=new ResizeObserver(Jk)),ld);let ud=null;const hv=()=>(ud||(ud=new IntersectionObserver(Xk,{root:null,rootMargin:"0px"})),ud);function Zk(){var r;const t=new h0({sdk:m0.JS,protocol:Rk,version:_k});return Pn()&&(t.os=(r=hy())!==null&&r!==void 0?r:""),t}function mv(){let r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:16,t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:16,i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1,a=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1;const o=document.createElement("canvas");o.width=r,o.height=t;const l=o.getContext("2d");l==null||l.fillRect(0,0,o.width,o.height),a&&l&&(l.beginPath(),l.arc(r/2,t/2,50,0,Math.PI*2,!0),l.closePath(),l.fillStyle="grey",l.fill());const f=o.captureStream(),[u]=f.getTracks();if(!u)throw Error("Could not get empty media stream video track");return u.enabled=i,u}let pr;function dd(){if(!pr){const r=new AudioContext,t=r.createOscillator(),i=r.createGain();i.gain.setValueAtTime(0,0);const a=r.createMediaStreamDestination();if(t.connect(i),i.connect(a),t.start(),[pr]=a.stream.getAudioTracks(),!pr)throw Error("Could not get empty media stream audio track");pr.enabled=!1}return pr.clone()}class gn{get isResolved(){return this._isResolved}constructor(t,i){this._isResolved=!1,this.onFinally=i,this.promise=new Promise((a,o)=>T(this,void 0,void 0,function*(){this.resolve=a,this.reject=o,t&&(yield t(a,o))})).finally(()=>{var a;this._isResolved=!0,(a=this.onFinally)===null||a===void 0||a.call(this)})}}function Wk(r){return Mk.includes(r)}function zi(r){if(typeof r=="string"||typeof r=="number")return r;if(Array.isArray(r))return r[0];if(r.exact!==void 0)return Array.isArray(r.exact)?r.exact[0]:r.exact;if(r.ideal!==void 0)return Array.isArray(r.ideal)?r.ideal[0]:r.ideal;throw Error("could not unwrap constraint")}function $k(r){return r.startsWith("http")?r.replace(/^(http)/,"ws"):r}function Dr(r){return r.startsWith("ws")?r.replace(/^(ws)/,"http"):r}function eE(r,t){return r.segments.map(i=>{let{id:a,text:o,language:l,startTime:f,endTime:u,final:m}=i;var p;const g=(p=t.get(a))!==null&&p!==void 0?p:Date.now(),v=Date.now();return m?t.delete(a):t.set(a,g),{id:a,text:o,startTime:Number.parseInt(f.toString()),endTime:Number.parseInt(u.toString()),final:m,language:l,firstReceivedTime:g,lastReceivedTime:v}})}function tE(r){const{id:t,timestamp:i,message:a,editTimestamp:o}=r;return{id:t,timestamp:Number.parseInt(i.toString()),editTimestamp:o?Number.parseInt(o.toString()):void 0,message:a}}function pv(r){switch(r.reason){case Ke.LeaveRequest:return r.context;case Ke.Cancelled:return _n.CLIENT_INITIATED;case Ke.NotAllowed:return _n.USER_REJECTED;case Ke.ServerUnreachable:return _n.JOIN_FAILURE;default:return _n.UNKNOWN_REASON}}function dc(r){return r!==void 0?Number(r):void 0}function fa(r){return r!==void 0?BigInt(r):void 0}function ds(r){return!!r&&!(r instanceof MediaStreamTrack)&&r.isLocal}function Nn(r){return!!r&&r.kind==G.Kind.Audio}function Fi(r){return!!r&&r.kind==G.Kind.Video}function Ui(r){return ds(r)&&Fi(r)}function ni(r){return ds(r)&&Nn(r)}function Bd(r){return!!r&&!r.isLocal}function nE(r){return!!r&&!r.isLocal}function fd(r){return Bd(r)&&Fi(r)}function iE(r){return r.isLocal}function aE(r,t){const i=[];let a=new TextEncoder().encode(r);for(;a.length>t;){let o=t;for(;o>0;){const l=a[o];if(l!==void 0&&(l&192)!==128)break;o--}i.push(a.slice(0,o)),a=a.slice(o)}return a.length>0&&i.push(a),i}function sE(r){var t;const i=r.get("Cache-Control");if(i){const a=(t=i.match(/(?:^|[,\s])max-age=(\d+)/))===null||t===void 0?void 0:t[1];if(a)return parseInt(a,10)}}function rE(r,t){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1;const a=oE(r,t);return i?a:df(a,"v1")}function oE(r,t){const i=new URL($k(r));return t.forEach((a,o)=>{i.searchParams.set(o,a)}),df(i,"rtc")}function cE(r){const t=new URL(Dr(r));return df(t,"validate")}function my(r){return r.endsWith("/")?r:"".concat(r,"/")}function df(r,t){return r.pathname="".concat(my(r.pathname)).concat(t),r}function gv(r){if(typeof r=="string")return Qg.fromJson(JSON.parse(r),{ignoreUnknownFields:!0});if(r instanceof ArrayBuffer)return Qg.fromBinary(new Uint8Array(r));throw new Error("could not decode websocket message: ".concat(typeof r))}function lE(r){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"Unknown reason";if(!(r instanceof AbortSignal))return t;const i=r.reason;switch(typeof i){case"string":return i;case"object":return i instanceof Error?i.message:t;default:return"toString"in i?i.toString():t}}const uE=10,gr="lk_e2ee",dE="LKFrameEncryptionKey",fE={sharedKey:!1,ratchetSalt:dE,ratchetWindowSize:8,failureTolerance:uE,keyringSize:16};var qi;(function(r){r.SetKey="setKey",r.RatchetRequest="ratchetRequest",r.KeyRatcheted="keyRatcheted"})(qi||(qi={}));var vv;(function(r){r.KeyRatcheted="keyRatcheted"})(vv||(vv={}));var ji;(function(r){r.ParticipantEncryptionStatusChanged="participantEncryptionStatusChanged",r.EncryptionError="encryptionError"})(ji||(ji={}));var yv;(function(r){r.Error="cryptorError"})(yv||(yv={}));function hE(){return mE()||zd()}function zd(){return typeof window.RTCRtpScriptTransform<"u"}function mE(){return typeof window.RTCRtpSender<"u"&&typeof window.RTCRtpSender.prototype.createEncodedStreams<"u"}function pE(r){var t,i,a,o,l;if(((t=r.value)===null||t===void 0?void 0:t.case)!=="sipDtmf"&&((i=r.value)===null||i===void 0?void 0:i.case)!=="metrics"&&((a=r.value)===null||a===void 0?void 0:a.case)!=="speaker"&&((o=r.value)===null||o===void 0?void 0:o.case)!=="transcription"&&((l=r.value)===null||l===void 0?void 0:l.case)!=="encryptedPacket")return new r0({value:r.value})}class t_ extends Ln.EventEmitter{constructor(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};super(),this.onKeyRatcheted=(i,a,o)=>{Se.debug("key ratcheted event received",{ratchetResult:i,participantId:a,keyIndex:o})},this.keyInfoMap=new Map,this.options=Object.assign(Object.assign({},fE),t),this.on(qi.KeyRatcheted,this.onKeyRatcheted)}onSetEncryptionKey(t,i,a){const o={key:t,participantIdentity:i,keyIndex:a};if(!this.options.sharedKey&&!i)throw new Error("participant identity needs to be passed for encryption key if sharedKey option is false");this.keyInfoMap.set("".concat(i??"shared","-").concat(a??0),o),this.emit(qi.SetKey,o)}getKeys(){return Array.from(this.keyInfoMap.values())}getOptions(){return this.options}ratchetKey(t,i){this.emit(qi.RatchetRequest,t,i)}}var bv;(function(r){r[r.InvalidKey=0]="InvalidKey",r[r.MissingKey=1]="MissingKey",r[r.InternalError=2]="InternalError"})(bv||(bv={}));class gE extends Ln.EventEmitter{constructor(t,i){super(),this.decryptDataRequests=new Map,this.encryptDataRequests=new Map,this.onWorkerMessage=a=>{var o,l;const{kind:f,data:u}=a.data;switch(f){case"error":if(Se.error(u.error.message),u.uuid){const g=this.decryptDataRequests.get(u.uuid);if(g!=null&&g.reject){g.reject(u.error);break}const v=this.encryptDataRequests.get(u.uuid);if(v!=null&&v.reject){v.reject(u.error);break}}this.emit(ji.EncryptionError,u.error,u.participantIdentity);break;case"initAck":u.enabled&&this.keyProvider.getKeys().forEach(g=>{this.postKey(g)});break;case"enable":if(u.enabled&&this.keyProvider.getKeys().forEach(g=>{this.postKey(g)}),this.encryptionEnabled!==u.enabled&&u.participantIdentity===((o=this.room)===null||o===void 0?void 0:o.localParticipant.identity))this.emit(ji.ParticipantEncryptionStatusChanged,u.enabled,this.room.localParticipant),this.encryptionEnabled=u.enabled;else if(u.participantIdentity){const g=(l=this.room)===null||l===void 0?void 0:l.getParticipantByIdentity(u.participantIdentity);if(!g)throw TypeError("couldn't set encryption status, participant not found".concat(u.participantIdentity));this.emit(ji.ParticipantEncryptionStatusChanged,u.enabled,g)}break;case"ratchetKey":this.keyProvider.emit(qi.KeyRatcheted,u.ratchetResult,u.participantIdentity,u.keyIndex);break;case"decryptDataResponse":const m=this.decryptDataRequests.get(u.uuid);m!=null&&m.resolve&&m.resolve(u);break;case"encryptDataResponse":const p=this.encryptDataRequests.get(u.uuid);p!=null&&p.resolve&&p.resolve(u);break}},this.onWorkerError=a=>{Se.error("e2ee worker encountered an error:",{error:a.error}),this.emit(ji.EncryptionError,a.error,void 0)},this.keyProvider=t.keyProvider,this.worker=t.worker,this.encryptionEnabled=!1,this.dataChannelEncryptionEnabled=i}get isEnabled(){return this.encryptionEnabled}get isDataChannelEncryptionEnabled(){return this.isEnabled&&this.dataChannelEncryptionEnabled}setup(t){if(!hE())throw new cf("tried to setup end-to-end encryption on an unsupported browser");if(Se.info("setting up e2ee"),t!==this.room){this.room=t,this.setupEventListeners(t,this.keyProvider);const i={kind:"init",data:{keyProviderOptions:this.keyProvider.getOptions(),loglevel:lk.getLevel()}};this.worker&&(Se.info("initializing worker",{worker:this.worker}),this.worker.onmessage=this.onWorkerMessage,this.worker.onerror=this.onWorkerError,this.worker.postMessage(i))}}setParticipantCryptorEnabled(t,i){Se.debug("set e2ee to ".concat(t," for participant ").concat(i)),this.postEnable(t,i)}setSifTrailer(t){!t||t.length===0?Se.warn("ignoring server sent trailer as it's empty"):this.postSifTrailer(t)}setupEngine(t){t.on($.RTPVideoMapUpdate,i=>{this.postRTPMap(i)})}setupEventListeners(t,i){t.on(J.TrackPublished,(a,o)=>this.setParticipantCryptorEnabled(a.trackInfo.encryption!==pt.NONE,o.identity)),t.on(J.ConnectionStateChanged,a=>{a===Le.Connected&&t.remoteParticipants.forEach(o=>{o.trackPublications.forEach(l=>{this.setParticipantCryptorEnabled(l.trackInfo.encryption!==pt.NONE,o.identity)})})}).on(J.TrackUnsubscribed,(a,o,l)=>{var f;const u={kind:"removeTransform",data:{participantIdentity:l.identity,trackId:a.mediaStreamID}};(f=this.worker)===null||f===void 0||f.postMessage(u)}).on(J.TrackSubscribed,(a,o,l)=>{this.setupE2EEReceiver(a,l.identity,o.trackInfo)}).on(J.SignalConnected,()=>{if(!this.room)throw new TypeError("expected room to be present on signal connect");i.getKeys().forEach(a=>{this.postKey(a)}),this.setParticipantCryptorEnabled(this.room.localParticipant.isE2EEEnabled,this.room.localParticipant.identity)}),t.localParticipant.on(ee.LocalSenderCreated,(a,o)=>T(this,void 0,void 0,function*(){this.setupE2EESender(o,a)})),t.localParticipant.on(ee.LocalTrackPublished,a=>{if(!Fi(a.track)||!Ar())return;const o={kind:"updateCodec",data:{trackId:a.track.mediaStreamID,codec:Cr(a.trackInfo.codecs[0].mimeType),participantIdentity:this.room.localParticipant.identity}};this.worker.postMessage(o)}),i.on(qi.SetKey,a=>this.postKey(a)).on(qi.RatchetRequest,(a,o)=>this.postRatchetRequest(a,o))}encryptData(t){return T(this,void 0,void 0,function*(){if(!this.worker)throw Error("could not encrypt data, worker is missing");const i=crypto.randomUUID(),a={kind:"encryptDataRequest",data:{uuid:i,payload:t,participantIdentity:this.room.localParticipant.identity}},o=new gn;return o.onFinally=()=>{this.encryptDataRequests.delete(i)},this.encryptDataRequests.set(i,o),this.worker.postMessage(a),o.promise})}handleEncryptedData(t,i,a,o){if(!this.worker)throw Error("could not handle encrypted data, worker is missing");const l=crypto.randomUUID(),f={kind:"decryptDataRequest",data:{uuid:l,payload:t,iv:i,participantIdentity:a,keyIndex:o}},u=new gn;return u.onFinally=()=>{this.decryptDataRequests.delete(l)},this.decryptDataRequests.set(l,u),this.worker.postMessage(f),u.promise}postRatchetRequest(t,i){if(!this.worker)throw Error("could not ratchet key, worker is missing");const a={kind:"ratchetRequest",data:{participantIdentity:t,keyIndex:i}};this.worker.postMessage(a)}postKey(t){let{key:i,participantIdentity:a,keyIndex:o}=t;var l;if(!this.worker)throw Error("could not set key, worker is missing");const f={kind:"setKey",data:{participantIdentity:a,isPublisher:a===((l=this.room)===null||l===void 0?void 0:l.localParticipant.identity),key:i,keyIndex:o}};this.worker.postMessage(f)}postEnable(t,i){if(this.worker){const a={kind:"enable",data:{enabled:t,participantIdentity:i}};this.worker.postMessage(a)}else throw new ReferenceError("failed to enable e2ee, worker is not ready")}postRTPMap(t){var i;if(!this.worker)throw TypeError("could not post rtp map, worker is missing");if(!(!((i=this.room)===null||i===void 0)&&i.localParticipant.identity))throw TypeError("could not post rtp map, local participant identity is missing");const a={kind:"setRTPMap",data:{map:t,participantIdentity:this.room.localParticipant.identity}};this.worker.postMessage(a)}postSifTrailer(t){if(!this.worker)throw Error("could not post SIF trailer, worker is missing");const i={kind:"setSifTrailer",data:{trailer:t}};this.worker.postMessage(i)}setupE2EEReceiver(t,i,a){if(t.receiver){if(!(a!=null&&a.mimeType)||a.mimeType==="")throw new TypeError("MimeType missing from trackInfo, cannot set up E2EE cryptor");this.handleReceiver(t.receiver,t.mediaStreamID,i,t.kind==="video"?Cr(a.mimeType):void 0)}}setupE2EESender(t,i){if(!ds(t)||!i){i||Se.warn("early return because sender is not ready");return}this.handleSender(i,t.mediaStreamID,void 0)}handleReceiver(t,i,a,o){return T(this,void 0,void 0,function*(){if(this.worker){if(zd()&&!uv()){const l={kind:"decode",participantIdentity:a,trackId:i,codec:o};t.transform=new RTCRtpScriptTransform(this.worker,l)}else{if(gr in t&&o){const m={kind:"updateCodec",data:{trackId:i,codec:o,participantIdentity:a}};this.worker.postMessage(m);return}let l=t.writableStream,f=t.readableStream;if(!l||!f){const m=t.createEncodedStreams();t.writableStream=m.writable,l=m.writable,t.readableStream=m.readable,f=m.readable}const u={kind:"decode",data:{readableStream:f,writableStream:l,trackId:i,codec:o,participantIdentity:a,isReuse:gr in t}};this.worker.postMessage(u,[f,l])}t[gr]=!0}})}handleSender(t,i,a){var o;if(!(gr in t||!this.worker)){if(!(!((o=this.room)===null||o===void 0)&&o.localParticipant.identity)||this.room.localParticipant.identity==="")throw TypeError("local identity needs to be known in order to set up encrypted sender");if(zd()&&!uv()){Se.info("initialize script transform");const l={kind:"encode",participantIdentity:this.room.localParticipant.identity,trackId:i,codec:a};t.transform=new RTCRtpScriptTransform(this.worker,l)}else{Se.info("initialize encoded streams");const l=t.createEncodedStreams(),f={kind:"encode",data:{readableStream:l.readable,writableStream:l.writable,codec:a,trackId:i,participantIdentity:this.room.localParticipant.identity,isReuse:!1}};this.worker.postMessage(f,[l.readable,l.writable])}t[gr]=!0}}}const vE=500,yE=15e3;class fs{constructor(){this.failedConnectionAttempts=new Map,this.backOffPromises=new Map}static getInstance(){return this._instance||(this._instance=new fs),this._instance}addFailedConnectionAttempt(t){var i;const a=new URL(t),o=cd(a);if(!o)return;let l=(i=this.failedConnectionAttempts.get(o))!==null&&i!==void 0?i:0;this.failedConnectionAttempts.set(o,l+1),this.backOffPromises.set(o,Rt(Math.min(vE*Math.pow(2,l),yE)))}getBackOffPromise(t){const i=new URL(t),a=i&&cd(i);return a&&this.backOffPromises.get(a)||Promise.resolve()}resetFailedConnectionAttempts(t){const i=new URL(t),a=i&&cd(i);a&&(this.failedConnectionAttempts.set(a,0),this.backOffPromises.set(a,Promise.resolve()))}resetAll(){this.backOffPromises.clear(),this.failedConnectionAttempts.clear()}}fs._instance=null;const hd="default";class bt{constructor(){this._previousDevices=[]}static getInstance(){return this.instance===void 0&&(this.instance=new bt),this.instance}get previousDevices(){return this._previousDevices}getDevices(t){return T(this,arguments,void 0,function(i){var a=this;let o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;return(function*(){var l;if(((l=bt.userMediaPromiseMap)===null||l===void 0?void 0:l.size)>0){Se.debug("awaiting getUserMedia promise");try{i?yield bt.userMediaPromiseMap.get(i):yield Promise.all(bt.userMediaPromiseMap.values())}catch{Se.warn("error waiting for media permissons")}}let f=yield navigator.mediaDevices.enumerateDevices();if(o&&!(pa()&&a.hasDeviceInUse(i))&&(f.filter(m=>m.kind===i).length===0||f.some(m=>{const p=m.label==="",g=i?m.kind===i:!0;return p&&g}))){const m={video:i!=="audioinput"&&i!=="audiooutput",audio:i!=="videoinput"&&{deviceId:{ideal:"default"}}},p=yield navigator.mediaDevices.getUserMedia(m);f=yield navigator.mediaDevices.enumerateDevices(),p.getTracks().forEach(g=>{g.stop()})}return a._previousDevices=f,i&&(f=f.filter(u=>u.kind===i)),f})()})}normalizeDeviceId(t,i,a){return T(this,void 0,void 0,function*(){if(i!==hd)return i;const o=yield this.getDevices(t),l=o.find(u=>u.deviceId===hd);if(!l){Se.warn("could not reliably determine default device");return}const f=o.find(u=>u.deviceId!==hd&&u.groupId===(a??l.groupId));if(!f){Se.warn("could not reliably determine default device");return}return f==null?void 0:f.deviceId})}hasDeviceInUse(t){return t?bt.userMediaPromiseMap.has(t):bt.userMediaPromiseMap.size>0}}bt.mediaDeviceKinds=["audioinput","audiooutput","videoinput"];bt.userMediaPromiseMap=new Map;var kr;(function(r){r[r.WAITING=0]="WAITING",r[r.RUNNING=1]="RUNNING",r[r.COMPLETED=2]="COMPLETED"})(kr||(kr={}));class bE{constructor(){this.pendingTasks=new Map,this.taskMutex=new xt,this.nextTaskIndex=0}run(t){return T(this,void 0,void 0,function*(){const i={id:this.nextTaskIndex++,enqueuedAt:Date.now(),status:kr.WAITING};this.pendingTasks.set(i.id,i);const a=yield this.taskMutex.lock();try{return i.executedAt=Date.now(),i.status=kr.RUNNING,yield t()}finally{i.status=kr.COMPLETED,this.pendingTasks.delete(i.id),a()}})}flush(){return T(this,void 0,void 0,function*(){return this.run(()=>T(this,void 0,void 0,function*(){}))})}snapshot(){return Array.from(this.pendingTasks.values())}}class SE{get readyState(){return this.ws.readyState}constructor(t){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};var a,o;if(!((a=i.signal)===null||a===void 0)&&a.aborted)throw new DOMException("This operation was aborted","AbortError");this.url=t;const l=new WebSocket(t,(o=i.protocols)!==null&&o!==void 0?o:[]);l.binaryType="arraybuffer",this.ws=l;const f=function(){let{closeCode:u,reason:m}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return l.close(u,m)};this.opened=new Ht((u,m)=>{const p=()=>{m(he.websocket("Encountered websocket error during connection establishment"))};l.onopen=()=>{u({readable:new ReadableStream({start(g){l.onmessage=v=>{let{data:S}=v;return g.enqueue(S)},l.onerror=v=>g.error(v)},cancel:f}),writable:new WritableStream({write(g){l.send(g)},abort(){l.close()},close:f}),protocol:l.protocol,extensions:l.extensions}),l.removeEventListener("error",p)},l.addEventListener("error",p)}),this.closed=new Ht((u,m)=>{const p=()=>T(this,void 0,void 0,function*(){const g=new Ht(S=>{l.readyState!==WebSocket.CLOSED&&l.addEventListener("close",k=>{S(k)},{once:!0})}),v=yield Ht.race([Rt(250),g]);v?u(v):m(he.websocket("Encountered unspecified websocket error without a timely close event"))});l.onclose=g=>{let{code:v,reason:S}=g;u({closeCode:v,reason:S}),l.removeEventListener("error",p)},l.addEventListener("error",p)}),i.signal&&(i.signal.onabort=()=>l.close()),this.close=f}}const TE=["syncState","trickle","offer","answer","simulate","leave"];function CE(r){const t=TE.indexOf(r.case)>=0;return Se.trace("request allowed to bypass queue:",{canPass:t,req:r}),t}var Ge;(function(r){r[r.CONNECTING=0]="CONNECTING",r[r.CONNECTED=1]="CONNECTED",r[r.RECONNECTING=2]="RECONNECTING",r[r.DISCONNECTING=3]="DISCONNECTING",r[r.DISCONNECTED=4]="DISCONNECTED"})(Ge||(Ge={}));const kE=250;class ff{get currentState(){return this.state}get isDisconnected(){return this.state===Ge.DISCONNECTING||this.state===Ge.DISCONNECTED}get isEstablishingConnection(){return this.state===Ge.CONNECTING||this.state===Ge.RECONNECTING}getNextRequestId(){return this._requestId+=1,this._requestId}constructor(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1,i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};var a;this.rtt=0,this.state=Ge.DISCONNECTED,this.log=Se,this._requestId=0,this.useV0SignalPath=!1,this.resetCallbacks=()=>{this.onAnswer=void 0,this.onLeave=void 0,this.onLocalTrackPublished=void 0,this.onLocalTrackUnpublished=void 0,this.onNegotiateRequested=void 0,this.onOffer=void 0,this.onRemoteMuteChanged=void 0,this.onSubscribedQualityUpdate=void 0,this.onTokenRefresh=void 0,this.onTrickle=void 0,this.onClose=void 0,this.onMediaSectionsRequirement=void 0},this.log=ci((a=i.loggerName)!==null&&a!==void 0?a:Rn.Signal),this.loggerContextCb=i.loggerContextCb,this.useJSON=t,this.requestQueue=new bE,this.queuedRequests=[],this.closingLock=new xt,this.connectionLock=new xt,this.state=Ge.DISCONNECTED}get logContext(){var t,i;return(i=(t=this.loggerContextCb)===null||t===void 0?void 0:t.call(this))!==null&&i!==void 0?i:{}}join(t,i,a,o){return T(this,arguments,void 0,function(l,f,u,m){var p=this;let g=arguments.length>4&&arguments[4]!==void 0?arguments[4]:!1;return(function*(){return p.state=Ge.CONNECTING,p.options=u,yield p.connect(l,f,u,m,g)})()})}reconnect(t,i,a,o){return T(this,void 0,void 0,function*(){if(!this.options){this.log.warn("attempted to reconnect without signal options being set, ignoring",this.logContext);return}return this.state=Ge.RECONNECTING,this.clearPingInterval(),yield this.connect(t,i,Object.assign(Object.assign({},this.options),{reconnect:!0,sid:a,reconnectReason:o}),void 0,this.useV0SignalPath)})}connect(t,i,a,o){return T(this,arguments,void 0,function(l,f,u,m){var p=this;let g=arguments.length>4&&arguments[4]!==void 0?arguments[4]:!1;return(function*(){const v=yield p.connectionLock.lock();p.connectOptions=u,p.useV0SignalPath=g;const S=Zk(),k=g?EE(f,S,u):_E(f,S,u),O=rE(l,k,g).toString(),E=cE(O).toString();return new Promise((j,U)=>T(p,void 0,void 0,function*(){var Y,Z;try{let M=!1;const N=ie=>T(this,void 0,void 0,function*(){if(M)return;M=!0;const se=ie instanceof Event?ie.currentTarget:ie,ue=lE(se,"Abort handler called");this.streamWriter&&!this.isDisconnected?this.sendLeave().then(()=>this.close(ue)).catch(Ne=>{this.log.error(Ne),this.close()}):this.close(),q(),U(he.cancelled(ue))});m==null||m.addEventListener("abort",N);const q=()=>{clearTimeout(Q),m==null||m.removeEventListener("abort",N)},Q=setTimeout(()=>{N(he.timeout("room connection has timed out (signal)"))},u.websocketTimeout),ae=(ie,se)=>{this.handleSignalConnected(ie,Q,se)},ne=new URL(O);ne.searchParams.has("access_token")&&ne.searchParams.set("access_token","<redacted>"),this.log.debug("connecting to ".concat(ne),Object.assign({reconnect:u.reconnect,reconnectReason:u.reconnectReason},this.logContext)),this.ws&&(yield this.close(!1)),this.ws=new SE(O);try{this.ws.closed.then(I=>{var W;this.isEstablishingConnection&&U(he.internal("Websocket got closed during a (re)connection attempt: ".concat(I.reason))),I.closeCode!==1e3&&(this.log.warn("websocket closed",Object.assign(Object.assign({},this.logContext),{reason:I.reason,code:I.closeCode,wasClean:I.closeCode===1e3,state:this.state})),this.state===Ge.CONNECTED&&this.handleOnClose((W=I.reason)!==null&&W!==void 0?W:"Unexpected WS error"))}).catch(I=>{this.isEstablishingConnection&&U(he.internal("Websocket error during a (re)connection attempt: ".concat(I)))});const ie=yield this.ws.opened.catch(I=>T(this,void 0,void 0,function*(){if(this.state!==Ge.CONNECTED){this.state=Ge.DISCONNECTED,clearTimeout(Q);const W=yield this.handleConnectionError(I,E);U(W);return}this.handleWSError(I),U(I)}));if(clearTimeout(Q),!ie)return;const se=ie.readable.getReader();this.streamWriter=ie.writable.getWriter();const ue=yield se.read();if(se.releaseLock(),!ue.value)throw he.internal("no message received as first message");const Ne=gv(ue.value),Ze=this.validateFirstMessage(Ne,(Y=u.reconnect)!==null&&Y!==void 0?Y:!1);if(!Ze.isValid){U(Ze.error);return}((Z=Ne.message)===null||Z===void 0?void 0:Z.case)==="join"&&(this.pingTimeoutDuration=Ne.message.value.pingTimeout,this.pingIntervalDuration=Ne.message.value.pingInterval,this.pingTimeoutDuration&&this.pingTimeoutDuration>0&&this.log.debug("ping config",Object.assign(Object.assign({},this.logContext),{timeout:this.pingTimeoutDuration,interval:this.pingIntervalDuration})));const ht=Ze.shouldProcessFirstMessage?Ne:void 0;ae(ie,ht),j(Ze.response)}catch(ie){U(ie)}finally{q()}}finally{v()}}))})()})}startReadingLoop(t,i){return T(this,void 0,void 0,function*(){for(i&&this.handleSignalResponse(i);;){this.signalLatency&&(yield Rt(this.signalLatency));const{done:a,value:o}=yield t.read();if(a)break;const l=gv(o);this.handleSignalResponse(l)}})}close(){return T(this,arguments,void 0,function(){var t=this;let i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0,a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"Close method called on signal client";return(function*(){if([Ge.DISCONNECTING||Ge.DISCONNECTED].includes(t.state)){t.log.debug("ignoring signal close as it's already in disconnecting state");return}const o=yield t.closingLock.lock();try{if(t.clearPingInterval(),i&&(t.state=Ge.DISCONNECTING),t.ws){t.ws.close({closeCode:1e3,reason:a});const l=t.ws.closed;t.ws=void 0,t.streamWriter=void 0,yield Promise.race([l,Rt(kE)])}}catch(l){t.log.debug("websocket error while closing",Object.assign(Object.assign({},t.logContext),{error:l}))}finally{i&&(t.state=Ge.DISCONNECTED),o()}})()})}sendOffer(t,i){this.log.debug("sending offer",Object.assign(Object.assign({},this.logContext),{offerSdp:t.sdp})),this.sendRequest({case:"offer",value:ss(t,i)})}sendAnswer(t,i){return this.log.debug("sending answer",Object.assign(Object.assign({},this.logContext),{answerSdp:t.sdp})),this.sendRequest({case:"answer",value:ss(t,i)})}sendIceCandidate(t,i){return this.log.debug("sending ice candidate",Object.assign(Object.assign({},this.logContext),{candidate:t})),this.sendRequest({case:"trickle",value:new _c({candidateInit:JSON.stringify(t),target:i})})}sendMuteTrack(t,i){return this.sendRequest({case:"mute",value:new Rc({sid:t,muted:i})})}sendAddTrack(t){return this.sendRequest({case:"addTrack",value:t})}sendUpdateLocalMetadata(t,i){return T(this,arguments,void 0,function(a,o){var l=this;let f=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return(function*(){const u=l.getNextRequestId();return yield l.sendRequest({case:"updateMetadata",value:new nf({requestId:u,metadata:a,name:o,attributes:f})}),u})()})}sendUpdateTrackSettings(t){this.sendRequest({case:"trackSetting",value:t})}sendUpdateSubscription(t){return this.sendRequest({case:"subscription",value:t})}sendSyncState(t){return this.sendRequest({case:"syncState",value:t})}sendUpdateVideoLayers(t,i){return this.sendRequest({case:"updateLayers",value:new T0({trackSid:t,layers:i})})}sendUpdateSubscriptionPermissions(t,i){return this.sendRequest({case:"subscriptionPermission",value:new E0({allParticipants:t,trackPermissions:i})})}sendSimulateScenario(t){return this.sendRequest({case:"simulate",value:t})}sendPing(){return Promise.all([this.sendRequest({case:"ping",value:Xe.parse(Date.now())}),this.sendRequest({case:"pingReq",value:new O0({timestamp:Xe.parse(Date.now()),rtt:Xe.parse(this.rtt)})})])}sendUpdateLocalAudioTrack(t,i){return this.sendRequest({case:"updateAudioTrack",value:new tf({trackSid:t,features:i})})}sendLeave(){return this.sendRequest({case:"leave",value:new Ac({reason:_n.CLIENT_INITIATED,action:os.DISCONNECT})})}sendRequest(t){return T(this,arguments,void 0,function(i){var a=this;let o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;return(function*(){if(!o&&!CE(i)&&a.state===Ge.RECONNECTING){a.queuedRequests.push(()=>T(a,void 0,void 0,function*(){yield this.sendRequest(i,!0)}));return}if(o||(yield a.requestQueue.flush()),a.signalLatency&&(yield Rt(a.signalLatency)),a.isDisconnected){a.log.debug("skipping signal request (type: ".concat(i.case,") - SignalClient disconnected"));return}if(!a.streamWriter){a.log.error("cannot send signal request before connected, type: ".concat(i==null?void 0:i.case),a.logContext);return}const f=new PC({message:i});try{a.useJSON?yield a.streamWriter.write(f.toJsonString()):yield a.streamWriter.write(f.toBinary())}catch(u){a.log.error("error sending signal message",Object.assign(Object.assign({},a.logContext),{error:u}))}})()})}handleSignalResponse(t){var i,a;const o=t.message;if(o==null){this.log.debug("received unsupported message",this.logContext);return}let l=!1;if(o.case==="answer"){const f=Sv(o.value);this.onAnswer&&this.onAnswer(f,o.value.id,o.value.midToTrackId)}else if(o.case==="offer"){const f=Sv(o.value);this.onOffer&&this.onOffer(f,o.value.id,o.value.midToTrackId)}else if(o.case==="trickle"){const f=JSON.parse(o.value.candidateInit);this.onTrickle&&this.onTrickle(f,o.value.target)}else o.case==="update"?this.onParticipantUpdate&&this.onParticipantUpdate((i=o.value.participants)!==null&&i!==void 0?i:[]):o.case==="trackPublished"?this.onLocalTrackPublished&&this.onLocalTrackPublished(o.value):o.case==="speakersChanged"?this.onSpeakersChanged&&this.onSpeakersChanged((a=o.value.speakers)!==null&&a!==void 0?a:[]):o.case==="leave"?this.onLeave&&this.onLeave(o.value):o.case==="mute"?this.onRemoteMuteChanged&&this.onRemoteMuteChanged(o.value.sid,o.value.muted):o.case==="roomUpdate"?this.onRoomUpdate&&o.value.room&&this.onRoomUpdate(o.value.room):o.case==="connectionQuality"?this.onConnectionQuality&&this.onConnectionQuality(o.value):o.case==="streamStateUpdate"?this.onStreamStateUpdate&&this.onStreamStateUpdate(o.value):o.case==="subscribedQualityUpdate"?this.onSubscribedQualityUpdate&&this.onSubscribedQualityUpdate(o.value):o.case==="subscriptionPermissionUpdate"?this.onSubscriptionPermissionUpdate&&this.onSubscriptionPermissionUpdate(o.value):o.case==="refreshToken"?this.onTokenRefresh&&this.onTokenRefresh(o.value):o.case==="trackUnpublished"?this.onLocalTrackUnpublished&&this.onLocalTrackUnpublished(o.value):o.case==="subscriptionResponse"?this.onSubscriptionError&&this.onSubscriptionError(o.value):o.case==="pong"||(o.case==="pongResp"?(this.rtt=Date.now()-Number.parseInt(o.value.lastPingTimestamp.toString()),this.resetPingTimeout(),l=!0):o.case==="requestResponse"?this.onRequestResponse&&this.onRequestResponse(o.value):o.case==="trackSubscribed"?this.onLocalTrackSubscribed&&this.onLocalTrackSubscribed(o.value.trackSid):o.case==="roomMoved"?(this.onTokenRefresh&&this.onTokenRefresh(o.value.token),this.onRoomMoved&&this.onRoomMoved(o.value)):o.case==="mediaSectionsRequirement"?this.onMediaSectionsRequirement&&this.onMediaSectionsRequirement(o.value):this.log.debug("unsupported message",Object.assign(Object.assign({},this.logContext),{msgCase:o.case})));l||this.resetPingTimeout()}setReconnected(){for(;this.queuedRequests.length>0;){const t=this.queuedRequests.shift();t&&this.requestQueue.run(t)}}handleOnClose(t){return T(this,void 0,void 0,function*(){if(this.state===Ge.DISCONNECTED)return;const i=this.onClose;yield this.close(void 0,t),this.log.debug("websocket connection closed: ".concat(t),Object.assign(Object.assign({},this.logContext),{reason:t})),i&&i(t)})}handleWSError(t){this.log.error("websocket error",Object.assign(Object.assign({},this.logContext),{error:t}))}resetPingTimeout(){if(this.clearPingTimeout(),!this.pingTimeoutDuration){this.log.warn("ping timeout duration not set",this.logContext);return}this.pingTimeout=_t.setTimeout(()=>{this.log.warn("ping timeout triggered. last pong received at: ".concat(new Date(Date.now()-this.pingTimeoutDuration*1e3).toUTCString()),this.logContext),this.handleOnClose("ping timeout")},this.pingTimeoutDuration*1e3)}clearPingTimeout(){this.pingTimeout&&_t.clearTimeout(this.pingTimeout)}startPingInterval(){if(this.clearPingInterval(),this.resetPingTimeout(),!this.pingIntervalDuration){this.log.warn("ping interval duration not set",this.logContext);return}this.log.debug("start ping interval",this.logContext),this.pingInterval=_t.setInterval(()=>{this.sendPing()},this.pingIntervalDuration*1e3)}clearPingInterval(){this.log.debug("clearing ping interval",this.logContext),this.clearPingTimeout(),this.pingInterval&&_t.clearInterval(this.pingInterval)}handleSignalConnected(t,i,a){this.state=Ge.CONNECTED,clearTimeout(i),this.startPingInterval(),this.startReadingLoop(t.readable.getReader(),a)}validateFirstMessage(t,i){var a,o,l,f,u;return((a=t.message)===null||a===void 0?void 0:a.case)==="join"?{isValid:!0,response:t.message.value}:this.state===Ge.RECONNECTING&&((o=t.message)===null||o===void 0?void 0:o.case)!=="leave"?((l=t.message)===null||l===void 0?void 0:l.case)==="reconnect"?{isValid:!0,response:t.message.value}:(this.log.debug("declaring signal reconnected without reconnect response received",this.logContext),{isValid:!0,response:void 0,shouldProcessFirstMessage:!0}):this.isEstablishingConnection&&((f=t.message)===null||f===void 0?void 0:f.case)==="leave"?{isValid:!1,error:he.leaveRequest("Received leave request while trying to (re)connect",t.message.value.reason)}:i?{isValid:!1,error:he.internal("Unexpected first message")}:{isValid:!1,error:he.internal("did not receive join response, got ".concat((u=t.message)===null||u===void 0?void 0:u.case," instead"))}}handleConnectionError(t,i){return T(this,void 0,void 0,function*(){try{const a=yield fetch(i);switch(a.status){case 404:return he.serviceNotFound("v1 RTC path not found. Consider upgrading your LiveKit server version","v0-rtc");case 401:case 403:const o=yield a.text();return he.notAllowed(o,a.status);default:break}return t instanceof he?t:he.internal("Encountered unknown websocket error during connection: ".concat(t),{status:a.status,statusText:a.statusText})}catch(a){return a instanceof he?a:he.serverUnreachable(a instanceof Error?a.message:"server was not reachable")}})}}function Sv(r){const t={type:"offer",sdp:r.sdp};switch(r.type){case"answer":case"offer":case"pranswer":case"rollback":t.type=r.type;break}return t}function ss(r,t){return new Hi({sdp:r.sdp,type:r.type,id:t})}function EE(r,t,i){var a;const o=new URLSearchParams;return o.set("access_token",r),i.reconnect&&(o.set("reconnect","1"),i.sid&&o.set("sid",i.sid)),o.set("auto_subscribe",i.autoSubscribe?"1":"0"),o.set("sdk",Pn()?"reactnative":"js"),o.set("version",t.version),o.set("protocol",t.protocol.toString()),t.deviceModel&&o.set("device_model",t.deviceModel),t.os&&o.set("os",t.os),t.osVersion&&o.set("os_version",t.osVersion),t.browser&&o.set("browser",t.browser),t.browserVersion&&o.set("browser_version",t.browserVersion),i.adaptiveStream&&o.set("adaptive_stream","1"),i.reconnectReason&&o.set("reconnect_reason",i.reconnectReason.toString()),!((a=navigator.connection)===null||a===void 0)&&a.type&&o.set("network",navigator.connection.type),o}function _E(r,t,i){const a=new URLSearchParams;a.set("access_token",r);const o=new nk({clientInfo:t,connectionSettings:new A0({autoSubscribe:!!i.autoSubscribe,adaptiveStream:!!i.adaptiveStream}),reconnect:!!i.reconnect,participantSid:i.sid?i.sid:void 0});i.reconnectReason&&(o.reconnectReason=i.reconnectReason);const l=new ik({joinRequest:o.toBinary()});return a.set("join_request",btoa(new TextDecoder("utf-8").decode(l.toBinary()))),a}class Tv{constructor(){this.buffer=[],this._totalSize=0}push(t){this.buffer.push(t),this._totalSize+=t.data.byteLength}pop(){const t=this.buffer.shift();return t&&(this._totalSize-=t.data.byteLength),t}getAll(){return this.buffer.slice()}popToSequence(t){for(;this.buffer.length>0&&this.buffer[0].sequence<=t;)this.pop()}alignBufferedAmount(t){for(;this.buffer.length>0;){const i=this.buffer[0];if(this._totalSize-i.data.byteLength<=t)break;this.pop()}}get length(){return this.buffer.length}}class RE{constructor(t){this._map=new Map,this._lastCleanup=0,this.ttl=t}set(t,i){const a=Date.now();a-this._lastCleanup>this.ttl/2&&this.cleanup();const o=a+this.ttl;return this._map.set(t,{value:i,expiresAt:o}),this}get(t){const i=this._map.get(t);if(i){if(i.expiresAt<Date.now()){this._map.delete(t);return}return i.value}}has(t){const i=this._map.get(t);return i?i.expiresAt<Date.now()?(this._map.delete(t),!1):!0:!1}delete(t){return this._map.delete(t)}clear(){this._map.clear()}cleanup(){const t=Date.now();for(const[i,a]of this._map.entries())a.expiresAt<t&&this._map.delete(i);this._lastCleanup=t}get size(){return this.cleanup(),this._map.size}forEach(t){this.cleanup();for(const[i,a]of this._map.entries())a.expiresAt>=Date.now()&&t(a.value,i,this.asValueMap())}map(t){this.cleanup();const i=[],a=this.asValueMap();for(const[o,l]of a.entries())i.push(t(l,o,a));return i}asValueMap(){const t=new Map;for(const[i,a]of this._map.entries())a.expiresAt>=Date.now()&&t.set(i,a.value);return t}}var Sn={},md={},pd={exports:{}},Cv;function hf(){if(Cv)return pd.exports;Cv=1;var r=pd.exports={v:[{name:"version",reg:/^(\d*)$/}],o:[{name:"origin",reg:/^(\S*) (\d*) (\d*) (\S*) IP(\d) (\S*)/,names:["username","sessionId","sessionVersion","netType","ipVer","address"],format:"%s %s %d %s IP%d %s"}],s:[{name:"name"}],i:[{name:"description"}],u:[{name:"uri"}],e:[{name:"email"}],p:[{name:"phone"}],z:[{name:"timezones"}],r:[{name:"repeats"}],t:[{name:"timing",reg:/^(\d*) (\d*)/,names:["start","stop"],format:"%d %d"}],c:[{name:"connection",reg:/^IN IP(\d) (\S*)/,names:["version","ip"],format:"IN IP%d %s"}],b:[{push:"bandwidth",reg:/^(TIAS|AS|CT|RR|RS):(\d*)/,names:["type","limit"],format:"%s:%s"}],m:[{reg:/^(\w*) (\d*) ([\w/]*)(?: (.*))?/,names:["type","port","protocol","payloads"],format:"%s %d %s %s"}],a:[{push:"rtp",reg:/^rtpmap:(\d*) ([\w\-.]*)(?:\s*\/(\d*)(?:\s*\/(\S*))?)?/,names:["payload","codec","rate","encoding"],format:function(t){return t.encoding?"rtpmap:%d %s/%s/%s":t.rate?"rtpmap:%d %s/%s":"rtpmap:%d %s"}},{push:"fmtp",reg:/^fmtp:(\d*) ([\S| ]*)/,names:["payload","config"],format:"fmtp:%d %s"},{name:"control",reg:/^control:(.*)/,format:"control:%s"},{name:"rtcp",reg:/^rtcp:(\d*)(?: (\S*) IP(\d) (\S*))?/,names:["port","netType","ipVer","address"],format:function(t){return t.address!=null?"rtcp:%d %s IP%d %s":"rtcp:%d"}},{push:"rtcpFbTrrInt",reg:/^rtcp-fb:(\*|\d*) trr-int (\d*)/,names:["payload","value"],format:"rtcp-fb:%s trr-int %d"},{push:"rtcpFb",reg:/^rtcp-fb:(\*|\d*) ([\w-_]*)(?: ([\w-_]*))?/,names:["payload","type","subtype"],format:function(t){return t.subtype!=null?"rtcp-fb:%s %s %s":"rtcp-fb:%s %s"}},{push:"ext",reg:/^extmap:(\d+)(?:\/(\w+))?(?: (urn:ietf:params:rtp-hdrext:encrypt))? (\S*)(?: (\S*))?/,names:["value","direction","encrypt-uri","uri","config"],format:function(t){return"extmap:%d"+(t.direction?"/%s":"%v")+(t["encrypt-uri"]?" %s":"%v")+" %s"+(t.config?" %s":"")}},{name:"extmapAllowMixed",reg:/^(extmap-allow-mixed)/},{push:"crypto",reg:/^crypto:(\d*) ([\w_]*) (\S*)(?: (\S*))?/,names:["id","suite","config","sessionConfig"],format:function(t){return t.sessionConfig!=null?"crypto:%d %s %s %s":"crypto:%d %s %s"}},{name:"setup",reg:/^setup:(\w*)/,format:"setup:%s"},{name:"connectionType",reg:/^connection:(new|existing)/,format:"connection:%s"},{name:"mid",reg:/^mid:([^\s]*)/,format:"mid:%s"},{name:"msid",reg:/^msid:(.*)/,format:"msid:%s"},{name:"ptime",reg:/^ptime:(\d*(?:\.\d*)*)/,format:"ptime:%d"},{name:"maxptime",reg:/^maxptime:(\d*(?:\.\d*)*)/,format:"maxptime:%d"},{name:"direction",reg:/^(sendrecv|recvonly|sendonly|inactive)/},{name:"icelite",reg:/^(ice-lite)/},{name:"iceUfrag",reg:/^ice-ufrag:(\S*)/,format:"ice-ufrag:%s"},{name:"icePwd",reg:/^ice-pwd:(\S*)/,format:"ice-pwd:%s"},{name:"fingerprint",reg:/^fingerprint:(\S*) (\S*)/,names:["type","hash"],format:"fingerprint:%s %s"},{push:"candidates",reg:/^candidate:(\S*) (\d*) (\S*) (\d*) (\S*) (\d*) typ (\S*)(?: raddr (\S*) rport (\d*))?(?: tcptype (\S*))?(?: generation (\d*))?(?: network-id (\d*))?(?: network-cost (\d*))?/,names:["foundation","component","transport","priority","ip","port","type","raddr","rport","tcptype","generation","network-id","network-cost"],format:function(t){var i="candidate:%s %d %s %d %s %d typ %s";return i+=t.raddr!=null?" raddr %s rport %d":"%v%v",i+=t.tcptype!=null?" tcptype %s":"%v",t.generation!=null&&(i+=" generation %d"),i+=t["network-id"]!=null?" network-id %d":"%v",i+=t["network-cost"]!=null?" network-cost %d":"%v",i}},{name:"endOfCandidates",reg:/^(end-of-candidates)/},{name:"remoteCandidates",reg:/^remote-candidates:(.*)/,format:"remote-candidates:%s"},{name:"iceOptions",reg:/^ice-options:(\S*)/,format:"ice-options:%s"},{push:"ssrcs",reg:/^ssrc:(\d*) ([\w_-]*)(?::(.*))?/,names:["id","attribute","value"],format:function(t){var i="ssrc:%d";return t.attribute!=null&&(i+=" %s",t.value!=null&&(i+=":%s")),i}},{push:"ssrcGroups",reg:/^ssrc-group:([\x21\x23\x24\x25\x26\x27\x2A\x2B\x2D\x2E\w]*) (.*)/,names:["semantics","ssrcs"],format:"ssrc-group:%s %s"},{name:"msidSemantic",reg:/^msid-semantic:\s?(\w*) (\S*)/,names:["semantic","token"],format:"msid-semantic: %s %s"},{push:"groups",reg:/^group:(\w*) (.*)/,names:["type","mids"],format:"group:%s %s"},{name:"rtcpMux",reg:/^(rtcp-mux)/},{name:"rtcpRsize",reg:/^(rtcp-rsize)/},{name:"sctpmap",reg:/^sctpmap:([\w_/]*) (\S*)(?: (\S*))?/,names:["sctpmapNumber","app","maxMessageSize"],format:function(t){return t.maxMessageSize!=null?"sctpmap:%s %s %s":"sctpmap:%s %s"}},{name:"xGoogleFlag",reg:/^x-google-flag:([^\s]*)/,format:"x-google-flag:%s"},{push:"rids",reg:/^rid:([\d\w]+) (\w+)(?: ([\S| ]*))?/,names:["id","direction","params"],format:function(t){return t.params?"rid:%s %s %s":"rid:%s %s"}},{push:"imageattrs",reg:new RegExp("^imageattr:(\\d+|\\*)[\\s\\t]+(send|recv)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*)(?:[\\s\\t]+(recv|send)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*))?"),names:["pt","dir1","attrs1","dir2","attrs2"],format:function(t){return"imageattr:%s %s %s"+(t.dir2?" %s %s":"")}},{name:"simulcast",reg:new RegExp("^simulcast:(send|recv) ([a-zA-Z0-9\\-_~;,]+)(?:\\s?(send|recv) ([a-zA-Z0-9\\-_~;,]+))?$"),names:["dir1","list1","dir2","list2"],format:function(t){return"simulcast:%s %s"+(t.dir2?" %s %s":"")}},{name:"simulcast_03",reg:/^simulcast:[\s\t]+([\S+\s\t]+)$/,names:["value"],format:"simulcast: %s"},{name:"framerate",reg:/^framerate:(\d+(?:$|\.\d+))/,format:"framerate:%s"},{name:"sourceFilter",reg:/^source-filter: *(excl|incl) (\S*) (IP4|IP6|\*) (\S*) (.*)/,names:["filterMode","netType","addressTypes","destAddress","srcList"],format:"source-filter: %s %s %s %s %s"},{name:"bundleOnly",reg:/^(bundle-only)/},{name:"label",reg:/^label:(.+)/,format:"label:%s"},{name:"sctpPort",reg:/^sctp-port:(\d+)$/,format:"sctp-port:%s"},{name:"maxMessageSize",reg:/^max-message-size:(\d+)$/,format:"max-message-size:%s"},{push:"tsRefClocks",reg:/^ts-refclk:([^\s=]*)(?:=(\S*))?/,names:["clksrc","clksrcExt"],format:function(t){return"ts-refclk:%s"+(t.clksrcExt!=null?"=%s":"")}},{name:"mediaClk",reg:/^mediaclk:(?:id=(\S*))? *([^\s=]*)(?:=(\S*))?(?: *rate=(\d+)\/(\d+))?/,names:["id","mediaClockName","mediaClockValue","rateNumerator","rateDenominator"],format:function(t){var i="mediaclk:";return i+=t.id!=null?"id=%s %s":"%v%s",i+=t.mediaClockValue!=null?"=%s":"",i+=t.rateNumerator!=null?" rate=%s":"",i+=t.rateDenominator!=null?"/%s":"",i}},{name:"keywords",reg:/^keywds:(.+)$/,format:"keywds:%s"},{name:"content",reg:/^content:(.+)/,format:"content:%s"},{name:"bfcpFloorCtrl",reg:/^floorctrl:(c-only|s-only|c-s)/,format:"floorctrl:%s"},{name:"bfcpConfId",reg:/^confid:(\d+)/,format:"confid:%s"},{name:"bfcpUserId",reg:/^userid:(\d+)/,format:"userid:%s"},{name:"bfcpFloorId",reg:/^floorid:(.+) (?:m-stream|mstrm):(.+)/,names:["id","mStream"],format:"floorid:%s mstrm:%s"},{push:"invalid",names:["value"]}]};return Object.keys(r).forEach(function(t){var i=r[t];i.forEach(function(a){a.reg||(a.reg=/(.*)/),a.format||(a.format="%s")})}),pd.exports}var kv;function OE(){return kv||(kv=1,(function(r){var t=function(u){return String(Number(u))===u?Number(u):u},i=function(u,m,p,g){if(g&&!p)m[g]=t(u[1]);else for(var v=0;v<p.length;v+=1)u[v+1]!=null&&(m[p[v]]=t(u[v+1]))},a=function(u,m,p){var g=u.name&&u.names;u.push&&!m[u.push]?m[u.push]=[]:g&&!m[u.name]&&(m[u.name]={});var v=u.push?{}:g?m[u.name]:m;i(p.match(u.reg),v,u.names,u.name),u.push&&m[u.push].push(v)},o=hf(),l=RegExp.prototype.test.bind(/^([a-z])=(.*)/);r.parse=function(u){var m={},p=[],g=m;return u.split(/(\r\n|\r|\n)/).filter(l).forEach(function(v){var S=v[0],k=v.slice(2);S==="m"&&(p.push({rtp:[],fmtp:[]}),g=p[p.length-1]);for(var O=0;O<(o[S]||[]).length;O+=1){var E=o[S][O];if(E.reg.test(k))return a(E,g,k)}}),m.media=p,m};var f=function(u,m){var p=m.split(/=(.+)/,2);return p.length===2?u[p[0]]=t(p[1]):p.length===1&&m.length>1&&(u[p[0]]=void 0),u};r.parseParams=function(u){return u.split(/;\s?/).reduce(f,{})},r.parseFmtpConfig=r.parseParams,r.parsePayloads=function(u){return u.toString().split(" ").map(Number)},r.parseRemoteCandidates=function(u){for(var m=[],p=u.split(" ").map(t),g=0;g<p.length;g+=3)m.push({component:p[g],ip:p[g+1],port:p[g+2]});return m},r.parseImageAttributes=function(u){return u.split(" ").map(function(m){return m.substring(1,m.length-1).split(",").reduce(f,{})})},r.parseSimulcastStreamList=function(u){return u.split(";").map(function(m){return m.split(",").map(function(p){var g,v=!1;return p[0]!=="~"?g=t(p):(g=t(p.substring(1,p.length)),v=!0),{scid:g,paused:v}})})}})(md)),md}var gd,Ev;function AE(){if(Ev)return gd;Ev=1;var r=hf(),t=/%[sdv%]/g,i=function(f){var u=1,m=arguments,p=m.length;return f.replace(t,function(g){if(u>=p)return g;var v=m[u];switch(u+=1,g){case"%%":return"%";case"%s":return String(v);case"%d":return Number(v);case"%v":return""}})},a=function(f,u,m){var p=u.format instanceof Function?u.format(u.push?m:m[u.name]):u.format,g=[f+"="+p];if(u.names)for(var v=0;v<u.names.length;v+=1){var S=u.names[v];u.name?g.push(m[u.name][S]):g.push(m[u.names[v]])}else g.push(m[u.name]);return i.apply(null,g)},o=["v","o","s","i","u","e","p","c","b","t","r","z","a"],l=["i","c","b","a"];return gd=function(f,u){u=u||{},f.version==null&&(f.version=0),f.name==null&&(f.name=" "),f.media.forEach(function(v){v.payloads==null&&(v.payloads="")});var m=u.outerOrder||o,p=u.innerOrder||l,g=[];return m.forEach(function(v){r[v].forEach(function(S){S.name in f&&f[S.name]!=null?g.push(a(v,S,f)):S.push in f&&f[S.push]!=null&&f[S.push].forEach(function(k){g.push(a(v,S,k))})})}),f.media.forEach(function(v){g.push(a("m",r.m[0],v)),p.forEach(function(S){r[S].forEach(function(k){k.name in v&&v[k.name]!=null?g.push(a(S,k,v)):k.push in v&&v[k.push]!=null&&v[k.push].forEach(function(O){g.push(a(S,k,O))})})})}),g.join(`\r
`)+`\r
`},gd}var _v;function DE(){if(_v)return Sn;_v=1;var r=OE(),t=AE(),i=hf();return Sn.grammar=i,Sn.write=t,Sn.parse=r.parse,Sn.parseParams=r.parseParams,Sn.parseFmtpConfig=r.parseFmtpConfig,Sn.parsePayloads=r.parsePayloads,Sn.parseRemoteCandidates=r.parseRemoteCandidates,Sn.parseImageAttributes=r.parseImageAttributes,Sn.parseSimulcastStreamList=r.parseSimulcastStreamList,Sn}var Li=DE();function mf(r,t,i){var a,o,l;t===void 0&&(t=50),i===void 0&&(i={});var f=(a=i.isImmediate)!=null&&a,u=(o=i.callback)!=null&&o,m=i.maxWait,p=Date.now(),g=[];function v(){if(m!==void 0){var k=Date.now()-p;if(k+t>=m)return m-k}return t}var S=function(){var k=[].slice.call(arguments),O=this;return new Promise(function(E,j){var U=f&&l===void 0;if(l!==void 0&&clearTimeout(l),l=setTimeout(function(){if(l=void 0,p=Date.now(),!f){var Z=r.apply(O,k);u&&u(Z),g.forEach(function(M){return(0,M.resolve)(Z)}),g=[]}},v()),U){var Y=r.apply(O,k);return u&&u(Y),E(Y)}g.push({resolve:E,reject:j})})};return S.cancel=function(k){l!==void 0&&clearTimeout(l),g.forEach(function(O){return(0,O.reject)(k)}),g=[]},S}const ME=.7,wE=20,hs={NegotiationStarted:"negotiationStarted",NegotiationComplete:"negotiationComplete",RTPVideoPayloadTypes:"rtpVideoPayloadTypes"};class Rv extends Ln.EventEmitter{get pc(){return this._pc||(this._pc=this.createPC()),this._pc}constructor(t){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};var a;super(),this.log=Se,this.ddExtID=0,this.latestOfferId=0,this.pendingCandidates=[],this.restartingIce=!1,this.renegotiate=!1,this.trackBitrates=[],this.remoteStereoMids=[],this.remoteNackMids=[],this.negotiate=mf(o=>T(this,void 0,void 0,function*(){this.emit(hs.NegotiationStarted);try{yield this.createAndSendOffer()}catch(l){if(o)o(l);else throw l}}),wE),this.close=()=>{this._pc&&(this._pc.close(),this._pc.onconnectionstatechange=null,this._pc.oniceconnectionstatechange=null,this._pc.onicegatheringstatechange=null,this._pc.ondatachannel=null,this._pc.onnegotiationneeded=null,this._pc.onsignalingstatechange=null,this._pc.onicecandidate=null,this._pc.ondatachannel=null,this._pc.ontrack=null,this._pc.onconnectionstatechange=null,this._pc.oniceconnectionstatechange=null,this._pc=null)},this.log=ci((a=i.loggerName)!==null&&a!==void 0?a:Rn.PCTransport),this.loggerOptions=i,this.config=t,this._pc=this.createPC(),this.offerLock=new xt}createPC(){const t=new RTCPeerConnection(this.config);return t.onicecandidate=i=>{var a;i.candidate&&((a=this.onIceCandidate)===null||a===void 0||a.call(this,i.candidate))},t.onicecandidateerror=i=>{var a;(a=this.onIceCandidateError)===null||a===void 0||a.call(this,i)},t.oniceconnectionstatechange=()=>{var i;(i=this.onIceConnectionStateChange)===null||i===void 0||i.call(this,t.iceConnectionState)},t.onsignalingstatechange=()=>{var i;(i=this.onSignalingStatechange)===null||i===void 0||i.call(this,t.signalingState)},t.onconnectionstatechange=()=>{var i;(i=this.onConnectionStateChange)===null||i===void 0||i.call(this,t.connectionState)},t.ondatachannel=i=>{var a;(a=this.onDataChannel)===null||a===void 0||a.call(this,i)},t.ontrack=i=>{var a;(a=this.onTrack)===null||a===void 0||a.call(this,i)},t}get logContext(){var t,i;return Object.assign({},(i=(t=this.loggerOptions).loggerContextCb)===null||i===void 0?void 0:i.call(t))}get isICEConnected(){return this._pc!==null&&(this.pc.iceConnectionState==="connected"||this.pc.iceConnectionState==="completed")}addIceCandidate(t){return T(this,void 0,void 0,function*(){if(this.pc.remoteDescription&&!this.restartingIce)return this.pc.addIceCandidate(t);this.pendingCandidates.push(t)})}setRemoteDescription(t,i){return T(this,void 0,void 0,function*(){var a;if(t.type==="answer"&&this.latestOfferId>0&&i>0&&i!==this.latestOfferId)return this.log.warn("ignoring answer for old offer",Object.assign(Object.assign({},this.logContext),{offerId:i,latestOfferId:this.latestOfferId})),!1;let o;if(t.type==="offer"){let{stereoMids:l,nackMids:f}=xE(t);this.remoteStereoMids=l,this.remoteNackMids=f}else if(t.type==="answer"){const l=Li.parse((a=t.sdp)!==null&&a!==void 0?a:"");l.media.forEach(f=>{const u=pf(f.mid);f.type==="audio"&&this.trackBitrates.some(m=>{if(!m.transceiver||u!=m.transceiver.mid)return!1;let p=0;if(f.rtp.some(v=>v.codec.toUpperCase()===m.codec.toUpperCase()?(p=v.payload,!0):!1),p===0)return!0;let g=!1;for(const v of f.fmtp)if(v.payload===p){v.config=v.config.split(";").filter(S=>!S.includes("maxaveragebitrate")).join(";"),m.maxbr>0&&(v.config+=";maxaveragebitrate=".concat(m.maxbr*1e3)),g=!0;break}return g||m.maxbr>0&&f.fmtp.push({payload:p,config:"maxaveragebitrate=".concat(m.maxbr*1e3)}),!0})}),o=Li.write(l)}return yield this.setMungedSDP(t,o,!0),this.pendingCandidates.forEach(l=>{this.pc.addIceCandidate(l)}),this.pendingCandidates=[],this.restartingIce=!1,this.renegotiate?(this.renegotiate=!1,yield this.createAndSendOffer()):t.type==="answer"&&(this.emit(hs.NegotiationComplete),t.sdp&&Li.parse(t.sdp).media.forEach(f=>{f.type==="video"&&this.emit(hs.RTPVideoPayloadTypes,f.rtp)})),!0})}createAndSendOffer(t){return T(this,void 0,void 0,function*(){var i;const a=yield this.offerLock.lock();try{if(this.onOffer===void 0)return;if(t!=null&&t.iceRestart&&(this.log.debug("restarting ICE",this.logContext),this.restartingIce=!0),this._pc&&this._pc.signalingState==="have-local-offer"){const u=this._pc.remoteDescription;if(t!=null&&t.iceRestart&&u)yield this._pc.setRemoteDescription(u);else{this.renegotiate=!0;return}}else if(!this._pc||this._pc.signalingState==="closed"){this.log.warn("could not createOffer with closed peer connection",this.logContext);return}this.log.debug("starting to negotiate",this.logContext);const o=this.latestOfferId+1;this.latestOfferId=o;const l=yield this.pc.createOffer(t);this.log.debug("original offer",Object.assign({sdp:l.sdp},this.logContext));const f=Li.parse((i=l.sdp)!==null&&i!==void 0?i:"");if(f.media.forEach(u=>{Av(u),u.type==="audio"?Ov(u,["all"],[]):u.type==="video"&&this.trackBitrates.some(m=>{if(!u.msid||!m.cid||!u.msid.includes(m.cid))return!1;let p=0;if(u.rtp.some(v=>v.codec.toUpperCase()===m.codec.toUpperCase()?(p=v.payload,!0):!1),p===0||(En(m.codec)&&!pa()&&this.ensureVideoDDExtensionForSVC(u,f),!En(m.codec)))return!0;const g=Math.round(m.maxbr*ME);for(const v of u.fmtp)if(v.payload===p){v.config.includes("x-google-start-bitrate")||(v.config+=";x-google-start-bitrate=".concat(g));break}return!0})}),this.latestOfferId>o){this.log.warn("latestOfferId mismatch",Object.assign(Object.assign({},this.logContext),{latestOfferId:this.latestOfferId,offerId:o}));return}yield this.setMungedSDP(l,Li.write(f)),this.onOffer(l,this.latestOfferId)}finally{a()}})}createAndSetAnswer(){return T(this,void 0,void 0,function*(){var t;const i=yield this.pc.createAnswer(),a=Li.parse((t=i.sdp)!==null&&t!==void 0?t:"");return a.media.forEach(o=>{Av(o),o.type==="audio"&&Ov(o,this.remoteStereoMids,this.remoteNackMids)}),yield this.setMungedSDP(i,Li.write(a)),i})}createDataChannel(t,i){return this.pc.createDataChannel(t,i)}addTransceiver(t,i){return this.pc.addTransceiver(t,i)}addTransceiverOfKind(t,i){return this.pc.addTransceiver(t,i)}addTrack(t){if(!this._pc)throw new rt("PC closed, cannot add track");return this._pc.addTrack(t)}setTrackCodecBitrate(t){this.trackBitrates.push(t)}setConfiguration(t){var i;if(!this._pc)throw new rt("PC closed, cannot configure");return(i=this._pc)===null||i===void 0?void 0:i.setConfiguration(t)}canRemoveTrack(){var t;return!!(!((t=this._pc)===null||t===void 0)&&t.removeTrack)}removeTrack(t){var i;return(i=this._pc)===null||i===void 0?void 0:i.removeTrack(t)}getConnectionState(){var t,i;return(i=(t=this._pc)===null||t===void 0?void 0:t.connectionState)!==null&&i!==void 0?i:"closed"}getICEConnectionState(){var t,i;return(i=(t=this._pc)===null||t===void 0?void 0:t.iceConnectionState)!==null&&i!==void 0?i:"closed"}getSignallingState(){var t,i;return(i=(t=this._pc)===null||t===void 0?void 0:t.signalingState)!==null&&i!==void 0?i:"closed"}getTransceivers(){var t,i;return(i=(t=this._pc)===null||t===void 0?void 0:t.getTransceivers())!==null&&i!==void 0?i:[]}getSenders(){var t,i;return(i=(t=this._pc)===null||t===void 0?void 0:t.getSenders())!==null&&i!==void 0?i:[]}getLocalDescription(){var t;return(t=this._pc)===null||t===void 0?void 0:t.localDescription}getRemoteDescription(){var t;return(t=this.pc)===null||t===void 0?void 0:t.remoteDescription}getStats(){return this.pc.getStats()}getConnectedAddress(){return T(this,void 0,void 0,function*(){var t;if(!this._pc)return;let i="";const a=new Map,o=new Map;if((yield this._pc.getStats()).forEach(u=>{switch(u.type){case"transport":i=u.selectedCandidatePairId;break;case"candidate-pair":i===""&&u.selected&&(i=u.id),a.set(u.id,u);break;case"remote-candidate":o.set(u.id,"".concat(u.address,":").concat(u.port));break}}),i==="")return;const f=(t=a.get(i))===null||t===void 0?void 0:t.remoteCandidateId;if(f!==void 0)return o.get(f)})}setMungedSDP(t,i,a){return T(this,void 0,void 0,function*(){if(i){const o=t.sdp;t.sdp=i;try{this.log.debug("setting munged ".concat(a?"remote":"local"," description"),this.logContext),a?yield this.pc.setRemoteDescription(t):yield this.pc.setLocalDescription(t);return}catch(l){this.log.warn("not able to set ".concat(t.type,", falling back to unmodified sdp"),Object.assign(Object.assign({},this.logContext),{error:l,sdp:i})),t.sdp=o}}try{a?yield this.pc.setRemoteDescription(t):yield this.pc.setLocalDescription(t)}catch(o){let l="unknown error";o instanceof Error?l=o.message:typeof o=="string"&&(l=o);const f={error:l,sdp:t.sdp};throw!a&&this.pc.remoteDescription&&(f.remoteSdp=this.pc.remoteDescription),this.log.error("unable to set ".concat(t.type),Object.assign(Object.assign({},this.logContext),{fields:f})),new ls(l)}})}ensureVideoDDExtensionForSVC(t,i){var a,o;if(!((a=t.ext)===null||a===void 0?void 0:a.some(f=>f.uri===lv))){if(this.ddExtID===0){let f=0;i.media.forEach(u=>{var m;u.type==="video"&&((m=u.ext)===null||m===void 0||m.forEach(p=>{p.value>f&&(f=p.value)}))}),this.ddExtID=f+1}(o=t.ext)===null||o===void 0||o.push({value:this.ddExtID,uri:lv})}}}function Ov(r,t,i){const a=pf(r.mid);let o=0;r.rtp.some(l=>l.codec==="opus"?(o=l.payload,!0):!1),o>0&&(r.rtcpFb||(r.rtcpFb=[]),i.includes(a)&&!r.rtcpFb.some(l=>l.payload===o&&l.type==="nack")&&r.rtcpFb.push({payload:o,type:"nack"}),(t.includes(a)||t.length===1&&t[0]==="all")&&r.fmtp.some(l=>l.payload===o?(l.config.includes("stereo=1")||(l.config+=";stereo=1"),!0):!1))}function xE(r){var t;const i=[],a=[],o=Li.parse((t=r.sdp)!==null&&t!==void 0?t:"");let l=0;return o.media.forEach(f=>{var u;const m=pf(f.mid);f.type==="audio"&&(f.rtp.some(p=>p.codec==="opus"?(l=p.payload,!0):!1),!((u=f.rtcpFb)===null||u===void 0)&&u.some(p=>p.payload===l&&p.type==="nack")&&a.push(m),f.fmtp.some(p=>p.payload===l?(p.config.includes("sprop-stereo=1")&&i.push(m),!0):!1))}),{stereoMids:i,nackMids:a}}function Av(r){if(r.connection){const t=r.connection.ip.indexOf(":")>=0;(r.connection.version===4&&t||r.connection.version===6&&!t)&&(r.connection.ip="0.0.0.0",r.connection.version=4)}}function pf(r){return typeof r=="number"?r.toFixed(0):r}const qd="vp8",NE={audioPreset:xd.music,dtx:!0,red:!0,forceStereo:!1,simulcast:!0,screenShareEncoding:lf.h1080fps15.encoding,stopMicTrackOnMute:!1,videoCodec:qd,backupCodec:!0,preConnectBuffer:!1},py={deviceId:{ideal:"default"},autoGainControl:!0,echoCancellation:!0,noiseSuppression:!0,voiceIsolation:!0},gy={deviceId:{ideal:"default"},resolution:Or.h720.resolution},PE={adaptiveStream:!1,dynacast:!1,stopLocalTrackOnUnpublish:!0,reconnectPolicy:new dk,disconnectOnPageLeave:!0,webAudioMix:!1,singlePeerConnection:!0},gf={autoSubscribe:!0,maxRetries:1,peerConnectionTimeout:15e3,websocketTimeout:15e3};var et;(function(r){r[r.NEW=0]="NEW",r[r.CONNECTING=1]="CONNECTING",r[r.CONNECTED=2]="CONNECTED",r[r.FAILED=3]="FAILED",r[r.CLOSING=4]="CLOSING",r[r.CLOSED=5]="CLOSED"})(et||(et={}));class UE{get needsPublisher(){return this.isPublisherConnectionRequired}get needsSubscriber(){return this.isSubscriberConnectionRequired}get currentState(){return this.state}get mode(){return this._mode}constructor(t,i,a){var o;this.peerConnectionTimeout=gf.peerConnectionTimeout,this.log=Se,this.updateState=()=>{var l,f;const u=this.state,m=this.requiredTransports.map(p=>p.getConnectionState());m.every(p=>p==="connected")?this.state=et.CONNECTED:m.some(p=>p==="failed")?this.state=et.FAILED:m.some(p=>p==="connecting")?this.state=et.CONNECTING:m.every(p=>p==="closed")?this.state=et.CLOSED:m.some(p=>p==="closed")?this.state=et.CLOSING:m.every(p=>p==="new")&&(this.state=et.NEW),u!==this.state&&(this.log.debug("pc state change: from ".concat(et[u]," to ").concat(et[this.state]),this.logContext),(l=this.onStateChange)===null||l===void 0||l.call(this,this.state,this.publisher.getConnectionState(),(f=this.subscriber)===null||f===void 0?void 0:f.getConnectionState()))},this.log=ci((o=a.loggerName)!==null&&o!==void 0?o:Rn.PCManager),this.loggerOptions=a,this.isPublisherConnectionRequired=i!=="subscriber-primary",this.isSubscriberConnectionRequired=i==="subscriber-primary",this.publisher=new Rv(t,a),this._mode=i,i!=="publisher-only"&&(this.subscriber=new Rv(t,a),this.subscriber.onConnectionStateChange=this.updateState,this.subscriber.onIceConnectionStateChange=this.updateState,this.subscriber.onSignalingStatechange=this.updateState,this.subscriber.onIceCandidate=l=>{var f;(f=this.onIceCandidate)===null||f===void 0||f.call(this,l,kn.SUBSCRIBER)},this.subscriber.onDataChannel=l=>{var f;(f=this.onDataChannel)===null||f===void 0||f.call(this,l)},this.subscriber.onTrack=l=>{var f;(f=this.onTrack)===null||f===void 0||f.call(this,l)}),this.publisher.onConnectionStateChange=this.updateState,this.publisher.onIceConnectionStateChange=this.updateState,this.publisher.onSignalingStatechange=this.updateState,this.publisher.onIceCandidate=l=>{var f;(f=this.onIceCandidate)===null||f===void 0||f.call(this,l,kn.PUBLISHER)},this.publisher.onTrack=l=>{var f;(f=this.onTrack)===null||f===void 0||f.call(this,l)},this.publisher.onOffer=(l,f)=>{var u;(u=this.onPublisherOffer)===null||u===void 0||u.call(this,l,f)},this.state=et.NEW,this.connectionLock=new xt,this.remoteOfferLock=new xt}get logContext(){var t,i;return Object.assign({},(i=(t=this.loggerOptions).loggerContextCb)===null||i===void 0?void 0:i.call(t))}requirePublisher(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;this.isPublisherConnectionRequired=t,this.updateState()}createAndSendPublisherOffer(t){return this.publisher.createAndSendOffer(t)}setPublisherAnswer(t,i){return this.publisher.setRemoteDescription(t,i)}removeTrack(t){return this.publisher.removeTrack(t)}close(){return T(this,void 0,void 0,function*(){var t;if(this.publisher&&this.publisher.getSignallingState()!=="closed"){const i=this.publisher;for(const a of i.getSenders())try{i.canRemoveTrack()&&i.removeTrack(a)}catch(o){this.log.warn("could not removeTrack",Object.assign(Object.assign({},this.logContext),{error:o}))}}yield Promise.all([this.publisher.close(),(t=this.subscriber)===null||t===void 0?void 0:t.close()]),this.updateState()})}triggerIceRestart(){return T(this,void 0,void 0,function*(){this.subscriber&&(this.subscriber.restartingIce=!0),this.needsPublisher&&(yield this.createAndSendPublisherOffer({iceRestart:!0}))})}addIceCandidate(t,i){return T(this,void 0,void 0,function*(){var a;i===kn.PUBLISHER?yield this.publisher.addIceCandidate(t):yield(a=this.subscriber)===null||a===void 0?void 0:a.addIceCandidate(t)})}createSubscriberAnswerFromOffer(t,i){return T(this,void 0,void 0,function*(){var a,o,l;this.log.debug("received server offer",Object.assign(Object.assign({},this.logContext),{RTCSdpType:t.type,sdp:t.sdp,signalingState:(a=this.subscriber)===null||a===void 0?void 0:a.getSignallingState().toString()}));const f=yield this.remoteOfferLock.lock();try{return(yield(o=this.subscriber)===null||o===void 0?void 0:o.setRemoteDescription(t,i))?yield(l=this.subscriber)===null||l===void 0?void 0:l.createAndSetAnswer():void 0}finally{f()}})}updateConfiguration(t,i){var a;this.publisher.setConfiguration(t),(a=this.subscriber)===null||a===void 0||a.setConfiguration(t),i&&this.triggerIceRestart()}ensurePCTransportConnection(t,i){return T(this,void 0,void 0,function*(){var a;const o=yield this.connectionLock.lock();try{this.isPublisherConnectionRequired&&this.publisher.getConnectionState()!=="connected"&&this.publisher.getConnectionState()!=="connecting"&&(this.log.debug("negotiation required, start negotiating",this.logContext),this.publisher.negotiate()),yield Promise.all((a=this.requiredTransports)===null||a===void 0?void 0:a.map(l=>this.ensureTransportConnected(l,t,i)))}finally{o()}})}negotiate(t){return T(this,void 0,void 0,function*(){return new Ht((i,a)=>T(this,void 0,void 0,function*(){const o=setTimeout(()=>{a(new ls("negotiation timed out"))},this.peerConnectionTimeout),l=()=>{clearTimeout(o),a(new ls("negotiation aborted"))};t.signal.addEventListener("abort",l),this.publisher.once(hs.NegotiationStarted,()=>{t.signal.aborted||this.publisher.once(hs.NegotiationComplete,()=>{clearTimeout(o),i()})}),yield this.publisher.negotiate(f=>{clearTimeout(o),f instanceof Error?a(f):a(new Error(String(f)))})}))})}addPublisherTransceiver(t,i){return this.publisher.addTransceiver(t,i)}addPublisherTransceiverOfKind(t,i){return this.publisher.addTransceiverOfKind(t,i)}getMidForReceiver(t){const a=(this.subscriber?this.subscriber.getTransceivers():this.publisher.getTransceivers()).find(o=>o.receiver===t);return a==null?void 0:a.mid}addPublisherTrack(t){return this.publisher.addTrack(t)}createPublisherDataChannel(t,i){return this.publisher.createDataChannel(t,i)}getConnectedAddress(t){return t===kn.PUBLISHER?this.publisher.getConnectedAddress():t===kn.SUBSCRIBER?this.publisher.getConnectedAddress():this.requiredTransports[0].getConnectedAddress()}get requiredTransports(){const t=[];return this.isPublisherConnectionRequired&&t.push(this.publisher),this.isSubscriberConnectionRequired&&this.subscriber&&t.push(this.subscriber),t}ensureTransportConnected(t,i){return T(this,arguments,void 0,function(a,o){var l=this;let f=arguments.length>2&&arguments[2]!==void 0?arguments[2]:this.peerConnectionTimeout;return(function*(){if(a.getConnectionState()!=="connected")return new Promise((m,p)=>T(l,void 0,void 0,function*(){const g=()=>{this.log.warn("abort transport connection",this.logContext),_t.clearTimeout(v),p(he.cancelled("room connection has been cancelled"))};o!=null&&o.signal.aborted&&g(),o==null||o.signal.addEventListener("abort",g);const v=_t.setTimeout(()=>{o==null||o.signal.removeEventListener("abort",g),p(he.internal("could not establish pc connection"))},f);for(;this.state!==et.CONNECTED;)if(yield Rt(50),o!=null&&o.signal.aborted){p(he.cancelled("room connection has been cancelled"));return}_t.clearTimeout(v),o==null||o.signal.removeEventListener("abort",g),m()}))})()})}}const vy=5e3,LE=3e4;class De{static fetchRegionSettings(t,i,a){return T(this,void 0,void 0,function*(){const o=yield De.fetchLock.lock();try{const l=yield fetch("".concat(IE(t),"/regions"),{headers:{authorization:"Bearer ".concat(i)},signal:a});if(l.ok){const f=sE(l.headers),u=f?f*1e3:vy;return{regionSettings:yield l.json(),updatedAtInMs:Date.now(),maxAgeInMs:u}}else throw l.status===401?he.notAllowed("Could not fetch region settings: ".concat(l.statusText),l.status):he.internal("Could not fetch region settings: ".concat(l.statusText))}catch(l){throw l instanceof he?l:a!=null&&a.aborted?he.cancelled("Region fetching was aborted"):he.serverUnreachable("Could not fetch region settings, ".concat(l instanceof Error?"".concat(l.name,": ").concat(l.message):l))}finally{o()}})}static scheduleRefetch(t,i,a){return T(this,void 0,void 0,function*(){const o=De.settingsTimeouts.get(t.hostname);clearTimeout(o),De.settingsTimeouts.set(t.hostname,setTimeout(()=>T(this,void 0,void 0,function*(){try{const l=yield De.fetchRegionSettings(t,i);De.updateCachedRegionSettings(t,i,l)}catch(l){if(l instanceof he&&l.reason===Ke.NotAllowed){Se.debug("token is not valid, cancelling auto region refresh");return}Se.debug("auto refetching of region settings failed",{error:l}),De.scheduleRefetch(t,i,a)}}),a))})}static updateCachedRegionSettings(t,i,a){De.cache.set(t.hostname,a),De.scheduleRefetch(t,i,a.maxAgeInMs)}static stopRefetch(t){const i=De.settingsTimeouts.get(t);i&&(clearTimeout(i),De.settingsTimeouts.delete(t))}static scheduleCleanup(t){let i=De.connectionTrackers.get(t);i&&(i.cleanupTimeout&&clearTimeout(i.cleanupTimeout),i.cleanupTimeout=setTimeout(()=>{const a=De.connectionTrackers.get(t);a&&a.connectionCount===0&&(Se.debug("stopping region refetch after disconnect delay",{hostname:t}),De.stopRefetch(t)),a&&(a.cleanupTimeout=void 0)},LE))}static cancelCleanup(t){const i=De.connectionTrackers.get(t);i!=null&&i.cleanupTimeout&&(clearTimeout(i.cleanupTimeout),i.cleanupTimeout=void 0)}notifyConnected(){const t=this.serverUrl.hostname;let i=De.connectionTrackers.get(t);i||(i={connectionCount:0},De.connectionTrackers.set(t,i)),i.connectionCount++,De.cancelCleanup(t)}notifyDisconnected(){const t=this.serverUrl.hostname,i=De.connectionTrackers.get(t);i&&(i.connectionCount=Math.max(0,i.connectionCount-1),i.connectionCount===0&&De.scheduleCleanup(t))}constructor(t,i){this.attemptedRegions=[],this.serverUrl=new URL(t),this.token=i}updateToken(t){this.token=t}isCloud(){return ps(this.serverUrl)}getServerUrl(){return this.serverUrl}fetchRegionSettings(t){return T(this,void 0,void 0,function*(){return De.fetchRegionSettings(this.serverUrl,this.token,t)})}getNextBestRegionUrl(t){return T(this,void 0,void 0,function*(){if(!this.isCloud())throw Error("region availability is only supported for LiveKit Cloud domains");let i=De.cache.get(this.serverUrl.hostname);(!i||Date.now()-i.updatedAtInMs>i.maxAgeInMs)&&(i=yield this.fetchRegionSettings(t),De.updateCachedRegionSettings(this.serverUrl,this.token,i));const a=i.regionSettings.regions.filter(o=>!this.attemptedRegions.find(l=>l.url===o.url));if(a.length>0){const o=a[0];return this.attemptedRegions.push(o),Se.debug("next region: ".concat(o.region)),o.url}else return null})}resetAttempts(){this.attemptedRegions=[]}setServerReportedRegions(t){De.updateCachedRegionSettings(this.serverUrl,this.token,t)}}De.cache=new Map;De.settingsTimeouts=new Map;De.connectionTrackers=new Map;De.fetchLock=new xt;function IE(r){return"".concat(r.protocol.replace("ws","http"),"//").concat(r.host,"/settings")}class nt extends Error{constructor(t,i,a){super(i),this.code=t,this.message=Dv(i,nt.MAX_MESSAGE_BYTES),this.data=a?Dv(a,nt.MAX_DATA_BYTES):void 0}static fromProto(t){return new nt(t.code,t.message,t.data)}toProto(){return new l0({code:this.code,message:this.message,data:this.data})}static builtIn(t,i){return new nt(nt.ErrorCode[t],nt.ErrorMessage[t],i)}}nt.MAX_MESSAGE_BYTES=256;nt.MAX_DATA_BYTES=15360;nt.ErrorCode={APPLICATION_ERROR:1500,CONNECTION_TIMEOUT:1501,RESPONSE_TIMEOUT:1502,RECIPIENT_DISCONNECTED:1503,RESPONSE_PAYLOAD_TOO_LARGE:1504,SEND_FAILED:1505,UNSUPPORTED_METHOD:1400,RECIPIENT_NOT_FOUND:1401,REQUEST_PAYLOAD_TOO_LARGE:1402,UNSUPPORTED_SERVER:1403,UNSUPPORTED_VERSION:1404};nt.ErrorMessage={APPLICATION_ERROR:"Application error in method handler",CONNECTION_TIMEOUT:"Connection timeout",RESPONSE_TIMEOUT:"Response timeout",RECIPIENT_DISCONNECTED:"Recipient disconnected",RESPONSE_PAYLOAD_TOO_LARGE:"Response payload too large",SEND_FAILED:"Failed to send",UNSUPPORTED_METHOD:"Method not supported at destination",RECIPIENT_NOT_FOUND:"Recipient not found",REQUEST_PAYLOAD_TOO_LARGE:"Request payload too large",UNSUPPORTED_SERVER:"RPC not supported by server",UNSUPPORTED_VERSION:"Unsupported RPC version"};const yy=15360;function vf(r){return new TextEncoder().encode(r).length}function Dv(r,t){if(vf(r)<=t)return r;let i=0,a=r.length;const o=new TextEncoder;for(;i<a;){const l=Math.floor((i+a+1)/2);o.encode(r.slice(0,l)).length<=t?i=l:a=l-1}return r.slice(0,i)}const yf=2e3;function Mc(r,t){if(!t)return 0;let i,a;return"bytesReceived"in r?(i=r.bytesReceived,a=t.bytesReceived):"bytesSent"in r&&(i=r.bytesSent,a=t.bytesSent),i===void 0||a===void 0||r.timestamp===void 0||t.timestamp===void 0?0:(i-a)*8*1e3/(r.timestamp-t.timestamp)}const bf=typeof MediaRecorder<"u";class jE{constructor(){throw new Error("MediaRecorder is not available in this environment")}}const BE=bf?MediaRecorder:jE;class zE extends BE{constructor(t,i){if(!bf)throw new Error("MediaRecorder is not available in this environment");super(new MediaStream([t.mediaStreamTrack]),i);let a,o;const l=()=>o===void 0,f=()=>{this.removeEventListener("dataavailable",a),this.removeEventListener("stop",f),this.removeEventListener("error",u),o==null||o.close(),o=void 0},u=m=>{o==null||o.error(m),this.removeEventListener("dataavailable",a),this.removeEventListener("stop",f),this.removeEventListener("error",u),o=void 0};this.byteStream=new ReadableStream({start:m=>{o=m,a=p=>T(this,void 0,void 0,function*(){let g;if(p.data.arrayBuffer){const v=yield p.data.arrayBuffer();g=new Uint8Array(v)}else if(p.data.byteArray)g=p.data.byteArray;else throw new Error("no data available!");l()||m.enqueue(g)}),this.addEventListener("dataavailable",a)},cancel:()=>{f()}}),this.addEventListener("stop",f),this.addEventListener("error",u)}}function qE(){return bf}const VE=1e3,HE=1e4;class by extends G{get sender(){return this._sender}set sender(t){this._sender=t}get constraints(){return this._constraints}get hasPreConnectBuffer(){return!!this.localTrackRecorder}constructor(t,i,a){let o=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1,l=arguments.length>4?arguments[4]:void 0;super(t,i,l),this.manuallyStopped=!1,this._isUpstreamPaused=!1,this.handleTrackMuteEvent=()=>this.debouncedTrackMuteHandler().catch(()=>this.log.debug("track mute bounce got cancelled by an unmute event",this.logContext)),this.debouncedTrackMuteHandler=mf(()=>T(this,void 0,void 0,function*(){yield this.pauseUpstream()}),5e3),this.handleTrackUnmuteEvent=()=>T(this,void 0,void 0,function*(){this.debouncedTrackMuteHandler.cancel("unmute"),yield this.resumeUpstream()}),this.handleEnded=()=>{this.isInBackground&&(this.reacquireTrack=!0),this._mediaStreamTrack.removeEventListener("mute",this.handleTrackMuteEvent),this._mediaStreamTrack.removeEventListener("unmute",this.handleTrackUnmuteEvent),this.emit(X.Ended,this)},this.reacquireTrack=!1,this.providedByUser=o,this.muteLock=new xt,this.pauseUpstreamLock=new xt,this.trackChangeLock=new xt,this.trackChangeLock.lock().then(f=>T(this,void 0,void 0,function*(){try{yield this.setMediaStreamTrack(t,!0)}finally{f()}})),this._constraints=t.getConstraints(),a&&(this._constraints=a)}get id(){return this._mediaStreamTrack.id}get dimensions(){if(this.kind!==G.Kind.Video)return;const{width:t,height:i}=this._mediaStreamTrack.getSettings();if(t&&i)return{width:t,height:i}}get isUpstreamPaused(){return this._isUpstreamPaused}get isUserProvided(){return this.providedByUser}get mediaStreamTrack(){var t,i;return(i=(t=this.processor)===null||t===void 0?void 0:t.processedTrack)!==null&&i!==void 0?i:this._mediaStreamTrack}get isLocal(){return!0}getSourceTrackSettings(){return this._mediaStreamTrack.getSettings()}setMediaStreamTrack(t,i){return T(this,void 0,void 0,function*(){var a;if(t===this._mediaStreamTrack&&!i)return;this._mediaStreamTrack&&(this.attachedElements.forEach(l=>{us(this._mediaStreamTrack,l)}),this.debouncedTrackMuteHandler.cancel("new-track"),this._mediaStreamTrack.removeEventListener("ended",this.handleEnded),this._mediaStreamTrack.removeEventListener("mute",this.handleTrackMuteEvent),this._mediaStreamTrack.removeEventListener("unmute",this.handleTrackUnmuteEvent)),this.mediaStream=new MediaStream([t]),t&&(t.addEventListener("ended",this.handleEnded),t.addEventListener("mute",this.handleTrackMuteEvent),t.addEventListener("unmute",this.handleTrackUnmuteEvent),this._constraints=t.getConstraints());let o;if(this.processor&&t){if(this.log.debug("restarting processor",this.logContext),this.kind==="unknown")throw TypeError("cannot set processor on track of unknown kind");this.processorElement&&(as(t,this.processorElement),this.processorElement.muted=!0),yield this.processor.restart({track:t,kind:this.kind,element:this.processorElement}),o=this.processor.processedTrack}this.sender&&((a=this.sender.transport)===null||a===void 0?void 0:a.state)!=="closed"&&(yield this.sender.replaceTrack(o??t)),!this.providedByUser&&this._mediaStreamTrack!==t&&this._mediaStreamTrack.stop(),this._mediaStreamTrack=t,t&&(this._mediaStreamTrack.enabled=!this.isMuted,yield this.resumeUpstream(),this.attachedElements.forEach(l=>{as(o??t,l)}))})}waitForDimensions(){return T(this,arguments,void 0,function(){var t=this;let i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:VE;return(function*(){var a;if(t.kind===G.Kind.Audio)throw new Error("cannot get dimensions for audio tracks");((a=Gt())===null||a===void 0?void 0:a.os)==="iOS"&&(yield Rt(10));const o=Date.now();for(;Date.now()-o<i;){const l=t.dimensions;if(l)return l;yield Rt(50)}throw new oi("unable to get track dimensions after timeout")})()})}setDeviceId(t){return T(this,void 0,void 0,function*(){return this._constraints.deviceId===t&&this._mediaStreamTrack.getSettings().deviceId===zi(t)||(this._constraints.deviceId=t,this.isMuted)?!0:(yield this.restartTrack(),zi(t)===this._mediaStreamTrack.getSettings().deviceId)})}getDeviceId(){return T(this,arguments,void 0,function(){var t=this;let i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;return(function*(){if(t.source===G.Source.ScreenShare)return;const{deviceId:a,groupId:o}=t._mediaStreamTrack.getSettings(),l=t.kind===G.Kind.Audio?"audioinput":"videoinput";return i?bt.getInstance().normalizeDeviceId(l,a,o):a})()})}mute(){return T(this,void 0,void 0,function*(){return this.setTrackMuted(!0),this})}unmute(){return T(this,void 0,void 0,function*(){return this.setTrackMuted(!1),this})}replaceTrack(t,i){return T(this,void 0,void 0,function*(){const a=yield this.trackChangeLock.lock();try{if(!this.sender)throw new oi("unable to replace an unpublished track");let o,l;return typeof i=="boolean"?o=i:i!==void 0&&(o=i.userProvidedTrack,l=i.stopProcessor),this.providedByUser=o??!0,this.log.debug("replace MediaStreamTrack",this.logContext),yield this.setMediaStreamTrack(t),l&&this.processor&&(yield this.internalStopProcessor()),this}finally{a()}})}restart(t){return T(this,void 0,void 0,function*(){this.manuallyStopped=!1;const i=yield this.trackChangeLock.lock();try{t||(t=this._constraints);const{deviceId:a,facingMode:o}=t,l=fk(t,["deviceId","facingMode"]);this.log.debug("restarting track with constraints",Object.assign(Object.assign({},this.logContext),{constraints:t}));const f={audio:!1,video:!1};this.kind===G.Kind.Video?f.video=a||o?{deviceId:a,facingMode:o}:!0:f.audio=a?Object.assign({deviceId:a},l):!0,this.attachedElements.forEach(p=>{us(this.mediaStreamTrack,p)}),this._mediaStreamTrack.removeEventListener("ended",this.handleEnded),this._mediaStreamTrack.stop();const m=(yield navigator.mediaDevices.getUserMedia(f)).getTracks()[0];return this.kind===G.Kind.Video&&(yield m.applyConstraints(l)),m.addEventListener("ended",this.handleEnded),this.log.debug("re-acquired MediaStreamTrack",this.logContext),yield this.setMediaStreamTrack(m),this._constraints=t,this.emit(X.Restarted,this),this.manuallyStopped&&(this.log.warn("track was stopped during a restart, stopping restarted track",this.logContext),this.stop()),this}finally{i()}})}setTrackMuted(t){this.log.debug("setting ".concat(this.kind," track ").concat(t?"muted":"unmuted"),this.logContext),!(this.isMuted===t&&this._mediaStreamTrack.enabled!==t)&&(this.isMuted=t,this._mediaStreamTrack.enabled=!t,this.emit(t?X.Muted:X.Unmuted,this))}get needsReAcquisition(){return this._mediaStreamTrack.readyState!=="live"||this._mediaStreamTrack.muted||!this._mediaStreamTrack.enabled||this.reacquireTrack}handleAppVisibilityChanged(){const t=Object.create(null,{handleAppVisibilityChanged:{get:()=>super.handleAppVisibilityChanged}});return T(this,void 0,void 0,function*(){yield t.handleAppVisibilityChanged.call(this),dy()&&(this.log.debug("visibility changed, is in Background: ".concat(this.isInBackground),this.logContext),!this.isInBackground&&this.needsReAcquisition&&!this.isUserProvided&&!this.isMuted&&(this.log.debug("track needs to be reacquired, restarting ".concat(this.source),this.logContext),yield this.restart(),this.reacquireTrack=!1))})}stop(){var t;this.manuallyStopped=!0,super.stop(),this._mediaStreamTrack.removeEventListener("ended",this.handleEnded),this._mediaStreamTrack.removeEventListener("mute",this.handleTrackMuteEvent),this._mediaStreamTrack.removeEventListener("unmute",this.handleTrackUnmuteEvent),(t=this.processor)===null||t===void 0||t.destroy(),this.processor=void 0}pauseUpstream(){return T(this,void 0,void 0,function*(){var t;const i=yield this.pauseUpstreamLock.lock();try{if(this._isUpstreamPaused===!0)return;if(!this.sender){this.log.warn("unable to pause upstream for an unpublished track",this.logContext);return}this._isUpstreamPaused=!0,this.emit(X.UpstreamPaused,this);const a=Gt();if((a==null?void 0:a.name)==="Safari"&&Un(a.version,"12.0")<0)throw new cf("pauseUpstream is not supported on Safari < 12.");((t=this.sender.transport)===null||t===void 0?void 0:t.state)!=="closed"&&(yield this.sender.replaceTrack(null))}finally{i()}})}resumeUpstream(){return T(this,void 0,void 0,function*(){var t;const i=yield this.pauseUpstreamLock.lock();try{if(this._isUpstreamPaused===!1)return;if(!this.sender){this.log.warn("unable to resume upstream for an unpublished track",this.logContext);return}this._isUpstreamPaused=!1,this.emit(X.UpstreamResumed,this),((t=this.sender.transport)===null||t===void 0?void 0:t.state)!=="closed"&&(yield this.sender.replaceTrack(this.mediaStreamTrack))}finally{i()}})}getRTCStatsReport(){return T(this,void 0,void 0,function*(){var t;return!((t=this.sender)===null||t===void 0)&&t.getStats?yield this.sender.getStats():void 0})}setProcessor(t){return T(this,arguments,void 0,function(i){var a=this;let o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;return(function*(){var l;const f=yield a.trackChangeLock.lock();try{a.log.debug("setting up processor",a.logContext);const u=document.createElement(a.kind),m={kind:a.kind,track:a._mediaStreamTrack,element:u,audioContext:a.audioContext};if(yield i.init(m),a.log.debug("processor initialized",a.logContext),a.processor&&(yield a.internalStopProcessor()),a.kind==="unknown")throw TypeError("cannot set processor on track of unknown kind");if(as(a._mediaStreamTrack,u),u.muted=!0,u.play().catch(p=>{p instanceof DOMException&&p.name==="AbortError"?(a.log.warn("failed to play processor element, retrying",Object.assign(Object.assign({},a.logContext),{error:p})),setTimeout(()=>{u.play().catch(g=>{a.log.error("failed to play processor element",Object.assign(Object.assign({},a.logContext),{err:g}))})},100)):a.log.error("failed to play processor element",Object.assign(Object.assign({},a.logContext),{error:p}))}),a.processor=i,a.processorElement=u,a.processor.processedTrack){for(const p of a.attachedElements)p!==a.processorElement&&o&&(us(a._mediaStreamTrack,p),as(a.processor.processedTrack,p));yield(l=a.sender)===null||l===void 0?void 0:l.replaceTrack(a.processor.processedTrack)}a.emit(X.TrackProcessorUpdate,a.processor)}finally{f()}})()})}getProcessor(){return this.processor}stopProcessor(){return T(this,arguments,void 0,function(){var t=this;let i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;return(function*(){const a=yield t.trackChangeLock.lock();try{yield t.internalStopProcessor(i)}finally{a()}})()})}internalStopProcessor(){return T(this,arguments,void 0,function(){var t=this;let i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;return(function*(){var a,o;t.processor&&(t.log.debug("stopping processor",t.logContext),(a=t.processor.processedTrack)===null||a===void 0||a.stop(),yield t.processor.destroy(),t.processor=void 0,i||((o=t.processorElement)===null||o===void 0||o.remove(),t.processorElement=void 0),yield t._mediaStreamTrack.applyConstraints(t._constraints),yield t.setMediaStreamTrack(t._mediaStreamTrack,!0),t.emit(X.TrackProcessorUpdate))})()})}startPreConnectBuffer(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:100;if(!qE()){this.log.warn("MediaRecorder is not available, cannot start preconnect buffer",this.logContext);return}if(this.localTrackRecorder){this.log.warn("preconnect buffer already started");return}else{let i="audio/webm;codecs=opus";MediaRecorder.isTypeSupported(i)||(i="video/mp4"),this.localTrackRecorder=new zE(this,{mimeType:i})}this.localTrackRecorder.start(t),this.autoStopPreConnectBuffer=setTimeout(()=>{this.log.warn("preconnect buffer timed out, stopping recording automatically",this.logContext),this.stopPreConnectBuffer()},HE)}stopPreConnectBuffer(){clearTimeout(this.autoStopPreConnectBuffer),this.localTrackRecorder&&(this.localTrackRecorder.stop(),this.localTrackRecorder=void 0)}getPreConnectBuffer(){var t;return(t=this.localTrackRecorder)===null||t===void 0?void 0:t.byteStream}getPreConnectBufferMimeType(){var t;return(t=this.localTrackRecorder)===null||t===void 0?void 0:t.mimeType}}class Sc extends by{get enhancedNoiseCancellation(){return this.isKrispNoiseFilterEnabled}constructor(t,i){let a=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0,o=arguments.length>3?arguments[3]:void 0,l=arguments.length>4?arguments[4]:void 0;super(t,G.Kind.Audio,i,a,l),this.stopOnMute=!1,this.isKrispNoiseFilterEnabled=!1,this.monitorSender=()=>T(this,void 0,void 0,function*(){if(!this.sender){this._currentBitrate=0;return}let f;try{f=yield this.getSenderStats()}catch(u){this.log.error("could not get audio sender stats",Object.assign(Object.assign({},this.logContext),{error:u}));return}f&&this.prevStats&&(this._currentBitrate=Mc(f,this.prevStats)),this.prevStats=f}),this.handleKrispNoiseFilterEnable=()=>{this.isKrispNoiseFilterEnabled=!0,this.log.debug("Krisp noise filter enabled",this.logContext),this.emit(X.AudioTrackFeatureUpdate,this,yt.TF_ENHANCED_NOISE_CANCELLATION,!0)},this.handleKrispNoiseFilterDisable=()=>{this.isKrispNoiseFilterEnabled=!1,this.log.debug("Krisp noise filter disabled",this.logContext),this.emit(X.AudioTrackFeatureUpdate,this,yt.TF_ENHANCED_NOISE_CANCELLATION,!1)},this.audioContext=o,this.checkForSilence()}mute(){const t=Object.create(null,{mute:{get:()=>super.mute}});return T(this,void 0,void 0,function*(){const i=yield this.muteLock.lock();try{return this.isMuted?(this.log.debug("Track already muted",this.logContext),this):(this.source===G.Source.Microphone&&this.stopOnMute&&!this.isUserProvided&&(this.log.debug("stopping mic track",this.logContext),this._mediaStreamTrack.stop()),yield t.mute.call(this),this)}finally{i()}})}unmute(){const t=Object.create(null,{unmute:{get:()=>super.unmute}});return T(this,void 0,void 0,function*(){const i=yield this.muteLock.lock();try{if(!this.isMuted)return this.log.debug("Track already unmuted",this.logContext),this;const a=this._constraints.deviceId&&this._mediaStreamTrack.getSettings().deviceId!==zi(this._constraints.deviceId);return this.source===G.Source.Microphone&&(this.stopOnMute||this._mediaStreamTrack.readyState==="ended"||a)&&!this.isUserProvided&&(this.log.debug("reacquiring mic track",this.logContext),yield this.restartTrack()),yield t.unmute.call(this),this}finally{i()}})}restartTrack(t){return T(this,void 0,void 0,function*(){let i;if(t){const a=uf({audio:t});typeof a.audio!="boolean"&&(i=a.audio)}yield this.restart(i)})}restart(t){const i=Object.create(null,{restart:{get:()=>super.restart}});return T(this,void 0,void 0,function*(){const a=yield i.restart.call(this,t);return this.checkForSilence(),a})}startMonitor(){Ft()&&(this.monitorInterval||(this.monitorInterval=setInterval(()=>{this.monitorSender()},yf)))}setProcessor(t){return T(this,void 0,void 0,function*(){var i;const a=yield this.trackChangeLock.lock();try{if(!Pn()&&!this.audioContext)throw Error("Audio context needs to be set on LocalAudioTrack in order to enable processors");this.processor&&(yield this.internalStopProcessor());const o={kind:this.kind,track:this._mediaStreamTrack,audioContext:this.audioContext};this.log.debug("setting up audio processor ".concat(t.name),this.logContext),yield t.init(o),this.processor=t,this.processor.processedTrack&&(yield(i=this.sender)===null||i===void 0?void 0:i.replaceTrack(this.processor.processedTrack),this.processor.processedTrack.addEventListener("enable-lk-krisp-noise-filter",this.handleKrispNoiseFilterEnable),this.processor.processedTrack.addEventListener("disable-lk-krisp-noise-filter",this.handleKrispNoiseFilterDisable)),this.emit(X.TrackProcessorUpdate,this.processor)}finally{a()}})}setAudioContext(t){this.audioContext=t}getSenderStats(){return T(this,void 0,void 0,function*(){var t;if(!(!((t=this.sender)===null||t===void 0)&&t.getStats))return;const i=yield this.sender.getStats();let a;return i.forEach(o=>{o.type==="outbound-rtp"&&(a={type:"audio",streamId:o.id,packetsSent:o.packetsSent,packetsLost:o.packetsLost,bytesSent:o.bytesSent,timestamp:o.timestamp,roundTripTime:o.roundTripTime,jitter:o.jitter})}),a})}checkForSilence(){return T(this,void 0,void 0,function*(){const t=yield cy(this);return t&&(this.isMuted||this.log.debug("silence detected on local audio track",this.logContext),this.emit(X.AudioSilenceDetected)),t})}}function FE(r,t,i){switch(r.kind){case"audio":return new Sc(r,t,!1,void 0,i);case"video":return new Tc(r,t,!1,i);default:throw new oi("unsupported track type: ".concat(r.kind))}}const GE=Object.values(Or),KE=Object.values(Nd),YE=Object.values(lf),QE=[Or.h180,Or.h360],JE=[Nd.h180,Nd.h360],XE=r=>[{scaleResolutionDownBy:2,fps:r.encoding.maxFramerate}].map(i=>{var a,o;return new He(Math.floor(r.width/i.scaleResolutionDownBy),Math.floor(r.height/i.scaleResolutionDownBy),Math.max(15e4,Math.floor(r.encoding.maxBitrate/(Math.pow(i.scaleResolutionDownBy,2)*(((a=r.encoding.maxFramerate)!==null&&a!==void 0?a:30)/((o=i.fps)!==null&&o!==void 0?o:30))))),i.fps,r.encoding.priority)}),Vd=["q","h","f"];function Hd(r,t,i,a){var o,l;let f=a==null?void 0:a.videoEncoding;r&&(f=a==null?void 0:a.screenShareEncoding);const u=a==null?void 0:a.simulcast,m=a==null?void 0:a.scalabilityMode,p=a==null?void 0:a.videoCodec;if(!f&&!u&&!m||!t||!i)return[{}];f||(f=WE(r,t,i,p),Se.debug("using video encoding",f));const g=f.maxFramerate,v=new He(t,i,f.maxBitrate,f.maxFramerate,f.priority);if(m&&En(p)){const O=new Sy(m),E=[];if(O.spatial>3)throw new Error("unsupported scalabilityMode: ".concat(m));const j=Gt();if(Ar()||Pn()||(j==null?void 0:j.name)==="Chrome"&&Un(j==null?void 0:j.version,"113")<0){const U=O.suffix=="h"?2:3,Y=Yk(j);for(let Z=0;Z<O.spatial;Z+=1)E.push({rid:Vd[2-Z],maxBitrate:f.maxBitrate/Math.pow(U,Z),maxFramerate:v.encoding.maxFramerate,scaleResolutionDownBy:Y?Math.pow(2,Z):void 0});E[0].scalabilityMode=m}else E.push({maxBitrate:f.maxBitrate,maxFramerate:v.encoding.maxFramerate,scalabilityMode:m});return v.encoding.priority&&(E[0].priority=v.encoding.priority,E[0].networkPriority=v.encoding.priority),Se.debug("using svc encoding",{encodings:E}),E}if(!u)return[f];let S=[];r?S=(o=wv(a==null?void 0:a.screenShareSimulcastLayers))!==null&&o!==void 0?o:Mv(r,v):S=(l=wv(a==null?void 0:a.videoSimulcastLayers))!==null&&l!==void 0?l:Mv(r,v);let k;if(S.length>0){const O=S[0];S.length>1&&([,k]=S);const E=Math.max(t,i);if(E>=960&&k)return vd(t,i,[O,k,v],g);if(E>=480)return vd(t,i,[O,v],g)}return vd(t,i,[v])}function ZE(r,t,i){var a,o,l,f;if(!i.backupCodec||i.backupCodec===!0||i.backupCodec.codec===i.videoCodec)return;t!==i.backupCodec.codec&&Se.warn("requested a different codec than specified as backup",{serverRequested:t,backup:i.backupCodec.codec}),i.videoCodec=t,i.videoEncoding=i.backupCodec.encoding;const u=r.mediaStreamTrack.getSettings(),m=(a=u.width)!==null&&a!==void 0?a:(o=r.dimensions)===null||o===void 0?void 0:o.width,p=(l=u.height)!==null&&l!==void 0?l:(f=r.dimensions)===null||f===void 0?void 0:f.height;return r.source===G.Source.ScreenShare&&i.simulcast&&(i.simulcast=!1),Hd(r.source===G.Source.ScreenShare,m,p,i)}function WE(r,t,i,a){const o=$E(r,t,i);let{encoding:l}=o[0];const f=Math.max(t,i);for(let u=0;u<o.length;u+=1){const m=o[u];if(l=m.encoding,m.width>=f)break}if(a)switch(a){case"av1":case"h265":l=Object.assign({},l),l.maxBitrate=l.maxBitrate*.7;break;case"vp9":l=Object.assign({},l),l.maxBitrate=l.maxBitrate*.85;break}return l}function $E(r,t,i){if(r)return YE;const a=t>i?t/i:i/t;return Math.abs(a-16/9)<Math.abs(a-4/3)?GE:KE}function Mv(r,t){if(r)return XE(t);const{width:i,height:a}=t,o=i>a?i/a:a/i;return Math.abs(o-16/9)<Math.abs(o-4/3)?QE:JE}function vd(r,t,i,a){const o=[];if(i.forEach((l,f)=>{if(f>=Vd.length)return;const u=Math.min(r,t),p={rid:Vd[f],scaleResolutionDownBy:Math.max(1,u/Math.min(l.width,l.height)),maxBitrate:l.encoding.maxBitrate},g=a&&l.encoding.maxFramerate?Math.min(a,l.encoding.maxFramerate):l.encoding.maxFramerate;g&&(p.maxFramerate=g);const v=ma()||f===0;l.encoding.priority&&v&&(p.priority=l.encoding.priority,p.networkPriority=l.encoding.priority),o.push(p)}),Pn()&&hy()==="ios"){let l;o.forEach(u=>{l?u.maxFramerate&&u.maxFramerate>l&&(l=u.maxFramerate):l=u.maxFramerate});let f=!0;o.forEach(u=>{var m;u.maxFramerate!=l&&(f&&(f=!1,Se.info("Simulcast on iOS React-Native requires all encodings to share the same framerate.")),Se.info('Setting framerate of encoding "'.concat((m=u.rid)!==null&&m!==void 0?m:"",'" to ').concat(l)),u.maxFramerate=l)})}return o}function wv(r){if(r)return r.sort((t,i)=>{const{encoding:a}=t,{encoding:o}=i;return a.maxBitrate>o.maxBitrate?1:a.maxBitrate<o.maxBitrate?-1:a.maxBitrate===o.maxBitrate&&a.maxFramerate&&o.maxFramerate?a.maxFramerate>o.maxFramerate?1:-1:0})}class Sy{constructor(t){const i=t.match(/^L(\d)T(\d)(h|_KEY|_KEY_SHIFT){0,1}$/);if(!i)throw new Error("invalid scalability mode");if(this.spatial=parseInt(i[1]),this.temporal=parseInt(i[2]),i.length>3)switch(i[3]){case"h":case"_KEY":case"_KEY_SHIFT":this.suffix=i[3]}}toString(){var t;return"L".concat(this.spatial,"T").concat(this.temporal).concat((t=this.suffix)!==null&&t!==void 0?t:"")}}function e1(r){return r.source===G.Source.ScreenShare||r.constraints.height&&zi(r.constraints.height)>=1080?"maintain-resolution":"balanced"}const t1=5e3;class Tc extends by{get sender(){return this._sender}set sender(t){this._sender=t,this.degradationPreference&&this.setDegradationPreference(this.degradationPreference)}constructor(t,i){let a=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0,o=arguments.length>3?arguments[3]:void 0;super(t,G.Kind.Video,i,a,o),this.simulcastCodecs=new Map,this.degradationPreference="balanced",this.isCpuConstrained=!1,this.optimizeForPerformance=!1,this.monitorSender=()=>T(this,void 0,void 0,function*(){if(!this.sender){this._currentBitrate=0;return}let l;try{l=yield this.getSenderStats()}catch(m){this.log.error("could not get video sender stats",Object.assign(Object.assign({},this.logContext),{error:m}));return}const f=new Map(l.map(m=>[m.rid,m])),u=l.some(m=>m.qualityLimitationReason==="cpu");if(u!==this.isCpuConstrained&&(this.isCpuConstrained=u,this.isCpuConstrained&&this.emit(X.CpuConstrained)),this.prevStats){let m=0;f.forEach((p,g)=>{var v;const S=(v=this.prevStats)===null||v===void 0?void 0:v.get(g);m+=Mc(p,S)}),this._currentBitrate=m}this.prevStats=f}),this.senderLock=new xt}get isSimulcast(){return!!(this.sender&&this.sender.getParameters().encodings.length>1)}startMonitor(t){var i;if(this.signalClient=t,!Ft())return;const a=(i=this.sender)===null||i===void 0?void 0:i.getParameters();a&&(this.encodings=a.encodings),!this.monitorInterval&&(this.monitorInterval=setInterval(()=>{this.monitorSender()},yf))}stop(){this._mediaStreamTrack.getConstraints(),this.simulcastCodecs.forEach(t=>{t.mediaStreamTrack.stop()}),super.stop()}pauseUpstream(){const t=Object.create(null,{pauseUpstream:{get:()=>super.pauseUpstream}});return T(this,void 0,void 0,function*(){var i,a,o,l,f;yield t.pauseUpstream.call(this);try{for(var u=!0,m=ri(this.simulcastCodecs.values()),p;p=yield m.next(),i=p.done,!i;u=!0)l=p.value,u=!1,yield(f=l.sender)===null||f===void 0?void 0:f.replaceTrack(null)}catch(g){a={error:g}}finally{try{!u&&!i&&(o=m.return)&&(yield o.call(m))}finally{if(a)throw a.error}}})}resumeUpstream(){const t=Object.create(null,{resumeUpstream:{get:()=>super.resumeUpstream}});return T(this,void 0,void 0,function*(){var i,a,o,l,f;yield t.resumeUpstream.call(this);try{for(var u=!0,m=ri(this.simulcastCodecs.values()),p;p=yield m.next(),i=p.done,!i;u=!0){l=p.value,u=!1;const g=l;yield(f=g.sender)===null||f===void 0?void 0:f.replaceTrack(g.mediaStreamTrack)}}catch(g){a={error:g}}finally{try{!u&&!i&&(o=m.return)&&(yield o.call(m))}finally{if(a)throw a.error}}})}mute(){const t=Object.create(null,{mute:{get:()=>super.mute}});return T(this,void 0,void 0,function*(){const i=yield this.muteLock.lock();try{return this.isMuted?(this.log.debug("Track already muted",this.logContext),this):(this.source===G.Source.Camera&&!this.isUserProvided&&(this.log.debug("stopping camera track",this.logContext),this._mediaStreamTrack.stop()),yield t.mute.call(this),this)}finally{i()}})}unmute(){const t=Object.create(null,{unmute:{get:()=>super.unmute}});return T(this,void 0,void 0,function*(){const i=yield this.muteLock.lock();try{return this.isMuted?(this.source===G.Source.Camera&&!this.isUserProvided&&(this.log.debug("reacquiring camera track",this.logContext),yield this.restartTrack()),yield t.unmute.call(this),this):(this.log.debug("Track already unmuted",this.logContext),this)}finally{i()}})}setTrackMuted(t){super.setTrackMuted(t);for(const i of this.simulcastCodecs.values())i.mediaStreamTrack.enabled=!t}getSenderStats(){return T(this,void 0,void 0,function*(){var t;if(!(!((t=this.sender)===null||t===void 0)&&t.getStats))return[];const i=[],a=yield this.sender.getStats();return a.forEach(o=>{var l;if(o.type==="outbound-rtp"){const f={type:"video",streamId:o.id,frameHeight:o.frameHeight,frameWidth:o.frameWidth,framesPerSecond:o.framesPerSecond,framesSent:o.framesSent,firCount:o.firCount,pliCount:o.pliCount,nackCount:o.nackCount,packetsSent:o.packetsSent,bytesSent:o.bytesSent,qualityLimitationReason:o.qualityLimitationReason,qualityLimitationDurations:o.qualityLimitationDurations,qualityLimitationResolutionChanges:o.qualityLimitationResolutionChanges,rid:(l=o.rid)!==null&&l!==void 0?l:o.id,retransmittedPacketsSent:o.retransmittedPacketsSent,targetBitrate:o.targetBitrate,timestamp:o.timestamp},u=a.get(o.remoteId);u&&(f.jitter=u.jitter,f.packetsLost=u.packetsLost,f.roundTripTime=u.roundTripTime),i.push(f)}}),i.sort((o,l)=>{var f,u;return((f=l.frameWidth)!==null&&f!==void 0?f:0)-((u=o.frameWidth)!==null&&u!==void 0?u:0)}),i})}setPublishingQuality(t){const i=[];for(let a=nn.LOW;a<=nn.HIGH;a+=1)i.push(new af({quality:a,enabled:a<=t}));this.log.debug("setting publishing quality. max quality ".concat(t),this.logContext),this.setPublishingLayers(En(this.codec),i)}restartTrack(t){return T(this,void 0,void 0,function*(){var i,a,o,l,f;let u;if(t){const v=uf({video:t});typeof v.video!="boolean"&&(u=v.video)}yield this.restart(u),this.isCpuConstrained=!1;try{for(var m=!0,p=ri(this.simulcastCodecs.values()),g;g=yield p.next(),i=g.done,!i;m=!0){l=g.value,m=!1;const v=l;v.sender&&((f=v.sender.transport)===null||f===void 0?void 0:f.state)!=="closed"&&(v.mediaStreamTrack=this.mediaStreamTrack.clone(),yield v.sender.replaceTrack(v.mediaStreamTrack))}}catch(v){a={error:v}}finally{try{!m&&!i&&(o=p.return)&&(yield o.call(p))}finally{if(a)throw a.error}}})}setProcessor(t){const i=Object.create(null,{setProcessor:{get:()=>super.setProcessor}});return T(this,arguments,void 0,function(a){var o=this;let l=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;return(function*(){var f,u,m,p,g,v;if(yield i.setProcessor.call(o,a,l),!((g=o.processor)===null||g===void 0)&&g.processedTrack)try{for(var S=!0,k=ri(o.simulcastCodecs.values()),O;O=yield k.next(),f=O.done,!f;S=!0)p=O.value,S=!1,yield(v=p.sender)===null||v===void 0?void 0:v.replaceTrack(o.processor.processedTrack)}catch(E){u={error:E}}finally{try{!S&&!f&&(m=k.return)&&(yield m.call(k))}finally{if(u)throw u.error}}})()})}setDegradationPreference(t){return T(this,void 0,void 0,function*(){if(this.degradationPreference=t,this.sender)try{this.log.debug("setting degradationPreference to ".concat(t),this.logContext);const i=this.sender.getParameters();i.degradationPreference=t,this.sender.setParameters(i)}catch(i){this.log.warn("failed to set degradationPreference",Object.assign({error:i},this.logContext))}})}addSimulcastTrack(t,i){if(this.simulcastCodecs.has(t)){this.log.error("".concat(t," already added, skipping adding simulcast codec"),this.logContext);return}const a={codec:t,mediaStreamTrack:this.mediaStreamTrack.clone(),sender:void 0,encodings:i};return this.simulcastCodecs.set(t,a),a}setSimulcastTrackSender(t,i){const a=this.simulcastCodecs.get(t);a&&(a.sender=i,setTimeout(()=>{this.subscribedCodecs&&this.setPublishingCodecs(this.subscribedCodecs)},t1))}setPublishingCodecs(t){return T(this,void 0,void 0,function*(){var i,a,o,l,f,u,m;if(this.log.debug("setting publishing codecs",Object.assign(Object.assign({},this.logContext),{codecs:t,currentCodec:this.codec})),!this.codec&&t.length>0)return yield this.setPublishingLayers(En(t[0].codec),t[0].qualities),[];this.subscribedCodecs=t;const p=[];try{for(i=!0,a=ri(t);o=yield a.next(),l=o.done,!l;i=!0){m=o.value,i=!1;const g=m;if(!this.codec||this.codec===g.codec)yield this.setPublishingLayers(En(g.codec),g.qualities);else{const v=this.simulcastCodecs.get(g.codec);if(this.log.debug("try setPublishingCodec for ".concat(g.codec),Object.assign(Object.assign({},this.logContext),{simulcastCodecInfo:v})),!v||!v.sender){for(const S of g.qualities)if(S.enabled){p.push(g.codec);break}}else v.encodings&&(this.log.debug("try setPublishingLayersForSender ".concat(g.codec),this.logContext),yield xv(v.sender,v.encodings,g.qualities,this.senderLock,En(g.codec),this.log,this.logContext))}}}catch(g){f={error:g}}finally{try{!i&&!l&&(u=a.return)&&(yield u.call(a))}finally{if(f)throw f.error}}return p})}setPublishingLayers(t,i){return T(this,void 0,void 0,function*(){if(this.optimizeForPerformance){this.log.info("skipping setPublishingLayers due to optimized publishing performance",Object.assign(Object.assign({},this.logContext),{qualities:i}));return}this.log.debug("setting publishing layers",Object.assign(Object.assign({},this.logContext),{qualities:i})),!(!this.sender||!this.encodings)&&(yield xv(this.sender,this.encodings,i,this.senderLock,t,this.log,this.logContext))})}prioritizePerformance(){return T(this,void 0,void 0,function*(){if(!this.sender)throw new Error("sender not found");const t=yield this.senderLock.lock();try{this.optimizeForPerformance=!0;const i=this.sender.getParameters();i.encodings=i.encodings.map((a,o)=>{var l;return Object.assign(Object.assign({},a),{active:o===0,scaleResolutionDownBy:Math.max(1,Math.ceil(((l=this.mediaStreamTrack.getSettings().height)!==null&&l!==void 0?l:360)/360)),scalabilityMode:o===0&&En(this.codec)?"L1T3":void 0,maxFramerate:o===0?15:0,maxBitrate:o===0?a.maxBitrate:0})}),this.log.debug("setting performance optimised encodings",Object.assign(Object.assign({},this.logContext),{encodings:i.encodings})),this.encodings=i.encodings,yield this.sender.setParameters(i)}catch(i){this.log.error("failed to set performance optimised encodings",Object.assign(Object.assign({},this.logContext),{error:i})),this.optimizeForPerformance=!1}finally{t()}})}handleAppVisibilityChanged(){const t=Object.create(null,{handleAppVisibilityChanged:{get:()=>super.handleAppVisibilityChanged}});return T(this,void 0,void 0,function*(){yield t.handleAppVisibilityChanged.call(this),dy()&&this.isInBackground&&this.source===G.Source.Camera&&(this._mediaStreamTrack.enabled=!1)})}}function xv(r,t,i,a,o,l,f){return T(this,void 0,void 0,function*(){const u=yield a.lock();l.debug("setPublishingLayersForSender",Object.assign(Object.assign({},f),{sender:r,qualities:i,senderEncodings:t}));try{const m=r.getParameters(),{encodings:p}=m;if(!p)return;if(p.length!==t.length){l.warn("cannot set publishing layers, encodings mismatch",Object.assign(Object.assign({},f),{encodings:p,senderEncodings:t}));return}let g=!1;!1&&p[0].scalabilityMode||(o&&i.some(k=>k.enabled)&&i.forEach(k=>k.enabled=!0),p.forEach((S,k)=>{var O;let E=(O=S.rid)!==null&&O!==void 0?O:"";E===""&&(E="q");const j=Ty(E),U=i.find(Y=>Y.quality===j);U&&S.active!==U.enabled&&(g=!0,S.active=U.enabled,l.debug("setting layer ".concat(U.quality," to ").concat(S.active?"enabled":"disabled"),f),ma()&&(U.enabled?(S.scaleResolutionDownBy=t[k].scaleResolutionDownBy,S.maxBitrate=t[k].maxBitrate,S.maxFrameRate=t[k].maxFrameRate):(S.scaleResolutionDownBy=4,S.maxBitrate=10,S.maxFrameRate=2)))})),g&&(m.encodings=p,l.debug("setting encodings",Object.assign(Object.assign({},f),{encodings:m.encodings})),yield r.setParameters(m))}finally{u()}})}function Ty(r){switch(r){case"f":return nn.HIGH;case"h":return nn.MEDIUM;case"q":return nn.LOW;default:return nn.HIGH}}function Nv(r,t,i,a){if(!i)return[new Bi({quality:nn.HIGH,width:r,height:t,bitrate:0,ssrc:0})];if(a){const o=i[0].scalabilityMode,l=new Sy(o),f=[],u=l.suffix=="h"?1.5:2,m=l.suffix=="h"?2:3;for(let p=0;p<l.spatial;p+=1)f.push(new Bi({quality:Math.min(nn.HIGH,l.spatial-1)-p,width:Math.ceil(r/Math.pow(u,p)),height:Math.ceil(t/Math.pow(u,p)),bitrate:i[0].maxBitrate?Math.ceil(i[0].maxBitrate/Math.pow(m,p)):0,ssrc:0}));return f}return i.map(o=>{var l,f,u;const m=(l=o.scaleResolutionDownBy)!==null&&l!==void 0?l:1;let p=Ty((f=o.rid)!==null&&f!==void 0?f:"");return new Bi({quality:p,width:Math.ceil(r/m),height:Math.ceil(t/m),bitrate:(u=o.maxBitrate)!==null&&u!==void 0?u:0,ssrc:0})})}const Pv="_lossy",Uv="_reliable",n1=2*1e3,yd="leave-reconnect",i1=3e4,a1=8*1024,s1=256*1024;var mn;(function(r){r[r.New=0]="New",r[r.Connected=1]="Connected",r[r.Disconnected=2]="Disconnected",r[r.Reconnecting=3]="Reconnecting",r[r.Closed=4]="Closed"})(mn||(mn={}));class r1 extends Ln.EventEmitter{get isClosed(){return this._isClosed}get pendingReconnect(){return!!this.reconnectTimeout}constructor(t){var i;super(),this.options=t,this.rtcConfig={},this.peerConnectionTimeout=gf.peerConnectionTimeout,this.fullReconnectOnNext=!1,this.latestRemoteOfferId=0,this.subscriberPrimary=!1,this.pcState=mn.New,this._isClosed=!0,this.pendingTrackResolvers={},this.reconnectAttempts=0,this.reconnectStart=0,this.attemptingReconnect=!1,this.joinAttempts=0,this.maxJoinAttempts=1,this.shouldFailNext=!1,this.log=Se,this.reliableDataSequence=1,this.reliableMessageBuffer=new Tv,this.reliableReceivedState=new RE(i1),this.lossyDataStatCurrentBytes=0,this.lossyDataStatByterate=0,this.lossyDataDropCount=0,this.midToTrackId={},this.isWaitingForNetworkReconnect=!1,this.handleDataChannel=a=>T(this,[a],void 0,function(o){var l=this;let{channel:f}=o;return(function*(){if(f){if(f.label===Uv)l.reliableDCSub=f;else if(f.label===Pv)l.lossyDCSub=f;else return;l.log.debug("on data channel ".concat(f.id,", ").concat(f.label),l.logContext),f.onmessage=l.handleDataMessage}})()}),this.handleDataMessage=a=>T(this,void 0,void 0,function*(){var o,l,f,u,m;const p=yield this.dataProcessLock.lock();try{let g;if(a.data instanceof ArrayBuffer)g=a.data;else if(a.data instanceof Blob)g=yield a.data.arrayBuffer();else{this.log.error("unsupported data type",Object.assign(Object.assign({},this.logContext),{data:a.data}));return}const v=wt.fromBinary(new Uint8Array(g));if(v.sequence>0&&v.participantSid!==""){const S=this.reliableReceivedState.get(v.participantSid);if(S&&v.sequence<=S)return;this.reliableReceivedState.set(v.participantSid,v.sequence)}if(((o=v.value)===null||o===void 0?void 0:o.case)==="speaker")this.emit($.ActiveSpeakersUpdate,v.value.value.speakers);else if(((l=v.value)===null||l===void 0?void 0:l.case)==="encryptedPacket"){if(!this.e2eeManager){this.log.error("Received encrypted packet but E2EE not set up",this.logContext);return}const S=yield(f=this.e2eeManager)===null||f===void 0?void 0:f.handleEncryptedData(v.value.value.encryptedValue,v.value.value.iv,v.participantIdentity,v.value.value.keyIndex),k=r0.fromBinary(S.payload),O=new wt({value:k.value,participantIdentity:v.participantIdentity,participantSid:v.participantSid});((u=O.value)===null||u===void 0?void 0:u.case)==="user"&&Lv(O,O.value.value),this.emit($.DataPacketReceived,O,v.value.value.encryptionType)}else((m=v.value)===null||m===void 0?void 0:m.case)==="user"&&Lv(v,v.value.value),this.emit($.DataPacketReceived,v,pt.NONE)}finally{p()}}),this.handleDataError=a=>{const l=a.currentTarget.maxRetransmits===0?"lossy":"reliable";if(a instanceof ErrorEvent&&a.error){const{error:f}=a.error;this.log.error("DataChannel error on ".concat(l,": ").concat(a.message),Object.assign(Object.assign({},this.logContext),{error:f}))}else this.log.error("Unknown DataChannel error on ".concat(l),Object.assign(Object.assign({},this.logContext),{event:a}))},this.handleBufferedAmountLow=a=>{const l=a.currentTarget.maxRetransmits===0?Te.LOSSY:Te.RELIABLE;this.updateAndEmitDCBufferStatus(l)},this.handleDisconnect=(a,o)=>{if(this._isClosed)return;this.log.warn("".concat(a," disconnected"),this.logContext),this.reconnectAttempts===0&&(this.reconnectStart=Date.now());const l=m=>{this.log.warn("could not recover connection after ".concat(this.reconnectAttempts," attempts, ").concat(m,"ms. giving up"),this.logContext),this.emit($.Disconnected),this.close()},f=Date.now()-this.reconnectStart;let u=this.getNextRetryDelay({elapsedMs:f,retryCount:this.reconnectAttempts});if(u===null){l(f);return}a===yd&&(u=0),this.log.debug("reconnecting in ".concat(u,"ms"),this.logContext),this.clearReconnectTimeout(),this.token&&this.regionUrlProvider&&this.regionUrlProvider.updateToken(this.token),this.reconnectTimeout=_t.setTimeout(()=>this.attemptReconnect(o).finally(()=>this.reconnectTimeout=void 0),u)},this.waitForRestarted=()=>new Promise((a,o)=>{this.pcState===mn.Connected&&a();const l=()=>{this.off($.Disconnected,f),a()},f=()=>{this.off($.Restarted,l),o()};this.once($.Restarted,l),this.once($.Disconnected,f)}),this.updateAndEmitDCBufferStatus=a=>{if(a===Te.RELIABLE){const l=this.dataChannelForKind(a);l&&this.reliableMessageBuffer.alignBufferedAmount(l.bufferedAmount)}const o=this.isBufferStatusLow(a);typeof o<"u"&&o!==this.dcBufferStatus.get(a)&&(this.dcBufferStatus.set(a,o),this.emit($.DCBufferStatusChanged,o,a))},this.isBufferStatusLow=a=>{const o=this.dataChannelForKind(a);if(o)return o.bufferedAmount<=o.bufferedAmountLowThreshold},this.handleBrowserOnLine=()=>T(this,void 0,void 0,function*(){!this.url||!(yield fetch(Dr(this.url),{method:"HEAD"}).then(o=>o.ok).catch(()=>!1))||(this.log.info("detected network reconnected"),(this.client.currentState===Ge.RECONNECTING||this.isWaitingForNetworkReconnect&&this.client.currentState===Ge.CONNECTED)&&(this.clearReconnectTimeout(),this.attemptReconnect(da.RR_SIGNAL_DISCONNECTED),this.isWaitingForNetworkReconnect=!1))}),this.handleBrowserOffline=()=>T(this,void 0,void 0,function*(){if(this.url)try{yield Promise.race([fetch(Dr(this.url),{method:"HEAD"}),Rt(4e3).then(()=>Promise.reject())])}catch{window.navigator.onLine===!1&&(this.log.info("detected network interruption"),this.isWaitingForNetworkReconnect=!0)}}),this.log=ci((i=t.loggerName)!==null&&i!==void 0?i:Rn.Engine),this.loggerOptions={loggerName:t.loggerName,loggerContextCb:()=>this.logContext},this.client=new ff(void 0,this.loggerOptions),this.client.signalLatency=this.options.expSignalLatency,this.reconnectPolicy=this.options.reconnectPolicy,this.closingLock=new xt,this.dataProcessLock=new xt,this.dcBufferStatus=new Map([[Te.LOSSY,!0],[Te.RELIABLE,!0]]),this.client.onParticipantUpdate=a=>this.emit($.ParticipantUpdate,a),this.client.onConnectionQuality=a=>this.emit($.ConnectionQualityUpdate,a),this.client.onRoomUpdate=a=>this.emit($.RoomUpdate,a),this.client.onSubscriptionError=a=>this.emit($.SubscriptionError,a),this.client.onSubscriptionPermissionUpdate=a=>this.emit($.SubscriptionPermissionUpdate,a),this.client.onSpeakersChanged=a=>this.emit($.SpeakersChanged,a),this.client.onStreamStateUpdate=a=>this.emit($.StreamStateChanged,a),this.client.onRequestResponse=a=>this.emit($.SignalRequestResponse,a)}get logContext(){var t,i,a,o,l,f;return{room:(i=(t=this.latestJoinResponse)===null||t===void 0?void 0:t.room)===null||i===void 0?void 0:i.name,roomID:(o=(a=this.latestJoinResponse)===null||a===void 0?void 0:a.room)===null||o===void 0?void 0:o.sid,participant:(f=(l=this.latestJoinResponse)===null||l===void 0?void 0:l.participant)===null||f===void 0?void 0:f.identity,pID:this.participantSid}}join(t,i,a,o){return T(this,arguments,void 0,function(l,f,u,m){var p=this;let g=arguments.length>4&&arguments[4]!==void 0?arguments[4]:!1;return(function*(){p.url=l,p.token=f,p.signalOpts=u,p.maxJoinAttempts=u.maxRetries;try{p.joinAttempts+=1,p.setupSignalClientCallbacks();const v=yield p.client.join(l,f,u,m,g);return p._isClosed=!1,p.latestJoinResponse=v,p.subscriberPrimary=v.subscriberPrimary,p.pcManager||(yield p.configure(v,!g)),(!p.subscriberPrimary||v.fastPublish)&&p.negotiate().catch(S=>{Se.error(S,p.logContext)}),p.registerOnLineListener(),p.clientConfiguration=v.clientConfiguration,p.emit($.SignalConnected,v),v}catch(v){if(v instanceof he){if(v.reason===Ke.ServerUnreachable){if(p.log.warn("Couldn't connect to server, attempt ".concat(p.joinAttempts," of ").concat(p.maxJoinAttempts),p.logContext),p.joinAttempts<p.maxJoinAttempts)return p.join(l,f,u,m,g)}else if(v.reason===Ke.ServiceNotFound)return p.log.warn("Initial connection failed: ".concat(v.message,"  Retrying")),p.join(l,f,u,m,!0)}throw v}})()})}close(){return T(this,void 0,void 0,function*(){const t=yield this.closingLock.lock();if(this.isClosed){t();return}try{this._isClosed=!0,this.joinAttempts=0,this.emit($.Closing),this.removeAllListeners(),this.deregisterOnLineListener(),this.clearPendingReconnect(),this.cleanupLossyDataStats(),yield this.cleanupPeerConnections(),yield this.cleanupClient()}finally{t()}})}cleanupPeerConnections(){return T(this,void 0,void 0,function*(){var t;yield(t=this.pcManager)===null||t===void 0?void 0:t.close(),this.pcManager=void 0;const i=a=>{a&&(a.close(),a.onbufferedamountlow=null,a.onclose=null,a.onclosing=null,a.onerror=null,a.onmessage=null,a.onopen=null)};i(this.lossyDC),i(this.lossyDCSub),i(this.reliableDC),i(this.reliableDCSub),this.lossyDC=void 0,this.lossyDCSub=void 0,this.reliableDC=void 0,this.reliableDCSub=void 0,this.reliableMessageBuffer=new Tv,this.reliableDataSequence=1,this.reliableReceivedState.clear()})}cleanupLossyDataStats(){this.lossyDataStatByterate=0,this.lossyDataStatCurrentBytes=0,this.lossyDataStatInterval&&(clearInterval(this.lossyDataStatInterval),this.lossyDataStatInterval=void 0),this.lossyDataDropCount=0}cleanupClient(){return T(this,void 0,void 0,function*(){yield this.client.close(),this.client.resetCallbacks()})}addTrack(t){if(this.pendingTrackResolvers[t.cid])throw new oi("a track with the same ID has already been published");return new Promise((i,a)=>{const o=setTimeout(()=>{delete this.pendingTrackResolvers[t.cid],a(he.timeout("publication of local track timed out, no response from server"))},1e4);this.pendingTrackResolvers[t.cid]={resolve:l=>{clearTimeout(o),i(l)},reject:()=>{clearTimeout(o),a(new Error("Cancelled publication by calling unpublish"))}},this.client.sendAddTrack(t)})}removeTrack(t){if(t.track&&this.pendingTrackResolvers[t.track.id]){const{reject:i}=this.pendingTrackResolvers[t.track.id];i&&i(),delete this.pendingTrackResolvers[t.track.id]}try{return this.pcManager.removeTrack(t),!0}catch(i){this.log.warn("failed to remove track",Object.assign(Object.assign({},this.logContext),{error:i}))}return!1}updateMuteStatus(t,i){this.client.sendMuteTrack(t,i)}get dataSubscriberReadyState(){var t;return(t=this.reliableDCSub)===null||t===void 0?void 0:t.readyState}getConnectedServerAddress(){return T(this,void 0,void 0,function*(){var t;return(t=this.pcManager)===null||t===void 0?void 0:t.getConnectedAddress()})}setRegionUrlProvider(t){this.regionUrlProvider=t}configure(t,i){return T(this,void 0,void 0,function*(){var a,o;if(this.pcManager&&this.pcManager.currentState!==et.NEW)return;this.participantSid=(a=t.participant)===null||a===void 0?void 0:a.sid;const l=this.makeRTCConfiguration(t);this.pcManager=new UE(l,i?"publisher-only":t.subscriberPrimary?"subscriber-primary":"publisher-primary",this.loggerOptions),this.emit($.TransportsCreated,this.pcManager.publisher,this.pcManager.subscriber),this.pcManager.onIceCandidate=(f,u)=>{this.client.sendIceCandidate(f,u)},this.pcManager.onPublisherOffer=(f,u)=>{this.client.sendOffer(f,u)},this.pcManager.onDataChannel=this.handleDataChannel,this.pcManager.onStateChange=(f,u,m)=>T(this,void 0,void 0,function*(){if(this.log.debug("primary PC state changed ".concat(f),this.logContext),["closed","disconnected","failed"].includes(u)&&(this.publisherConnectionPromise=void 0),f===et.CONNECTED){const v=this.pcState===mn.New;this.pcState=mn.Connected,v&&this.emit($.Connected,t)}else f===et.FAILED&&(this.pcState===mn.Connected||this.pcState===mn.Reconnecting)&&(this.pcState=mn.Disconnected,this.handleDisconnect("peerconnection failed",m==="failed"?da.RR_SUBSCRIBER_FAILED:da.RR_PUBLISHER_FAILED));const p=this.client.isDisconnected||this.client.currentState===Ge.RECONNECTING,g=[et.FAILED,et.CLOSING,et.CLOSED].includes(f);p&&g&&!this._isClosed&&this.emit($.Offline)}),this.pcManager.onTrack=f=>{f.streams.length!==0&&this.emit($.MediaTrackAdded,f.track,f.streams[0],f.receiver)},o1((o=t.serverInfo)===null||o===void 0?void 0:o.protocol)||this.createDataChannels()})}setupSignalClientCallbacks(){this.client.onAnswer=(t,i,a)=>T(this,void 0,void 0,function*(){this.pcManager&&(this.log.debug("received server answer",Object.assign(Object.assign({},this.logContext),{RTCSdpType:t.type,sdp:t.sdp,midToTrackId:a})),this.midToTrackId=a,yield this.pcManager.setPublisherAnswer(t,i))}),this.client.onTrickle=(t,i)=>{this.pcManager&&(this.log.debug("got ICE candidate from peer",Object.assign(Object.assign({},this.logContext),{candidate:t,target:i})),this.pcManager.addIceCandidate(t,i))},this.client.onOffer=(t,i,a)=>T(this,void 0,void 0,function*(){if(this.latestRemoteOfferId=i,!this.pcManager)return;this.midToTrackId=a;const o=yield this.pcManager.createSubscriberAnswerFromOffer(t,i);o&&this.client.sendAnswer(o,i)}),this.client.onLocalTrackPublished=t=>{var i;if(this.log.debug("received trackPublishedResponse",Object.assign(Object.assign({},this.logContext),{cid:t.cid,track:(i=t.track)===null||i===void 0?void 0:i.sid})),!this.pendingTrackResolvers[t.cid]){this.log.error("missing track resolver for ".concat(t.cid),Object.assign(Object.assign({},this.logContext),{cid:t.cid}));return}const{resolve:a}=this.pendingTrackResolvers[t.cid];delete this.pendingTrackResolvers[t.cid],a(t.track)},this.client.onLocalTrackUnpublished=t=>{this.emit($.LocalTrackUnpublished,t)},this.client.onLocalTrackSubscribed=t=>{this.emit($.LocalTrackSubscribed,t)},this.client.onTokenRefresh=t=>{var i;this.token=t,(i=this.regionUrlProvider)===null||i===void 0||i.updateToken(t)},this.client.onRemoteMuteChanged=(t,i)=>{this.emit($.RemoteMute,t,i)},this.client.onSubscribedQualityUpdate=t=>{this.emit($.SubscribedQualityUpdate,t)},this.client.onRoomMoved=t=>{var i;this.participantSid=(i=t.participant)===null||i===void 0?void 0:i.sid,this.latestJoinResponse&&(this.latestJoinResponse.room=t.room),this.emit($.RoomMoved,t)},this.client.onMediaSectionsRequirement=t=>{var i,a;const o={direction:"recvonly"};for(let l=0;l<t.numAudios;l++)(i=this.pcManager)===null||i===void 0||i.addPublisherTransceiverOfKind("audio",o);for(let l=0;l<t.numVideos;l++)(a=this.pcManager)===null||a===void 0||a.addPublisherTransceiverOfKind("video",o);this.negotiate()},this.client.onClose=()=>{this.handleDisconnect("signal",da.RR_SIGNAL_DISCONNECTED)},this.client.onLeave=t=>{switch(this.log.debug("client leave request",Object.assign(Object.assign({},this.logContext),{reason:t==null?void 0:t.reason})),t.regions&&this.regionUrlProvider&&(this.log.debug("updating regions",this.logContext),this.regionUrlProvider.setServerReportedRegions({updatedAtInMs:Date.now(),maxAgeInMs:vy,regionSettings:t.regions})),t.action){case os.DISCONNECT:this.emit($.Disconnected,t==null?void 0:t.reason),this.close();break;case os.RECONNECT:this.fullReconnectOnNext=!0,this.handleDisconnect(yd);break;case os.RESUME:this.handleDisconnect(yd)}}}makeRTCConfiguration(t){var i;const a=Object.assign({},this.rtcConfig);if(!((i=this.signalOpts)===null||i===void 0)&&i.e2eeEnabled&&(this.log.debug("E2EE - setting up transports with insertable streams",this.logContext),a.encodedInsertableStreams=!0),t.iceServers&&!a.iceServers){const o=[];t.iceServers.forEach(l=>{const f={urls:l.urls};l.username&&(f.username=l.username),l.credential&&(f.credential=l.credential),o.push(f)}),a.iceServers=o}return t.clientConfiguration&&t.clientConfiguration.forceRelay===Er.ENABLED&&(a.iceTransportPolicy="relay"),a.sdpSemantics="unified-plan",a.continualGatheringPolicy="gather_continually",a}createDataChannels(){this.pcManager&&(this.lossyDC&&(this.lossyDC.onmessage=null,this.lossyDC.onerror=null),this.reliableDC&&(this.reliableDC.onmessage=null,this.reliableDC.onerror=null),this.lossyDC=this.pcManager.createPublisherDataChannel(Pv,{ordered:!1,maxRetransmits:0}),this.reliableDC=this.pcManager.createPublisherDataChannel(Uv,{ordered:!0}),this.lossyDC.onmessage=this.handleDataMessage,this.reliableDC.onmessage=this.handleDataMessage,this.lossyDC.onerror=this.handleDataError,this.reliableDC.onerror=this.handleDataError,this.lossyDC.bufferedAmountLowThreshold=65535,this.reliableDC.bufferedAmountLowThreshold=65535,this.lossyDC.onbufferedamountlow=this.handleBufferedAmountLow,this.reliableDC.onbufferedamountlow=this.handleBufferedAmountLow,this.cleanupLossyDataStats(),this.lossyDataStatInterval=setInterval(()=>{this.lossyDataStatByterate=this.lossyDataStatCurrentBytes,this.lossyDataStatCurrentBytes=0;const t=this.dataChannelForKind(Te.LOSSY);if(t){const i=this.lossyDataStatByterate/10;t.bufferedAmountLowThreshold=Math.min(Math.max(i,a1),s1)}},1e3))}createSender(t,i,a){return T(this,void 0,void 0,function*(){if(Ld())return yield this.createTransceiverRTCRtpSender(t,i,a);if(Id())return this.log.warn("using add-track fallback",this.logContext),yield this.createRTCRtpSender(t.mediaStreamTrack);throw new rt("Required webRTC APIs not supported on this device")})}createSimulcastSender(t,i,a,o){return T(this,void 0,void 0,function*(){if(Ld())return this.createSimulcastTransceiverSender(t,i,a,o);if(Id())return this.log.debug("using add-track fallback",this.logContext),this.createRTCRtpSender(t.mediaStreamTrack);throw new rt("Cannot stream on this device")})}createTransceiverRTCRtpSender(t,i,a){return T(this,void 0,void 0,function*(){if(!this.pcManager)throw new rt("publisher is closed");const o=[];t.mediaStream&&o.push(t.mediaStream),Fi(t)&&(t.codec=i.videoCodec);const l={direction:"sendonly",streams:o};return a&&(l.sendEncodings=a),(yield this.pcManager.addPublisherTransceiver(t.mediaStreamTrack,l)).sender})}createSimulcastTransceiverSender(t,i,a,o){return T(this,void 0,void 0,function*(){if(!this.pcManager)throw new rt("publisher is closed");const l={direction:"sendonly"};o&&(l.sendEncodings=o);const f=yield this.pcManager.addPublisherTransceiver(i.mediaStreamTrack,l);if(a.videoCodec)return t.setSimulcastTrackSender(a.videoCodec,f.sender),f.sender})}createRTCRtpSender(t){return T(this,void 0,void 0,function*(){if(!this.pcManager)throw new rt("publisher is closed");return this.pcManager.addPublisherTrack(t)})}attemptReconnect(t){return T(this,void 0,void 0,function*(){var i,a,o;if(!this._isClosed){if(this.attemptingReconnect){Se.warn("already attempting reconnect, returning early",this.logContext);return}(((i=this.clientConfiguration)===null||i===void 0?void 0:i.resumeConnection)===Er.DISABLED||((o=(a=this.pcManager)===null||a===void 0?void 0:a.currentState)!==null&&o!==void 0?o:et.NEW)===et.NEW)&&(this.fullReconnectOnNext=!0);try{this.attemptingReconnect=!0,this.fullReconnectOnNext?yield this.restartConnection():yield this.resumeConnection(t),this.clearPendingReconnect(),this.fullReconnectOnNext=!1}catch(l){this.reconnectAttempts+=1;let f=!0;l instanceof rt?(this.log.debug("received unrecoverable error",Object.assign(Object.assign({},this.logContext),{error:l})),f=!1):l instanceof ns||(this.fullReconnectOnNext=!0),f?this.handleDisconnect("reconnect",da.RR_UNKNOWN):(this.log.info("could not recover connection after ".concat(this.reconnectAttempts," attempts, ").concat(Date.now()-this.reconnectStart,"ms. giving up"),this.logContext),this.emit($.Disconnected),yield this.close())}finally{this.attemptingReconnect=!1}}})}getNextRetryDelay(t){try{return this.reconnectPolicy.nextRetryDelayInMs(t)}catch(i){this.log.warn("encountered error in reconnect policy",Object.assign(Object.assign({},this.logContext),{error:i}))}return null}restartConnection(t){return T(this,void 0,void 0,function*(){var i,a,o;try{if(!this.url||!this.token)throw new rt("could not reconnect, url or token not saved");this.log.info("reconnecting, attempt: ".concat(this.reconnectAttempts),this.logContext),this.emit($.Restarting),this.client.isDisconnected||(yield this.client.sendLeave()),yield this.cleanupPeerConnections(),yield this.cleanupClient();let l;try{if(!this.signalOpts)throw this.log.warn("attempted connection restart, without signal options present",this.logContext),new ns;l=yield this.join(t??this.url,this.token,this.signalOpts,void 0,!this.options.singlePeerConnection)}catch(f){throw f instanceof he&&f.reason===Ke.NotAllowed?new rt("could not reconnect, token might be expired"):new ns}if(this.shouldFailNext)throw this.shouldFailNext=!1,new Error("simulated failure");if(this.client.setReconnected(),this.emit($.SignalRestarted,l),yield this.waitForPCReconnected(),this.client.currentState!==Ge.CONNECTED)throw new ns("Signal connection got severed during reconnect");(i=this.regionUrlProvider)===null||i===void 0||i.resetAttempts(),this.emit($.Restarted)}catch(l){const f=yield(a=this.regionUrlProvider)===null||a===void 0?void 0:a.getNextBestRegionUrl();if(f){yield this.restartConnection(f);return}else throw(o=this.regionUrlProvider)===null||o===void 0||o.resetAttempts(),l}})}resumeConnection(t){return T(this,void 0,void 0,function*(){var i;if(!this.url||!this.token)throw new rt("could not reconnect, url or token not saved");if(!this.pcManager)throw new rt("publisher and subscriber connections unset");this.log.info("resuming signal connection, attempt ".concat(this.reconnectAttempts),this.logContext),this.emit($.Resuming);let a;try{this.setupSignalClientCallbacks(),a=yield this.client.reconnect(this.url,this.token,this.participantSid,t)}catch(o){let l="";throw o instanceof Error&&(l=o.message,this.log.error(o.message,Object.assign(Object.assign({},this.logContext),{error:o}))),o instanceof he&&o.reason===Ke.NotAllowed?new rt("could not reconnect, token might be expired"):o instanceof he&&o.reason===Ke.LeaveRequest?o:new ns(l)}if(this.emit($.SignalResumed),a){const o=this.makeRTCConfiguration(a);this.pcManager.updateConfiguration(o),this.latestJoinResponse&&(this.latestJoinResponse.serverInfo=a.serverInfo)}else this.log.warn("Did not receive reconnect response",this.logContext);if(this.shouldFailNext)throw this.shouldFailNext=!1,new Error("simulated failure");if(yield this.pcManager.triggerIceRestart(),yield this.waitForPCReconnected(),this.client.currentState!==Ge.CONNECTED)throw new ns("Signal connection got severed during reconnect");this.client.setReconnected(),((i=this.reliableDC)===null||i===void 0?void 0:i.readyState)==="open"&&this.reliableDC.id===null&&this.createDataChannels(),a!=null&&a.lastMessageSeq&&this.resendReliableMessagesForResume(a.lastMessageSeq),this.emit($.Resumed)})}waitForPCInitialConnection(t,i){return T(this,void 0,void 0,function*(){if(!this.pcManager)throw new rt("PC manager is closed");yield this.pcManager.ensurePCTransportConnection(i,t)})}waitForPCReconnected(){return T(this,void 0,void 0,function*(){this.pcState=mn.Reconnecting,this.log.debug("waiting for peer connection to reconnect",this.logContext);try{if(yield Rt(n1),!this.pcManager)throw new rt("PC manager is closed");yield this.pcManager.ensurePCTransportConnection(void 0,this.peerConnectionTimeout),this.pcState=mn.Connected}catch(t){throw this.pcState=mn.Disconnected,he.internal("could not establish PC connection, ".concat(t.message))}})}publishRpcResponse(t,i,a,o){return T(this,void 0,void 0,function*(){const l=new wt({destinationIdentities:[t],kind:Te.RELIABLE,value:{case:"rpcResponse",value:new $d({requestId:i,value:o?{case:"error",value:o.toProto()}:{case:"payload",value:a??""}})}});yield this.sendDataPacket(l,Te.RELIABLE)})}publishRpcAck(t,i){return T(this,void 0,void 0,function*(){const a=new wt({destinationIdentities:[t],kind:Te.RELIABLE,value:{case:"rpcAck",value:new Wd({requestId:i})}});yield this.sendDataPacket(a,Te.RELIABLE)})}sendDataPacket(t,i){return T(this,void 0,void 0,function*(){if(yield this.ensurePublisherConnected(i),this.e2eeManager&&this.e2eeManager.isDataChannelEncryptionEnabled){const l=pE(t);if(l){const f=yield this.e2eeManager.encryptData(l.toBinary());t.value={case:"encryptedPacket",value:new s0({encryptedValue:f.payload,iv:f.iv,keyIndex:f.keyIndex})}}}i===Te.RELIABLE&&(t.sequence=this.reliableDataSequence,this.reliableDataSequence+=1);const a=t.toBinary(),o=this.dataChannelForKind(i);if(o){if(i===Te.RELIABLE)yield this.waitForBufferStatusLow(i),this.reliableMessageBuffer.push({data:a,sequence:t.sequence});else{if(!this.isBufferStatusLow(i)){this.lossyDataDropCount+=1,this.lossyDataDropCount%100===0&&this.log.warn("dropping lossy data channel messages, total dropped: ".concat(this.lossyDataDropCount),this.logContext);return}this.lossyDataStatCurrentBytes+=a.byteLength}if(this.attemptingReconnect)return;o.send(a)}this.updateAndEmitDCBufferStatus(i)})}resendReliableMessagesForResume(t){return T(this,void 0,void 0,function*(){yield this.ensurePublisherConnected(Te.RELIABLE);const i=this.dataChannelForKind(Te.RELIABLE);i&&(this.reliableMessageBuffer.popToSequence(t),this.reliableMessageBuffer.getAll().forEach(a=>{i.send(a.data)})),this.updateAndEmitDCBufferStatus(Te.RELIABLE)})}waitForBufferStatusLow(t){return new Ht((i,a)=>T(this,void 0,void 0,function*(){if(this.isBufferStatusLow(t))i();else{const o=()=>a(new rt("engine closed"));for(this.once($.Closing,o);!this.dcBufferStatus.get(t);)yield Rt(10);this.off($.Closing,o),i()}}))}ensureDataTransportConnected(t){return T(this,arguments,void 0,function(i){var a=this;let o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.subscriberPrimary;return(function*(){var l;if(!a.pcManager)throw new rt("PC manager is closed");const f=o?a.pcManager.subscriber:a.pcManager.publisher,u=o?"Subscriber":"Publisher";if(!f)throw he.internal("".concat(u," connection not set"));let m=!1;!o&&!a.dataChannelForKind(i,o)&&(a.createDataChannels(),m=!0),!m&&!o&&!a.pcManager.publisher.isICEConnected&&a.pcManager.publisher.getICEConnectionState()!=="checking"&&(m=!0),m&&a.negotiate().catch(v=>{Se.error(v,a.logContext)});const p=a.dataChannelForKind(i,o);if((p==null?void 0:p.readyState)==="open")return;const g=new Date().getTime()+a.peerConnectionTimeout;for(;new Date().getTime()<g;){if(f.isICEConnected&&((l=a.dataChannelForKind(i,o))===null||l===void 0?void 0:l.readyState)==="open")return;yield Rt(50)}throw he.internal("could not establish ".concat(u," connection, state: ").concat(f.getICEConnectionState()))})()})}ensurePublisherConnected(t){return T(this,void 0,void 0,function*(){this.publisherConnectionPromise||(this.publisherConnectionPromise=this.ensureDataTransportConnected(t,!1)),yield this.publisherConnectionPromise})}verifyTransport(){return!(!this.pcManager||this.pcManager.currentState!==et.CONNECTED||!this.client.ws||this.client.ws.readyState===WebSocket.CLOSED)}negotiate(){return T(this,void 0,void 0,function*(){return new Ht((t,i)=>T(this,void 0,void 0,function*(){if(!this.pcManager){i(new ls("PC manager is closed"));return}this.pcManager.requirePublisher(),this.pcManager.publisher.getTransceivers().length==0&&!this.lossyDC&&!this.reliableDC&&this.createDataChannels();const a=new AbortController,o=()=>{a.abort(),this.log.debug("engine disconnected while negotiation was ongoing",this.logContext),t()};this.isClosed&&i(new ls("cannot negotiate on closed engine")),this.on($.Closing,o),this.pcManager.publisher.once(hs.RTPVideoPayloadTypes,l=>{const f=new Map;l.forEach(u=>{const m=u.codec.toLowerCase();Wk(m)&&f.set(u.payload,m)}),this.emit($.RTPVideoMapUpdate,f)});try{yield this.pcManager.negotiate(a),t()}catch(l){l instanceof ls&&(this.fullReconnectOnNext=!0),this.handleDisconnect("negotiation",da.RR_UNKNOWN),l instanceof Error?i(l):i(new Error(String(l)))}finally{this.off($.Closing,o)}}))})}dataChannelForKind(t,i){if(i){if(t===Te.LOSSY)return this.lossyDCSub;if(t===Te.RELIABLE)return this.reliableDCSub}else{if(t===Te.LOSSY)return this.lossyDC;if(t===Te.RELIABLE)return this.reliableDC}}sendSyncState(t,i){var a,o,l,f;if(!this.pcManager){this.log.warn("sync state cannot be sent without peer connection setup",this.logContext);return}const u=this.pcManager.publisher.getLocalDescription(),m=this.pcManager.publisher.getRemoteDescription(),p=(a=this.pcManager.subscriber)===null||a===void 0?void 0:a.getRemoteDescription(),g=(o=this.pcManager.subscriber)===null||o===void 0?void 0:o.getLocalDescription(),v=(f=(l=this.signalOpts)===null||l===void 0?void 0:l.autoSubscribe)!==null&&f!==void 0?f:!0,S=new Array,k=new Array;t.forEach(O=>{O.isDesired!==v&&S.push(O.trackSid),O.isEnabled||k.push(O.trackSid)}),this.client.sendSyncState(new sf({answer:this.pcManager.mode==="publisher-only"?m?ss({sdp:m.sdp,type:m.type}):void 0:g?ss({sdp:g.sdp,type:g.type}):void 0,offer:this.pcManager.mode==="publisher-only"?u?ss({sdp:u.sdp,type:u.type}):void 0:p?ss({sdp:p.sdp,type:p.type}):void 0,subscription:new Oc({trackSids:S,subscribe:!v,participantTracks:[]}),publishTracks:Uk(i),dataChannels:this.dataChannelsInfo(),trackSidsDisabled:k,datachannelReceiveStates:this.reliableReceivedState.map((O,E)=>new _0({publisherSid:E,lastSeq:O}))}))}failNext(){this.shouldFailNext=!0}dataChannelsInfo(){const t=[],i=(a,o)=>{(a==null?void 0:a.id)!==void 0&&a.id!==null&&t.push(new R0({label:a.label,id:a.id,target:o}))};return i(this.dataChannelForKind(Te.LOSSY),kn.PUBLISHER),i(this.dataChannelForKind(Te.RELIABLE),kn.PUBLISHER),i(this.dataChannelForKind(Te.LOSSY,!0),kn.SUBSCRIBER),i(this.dataChannelForKind(Te.RELIABLE,!0),kn.SUBSCRIBER),t}clearReconnectTimeout(){this.reconnectTimeout&&_t.clearTimeout(this.reconnectTimeout)}clearPendingReconnect(){this.clearReconnectTimeout(),this.reconnectAttempts=0}registerOnLineListener(){Ft()&&(window.addEventListener("online",this.handleBrowserOnLine),window.addEventListener("offline",this.handleBrowserOffline))}deregisterOnLineListener(){Ft()&&(window.removeEventListener("online",this.handleBrowserOnLine),window.removeEventListener("offline",this.handleBrowserOffline))}getTrackIdForReceiver(t){var i;const a=(i=this.pcManager)===null||i===void 0?void 0:i.getMidForReceiver(t);if(a){const o=Object.entries(this.midToTrackId).find(l=>{let[f]=l;return f===a});if(o)return o[1]}}}function o1(r){return r!==void 0&&r>13}function Lv(r,t){const i=r.participantIdentity?r.participantIdentity:t.participantIdentity;r.participantIdentity=i,t.participantIdentity=i;const a=r.destinationIdentities.length!==0?r.destinationIdentities:t.destinationIdentities;r.destinationIdentities=a,t.destinationIdentities=a}class Cy{get info(){return this._info}validateBytesReceived(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1;if(!(typeof this.totalByteSize!="number"||this.totalByteSize===0)){if(t&&this.bytesReceived<this.totalByteSize)throw new pn("Not enough chunk(s) received - expected ".concat(this.totalByteSize," bytes of data total, only received ").concat(this.bytesReceived," bytes"),Mt.Incomplete);if(this.bytesReceived>this.totalByteSize)throw new pn("Extra chunk(s) received - expected ".concat(this.totalByteSize," bytes of data total, received ").concat(this.bytesReceived," bytes"),Mt.LengthExceeded)}}constructor(t,i,a,o){this.reader=i,this.totalByteSize=a,this._info=t,this.bytesReceived=0,this.outOfBandFailureRejectingFuture=o}}class c1 extends Cy{handleChunkReceived(t){var i;this.bytesReceived+=t.content.byteLength,this.validateBytesReceived();const a=this.totalByteSize?this.bytesReceived/this.totalByteSize:void 0;(i=this.onProgress)===null||i===void 0||i.call(this,a)}[Symbol.asyncIterator](){const t=this.reader.getReader();let i=new gn,a=null,o=null;if(this.signal){const f=this.signal;o=()=>{var u;(u=i.reject)===null||u===void 0||u.call(i,f.reason)},f.addEventListener("abort",o),a=f}const l=()=>{t.releaseLock(),a&&o&&a.removeEventListener("abort",o),this.signal=void 0};return{next:()=>T(this,void 0,void 0,function*(){var f,u;try{const{done:m,value:p}=yield Promise.race([t.read(),i.promise,(u=(f=this.outOfBandFailureRejectingFuture)===null||f===void 0?void 0:f.promise)!==null&&u!==void 0?u:new Promise(()=>{})]);return m?(this.validateBytesReceived(!0),{done:!0,value:void 0}):(this.handleChunkReceived(p),{done:!1,value:p.content})}catch(m){throw l(),m}}),return(){return T(this,void 0,void 0,function*(){return l(),{done:!0,value:void 0}})}}}withAbortSignal(t){return this.signal=t,this}readAll(){return T(this,arguments,void 0,function(){var t=this;let i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return(function*(){var a,o,l,f;let u=new Set;const m=i.signal?t.withAbortSignal(i.signal):t;try{for(var p=!0,g=ri(m),v;v=yield g.next(),a=v.done,!a;p=!0){f=v.value,p=!1;const S=f;u.add(S)}}catch(S){o={error:S}}finally{try{!p&&!a&&(l=g.return)&&(yield l.call(g))}finally{if(o)throw o.error}}return Array.from(u)})()})}}class l1 extends Cy{constructor(t,i,a,o){super(t,i,a,o),this.receivedChunks=new Map}handleChunkReceived(t){var i;const a=dc(t.chunkIndex),o=this.receivedChunks.get(a);if(o&&o.version>t.version)return;this.receivedChunks.set(a,t),this.bytesReceived+=t.content.byteLength,this.validateBytesReceived();const l=this.totalByteSize?this.bytesReceived/this.totalByteSize:void 0;(i=this.onProgress)===null||i===void 0||i.call(this,l)}[Symbol.asyncIterator](){const t=this.reader.getReader(),i=new TextDecoder("utf-8",{fatal:!0});let a=new gn,o=null,l=null;if(this.signal){const u=this.signal;l=()=>{var m;(m=a.reject)===null||m===void 0||m.call(a,u.reason)},u.addEventListener("abort",l),o=u}const f=()=>{t.releaseLock(),o&&l&&o.removeEventListener("abort",l),this.signal=void 0};return{next:()=>T(this,void 0,void 0,function*(){var u,m;try{const{done:p,value:g}=yield Promise.race([t.read(),a.promise,(m=(u=this.outOfBandFailureRejectingFuture)===null||u===void 0?void 0:u.promise)!==null&&m!==void 0?m:new Promise(()=>{})]);if(p)return this.validateBytesReceived(!0),{done:!0,value:void 0};{this.handleChunkReceived(g);let v;try{v=i.decode(g.content)}catch(S){throw new pn("Cannot decode datastream chunk ".concat(g.chunkIndex," as text: ").concat(S),Mt.DecodeFailed)}return{done:!1,value:v}}}catch(p){throw f(),p}}),return(){return T(this,void 0,void 0,function*(){return f(),{done:!0,value:void 0}})}}}withAbortSignal(t){return this.signal=t,this}readAll(){return T(this,arguments,void 0,function(){var t=this;let i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return(function*(){var a,o,l,f;let u="";const m=i.signal?t.withAbortSignal(i.signal):t;try{for(var p=!0,g=ri(m),v;v=yield g.next(),a=v.done,!a;p=!0)f=v.value,p=!1,u+=f}catch(S){o={error:S}}finally{try{!p&&!a&&(l=g.return)&&(yield l.call(g))}finally{if(o)throw o.error}}return u})()})}}class u1{constructor(){this.log=Se,this.byteStreamControllers=new Map,this.textStreamControllers=new Map,this.byteStreamHandlers=new Map,this.textStreamHandlers=new Map}registerTextStreamHandler(t,i){if(this.textStreamHandlers.has(t))throw new pn('A text stream handler for topic "'.concat(t,'" has already been set.'),Mt.HandlerAlreadyRegistered);this.textStreamHandlers.set(t,i)}unregisterTextStreamHandler(t){this.textStreamHandlers.delete(t)}registerByteStreamHandler(t,i){if(this.byteStreamHandlers.has(t))throw new pn('A byte stream handler for topic "'.concat(t,'" has already been set.'),Mt.HandlerAlreadyRegistered);this.byteStreamHandlers.set(t,i)}unregisterByteStreamHandler(t){this.byteStreamHandlers.delete(t)}clearControllers(){this.byteStreamControllers.clear(),this.textStreamControllers.clear()}validateParticipantHasNoActiveDataStreams(t){var i,a,o,l;const f=Array.from(this.textStreamControllers.entries()).filter(m=>m[1].sendingParticipantIdentity===t),u=Array.from(this.byteStreamControllers.entries()).filter(m=>m[1].sendingParticipantIdentity===t);if(f.length>0||u.length>0){const m=new pn("Participant ".concat(t," unexpectedly disconnected in the middle of sending data"),Mt.AbnormalEnd);for(const[p,g]of u)(a=(i=g.outOfBandFailureRejectingFuture).reject)===null||a===void 0||a.call(i,m),this.byteStreamControllers.delete(p);for(const[p,g]of f)(l=(o=g.outOfBandFailureRejectingFuture).reject)===null||l===void 0||l.call(o,m),this.textStreamControllers.delete(p)}}handleDataStreamPacket(t,i){return T(this,void 0,void 0,function*(){switch(t.value.case){case"streamHeader":return this.handleStreamHeader(t.value.value,t.participantIdentity,i);case"streamChunk":return this.handleStreamChunk(t.value.value,i);case"streamTrailer":return this.handleStreamTrailer(t.value.value,i);default:throw new Error('DataPacket of value "'.concat(t.value.case,'" is not data stream related!'))}})}handleStreamHeader(t,i,a){return T(this,void 0,void 0,function*(){var o;if(t.contentHeader.case==="byteHeader"){const l=this.byteStreamHandlers.get(t.topic);if(!l){this.log.debug("ignoring incoming byte stream due to no handler for topic",t.topic);return}let f;const u=new gn;u.promise.catch(g=>{this.log.error(g)});const m={id:t.streamId,name:(o=t.contentHeader.value.name)!==null&&o!==void 0?o:"unknown",mimeType:t.mimeType,size:t.totalLength?Number(t.totalLength):void 0,topic:t.topic,timestamp:dc(t.timestamp),attributes:t.attributes,encryptionType:a},p=new ReadableStream({start:g=>{if(f=g,this.textStreamControllers.has(t.streamId))throw new pn("A data stream read is already in progress for a stream with id ".concat(t.streamId,"."),Mt.AlreadyOpened);this.byteStreamControllers.set(t.streamId,{info:m,controller:f,startTime:Date.now(),sendingParticipantIdentity:i,outOfBandFailureRejectingFuture:u})}});l(new c1(m,p,dc(t.totalLength),u),{identity:i})}else if(t.contentHeader.case==="textHeader"){const l=this.textStreamHandlers.get(t.topic);if(!l){this.log.debug("ignoring incoming text stream due to no handler for topic",t.topic);return}let f;const u=new gn;u.promise.catch(g=>{this.log.error(g)});const m={id:t.streamId,mimeType:t.mimeType,size:t.totalLength?Number(t.totalLength):void 0,topic:t.topic,timestamp:Number(t.timestamp),attributes:t.attributes,encryptionType:a},p=new ReadableStream({start:g=>{if(f=g,this.textStreamControllers.has(t.streamId))throw new pn("A data stream read is already in progress for a stream with id ".concat(t.streamId,"."),Mt.AlreadyOpened);this.textStreamControllers.set(t.streamId,{info:m,controller:f,startTime:Date.now(),sendingParticipantIdentity:i,outOfBandFailureRejectingFuture:u})}});l(new l1(m,p,dc(t.totalLength),u),{identity:i})}})}handleStreamChunk(t,i){const a=this.byteStreamControllers.get(t.streamId);a&&(a.info.encryptionType!==i?(a.controller.error(new pn("Encryption type mismatch for stream ".concat(t.streamId,". Expected ").concat(i,", got ").concat(a.info.encryptionType),Mt.EncryptionTypeMismatch)),this.byteStreamControllers.delete(t.streamId)):t.content.length>0&&a.controller.enqueue(t));const o=this.textStreamControllers.get(t.streamId);o&&(o.info.encryptionType!==i?(o.controller.error(new pn("Encryption type mismatch for stream ".concat(t.streamId,". Expected ").concat(i,", got ").concat(o.info.encryptionType),Mt.EncryptionTypeMismatch)),this.textStreamControllers.delete(t.streamId)):t.content.length>0&&o.controller.enqueue(t))}handleStreamTrailer(t,i){const a=this.textStreamControllers.get(t.streamId);a&&(a.info.encryptionType!==i?a.controller.error(new pn("Encryption type mismatch for stream ".concat(t.streamId,". Expected ").concat(i,", got ").concat(a.info.encryptionType),Mt.EncryptionTypeMismatch)):(a.info.attributes=Object.assign(Object.assign({},a.info.attributes),t.attributes),a.controller.close(),this.textStreamControllers.delete(t.streamId)));const o=this.byteStreamControllers.get(t.streamId);o&&(o.info.encryptionType!==i?o.controller.error(new pn("Encryption type mismatch for stream ".concat(t.streamId,". Expected ").concat(i,", got ").concat(o.info.encryptionType),Mt.EncryptionTypeMismatch)):(o.info.attributes=Object.assign(Object.assign({},o.info.attributes),t.attributes),o.controller.close()),this.byteStreamControllers.delete(t.streamId))}}class ky{constructor(t,i,a){this.writableStream=t,this.defaultWriter=t.getWriter(),this.onClose=a,this.info=i}write(t){return this.defaultWriter.write(t)}close(){return T(this,void 0,void 0,function*(){var t;yield this.defaultWriter.close(),this.defaultWriter.releaseLock(),(t=this.onClose)===null||t===void 0||t.call(this)})}}class d1 extends ky{}class f1 extends ky{}const Iv=15e3;class h1{constructor(t,i){this.engine=t,this.log=i}setupEngine(t){this.engine=t}sendText(t,i){return T(this,void 0,void 0,function*(){var a;const o=crypto.randomUUID(),f=new TextEncoder().encode(t).byteLength,u=(a=i==null?void 0:i.attachments)===null||a===void 0?void 0:a.map(()=>crypto.randomUUID()),m=new Array(u?u.length+1:1).fill(0),p=(v,S)=>{var k;m[S]=v;const O=m.reduce((E,j)=>E+j,0);(k=i==null?void 0:i.onProgress)===null||k===void 0||k.call(i,O)},g=yield this.streamText({streamId:o,totalSize:f,destinationIdentities:i==null?void 0:i.destinationIdentities,topic:i==null?void 0:i.topic,attachedStreamIds:u,attributes:i==null?void 0:i.attributes});return yield g.write(t),p(1,0),yield g.close(),i!=null&&i.attachments&&u&&(yield Promise.all(i.attachments.map((v,S)=>T(this,void 0,void 0,function*(){return this._sendFile(u[S],v,{topic:i.topic,mimeType:v.type,onProgress:k=>{p(k,S+1)}})})))),g.info})}streamText(t){return T(this,void 0,void 0,function*(){var i,a,o;const l=(i=t==null?void 0:t.streamId)!==null&&i!==void 0?i:crypto.randomUUID(),f={id:l,mimeType:"text/plain",timestamp:Date.now(),topic:(a=t==null?void 0:t.topic)!==null&&a!==void 0?a:"",size:t==null?void 0:t.totalSize,attributes:t==null?void 0:t.attributes,encryptionType:!((o=this.engine.e2eeManager)===null||o===void 0)&&o.isDataChannelEncryptionEnabled?pt.GCM:pt.NONE},u=new gc({streamId:l,mimeType:f.mimeType,topic:f.topic,timestamp:fa(f.timestamp),totalLength:fa(t==null?void 0:t.totalSize),attributes:f.attributes,contentHeader:{case:"textHeader",value:new v0({version:t==null?void 0:t.version,attachedStreamIds:t==null?void 0:t.attachedStreamIds,replyToStreamId:t==null?void 0:t.replyToStreamId,operationType:(t==null?void 0:t.type)==="update"?Cd.UPDATE:Cd.CREATE})}}),m=t==null?void 0:t.destinationIdentities,p=new wt({destinationIdentities:m,value:{case:"streamHeader",value:u}});yield this.engine.sendDataPacket(p,Te.RELIABLE);let g=0;const v=this.engine,S=new WritableStream({write(E){return T(this,void 0,void 0,function*(){for(const j of aE(E,Iv)){const U=new vc({content:j,streamId:l,chunkIndex:fa(g)}),Y=new wt({destinationIdentities:m,value:{case:"streamChunk",value:U}});yield v.sendDataPacket(Y,Te.RELIABLE),g+=1}})},close(){return T(this,void 0,void 0,function*(){const E=new yc({streamId:l}),j=new wt({destinationIdentities:m,value:{case:"streamTrailer",value:E}});yield v.sendDataPacket(j,Te.RELIABLE)})},abort(E){console.log("Sink error:",E)}});let k=()=>T(this,void 0,void 0,function*(){yield O.close()});v.once($.Closing,k);const O=new d1(S,f,()=>this.engine.off($.Closing,k));return O})}sendFile(t,i){return T(this,void 0,void 0,function*(){const a=crypto.randomUUID();return yield this._sendFile(a,t,i),{id:a}})}_sendFile(t,i,a){return T(this,void 0,void 0,function*(){var o;const l=yield this.streamBytes({streamId:t,totalSize:i.size,name:i.name,mimeType:(o=a==null?void 0:a.mimeType)!==null&&o!==void 0?o:i.type,topic:a==null?void 0:a.topic,destinationIdentities:a==null?void 0:a.destinationIdentities}),f=i.stream().getReader();for(;;){const{done:u,value:m}=yield f.read();if(u)break;yield l.write(m)}return yield l.close(),l.info})}streamBytes(t){return T(this,void 0,void 0,function*(){var i,a,o,l,f,u;const m=(i=t==null?void 0:t.streamId)!==null&&i!==void 0?i:crypto.randomUUID(),p=t==null?void 0:t.destinationIdentities,g={id:m,mimeType:(a=t==null?void 0:t.mimeType)!==null&&a!==void 0?a:"application/octet-stream",topic:(o=t==null?void 0:t.topic)!==null&&o!==void 0?o:"",timestamp:Date.now(),attributes:t==null?void 0:t.attributes,size:t==null?void 0:t.totalSize,name:(l=t==null?void 0:t.name)!==null&&l!==void 0?l:"unknown",encryptionType:!((f=this.engine.e2eeManager)===null||f===void 0)&&f.isDataChannelEncryptionEnabled?pt.GCM:pt.NONE},v=new gc({totalLength:fa((u=g.size)!==null&&u!==void 0?u:0),mimeType:g.mimeType,streamId:m,topic:g.topic,timestamp:fa(Date.now()),attributes:g.attributes,contentHeader:{case:"byteHeader",value:new y0({name:g.name})}}),S=new wt({destinationIdentities:p,value:{case:"streamHeader",value:v}});yield this.engine.sendDataPacket(S,Te.RELIABLE);let k=0;const O=new xt,E=this.engine,j=this.log,U=new WritableStream({write(Z){return T(this,void 0,void 0,function*(){const M=yield O.lock();let N=0;try{for(;N<Z.byteLength;){const q=Z.slice(N,N+Iv),Q=new wt({destinationIdentities:p,value:{case:"streamChunk",value:new vc({content:q,streamId:m,chunkIndex:fa(k)})}});yield E.sendDataPacket(Q,Te.RELIABLE),k+=1,N+=q.byteLength}}finally{M()}})},close(){return T(this,void 0,void 0,function*(){const Z=new yc({streamId:m}),M=new wt({destinationIdentities:p,value:{case:"streamTrailer",value:Z}});yield E.sendDataPacket(M,Te.RELIABLE)})},abort(Z){j.error("Sink error:",Z)}});return new f1(U,g)})}}class Ey extends G{constructor(t,i,a,o,l){super(t,a,l),this.sid=i,this.receiver=o}get isLocal(){return!1}setMuted(t){this.isMuted!==t&&(this.isMuted=t,this._mediaStreamTrack.enabled=!t,this.emit(t?X.Muted:X.Unmuted,this))}setMediaStream(t){this.mediaStream=t;const i=a=>{a.track===this._mediaStreamTrack&&(t.removeEventListener("removetrack",i),this.receiver&&"playoutDelayHint"in this.receiver&&(this.receiver.playoutDelayHint=void 0),this.receiver=void 0,this._currentBitrate=0,this.emit(X.Ended,this))};t.addEventListener("removetrack",i)}start(){this.startMonitor(),super.enable()}stop(){this.stopMonitor(),super.disable()}getRTCStatsReport(){return T(this,void 0,void 0,function*(){var t;return!((t=this.receiver)===null||t===void 0)&&t.getStats?yield this.receiver.getStats():void 0})}setPlayoutDelay(t){this.receiver?"playoutDelayHint"in this.receiver?this.receiver.playoutDelayHint=t:this.log.warn("Playout delay not supported in this browser"):this.log.warn("Cannot set playout delay, track already ended")}getPlayoutDelay(){if(this.receiver){if("playoutDelayHint"in this.receiver)return this.receiver.playoutDelayHint;this.log.warn("Playout delay not supported in this browser")}else this.log.warn("Cannot get playout delay, track already ended");return 0}startMonitor(){this.monitorInterval||(this.monitorInterval=setInterval(()=>this.monitorReceiver(),yf)),Lk()&&this.registerTimeSyncUpdate()}registerTimeSyncUpdate(){const t=()=>{var i;this.timeSyncHandle=requestAnimationFrame(()=>t());const a=(i=this.receiver)===null||i===void 0?void 0:i.getSynchronizationSources()[0];if(a){const{timestamp:o,rtpTimestamp:l}=a;l&&this.rtpTimestamp!==l&&(this.emit(X.TimeSyncUpdate,{timestamp:o,rtpTimestamp:l}),this.rtpTimestamp=l)}};t()}}class m1 extends Ey{constructor(t,i,a,o,l,f){super(t,i,G.Kind.Audio,a,f),this.monitorReceiver=()=>T(this,void 0,void 0,function*(){if(!this.receiver){this._currentBitrate=0;return}const u=yield this.getReceiverStats();u&&this.prevStats&&this.receiver&&(this._currentBitrate=Mc(u,this.prevStats)),this.prevStats=u}),this.audioContext=o,this.webAudioPluginNodes=[],l&&(this.sinkId=l.deviceId)}setVolume(t){var i;for(const a of this.attachedElements)this.audioContext?(i=this.gainNode)===null||i===void 0||i.gain.setTargetAtTime(t,0,.1):a.volume=t;Pn()&&this._mediaStreamTrack._setVolume(t),this.elementVolume=t}getVolume(){if(this.elementVolume)return this.elementVolume;if(Pn())return 1;let t=0;return this.attachedElements.forEach(i=>{i.volume>t&&(t=i.volume)}),t}setSinkId(t){return T(this,void 0,void 0,function*(){this.sinkId=t,yield Promise.all(this.attachedElements.map(i=>{if(jd(i))return i.setSinkId(t)}))})}attach(t){const i=this.attachedElements.length===0;return t?super.attach(t):t=super.attach(),this.sinkId&&jd(t)&&t.setSinkId(this.sinkId).catch(a=>{this.log.error("Failed to set sink id on remote audio track",a,this.logContext)}),this.audioContext&&i&&(this.log.debug("using audio context mapping",this.logContext),this.connectWebAudio(this.audioContext,t),t.volume=0,t.muted=!0),this.elementVolume&&this.setVolume(this.elementVolume),t}detach(t){let i;return t?(i=super.detach(t),this.audioContext&&(this.attachedElements.length>0?this.connectWebAudio(this.audioContext,this.attachedElements[0]):this.disconnectWebAudio())):(i=super.detach(),this.disconnectWebAudio()),i}setAudioContext(t){this.audioContext=t,t&&this.attachedElements.length>0?this.connectWebAudio(t,this.attachedElements[0]):t||this.disconnectWebAudio()}setWebAudioPlugins(t){this.webAudioPluginNodes=t,this.attachedElements.length>0&&this.audioContext&&this.connectWebAudio(this.audioContext,this.attachedElements[0])}connectWebAudio(t,i){this.disconnectWebAudio(),this.sourceNode=t.createMediaStreamSource(i.srcObject);let a=this.sourceNode;this.webAudioPluginNodes.forEach(o=>{a.connect(o),a=o}),this.gainNode=t.createGain(),a.connect(this.gainNode),this.gainNode.connect(t.destination),this.elementVolume&&this.gainNode.gain.setTargetAtTime(this.elementVolume,0,.1),t.state!=="running"&&t.resume().then(()=>{t.state!=="running"&&this.emit(X.AudioPlaybackFailed,new Error("Audio Context couldn't be started automatically"))}).catch(o=>{this.emit(X.AudioPlaybackFailed,o)})}disconnectWebAudio(){var t,i;(t=this.gainNode)===null||t===void 0||t.disconnect(),(i=this.sourceNode)===null||i===void 0||i.disconnect(),this.gainNode=void 0,this.sourceNode=void 0}getReceiverStats(){return T(this,void 0,void 0,function*(){if(!this.receiver||!this.receiver.getStats)return;const t=yield this.receiver.getStats();let i;return t.forEach(a=>{a.type==="inbound-rtp"&&(i={type:"audio",streamId:a.id,timestamp:a.timestamp,jitter:a.jitter,bytesReceived:a.bytesReceived,concealedSamples:a.concealedSamples,concealmentEvents:a.concealmentEvents,silentConcealedSamples:a.silentConcealedSamples,silentConcealmentEvents:a.silentConcealmentEvents,totalAudioEnergy:a.totalAudioEnergy,totalSamplesDuration:a.totalSamplesDuration})}),i})}}const bd=100;class p1 extends Ey{constructor(t,i,a,o,l){super(t,i,G.Kind.Video,a,l),this.elementInfos=[],this.monitorReceiver=()=>T(this,void 0,void 0,function*(){if(!this.receiver){this._currentBitrate=0;return}const f=yield this.getReceiverStats();f&&this.prevStats&&this.receiver&&(this._currentBitrate=Mc(f,this.prevStats)),this.prevStats=f}),this.debouncedHandleResize=mf(()=>{this.updateDimensions()},bd),this.adaptiveStreamSettings=o}get isAdaptiveStream(){return this.adaptiveStreamSettings!==void 0}setStreamState(t){super.setStreamState(t),this.log.debug("setStreamState",t),this.isAdaptiveStream&&t===G.StreamState.Active&&this.updateVisibility()}get mediaStreamTrack(){return this._mediaStreamTrack}setMuted(t){super.setMuted(t),this.attachedElements.forEach(i=>{t?us(this._mediaStreamTrack,i):as(this._mediaStreamTrack,i)})}attach(t){if(t?super.attach(t):t=super.attach(),this.adaptiveStreamSettings&&this.elementInfos.find(i=>i.element===t)===void 0){const i=new g1(t);this.observeElementInfo(i)}return t}observeElementInfo(t){this.adaptiveStreamSettings&&this.elementInfos.find(i=>i===t)===void 0?(t.handleResize=()=>{this.debouncedHandleResize()},t.handleVisibilityChanged=()=>{this.updateVisibility()},this.elementInfos.push(t),t.observe(),this.debouncedHandleResize(),this.updateVisibility()):this.log.warn("visibility resize observer not triggered",this.logContext)}stopObservingElementInfo(t){if(!this.isAdaptiveStream){this.log.warn("stopObservingElementInfo ignored",this.logContext);return}const i=this.elementInfos.filter(a=>a===t);for(const a of i)a.stopObserving();this.elementInfos=this.elementInfos.filter(a=>a!==t),this.updateVisibility(),this.debouncedHandleResize()}detach(t){let i=[];if(t)return this.stopObservingElement(t),super.detach(t);i=super.detach();for(const a of i)this.stopObservingElement(a);return i}getDecoderImplementation(){var t;return(t=this.prevStats)===null||t===void 0?void 0:t.decoderImplementation}getReceiverStats(){return T(this,void 0,void 0,function*(){if(!this.receiver||!this.receiver.getStats)return;const t=yield this.receiver.getStats();let i,a="",o=new Map;return t.forEach(l=>{l.type==="inbound-rtp"?(a=l.codecId,i={type:"video",streamId:l.id,framesDecoded:l.framesDecoded,framesDropped:l.framesDropped,framesReceived:l.framesReceived,packetsReceived:l.packetsReceived,packetsLost:l.packetsLost,frameWidth:l.frameWidth,frameHeight:l.frameHeight,pliCount:l.pliCount,firCount:l.firCount,nackCount:l.nackCount,jitter:l.jitter,timestamp:l.timestamp,bytesReceived:l.bytesReceived,decoderImplementation:l.decoderImplementation}):l.type==="codec"&&o.set(l.id,l)}),i&&a!==""&&o.get(a)&&(i.mimeType=o.get(a).mimeType),i})}stopObservingElement(t){const i=this.elementInfos.filter(a=>a.element===t);for(const a of i)this.stopObservingElementInfo(a)}handleAppVisibilityChanged(){const t=Object.create(null,{handleAppVisibilityChanged:{get:()=>super.handleAppVisibilityChanged}});return T(this,void 0,void 0,function*(){yield t.handleAppVisibilityChanged.call(this),this.isAdaptiveStream&&this.updateVisibility()})}updateVisibility(t){var i,a;const o=this.elementInfos.reduce((m,p)=>Math.max(m,p.visibilityChangedAt||0),0),l=!((a=(i=this.adaptiveStreamSettings)===null||i===void 0?void 0:i.pauseVideoInBackground)!==null&&a!==void 0)||a?this.isInBackground:!1,f=this.elementInfos.some(m=>m.pictureInPicture),u=this.elementInfos.some(m=>m.visible)&&!l||f;if(!(this.lastVisible===u&&!t)){if(!u&&Date.now()-o<bd){_t.setTimeout(()=>{this.updateVisibility()},bd);return}this.lastVisible=u,this.emit(X.VisibilityChanged,u,this)}}updateDimensions(){var t,i;let a=0,o=0;const l=this.getPixelDensity();for(const f of this.elementInfos){const u=f.width()*l,m=f.height()*l;u+m>a+o&&(a=u,o=m)}((t=this.lastDimensions)===null||t===void 0?void 0:t.width)===a&&((i=this.lastDimensions)===null||i===void 0?void 0:i.height)===o||(this.lastDimensions={width:a,height:o},this.emit(X.VideoDimensionsChanged,this.lastDimensions,this))}getPixelDensity(){var t;const i=(t=this.adaptiveStreamSettings)===null||t===void 0?void 0:t.pixelDensity;return i==="screen"?dv():i||(dv()>2?2:1)}}class g1{get visible(){return this.isPiP||this.isIntersecting}get pictureInPicture(){return this.isPiP}constructor(t,i){this.onVisibilityChanged=a=>{var o;const{target:l,isIntersecting:f}=a;l===this.element&&(this.isIntersecting=f,this.isPiP=vr(this.element),this.visibilityChangedAt=Date.now(),(o=this.handleVisibilityChanged)===null||o===void 0||o.call(this))},this.onEnterPiP=()=>{var a,o,l;(o=(a=window.documentPictureInPicture)===null||a===void 0?void 0:a.window)===null||o===void 0||o.addEventListener("pagehide",this.onLeavePiP),this.isPiP=vr(this.element),(l=this.handleVisibilityChanged)===null||l===void 0||l.call(this)},this.onLeavePiP=()=>{var a;this.isPiP=vr(this.element),(a=this.handleVisibilityChanged)===null||a===void 0||a.call(this)},this.element=t,this.isIntersecting=i??Fd(t),this.isPiP=Ft()&&vr(t),this.visibilityChangedAt=0}width(){return this.element.clientWidth}height(){return this.element.clientHeight}observe(){var t,i,a;this.isIntersecting=Fd(this.element),this.isPiP=vr(this.element),this.element.handleResize=()=>{var o;(o=this.handleResize)===null||o===void 0||o.call(this)},this.element.handleVisibilityChanged=this.onVisibilityChanged,hv().observe(this.element),fv().observe(this.element),this.element.addEventListener("enterpictureinpicture",this.onEnterPiP),this.element.addEventListener("leavepictureinpicture",this.onLeavePiP),(t=window.documentPictureInPicture)===null||t===void 0||t.addEventListener("enter",this.onEnterPiP),(a=(i=window.documentPictureInPicture)===null||i===void 0?void 0:i.window)===null||a===void 0||a.addEventListener("pagehide",this.onLeavePiP)}stopObserving(){var t,i,a,o,l;(t=hv())===null||t===void 0||t.unobserve(this.element),(i=fv())===null||i===void 0||i.unobserve(this.element),this.element.removeEventListener("enterpictureinpicture",this.onEnterPiP),this.element.removeEventListener("leavepictureinpicture",this.onLeavePiP),(a=window.documentPictureInPicture)===null||a===void 0||a.removeEventListener("enter",this.onEnterPiP),(l=(o=window.documentPictureInPicture)===null||o===void 0?void 0:o.window)===null||l===void 0||l.removeEventListener("pagehide",this.onLeavePiP)}}function vr(r){var t,i;return document.pictureInPictureElement===r?!0:!((t=window.documentPictureInPicture)===null||t===void 0)&&t.window?Fd(r,(i=window.documentPictureInPicture)===null||i===void 0?void 0:i.window):!1}function Fd(r,t){const i=t||window;let a=r.offsetTop,o=r.offsetLeft;const l=r.offsetWidth,f=r.offsetHeight,{hidden:u}=r,{display:m}=getComputedStyle(r);for(;r.offsetParent;)r=r.offsetParent,a+=r.offsetTop,o+=r.offsetLeft;return a<i.pageYOffset+i.innerHeight&&o<i.pageXOffset+i.innerWidth&&a+f>i.pageYOffset&&o+l>i.pageXOffset&&!u&&m!=="none"}class ii extends Ln.EventEmitter{constructor(t,i,a,o){var l;super(),this.metadataMuted=!1,this.encryption=pt.NONE,this.log=Se,this.handleMuted=()=>{this.emit(X.Muted)},this.handleUnmuted=()=>{this.emit(X.Unmuted)},this.log=ci((l=o==null?void 0:o.loggerName)!==null&&l!==void 0?l:Rn.Publication),this.loggerContextCb=this.loggerContextCb,this.setMaxListeners(100),this.kind=t,this.trackSid=i,this.trackName=a,this.source=G.Source.Unknown}setTrack(t){this.track&&(this.track.off(X.Muted,this.handleMuted),this.track.off(X.Unmuted,this.handleUnmuted)),this.track=t,t&&(t.on(X.Muted,this.handleMuted),t.on(X.Unmuted,this.handleUnmuted))}get logContext(){var t;return Object.assign(Object.assign({},(t=this.loggerContextCb)===null||t===void 0?void 0:t.call(this)),Ee(this))}get isMuted(){return this.metadataMuted}get isEnabled(){return!0}get isSubscribed(){return this.track!==void 0}get isEncrypted(){return this.encryption!==pt.NONE}get audioTrack(){if(Nn(this.track))return this.track}get videoTrack(){if(Fi(this.track))return this.track}updateInfo(t){this.trackSid=t.sid,this.trackName=t.name,this.source=G.sourceFromProto(t.source),this.mimeType=t.mimeType,this.kind===G.Kind.Video&&t.width>0&&(this.dimensions={width:t.width,height:t.height},this.simulcasted=t.simulcast),this.encryption=t.encryption,this.trackInfo=t,this.log.debug("update publication info",Object.assign(Object.assign({},this.logContext),{info:t}))}}(function(r){(function(t){t.Desired="desired",t.Subscribed="subscribed",t.Unsubscribed="unsubscribed"})(r.SubscriptionStatus||(r.SubscriptionStatus={})),(function(t){t.Allowed="allowed",t.NotAllowed="not_allowed"})(r.PermissionStatus||(r.PermissionStatus={}))})(ii||(ii={}));class Gd extends ii{get isUpstreamPaused(){var t;return(t=this.track)===null||t===void 0?void 0:t.isUpstreamPaused}constructor(t,i,a,o){super(t,i.sid,i.name,o),this.track=void 0,this.handleTrackEnded=()=>{this.emit(X.Ended)},this.handleCpuConstrained=()=>{this.track&&Fi(this.track)&&this.emit(X.CpuConstrained,this.track)},this.updateInfo(i),this.setTrack(a)}setTrack(t){this.track&&(this.track.off(X.Ended,this.handleTrackEnded),this.track.off(X.CpuConstrained,this.handleCpuConstrained)),super.setTrack(t),t&&(t.on(X.Ended,this.handleTrackEnded),t.on(X.CpuConstrained,this.handleCpuConstrained))}get isMuted(){return this.track?this.track.isMuted:super.isMuted}get audioTrack(){return super.audioTrack}get videoTrack(){return super.videoTrack}get isLocal(){return!0}mute(){return T(this,void 0,void 0,function*(){var t;return(t=this.track)===null||t===void 0?void 0:t.mute()})}unmute(){return T(this,void 0,void 0,function*(){var t;return(t=this.track)===null||t===void 0?void 0:t.unmute()})}pauseUpstream(){return T(this,void 0,void 0,function*(){var t;yield(t=this.track)===null||t===void 0?void 0:t.pauseUpstream()})}resumeUpstream(){return T(this,void 0,void 0,function*(){var t;yield(t=this.track)===null||t===void 0?void 0:t.resumeUpstream()})}getTrackFeatures(){var t;if(Nn(this.track)){const i=this.track.getSourceTrackSettings(),a=new Set;return i.autoGainControl&&a.add(yt.TF_AUTO_GAIN_CONTROL),i.echoCancellation&&a.add(yt.TF_ECHO_CANCELLATION),i.noiseSuppression&&a.add(yt.TF_NOISE_SUPPRESSION),i.channelCount&&i.channelCount>1&&a.add(yt.TF_STEREO),!((t=this.options)===null||t===void 0)&&t.dtx||a.add(yt.TF_NO_DTX),this.track.enhancedNoiseCancellation&&a.add(yt.TF_ENHANCED_NOISE_CANCELLATION),Array.from(a.values())}else return[]}}function wc(r,t){return T(this,void 0,void 0,function*(){r??(r={});let i=!1;const{audioProcessor:a,videoProcessor:o,optionsWithoutProcessor:l}=uy(r);let f=l.audio,u=l.video;if(a&&typeof l.audio=="object"&&(l.audio.processor=a),o&&typeof l.video=="object"&&(l.video.processor=o),r.audio&&typeof l.audio=="object"&&typeof l.audio.deviceId=="string"){const v=l.audio.deviceId;l.audio.deviceId={exact:v},i=!0,f=Object.assign(Object.assign({},l.audio),{deviceId:{ideal:v}})}if(l.video&&typeof l.video=="object"&&typeof l.video.deviceId=="string"){const v=l.video.deviceId;l.video.deviceId={exact:v},i=!0,u=Object.assign(Object.assign({},l.video),{deviceId:{ideal:v}})}l.audio===!0?l.audio={deviceId:"default"}:typeof l.audio=="object"&&l.audio!==null&&(l.audio=Object.assign(Object.assign({},l.audio),{deviceId:l.audio.deviceId||"default"})),l.video===!0?l.video={deviceId:"default"}:typeof l.video=="object"&&!l.video.deviceId&&(l.video.deviceId="default");const m=oy(l,py,gy),p=uf(m),g=navigator.mediaDevices.getUserMedia(p);l.audio&&(bt.userMediaPromiseMap.set("audioinput",g),g.catch(()=>bt.userMediaPromiseMap.delete("audioinput"))),l.video&&(bt.userMediaPromiseMap.set("videoinput",g),g.catch(()=>bt.userMediaPromiseMap.delete("videoinput")));try{const v=yield g;return yield Promise.all(v.getTracks().map(S=>T(this,void 0,void 0,function*(){const k=S.kind==="audio";let O=k?m.audio:m.video;(typeof O=="boolean"||!O)&&(O={});let E;const j=k?p.audio:p.video;typeof j!="boolean"&&(E=j);const U=S.getSettings().deviceId;E!=null&&E.deviceId&&zi(E.deviceId)!==U?E.deviceId=U:E||(E={deviceId:U});const Y=FE(S,E,t);return Y.kind===G.Kind.Video?Y.source=G.Source.Camera:Y.kind===G.Kind.Audio&&(Y.source=G.Source.Microphone),Y.mediaStream=v,Nn(Y)&&a?yield Y.setProcessor(a):Fi(Y)&&o&&(yield Y.setProcessor(o)),Y})))}catch(v){if(!i)throw v;return wc(Object.assign(Object.assign({},r),{audio:f,video:u}),t)}})}function v1(r){return T(this,void 0,void 0,function*(){return(yield wc({audio:!1,video:!0}))[0]})}function y1(r){return T(this,void 0,void 0,function*(){return(yield wc({audio:!0,video:!1}))[0]})}var Ii;(function(r){r.Excellent="excellent",r.Good="good",r.Poor="poor",r.Lost="lost",r.Unknown="unknown"})(Ii||(Ii={}));function b1(r){switch(r){case yr.EXCELLENT:return Ii.Excellent;case yr.GOOD:return Ii.Good;case yr.POOR:return Ii.Poor;case yr.LOST:return Ii.Lost;default:return Ii.Unknown}}class _y extends Ln.EventEmitter{get logContext(){var t,i;return Object.assign({},(i=(t=this.loggerOptions)===null||t===void 0?void 0:t.loggerContextCb)===null||i===void 0?void 0:i.call(t))}get isEncrypted(){return this.trackPublications.size>0&&Array.from(this.trackPublications.values()).every(t=>t.isEncrypted)}get isAgent(){var t;return((t=this.permissions)===null||t===void 0?void 0:t.agent)||this.kind===_r.AGENT}get isActive(){var t;return((t=this.participantInfo)===null||t===void 0?void 0:t.state)===rs.ACTIVE}get kind(){return this._kind}get attributes(){return Object.freeze(Object.assign({},this._attributes))}constructor(t,i,a,o,l,f){let u=arguments.length>6&&arguments[6]!==void 0?arguments[6]:_r.STANDARD;var m;super(),this.audioLevel=0,this.isSpeaking=!1,this._connectionQuality=Ii.Unknown,this.log=Se,this.log=ci((m=f==null?void 0:f.loggerName)!==null&&m!==void 0?m:Rn.Participant),this.loggerOptions=f,this.setMaxListeners(100),this.sid=t,this.identity=i,this.name=a,this.metadata=o,this.audioTrackPublications=new Map,this.videoTrackPublications=new Map,this.trackPublications=new Map,this._kind=u,this._attributes=l??{}}getTrackPublications(){return Array.from(this.trackPublications.values())}getTrackPublication(t){for(const[,i]of this.trackPublications)if(i.source===t)return i}getTrackPublicationByName(t){for(const[,i]of this.trackPublications)if(i.trackName===t)return i}waitUntilActive(){return this.isActive?Promise.resolve():this.activeFuture?this.activeFuture.promise:(this.activeFuture=new gn,this.once(ee.Active,()=>{var t,i;(i=(t=this.activeFuture)===null||t===void 0?void 0:t.resolve)===null||i===void 0||i.call(t),this.activeFuture=void 0}),this.activeFuture.promise)}get connectionQuality(){return this._connectionQuality}get isCameraEnabled(){var t;const i=this.getTrackPublication(G.Source.Camera);return!(!((t=i==null?void 0:i.isMuted)!==null&&t!==void 0)||t)}get isMicrophoneEnabled(){var t;const i=this.getTrackPublication(G.Source.Microphone);return!(!((t=i==null?void 0:i.isMuted)!==null&&t!==void 0)||t)}get isScreenShareEnabled(){return!!this.getTrackPublication(G.Source.ScreenShare)}get isLocal(){return!1}get joinedAt(){return this.participantInfo?new Date(Number.parseInt(this.participantInfo.joinedAt.toString())*1e3):new Date}updateInfo(t){var i;return this.participantInfo&&this.participantInfo.sid===t.sid&&this.participantInfo.version>t.version?!1:(this.identity=t.identity,this.sid=t.sid,this._setName(t.name),this._setMetadata(t.metadata),this._setAttributes(t.attributes),t.state===rs.ACTIVE&&((i=this.participantInfo)===null||i===void 0?void 0:i.state)!==rs.ACTIVE&&this.emit(ee.Active),t.permission&&this.setPermissions(t.permission),this.participantInfo=t,!0)}_setMetadata(t){const i=this.metadata!==t,a=this.metadata;this.metadata=t,i&&this.emit(ee.ParticipantMetadataChanged,a)}_setName(t){const i=this.name!==t;this.name=t,i&&this.emit(ee.ParticipantNameChanged,t)}_setAttributes(t){const i=Ik(this.attributes,t);this._attributes=t,Object.keys(i).length>0&&this.emit(ee.AttributesChanged,i)}setPermissions(t){var i,a,o,l,f,u;const m=this.permissions,p=t.canPublish!==((i=this.permissions)===null||i===void 0?void 0:i.canPublish)||t.canSubscribe!==((a=this.permissions)===null||a===void 0?void 0:a.canSubscribe)||t.canPublishData!==((o=this.permissions)===null||o===void 0?void 0:o.canPublishData)||t.hidden!==((l=this.permissions)===null||l===void 0?void 0:l.hidden)||t.recorder!==((f=this.permissions)===null||f===void 0?void 0:f.recorder)||t.canPublishSources.length!==this.permissions.canPublishSources.length||t.canPublishSources.some((g,v)=>{var S;return g!==((S=this.permissions)===null||S===void 0?void 0:S.canPublishSources[v])})||t.canSubscribeMetrics!==((u=this.permissions)===null||u===void 0?void 0:u.canSubscribeMetrics);return this.permissions=t,p&&this.emit(ee.ParticipantPermissionsChanged,m),p}setIsSpeaking(t){t!==this.isSpeaking&&(this.isSpeaking=t,t&&(this.lastSpokeAt=new Date),this.emit(ee.IsSpeakingChanged,t))}setConnectionQuality(t){const i=this._connectionQuality;this._connectionQuality=b1(t),i!==this._connectionQuality&&this.emit(ee.ConnectionQualityChanged,this._connectionQuality)}setDisconnected(){var t,i;this.activeFuture&&((i=(t=this.activeFuture).reject)===null||i===void 0||i.call(t,new Error("Participant disconnected")),this.activeFuture=void 0)}setAudioContext(t){this.audioContext=t,this.audioTrackPublications.forEach(i=>Nn(i.track)&&i.track.setAudioContext(t))}addTrackPublication(t){t.on(X.Muted,()=>{this.emit(ee.TrackMuted,t)}),t.on(X.Unmuted,()=>{this.emit(ee.TrackUnmuted,t)});const i=t;switch(i.track&&(i.track.sid=t.trackSid),this.trackPublications.set(t.trackSid,t),t.kind){case G.Kind.Audio:this.audioTrackPublications.set(t.trackSid,t);break;case G.Kind.Video:this.videoTrackPublications.set(t.trackSid,t);break}}}function S1(r){var t,i,a;if(!r.participantSid&&!r.participantIdentity)throw new Error("Invalid track permission, must provide at least one of participantIdentity and participantSid");return new k0({participantIdentity:(t=r.participantIdentity)!==null&&t!==void 0?t:"",participantSid:(i=r.participantSid)!==null&&i!==void 0?i:"",allTracks:(a=r.allowAll)!==null&&a!==void 0?a:!1,trackSids:r.allowedTrackSids||[]})}class T1 extends _y{constructor(t,i,a,o,l,f){super(t,i,void 0,void 0,void 0,{loggerName:o.loggerName,loggerContextCb:()=>this.engine.logContext}),this.pendingPublishing=new Set,this.pendingPublishPromises=new Map,this.participantTrackPermissions=[],this.allParticipantsAllowedToSubscribe=!0,this.encryptionType=pt.NONE,this.enabledPublishVideoCodecs=[],this.pendingAcks=new Map,this.pendingResponses=new Map,this.handleReconnecting=()=>{this.reconnectFuture||(this.reconnectFuture=new gn)},this.handleReconnected=()=>{var u,m;(m=(u=this.reconnectFuture)===null||u===void 0?void 0:u.resolve)===null||m===void 0||m.call(u),this.reconnectFuture=void 0,this.updateTrackSubscriptionPermissions()},this.handleClosing=()=>{var u,m,p,g,v,S;this.reconnectFuture&&(this.reconnectFuture.promise.catch(k=>this.log.warn(k.message,this.logContext)),(m=(u=this.reconnectFuture)===null||u===void 0?void 0:u.reject)===null||m===void 0||m.call(u,new Error("Got disconnected during reconnection attempt")),this.reconnectFuture=void 0),this.signalConnectedFuture&&((g=(p=this.signalConnectedFuture).reject)===null||g===void 0||g.call(p,new Error("Got disconnected without signal connected")),this.signalConnectedFuture=void 0),(S=(v=this.activeAgentFuture)===null||v===void 0?void 0:v.reject)===null||S===void 0||S.call(v,new Error("Got disconnected without active agent present")),this.activeAgentFuture=void 0,this.firstActiveAgent=void 0},this.handleSignalConnected=u=>{var m,p;u.participant&&this.updateInfo(u.participant),this.signalConnectedFuture||(this.signalConnectedFuture=new gn),(p=(m=this.signalConnectedFuture).resolve)===null||p===void 0||p.call(m)},this.handleSignalRequestResponse=u=>{const{requestId:m,reason:p,message:g}=u,v=this.pendingSignalRequests.get(m);v&&(p!==rf.OK&&v.reject(new rv(g,p)),this.pendingSignalRequests.delete(m))},this.handleDataPacket=u=>{switch(u.value.case){case"rpcResponse":let m=u.value.value,p=null,g=null;m.value.case==="payload"?p=m.value.value:m.value.case==="error"&&(g=nt.fromProto(m.value.value)),this.handleIncomingRpcResponse(m.requestId,p,g);break;case"rpcAck":let v=u.value.value;this.handleIncomingRpcAck(v.requestId);break}},this.updateTrackSubscriptionPermissions=()=>{this.log.debug("updating track subscription permissions",Object.assign(Object.assign({},this.logContext),{allParticipantsAllowed:this.allParticipantsAllowedToSubscribe,participantTrackPermissions:this.participantTrackPermissions})),this.engine.client.sendUpdateSubscriptionPermissions(this.allParticipantsAllowedToSubscribe,this.participantTrackPermissions.map(u=>S1(u)))},this.onTrackUnmuted=u=>{this.onTrackMuted(u,u.isUpstreamPaused)},this.onTrackMuted=(u,m)=>{if(m===void 0&&(m=!0),!u.sid){this.log.error("could not update mute status for unpublished track",Object.assign(Object.assign({},this.logContext),Ee(u)));return}this.engine.updateMuteStatus(u.sid,m)},this.onTrackUpstreamPaused=u=>{this.log.debug("upstream paused",Object.assign(Object.assign({},this.logContext),Ee(u))),this.onTrackMuted(u,!0)},this.onTrackUpstreamResumed=u=>{this.log.debug("upstream resumed",Object.assign(Object.assign({},this.logContext),Ee(u))),this.onTrackMuted(u,u.isMuted)},this.onTrackFeatureUpdate=u=>{const m=this.audioTrackPublications.get(u.sid);if(!m){this.log.warn("Could not update local audio track settings, missing publication for track ".concat(u.sid),this.logContext);return}this.engine.client.sendUpdateLocalAudioTrack(m.trackSid,m.getTrackFeatures())},this.onTrackCpuConstrained=(u,m)=>{this.log.debug("track cpu constrained",Object.assign(Object.assign({},this.logContext),Ee(m))),this.emit(ee.LocalTrackCpuConstrained,u,m)},this.handleSubscribedQualityUpdate=u=>T(this,void 0,void 0,function*(){var m,p,g,v,S;if(!(!((S=this.roomOptions)===null||S===void 0)&&S.dynacast))return;const k=this.videoTrackPublications.get(u.trackSid);if(!k){this.log.warn("received subscribed quality update for unknown track",Object.assign(Object.assign({},this.logContext),{trackSid:u.trackSid}));return}if(!k.videoTrack)return;const O=yield k.videoTrack.setPublishingCodecs(u.subscribedCodecs);try{for(var E=!0,j=ri(O),U;U=yield j.next(),m=U.done,!m;E=!0){v=U.value,E=!1;const Y=v;xk(Y)&&(this.log.debug("publish ".concat(Y," for ").concat(k.videoTrack.sid),Object.assign(Object.assign({},this.logContext),Ee(k))),yield this.publishAdditionalCodecForTrack(k.videoTrack,Y,k.options))}}catch(Y){p={error:Y}}finally{try{!E&&!m&&(g=j.return)&&(yield g.call(j))}finally{if(p)throw p.error}}}),this.handleLocalTrackUnpublished=u=>{const m=this.trackPublications.get(u.trackSid);if(!m){this.log.warn("received unpublished event for unknown track",Object.assign(Object.assign({},this.logContext),{trackSid:u.trackSid}));return}this.unpublishTrack(m.track)},this.handleTrackEnded=u=>T(this,void 0,void 0,function*(){if(u.source===G.Source.ScreenShare||u.source===G.Source.ScreenShareAudio)this.log.debug("unpublishing local track due to TrackEnded",Object.assign(Object.assign({},this.logContext),Ee(u))),this.unpublishTrack(u);else if(u.isUserProvided)yield u.mute();else if(ni(u)||Ui(u))try{if(Ft())try{const m=yield navigator==null?void 0:navigator.permissions.query({name:u.source===G.Source.Camera?"camera":"microphone"});if(m&&m.state==="denied")throw this.log.warn("user has revoked access to ".concat(u.source),Object.assign(Object.assign({},this.logContext),Ee(u))),m.onchange=()=>{m.state!=="denied"&&(u.isMuted||u.restartTrack(),m.onchange=null)},new Error("GetUserMedia Permission denied")}catch{}u.isMuted||(this.log.debug("track ended, attempting to use a different device",Object.assign(Object.assign({},this.logContext),Ee(u))),ni(u)?yield u.restartTrack({deviceId:"default"}):yield u.restartTrack())}catch{this.log.warn("could not restart track, muting instead",Object.assign(Object.assign({},this.logContext),Ee(u))),yield u.mute()}}),this.audioTrackPublications=new Map,this.videoTrackPublications=new Map,this.trackPublications=new Map,this.engine=a,this.roomOptions=o,this.setupEngine(a),this.activeDeviceMap=new Map([["audioinput","default"],["videoinput","default"],["audiooutput","default"]]),this.pendingSignalRequests=new Map,this.rpcHandlers=l,this.roomOutgoingDataStreamManager=f}get lastCameraError(){return this.cameraError}get lastMicrophoneError(){return this.microphoneError}get isE2EEEnabled(){return this.encryptionType!==pt.NONE}getTrackPublication(t){const i=super.getTrackPublication(t);if(i)return i}getTrackPublicationByName(t){const i=super.getTrackPublicationByName(t);if(i)return i}setupEngine(t){var i;this.engine=t,this.engine.on($.RemoteMute,(a,o)=>{const l=this.trackPublications.get(a);!l||!l.track||(o?l.mute():l.unmute())}),!((i=this.signalConnectedFuture)===null||i===void 0)&&i.isResolved&&(this.signalConnectedFuture=void 0),this.engine.on($.Connected,this.handleReconnected).on($.SignalConnected,this.handleSignalConnected).on($.SignalRestarted,this.handleReconnected).on($.SignalResumed,this.handleReconnected).on($.Restarting,this.handleReconnecting).on($.Resuming,this.handleReconnecting).on($.LocalTrackUnpublished,this.handleLocalTrackUnpublished).on($.SubscribedQualityUpdate,this.handleSubscribedQualityUpdate).on($.Closing,this.handleClosing).on($.SignalRequestResponse,this.handleSignalRequestResponse).on($.DataPacketReceived,this.handleDataPacket)}setMetadata(t){return T(this,void 0,void 0,function*(){yield this.requestMetadataUpdate({metadata:t})})}setName(t){return T(this,void 0,void 0,function*(){yield this.requestMetadataUpdate({name:t})})}setAttributes(t){return T(this,void 0,void 0,function*(){yield this.requestMetadataUpdate({attributes:t})})}requestMetadataUpdate(t){return T(this,arguments,void 0,function(i){var a=this;let{metadata:o,name:l,attributes:f}=i;return(function*(){return new Ht((u,m)=>T(a,void 0,void 0,function*(){var p,g;try{let v=!1;const S=yield this.engine.client.sendUpdateLocalMetadata((p=o??this.metadata)!==null&&p!==void 0?p:"",(g=l??this.name)!==null&&g!==void 0?g:"",f),k=performance.now();for(this.pendingSignalRequests.set(S,{resolve:u,reject:O=>{m(O),v=!0},values:{name:l,metadata:o,attributes:f}});performance.now()-k<5e3&&!v;){if((!l||this.name===l)&&(!o||this.metadata===o)&&(!f||Object.entries(f).every(O=>{let[E,j]=O;return this.attributes[E]===j||j===""&&!this.attributes[E]}))){this.pendingSignalRequests.delete(S),u();return}yield Rt(50)}m(new rv("Request to update local metadata timed out","TimeoutError"))}catch(v){v instanceof Error?m(v):m(new Error(String(v)))}}))})()})}setCameraEnabled(t,i,a){return this.setTrackEnabled(G.Source.Camera,t,i,a)}setMicrophoneEnabled(t,i,a){return this.setTrackEnabled(G.Source.Microphone,t,i,a)}setScreenShareEnabled(t,i,a){return this.setTrackEnabled(G.Source.ScreenShare,t,i,a)}setE2EEEnabled(t){return T(this,void 0,void 0,function*(){this.encryptionType=t?pt.GCM:pt.NONE,yield this.republishAllTracks(void 0,!1)})}setTrackEnabled(t,i,a,o){return T(this,void 0,void 0,function*(){var l,f;this.log.debug("setTrackEnabled",Object.assign(Object.assign({},this.logContext),{source:t,enabled:i})),this.republishPromise&&(yield this.republishPromise);let u=this.getTrackPublication(t);if(i)if(u)yield u.unmute();else{let m;if(this.pendingPublishing.has(t)){const p=yield this.waitForPendingPublicationOfSource(t);return p||this.log.info("waiting for pending publication promise timed out",Object.assign(Object.assign({},this.logContext),{source:t})),yield p==null?void 0:p.unmute(),p}this.pendingPublishing.add(t);try{switch(t){case G.Source.Camera:m=yield this.createTracks({video:(l=a)!==null&&l!==void 0?l:!0});break;case G.Source.Microphone:m=yield this.createTracks({audio:(f=a)!==null&&f!==void 0?f:!0});break;case G.Source.ScreenShare:m=yield this.createScreenTracks(Object.assign({},a));break;default:throw new oi(t)}}catch(p){throw m==null||m.forEach(g=>{g.stop()}),p instanceof Error&&this.emit(ee.MediaDevicesError,p,Ud(t)),this.pendingPublishing.delete(t),p}for(const p of m){const g=Object.assign(Object.assign({},this.roomOptions.publishDefaults),a);t===G.Source.Microphone&&Nn(p)&&g.preConnectBuffer&&(this.log.info("starting preconnect buffer for microphone",Object.assign({},this.logContext)),p.startPreConnectBuffer())}try{const p=[];for(const v of m)this.log.info("publishing track",Object.assign(Object.assign({},this.logContext),Ee(v))),p.push(this.publishTrack(v,o));[u]=yield Promise.all(p)}catch(p){throw m==null||m.forEach(g=>{g.stop()}),p}finally{this.pendingPublishing.delete(t)}}else if(!(u!=null&&u.track)&&this.pendingPublishing.has(t)&&(u=yield this.waitForPendingPublicationOfSource(t),u||this.log.info("waiting for pending publication promise timed out",Object.assign(Object.assign({},this.logContext),{source:t}))),u&&u.track)if(t===G.Source.ScreenShare){u=yield this.unpublishTrack(u.track);const m=this.getTrackPublication(G.Source.ScreenShareAudio);m&&m.track&&this.unpublishTrack(m.track)}else yield u.mute();return u})}enableCameraAndMicrophone(){return T(this,void 0,void 0,function*(){if(!(this.pendingPublishing.has(G.Source.Camera)||this.pendingPublishing.has(G.Source.Microphone))){this.pendingPublishing.add(G.Source.Camera),this.pendingPublishing.add(G.Source.Microphone);try{const t=yield this.createTracks({audio:!0,video:!0});yield Promise.all(t.map(i=>this.publishTrack(i)))}finally{this.pendingPublishing.delete(G.Source.Camera),this.pendingPublishing.delete(G.Source.Microphone)}}})}createTracks(t){return T(this,void 0,void 0,function*(){var i,a;t??(t={});const o=oy(t,(i=this.roomOptions)===null||i===void 0?void 0:i.audioCaptureDefaults,(a=this.roomOptions)===null||a===void 0?void 0:a.videoCaptureDefaults);try{return(yield wc(o,{loggerName:this.roomOptions.loggerName,loggerContextCb:()=>this.logContext})).map(u=>(Nn(u)&&(this.microphoneError=void 0,u.setAudioContext(this.audioContext),u.source=G.Source.Microphone,this.emit(ee.AudioStreamAcquired)),Fi(u)&&(this.cameraError=void 0,u.source=G.Source.Camera),u))}catch(l){throw l instanceof Error&&(t.audio&&(this.microphoneError=l),t.video&&(this.cameraError=l)),l}})}createScreenTracks(t){return T(this,void 0,void 0,function*(){if(t===void 0&&(t={}),navigator.mediaDevices.getDisplayMedia===void 0)throw new cf("getDisplayMedia not supported");t.resolution===void 0&&!Kk()&&(t.resolution=lf.h1080fps30.resolution);const i=Pk(t),a=yield navigator.mediaDevices.getDisplayMedia(i),o=a.getVideoTracks();if(o.length===0)throw new oi("no video track found");const l=new Tc(o[0],void 0,!1,{loggerName:this.roomOptions.loggerName,loggerContextCb:()=>this.logContext});l.source=G.Source.ScreenShare,t.contentHint&&(l.mediaStreamTrack.contentHint=t.contentHint);const f=[l];if(a.getAudioTracks().length>0){this.emit(ee.AudioStreamAcquired);const u=new Sc(a.getAudioTracks()[0],void 0,!1,this.audioContext,{loggerName:this.roomOptions.loggerName,loggerContextCb:()=>this.logContext});u.source=G.Source.ScreenShareAudio,f.push(u)}return f})}publishTrack(t,i){return T(this,void 0,void 0,function*(){return this.publishOrRepublishTrack(t,i)})}publishOrRepublishTrack(t,i){return T(this,arguments,void 0,function(a,o){var l=this;let f=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1;return(function*(){var u,m,p,g;ni(a)&&a.setAudioContext(l.audioContext),yield(u=l.reconnectFuture)===null||u===void 0?void 0:u.promise,l.republishPromise&&!f&&(yield l.republishPromise),ds(a)&&l.pendingPublishPromises.has(a)&&(yield l.pendingPublishPromises.get(a));let v;if(a instanceof MediaStreamTrack)v=a.getConstraints();else{v=a.constraints;let U;switch(a.source){case G.Source.Microphone:U="audioinput";break;case G.Source.Camera:U="videoinput"}U&&l.activeDeviceMap.has(U)&&(v=Object.assign(Object.assign({},v),{deviceId:l.activeDeviceMap.get(U)}))}if(a instanceof MediaStreamTrack)switch(a.kind){case"audio":a=new Sc(a,v,!0,l.audioContext,{loggerName:l.roomOptions.loggerName,loggerContextCb:()=>l.logContext});break;case"video":a=new Tc(a,v,!0,{loggerName:l.roomOptions.loggerName,loggerContextCb:()=>l.logContext});break;default:throw new oi("unsupported MediaStreamTrack kind ".concat(a.kind))}else a.updateLoggerOptions({loggerName:l.roomOptions.loggerName,loggerContextCb:()=>l.logContext});let S;if(l.trackPublications.forEach(U=>{U.track&&U.track===a&&(S=U)}),S)return l.log.warn("track has already been published, skipping",Object.assign(Object.assign({},l.logContext),Ee(S))),S;const k=Object.assign(Object.assign({},l.roomOptions.publishDefaults),o),O="channelCount"in a.mediaStreamTrack.getSettings()&&a.mediaStreamTrack.getSettings().channelCount===2||a.mediaStreamTrack.getConstraints().channelCount===2,E=(m=k.forceStereo)!==null&&m!==void 0?m:O;E&&(k.dtx===void 0&&l.log.info("Opus DTX will be disabled for stereo tracks by default. Enable them explicitly to make it work.",Object.assign(Object.assign({},l.logContext),Ee(a))),k.red===void 0&&l.log.info("Opus RED will be disabled for stereo tracks by default. Enable them explicitly to make it work."),(p=k.dtx)!==null&&p!==void 0||(k.dtx=!1),(g=k.red)!==null&&g!==void 0||(k.red=!1)),!Qk()&&l.roomOptions.e2ee&&(l.log.info("End-to-end encryption is set up, simulcast publishing will be disabled on Safari versions and iOS browsers running iOS < v17.2",Object.assign({},l.logContext)),k.simulcast=!1),k.source&&(a.source=k.source);const j=new Promise((U,Y)=>T(l,void 0,void 0,function*(){try{if(this.engine.client.currentState!==Ge.CONNECTED){this.log.debug("deferring track publication until signal is connected",Object.assign(Object.assign({},this.logContext),{track:Ee(a)}));let Z=!1;const M=setTimeout(()=>{Z=!0,a.stop(),Y(new sv("publishing rejected as engine not connected within timeout",408))},15e3);if(yield this.waitUntilEngineConnected(),clearTimeout(M),Z)return;const N=yield this.publish(a,k,E);U(N)}else try{const Z=yield this.publish(a,k,E);U(Z)}catch(Z){Y(Z)}}catch(Z){Y(Z)}}));l.pendingPublishPromises.set(a,j);try{return yield j}catch(U){throw U}finally{l.pendingPublishPromises.delete(a)}})()})}waitUntilEngineConnected(){return this.signalConnectedFuture||(this.signalConnectedFuture=new gn),this.signalConnectedFuture.promise}hasPermissionsToPublish(t){if(!this.permissions)return this.log.warn("no permissions present for publishing track",Object.assign(Object.assign({},this.logContext),Ee(t))),!1;const{canPublish:i,canPublishSources:a}=this.permissions;return i&&(a.length===0||a.map(o=>jk(o)).includes(t.source))?!0:(this.log.warn("insufficient permissions to publish",Object.assign(Object.assign({},this.logContext),Ee(t))),!1)}publish(t,i,a){return T(this,void 0,void 0,function*(){var o,l,f,u,m,p,g,v,S,k;if(!this.hasPermissionsToPublish(t))throw new sv("failed to publish track, insufficient permissions",403);Array.from(this.trackPublications.values()).find(ne=>ds(t)&&ne.source===t.source)&&t.source!==G.Source.Unknown&&this.log.info("publishing a second track with the same source: ".concat(t.source),Object.assign(Object.assign({},this.logContext),Ee(t))),i.stopMicTrackOnMute&&Nn(t)&&(t.stopOnMute=!0),t.source===G.Source.ScreenShare&&ma()&&(i.simulcast=!1),i.videoCodec==="av1"&&!Hk()&&(i.videoCodec=void 0),i.videoCodec==="vp9"&&!Fk()&&(i.videoCodec=void 0),i.videoCodec===void 0&&(i.videoCodec=qd),this.enabledPublishVideoCodecs.length>0&&(this.enabledPublishVideoCodecs.some(ne=>i.videoCodec===Cr(ne.mime))||(i.videoCodec=Cr(this.enabledPublishVideoCodecs[0].mime)));const E=i.videoCodec;t.on(X.Muted,this.onTrackMuted),t.on(X.Unmuted,this.onTrackUnmuted),t.on(X.Ended,this.handleTrackEnded),t.on(X.UpstreamPaused,this.onTrackUpstreamPaused),t.on(X.UpstreamResumed,this.onTrackUpstreamResumed),t.on(X.AudioTrackFeatureUpdate,this.onTrackFeatureUpdate);const j=[],U=!(!((o=i.dtx)!==null&&o!==void 0)||o),Y=t.getSourceTrackSettings();Y.autoGainControl&&j.push(yt.TF_AUTO_GAIN_CONTROL),Y.echoCancellation&&j.push(yt.TF_ECHO_CANCELLATION),Y.noiseSuppression&&j.push(yt.TF_NOISE_SUPPRESSION),Y.channelCount&&Y.channelCount>1&&j.push(yt.TF_STEREO),U&&j.push(yt.TF_NO_DTX),ni(t)&&t.hasPreConnectBuffer&&j.push(yt.TF_PRECONNECT_BUFFER);const Z=new Rr({cid:t.mediaStreamTrack.id,name:i.name,type:G.kindToProto(t.kind),muted:t.isMuted,source:G.sourceToProto(t.source),disableDtx:U,encryption:this.encryptionType,stereo:a,disableRed:this.isE2EEEnabled||!(!((l=i.red)!==null&&l!==void 0)||l),stream:i==null?void 0:i.stream,backupCodecPolicy:i==null?void 0:i.backupCodecPolicy,audioFeatures:j});let M;if(t.kind===G.Kind.Video){let ne={width:0,height:0};try{ne=yield t.waitForDimensions()}catch{const se=(u=(f=this.roomOptions.videoCaptureDefaults)===null||f===void 0?void 0:f.resolution)!==null&&u!==void 0?u:Or.h720.resolution;ne={width:se.width,height:se.height},this.log.error("could not determine track dimensions, using defaults",Object.assign(Object.assign(Object.assign({},this.logContext),Ee(t)),{dims:ne}))}Z.width=ne.width,Z.height=ne.height,Ui(t)&&(En(E)&&(t.source===G.Source.ScreenShare&&(i.scalabilityMode="L1T3","contentHint"in t.mediaStreamTrack&&(t.mediaStreamTrack.contentHint="motion",this.log.info("forcing contentHint to motion for screenshare with SVC codecs",Object.assign(Object.assign({},this.logContext),Ee(t))))),i.scalabilityMode=(m=i.scalabilityMode)!==null&&m!==void 0?m:"L3T3_KEY"),Z.simulcastCodecs=[new Ed({codec:E,cid:t.mediaStreamTrack.id})],i.backupCodec===!0&&(i.backupCodec={codec:qd}),i.backupCodec&&E!==i.backupCodec.codec&&Z.encryption===pt.NONE&&(this.roomOptions.dynacast||(this.roomOptions.dynacast=!0),Z.simulcastCodecs.push(new Ed({codec:i.backupCodec.codec,cid:""})))),M=Hd(t.source===G.Source.ScreenShare,Z.width,Z.height,i),Z.layers=Nv(Z.width,Z.height,M,En(i.videoCodec))}else t.kind===G.Kind.Audio&&(M=[{maxBitrate:(p=i.audioPreset)===null||p===void 0?void 0:p.maxBitrate,priority:(v=(g=i.audioPreset)===null||g===void 0?void 0:g.priority)!==null&&v!==void 0?v:"high",networkPriority:(k=(S=i.audioPreset)===null||S===void 0?void 0:S.priority)!==null&&k!==void 0?k:"high"}]);if(!this.engine||this.engine.isClosed)throw new rt("cannot publish track when not connected");const N=()=>T(this,void 0,void 0,function*(){var ne,ie,se;if(!this.engine.pcManager)throw new rt("pcManager is not ready");if(t.sender=yield this.engine.createSender(t,i,M),this.emit(ee.LocalSenderCreated,t.sender,t),Ui(t)&&((ne=i.degradationPreference)!==null&&ne!==void 0||(i.degradationPreference=e1(t)),t.setDegradationPreference(i.degradationPreference)),M)if(ma()&&t.kind===G.Kind.Audio){let ue;for(const Ne of this.engine.pcManager.publisher.getTransceivers())if(Ne.sender===t.sender){ue=Ne;break}ue&&this.engine.pcManager.publisher.setTrackCodecBitrate({transceiver:ue,codec:"opus",maxbr:!((ie=M[0])===null||ie===void 0)&&ie.maxBitrate?M[0].maxBitrate/1e3:0})}else t.codec&&En(t.codec)&&(!((se=M[0])===null||se===void 0)&&se.maxBitrate)&&this.engine.pcManager.publisher.setTrackCodecBitrate({cid:Z.cid,codec:t.codec,maxbr:M[0].maxBitrate/1e3});yield this.engine.negotiate()});let q;const Q=new Promise((ne,ie)=>T(this,void 0,void 0,function*(){var se;try{q=yield this.engine.addTrack(Z),ne(q)}catch(ue){t.sender&&(!((se=this.engine.pcManager)===null||se===void 0)&&se.publisher)&&(this.engine.pcManager.publisher.removeTrack(t.sender),yield this.engine.negotiate().catch(Ne=>{this.log.error("failed to negotiate after removing track due to failed add track request",Object.assign(Object.assign(Object.assign({},this.logContext),Ee(t)),{error:Ne}))})),ie(ue)}}));if(this.enabledPublishVideoCodecs.length>0)q=(yield Promise.all([Q,N()]))[0];else{q=yield Q;let ne;if(q.codecs.forEach(ie=>{ne===void 0&&(ne=ie.mimeType)}),ne&&t.kind===G.Kind.Video){const ie=Cr(ne);ie!==E&&(this.log.debug("falling back to server selected codec",Object.assign(Object.assign(Object.assign({},this.logContext),Ee(t)),{codec:ie})),i.videoCodec=ie,M=Hd(t.source===G.Source.ScreenShare,Z.width,Z.height,i))}yield N()}const ae=new Gd(t.kind,q,t,{loggerName:this.roomOptions.loggerName,loggerContextCb:()=>this.logContext});if(ae.on(X.CpuConstrained,ne=>this.onTrackCpuConstrained(ne,ae)),ae.options=i,t.sid=q.sid,this.log.debug("publishing ".concat(t.kind," with encodings"),Object.assign(Object.assign({},this.logContext),{encodings:M,trackInfo:q})),Ui(t)?t.startMonitor(this.engine.client):ni(t)&&t.startMonitor(),this.addTrackPublication(ae),this.emit(ee.LocalTrackPublished,ae),ni(t)&&q.audioFeatures.includes(yt.TF_PRECONNECT_BUFFER)){const ne=t.getPreConnectBuffer(),ie=t.getPreConnectBufferMimeType();this.on(ee.LocalTrackSubscribed,se=>{if(se.trackSid===q.sid){if(!t.hasPreConnectBuffer){this.log.warn("subscribe event came to late, buffer already closed",this.logContext);return}this.log.debug("finished recording preconnect buffer",Object.assign(Object.assign({},this.logContext),Ee(t))),t.stopPreConnectBuffer()}}),ne&&new Promise((ue,Ne)=>T(this,void 0,void 0,function*(){var Ze,ht,I,W,de,Me;try{this.log.debug("waiting for agent",Object.assign(Object.assign({},this.logContext),Ee(t)));const te=setTimeout(()=>{Ne(new Error("agent not active within 10 seconds"))},1e4),oe=yield this.waitUntilActiveAgentPresent();clearTimeout(te),this.log.debug("sending preconnect buffer",Object.assign(Object.assign({},this.logContext),Ee(t)));const pe=yield this.streamBytes({name:"preconnect-buffer",mimeType:ie,topic:"lk.agent.pre-connect-audio-buffer",destinationIdentities:[oe.identity],attributes:{trackId:ae.trackSid,sampleRate:String((de=Y.sampleRate)!==null&&de!==void 0?de:"48000"),channels:String((Me=Y.channelCount)!==null&&Me!==void 0?Me:"1")}});try{for(var Pe=!0,R=ri(ne),V;V=yield R.next(),Ze=V.done,!Ze;Pe=!0){W=V.value,Pe=!1;const ye=W;yield pe.write(ye)}}catch(ye){ht={error:ye}}finally{try{!Pe&&!Ze&&(I=R.return)&&(yield I.call(R))}finally{if(ht)throw ht.error}}yield pe.close(),ue()}catch(te){Ne(te)}})).then(()=>{this.log.debug("preconnect buffer sent successfully",Object.assign(Object.assign({},this.logContext),Ee(t)))}).catch(ue=>{this.log.error("error sending preconnect buffer",Object.assign(Object.assign(Object.assign({},this.logContext),Ee(t)),{error:ue}))})}return ae})}get isLocal(){return!0}publishAdditionalCodecForTrack(t,i,a){return T(this,void 0,void 0,function*(){var o;if(this.encryptionType!==pt.NONE)return;let l;if(this.trackPublications.forEach(k=>{k.track&&k.track===t&&(l=k)}),!l)throw new oi("track is not published");if(!Ui(t))throw new oi("track is not a video track");const f=Object.assign(Object.assign({},(o=this.roomOptions)===null||o===void 0?void 0:o.publishDefaults),a),u=ZE(t,i,f);if(!u){this.log.info("backup codec has been disabled, ignoring request to add additional codec for track",Object.assign(Object.assign({},this.logContext),Ee(t)));return}const m=t.addSimulcastTrack(i,u);if(!m)return;const p=new Rr({cid:m.mediaStreamTrack.id,type:G.kindToProto(t.kind),muted:t.isMuted,source:G.sourceToProto(t.source),sid:t.sid,simulcastCodecs:[{codec:f.videoCodec,cid:m.mediaStreamTrack.id}]});if(p.layers=Nv(p.width,p.height,u),!this.engine||this.engine.isClosed)throw new rt("cannot publish track when not connected");const g=()=>T(this,void 0,void 0,function*(){yield this.engine.createSimulcastSender(t,m,f,u),yield this.engine.negotiate()}),S=(yield Promise.all([this.engine.addTrack(p),g()]))[0];this.log.debug("published ".concat(i," for track ").concat(t.sid),Object.assign(Object.assign({},this.logContext),{encodings:u,trackInfo:S}))})}unpublishTrack(t,i){return T(this,void 0,void 0,function*(){var a,o;if(ds(t)){const p=this.pendingPublishPromises.get(t);p&&(this.log.info("awaiting publish promise before attempting to unpublish",Object.assign(Object.assign({},this.logContext),Ee(t))),yield p)}const l=this.getPublicationForTrack(t),f=l?Ee(l):void 0;if(this.log.debug("unpublishing track",Object.assign(Object.assign({},this.logContext),f)),!l||!l.track){this.log.warn("track was not unpublished because no publication was found",Object.assign(Object.assign({},this.logContext),f));return}t=l.track,t.off(X.Muted,this.onTrackMuted),t.off(X.Unmuted,this.onTrackUnmuted),t.off(X.Ended,this.handleTrackEnded),t.off(X.UpstreamPaused,this.onTrackUpstreamPaused),t.off(X.UpstreamResumed,this.onTrackUpstreamResumed),t.off(X.AudioTrackFeatureUpdate,this.onTrackFeatureUpdate),i===void 0&&(i=(o=(a=this.roomOptions)===null||a===void 0?void 0:a.stopLocalTrackOnUnpublish)!==null&&o!==void 0?o:!0),i?t.stop():t.stopMonitor();let u=!1;const m=t.sender;if(t.sender=void 0,this.engine.pcManager&&this.engine.pcManager.currentState<et.FAILED&&m)try{for(const p of this.engine.pcManager.publisher.getTransceivers())p.sender===m&&(p.direction="inactive",u=!0);if(this.engine.removeTrack(m)&&(u=!0),Ui(t)){for(const[,p]of t.simulcastCodecs)p.sender&&(this.engine.removeTrack(p.sender)&&(u=!0),p.sender=void 0);t.simulcastCodecs.clear()}}catch(p){this.log.warn("failed to unpublish track",Object.assign(Object.assign(Object.assign({},this.logContext),f),{error:p}))}switch(this.trackPublications.delete(l.trackSid),l.kind){case G.Kind.Audio:this.audioTrackPublications.delete(l.trackSid);break;case G.Kind.Video:this.videoTrackPublications.delete(l.trackSid);break}return this.emit(ee.LocalTrackUnpublished,l),l.setTrack(void 0),u&&(yield this.engine.negotiate()),l})}unpublishTracks(t){return T(this,void 0,void 0,function*(){return(yield Promise.all(t.map(a=>this.unpublishTrack(a)))).filter(a=>!!a)})}republishAllTracks(t){return T(this,arguments,void 0,function(i){var a=this;let o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;return(function*(){a.republishPromise&&(yield a.republishPromise),a.republishPromise=new Ht((l,f)=>T(a,void 0,void 0,function*(){try{const u=[];this.trackPublications.forEach(m=>{m.track&&(i&&(m.options=Object.assign(Object.assign({},m.options),i)),u.push(m))}),yield Promise.all(u.map(m=>T(this,void 0,void 0,function*(){const p=m.track;yield this.unpublishTrack(p,!1),o&&!p.isMuted&&p.source!==G.Source.ScreenShare&&p.source!==G.Source.ScreenShareAudio&&(ni(p)||Ui(p))&&!p.isUserProvided&&(this.log.debug("restarting existing track",Object.assign(Object.assign({},this.logContext),{track:m.trackSid})),yield p.restartTrack()),yield this.publishOrRepublishTrack(p,m.options,!0)}))),l()}catch(u){u instanceof Error?f(u):f(new Error(String(u)))}finally{this.republishPromise=void 0}})),yield a.republishPromise})()})}publishData(t){return T(this,arguments,void 0,function(i){var a=this;let o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return(function*(){const l=o.reliable?Te.RELIABLE:Te.LOSSY,f=o.destinationIdentities,u=o.topic;let m=new Xd({participantIdentity:a.identity,payload:i,destinationIdentities:f,topic:u});const p=new wt({kind:l,value:{case:"user",value:m}});yield a.engine.sendDataPacket(p,l)})()})}publishDtmf(t,i){return T(this,void 0,void 0,function*(){const a=new wt({kind:Te.RELIABLE,value:{case:"sipDtmf",value:new c0({code:t,digit:i})}});yield this.engine.sendDataPacket(a,Te.RELIABLE)})}sendChatMessage(t,i){return T(this,void 0,void 0,function*(){const a={id:crypto.randomUUID(),message:t,timestamp:Date.now(),attachedFiles:i==null?void 0:i.attachments},o=new wt({value:{case:"chatMessage",value:new pc(Object.assign(Object.assign({},a),{timestamp:Xe.parse(a.timestamp)}))}});return yield this.engine.sendDataPacket(o,Te.RELIABLE),this.emit(ee.ChatMessage,a),a})}editChatMessage(t,i){return T(this,void 0,void 0,function*(){const a=Object.assign(Object.assign({},i),{message:t,editTimestamp:Date.now()}),o=new wt({value:{case:"chatMessage",value:new pc(Object.assign(Object.assign({},a),{timestamp:Xe.parse(a.timestamp),editTimestamp:Xe.parse(a.editTimestamp)}))}});return yield this.engine.sendDataPacket(o,Te.RELIABLE),this.emit(ee.ChatMessage,a),a})}sendText(t,i){return T(this,void 0,void 0,function*(){return this.roomOutgoingDataStreamManager.sendText(t,i)})}streamText(t){return T(this,void 0,void 0,function*(){return this.roomOutgoingDataStreamManager.streamText(t)})}sendFile(t,i){return T(this,void 0,void 0,function*(){return this.roomOutgoingDataStreamManager.sendFile(t,i)})}streamBytes(t){return T(this,void 0,void 0,function*(){return this.roomOutgoingDataStreamManager.streamBytes(t)})}performRpc(t){let{destinationIdentity:i,method:a,payload:o,responseTimeout:l=15e3}=t;const f=7e3,u=f+1e3;return new Ht((m,p)=>T(this,void 0,void 0,function*(){var g,v,S,k;if(vf(o)>yy){p(nt.builtIn("REQUEST_PAYLOAD_TOO_LARGE"));return}if(!((v=(g=this.engine.latestJoinResponse)===null||g===void 0?void 0:g.serverInfo)===null||v===void 0)&&v.version&&Un((k=(S=this.engine.latestJoinResponse)===null||S===void 0?void 0:S.serverInfo)===null||k===void 0?void 0:k.version,"1.8.0")<0){p(nt.builtIn("UNSUPPORTED_SERVER"));return}const O=Math.max(l,u),E=crypto.randomUUID();yield this.publishRpcRequest(i,E,a,o,O);const j=setTimeout(()=>{this.pendingAcks.delete(E),p(nt.builtIn("CONNECTION_TIMEOUT")),this.pendingResponses.delete(E),clearTimeout(U)},f);this.pendingAcks.set(E,{resolve:()=>{clearTimeout(j)},participantIdentity:i});const U=setTimeout(()=>{this.pendingResponses.delete(E),p(nt.builtIn("RESPONSE_TIMEOUT"))},l);this.pendingResponses.set(E,{resolve:(Y,Z)=>{clearTimeout(U),this.pendingAcks.has(E)&&(this.log.warn("RPC response received before ack",E),this.pendingAcks.delete(E),clearTimeout(j)),Z?p(Z):m(Y??"")},participantIdentity:i})}))}registerRpcMethod(t,i){this.rpcHandlers.has(t)&&this.log.warn("you're overriding the RPC handler for method ".concat(t,", in the future this will throw an error")),this.rpcHandlers.set(t,i)}unregisterRpcMethod(t){this.rpcHandlers.delete(t)}setTrackSubscriptionPermissions(t){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[];this.participantTrackPermissions=i,this.allParticipantsAllowedToSubscribe=t,this.engine.client.isDisconnected||this.updateTrackSubscriptionPermissions()}handleIncomingRpcAck(t){const i=this.pendingAcks.get(t);i?(i.resolve(),this.pendingAcks.delete(t)):console.error("Ack received for unexpected RPC request",t)}handleIncomingRpcResponse(t,i,a){const o=this.pendingResponses.get(t);o?(o.resolve(i,a),this.pendingResponses.delete(t)):console.error("Response received for unexpected RPC request",t)}publishRpcRequest(t,i,a,o,l){return T(this,void 0,void 0,function*(){const f=new wt({destinationIdentities:[t],kind:Te.RELIABLE,value:{case:"rpcRequest",value:new Zd({id:i,method:a,payload:o,responseTimeoutMs:l,version:1})}});yield this.engine.sendDataPacket(f,Te.RELIABLE)})}handleParticipantDisconnected(t){for(const[i,{participantIdentity:a}]of this.pendingAcks)a===t&&this.pendingAcks.delete(i);for(const[i,{participantIdentity:a,resolve:o}]of this.pendingResponses)a===t&&(o(null,nt.builtIn("RECIPIENT_DISCONNECTED")),this.pendingResponses.delete(i))}setEnabledPublishCodecs(t){this.enabledPublishVideoCodecs=t.filter(i=>i.mime.split("/")[0].toLowerCase()==="video")}updateInfo(t){return super.updateInfo(t)?(t.tracks.forEach(i=>{var a,o;const l=this.trackPublications.get(i.sid);if(l){const f=l.isMuted||((o=(a=l.track)===null||a===void 0?void 0:a.isUpstreamPaused)!==null&&o!==void 0?o:!1);f!==i.muted&&(this.log.debug("updating server mute state after reconcile",Object.assign(Object.assign(Object.assign({},this.logContext),Ee(l)),{mutedOnServer:f})),this.engine.client.sendMuteTrack(i.sid,f))}}),!0):!1}setActiveAgent(t){var i,a,o,l;this.firstActiveAgent=t,t&&!this.firstActiveAgent&&(this.firstActiveAgent=t),t?(a=(i=this.activeAgentFuture)===null||i===void 0?void 0:i.resolve)===null||a===void 0||a.call(i,t):(l=(o=this.activeAgentFuture)===null||o===void 0?void 0:o.reject)===null||l===void 0||l.call(o,new Error("Agent disconnected")),this.activeAgentFuture=void 0}waitUntilActiveAgentPresent(){return this.firstActiveAgent?Promise.resolve(this.firstActiveAgent):(this.activeAgentFuture||(this.activeAgentFuture=new gn),this.activeAgentFuture.promise)}getPublicationForTrack(t){let i;return this.trackPublications.forEach(a=>{const o=a.track;o&&(t instanceof MediaStreamTrack?(ni(o)||Ui(o))&&o.mediaStreamTrack===t&&(i=a):t===o&&(i=a))}),i}waitForPendingPublicationOfSource(t){return T(this,void 0,void 0,function*(){const a=Date.now();for(;Date.now()<a+1e4;){const o=Array.from(this.pendingPublishPromises.entries()).find(l=>{let[f]=l;return f.source===t});if(o)return o[1];yield Rt(20)}})}}class C1 extends ii{constructor(t,i,a,o){super(t,i.sid,i.name,o),this.track=void 0,this.allowed=!0,this.requestedDisabled=void 0,this.visible=!0,this.handleEnded=l=>{this.setTrack(void 0),this.emit(X.Ended,l)},this.handleVisibilityChange=l=>{this.log.debug("adaptivestream video visibility ".concat(this.trackSid,", visible=").concat(l),this.logContext),this.visible=l,this.emitTrackUpdate()},this.handleVideoDimensionsChange=l=>{this.log.debug("adaptivestream video dimensions ".concat(l.width,"x").concat(l.height),this.logContext),this.videoDimensionsAdaptiveStream=l,this.emitTrackUpdate()},this.subscribed=a,this.updateInfo(i)}setSubscribed(t){const i=this.subscriptionStatus,a=this.permissionStatus;this.subscribed=t,t&&(this.allowed=!0);const o=new Oc({trackSids:[this.trackSid],subscribe:this.subscribed,participantTracks:[new u0({participantSid:"",trackSids:[this.trackSid]})]});this.emit(X.UpdateSubscription,o),this.emitSubscriptionUpdateIfChanged(i),this.emitPermissionUpdateIfChanged(a)}get subscriptionStatus(){return this.subscribed===!1?ii.SubscriptionStatus.Unsubscribed:super.isSubscribed?ii.SubscriptionStatus.Subscribed:ii.SubscriptionStatus.Desired}get permissionStatus(){return this.allowed?ii.PermissionStatus.Allowed:ii.PermissionStatus.NotAllowed}get isSubscribed(){return this.subscribed===!1?!1:super.isSubscribed}get isDesired(){return this.subscribed!==!1}get isEnabled(){return this.requestedDisabled!==void 0?!this.requestedDisabled:this.isAdaptiveStream?this.visible:!0}get isLocal(){return!1}setEnabled(t){!this.isManualOperationAllowed()||this.requestedDisabled===!t||(this.requestedDisabled=!t,this.emitTrackUpdate())}setVideoQuality(t){!this.isManualOperationAllowed()||this.requestedMaxQuality===t||(this.requestedMaxQuality=t,this.requestedVideoDimensions=void 0,this.emitTrackUpdate())}setVideoDimensions(t){var i,a;this.isManualOperationAllowed()&&(((i=this.requestedVideoDimensions)===null||i===void 0?void 0:i.width)===t.width&&((a=this.requestedVideoDimensions)===null||a===void 0?void 0:a.height)===t.height||(fd(this.track)&&(this.requestedVideoDimensions=t),this.requestedMaxQuality=void 0,this.emitTrackUpdate()))}setVideoFPS(t){this.isManualOperationAllowed()&&fd(this.track)&&this.fps!==t&&(this.fps=t,this.emitTrackUpdate())}get videoQuality(){var t;return(t=this.requestedMaxQuality)!==null&&t!==void 0?t:nn.HIGH}setTrack(t){const i=this.subscriptionStatus,a=this.permissionStatus,o=this.track;o!==t&&(o&&(o.off(X.VideoDimensionsChanged,this.handleVideoDimensionsChange),o.off(X.VisibilityChanged,this.handleVisibilityChange),o.off(X.Ended,this.handleEnded),o.detach(),o.stopMonitor(),this.emit(X.Unsubscribed,o)),super.setTrack(t),t&&(t.sid=this.trackSid,t.on(X.VideoDimensionsChanged,this.handleVideoDimensionsChange),t.on(X.VisibilityChanged,this.handleVisibilityChange),t.on(X.Ended,this.handleEnded),this.emit(X.Subscribed,t)),this.emitPermissionUpdateIfChanged(a),this.emitSubscriptionUpdateIfChanged(i))}setAllowed(t){const i=this.subscriptionStatus,a=this.permissionStatus;this.allowed=t,this.emitPermissionUpdateIfChanged(a),this.emitSubscriptionUpdateIfChanged(i)}setSubscriptionError(t){this.emit(X.SubscriptionFailed,t)}updateInfo(t){super.updateInfo(t);const i=this.metadataMuted;this.metadataMuted=t.muted,this.track?this.track.setMuted(t.muted):i!==t.muted&&this.emit(t.muted?X.Muted:X.Unmuted)}emitSubscriptionUpdateIfChanged(t){const i=this.subscriptionStatus;t!==i&&this.emit(X.SubscriptionStatusChanged,i,t)}emitPermissionUpdateIfChanged(t){this.permissionStatus!==t&&this.emit(X.SubscriptionPermissionChanged,this.permissionStatus,t)}isManualOperationAllowed(){return this.isDesired?!0:(this.log.warn("cannot update track settings when not subscribed",this.logContext),!1)}get isAdaptiveStream(){return fd(this.track)&&this.track.isAdaptiveStream}emitTrackUpdate(){const t=new b0({trackSids:[this.trackSid],disabled:!this.isEnabled,fps:this.fps});if(this.kind===G.Kind.Video){let i=this.requestedVideoDimensions;if(this.videoDimensionsAdaptiveStream!==void 0)if(i)cv(this.videoDimensionsAdaptiveStream,i)&&(this.log.debug("using adaptive stream dimensions instead of requested",Object.assign(Object.assign({},this.logContext),this.videoDimensionsAdaptiveStream)),i=this.videoDimensionsAdaptiveStream);else if(this.requestedMaxQuality!==void 0&&this.trackInfo){const a=Bk(this.trackInfo,this.requestedMaxQuality);a&&cv(this.videoDimensionsAdaptiveStream,a)&&(this.log.debug("using adaptive stream dimensions instead of max quality layer",Object.assign(Object.assign({},this.logContext),this.videoDimensionsAdaptiveStream)),i=this.videoDimensionsAdaptiveStream)}else this.log.debug("using adaptive stream dimensions",Object.assign(Object.assign({},this.logContext),this.videoDimensionsAdaptiveStream)),i=this.videoDimensionsAdaptiveStream;i?(t.width=Math.ceil(i.width),t.height=Math.ceil(i.height)):this.requestedMaxQuality!==void 0?(this.log.debug("using requested max quality",Object.assign(Object.assign({},this.logContext),{quality:this.requestedMaxQuality})),t.quality=this.requestedMaxQuality):(this.log.debug("using default quality",Object.assign(Object.assign({},this.logContext),{quality:nn.HIGH})),t.quality=nn.HIGH)}this.emit(X.UpdateSettings,t)}}class Cc extends _y{static fromParticipantInfo(t,i,a){return new Cc(t,i.sid,i.identity,i.name,i.metadata,i.attributes,a,i.kind)}get logContext(){return Object.assign(Object.assign({},super.logContext),{rpID:this.sid,remoteParticipant:this.identity})}constructor(t,i,a,o,l,f,u){let m=arguments.length>7&&arguments[7]!==void 0?arguments[7]:_r.STANDARD;super(i,a||"",o,l,f,u,m),this.signalClient=t,this.trackPublications=new Map,this.audioTrackPublications=new Map,this.videoTrackPublications=new Map,this.volumeMap=new Map}addTrackPublication(t){super.addTrackPublication(t),t.on(X.UpdateSettings,i=>{this.log.debug("send update settings",Object.assign(Object.assign(Object.assign({},this.logContext),Ee(t)),{settings:i})),this.signalClient.sendUpdateTrackSettings(i)}),t.on(X.UpdateSubscription,i=>{i.participantTracks.forEach(a=>{a.participantSid=this.sid}),this.signalClient.sendUpdateSubscription(i)}),t.on(X.SubscriptionPermissionChanged,i=>{this.emit(ee.TrackSubscriptionPermissionChanged,t,i)}),t.on(X.SubscriptionStatusChanged,i=>{this.emit(ee.TrackSubscriptionStatusChanged,t,i)}),t.on(X.Subscribed,i=>{this.emit(ee.TrackSubscribed,i,t)}),t.on(X.Unsubscribed,i=>{this.emit(ee.TrackUnsubscribed,i,t)}),t.on(X.SubscriptionFailed,i=>{this.emit(ee.TrackSubscriptionFailed,t.trackSid,i)})}getTrackPublication(t){const i=super.getTrackPublication(t);if(i)return i}getTrackPublicationByName(t){const i=super.getTrackPublicationByName(t);if(i)return i}setVolume(t){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:G.Source.Microphone;this.volumeMap.set(i,t);const a=this.getTrackPublication(i);a&&a.track&&a.track.setVolume(t)}getVolume(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:G.Source.Microphone;const i=this.getTrackPublication(t);return i&&i.track?i.track.getVolume():this.volumeMap.get(t)}addSubscribedMediaTrack(t,i,a,o,l,f){let u=this.getTrackPublicationBySid(i);if(u||i.startsWith("TR")||this.trackPublications.forEach(g=>{!u&&t.kind===g.kind.toString()&&(u=g)}),!u){if(f===0){this.log.error("could not find published track",Object.assign(Object.assign({},this.logContext),{trackSid:i})),this.emit(ee.TrackSubscriptionFailed,i);return}f===void 0&&(f=20),setTimeout(()=>{this.addSubscribedMediaTrack(t,i,a,o,l,f-1)},150);return}if(t.readyState==="ended"){this.log.error("unable to subscribe because MediaStreamTrack is ended. Do not call MediaStreamTrack.stop()",Object.assign(Object.assign({},this.logContext),Ee(u))),this.emit(ee.TrackSubscriptionFailed,i);return}const m=t.kind==="video";let p;return m?p=new p1(t,i,o,l):p=new m1(t,i,o,this.audioContext,this.audioOutput),p.source=u.source,p.isMuted=u.isMuted,p.setMediaStream(a),p.start(),u.setTrack(p),this.volumeMap.has(u.source)&&Bd(p)&&Nn(p)&&p.setVolume(this.volumeMap.get(u.source)),u}get hasMetadata(){return!!this.participantInfo}getTrackPublicationBySid(t){return this.trackPublications.get(t)}updateInfo(t){if(!super.updateInfo(t))return!1;const i=new Map,a=new Map;return t.tracks.forEach(o=>{var l,f;let u=this.getTrackPublicationBySid(o.sid);if(u)u.updateInfo(o);else{const m=G.kindFromProto(o.type);if(!m)return;u=new C1(m,o,(l=this.signalClient.connectOptions)===null||l===void 0?void 0:l.autoSubscribe,{loggerContextCb:()=>this.logContext,loggerName:(f=this.loggerOptions)===null||f===void 0?void 0:f.loggerName}),u.updateInfo(o),a.set(o.sid,u);const p=Array.from(this.trackPublications.values()).find(g=>g.source===(u==null?void 0:u.source));p&&u.source!==G.Source.Unknown&&this.log.debug("received a second track publication for ".concat(this.identity," with the same source: ").concat(u.source),Object.assign(Object.assign({},this.logContext),{oldTrack:Ee(p),newTrack:Ee(u)})),this.addTrackPublication(u)}i.set(o.sid,u)}),this.trackPublications.forEach(o=>{i.has(o.trackSid)||(this.log.trace("detected removed track on remote participant, unpublishing",Object.assign(Object.assign({},this.logContext),Ee(o))),this.unpublishTrack(o.trackSid,!0))}),a.forEach(o=>{this.emit(ee.TrackPublished,o)}),!0}unpublishTrack(t,i){const a=this.trackPublications.get(t);if(!a)return;const{track:o}=a;switch(o&&(o.stop(),a.setTrack(void 0)),this.trackPublications.delete(t),a.kind){case G.Kind.Audio:this.audioTrackPublications.delete(t);break;case G.Kind.Video:this.videoTrackPublications.delete(t);break}i&&this.emit(ee.TrackUnpublished,a)}setAudioOutput(t){return T(this,void 0,void 0,function*(){this.audioOutput=t;const i=[];this.audioTrackPublications.forEach(a=>{var o;Nn(a.track)&&Bd(a.track)&&i.push(a.track.setSinkId((o=t.deviceId)!==null&&o!==void 0?o:"default"))}),yield Promise.all(i)})}emit(t){for(var i=arguments.length,a=new Array(i>1?i-1:0),o=1;o<i;o++)a[o-1]=arguments[o];return this.log.trace("participant event",Object.assign(Object.assign({},this.logContext),{event:t,args:a})),super.emit(t,...a)}}var Le;(function(r){r.Disconnected="disconnected",r.Connecting="connecting",r.Connected="connected",r.Reconnecting="reconnecting",r.SignalReconnecting="signalReconnecting"})(Le||(Le={}));const k1=4*1e3;class gs extends Ln.EventEmitter{get hasE2EESetup(){return this.e2eeManager!==void 0}constructor(t){var i,a,o,l,f;if(super(),i=this,this.state=Le.Disconnected,this.activeSpeakers=[],this.isE2EEEnabled=!1,this.audioEnabled=!0,this.isVideoPlaybackBlocked=!1,this.log=Se,this.bufferedEvents=[],this.isResuming=!1,this.rpcHandlers=new Map,this.connect=(u,m,p)=>T(this,void 0,void 0,function*(){var g;if(!Gk())throw Pn()?Error("WebRTC isn't detected, have you called registerGlobals?"):Error("LiveKit doesn't seem to be supported on this browser. Try to update your browser and make sure no browser extensions are disabling webRTC.");const v=yield this.disconnectLock.lock();if(this.state===Le.Connected)return this.log.info("already connected to room ".concat(this.name),this.logContext),v(),Promise.resolve();if(this.connectFuture)return v(),this.connectFuture.promise;this.setAndEmitConnectionState(Le.Connecting),((g=this.regionUrlProvider)===null||g===void 0?void 0:g.getServerUrl().toString())!==my(u)&&(this.regionUrl=void 0,this.regionUrlProvider=void 0),ps(new URL(u))&&(this.regionUrlProvider===void 0?this.regionUrlProvider=new De(u,m):this.regionUrlProvider.updateToken(m),this.regionUrlProvider.fetchRegionSettings().then(O=>{var E;(E=this.regionUrlProvider)===null||E===void 0||E.setServerReportedRegions(O)}).catch(O=>{this.log.warn("could not fetch region settings",Object.assign(Object.assign({},this.logContext),{error:O}))}));const S=(O,E,j)=>T(this,void 0,void 0,function*(){var U,Y;this.abortController&&this.abortController.abort();const Z=new AbortController;this.abortController=Z,v==null||v();try{if(yield fs.getInstance().getBackOffPromise(u),Z.signal.aborted)throw he.cancelled("Connection attempt aborted");yield this.attemptConnection(j??u,m,p,Z),this.abortController=void 0,O()}catch(M){if(this.regionUrlProvider&&M instanceof he&&M.reason!==Ke.Cancelled&&M.reason!==Ke.NotAllowed){let N=null;try{this.log.debug("Fetching next region"),N=yield this.regionUrlProvider.getNextBestRegionUrl((U=this.abortController)===null||U===void 0?void 0:U.signal)}catch(q){if(q instanceof he&&(q.status===401||q.reason===Ke.Cancelled)){this.handleDisconnect(this.options.stopLocalTrackOnUnpublish),E(q);return}}[Ke.InternalError,Ke.ServerUnreachable,Ke.Timeout].includes(M.reason)&&(this.log.debug("Adding failed connection attempt to back off"),fs.getInstance().addFailedConnectionAttempt(u)),N&&!(!((Y=this.abortController)===null||Y===void 0)&&Y.signal.aborted)?(this.log.info("Initial connection failed with ConnectionError: ".concat(M.message,". Retrying with another region: ").concat(N),this.logContext),this.recreateEngine(),yield S(O,E,N)):(this.handleDisconnect(this.options.stopLocalTrackOnUnpublish,pv(M)),E(M))}else{let N=_n.UNKNOWN_REASON;M instanceof he&&(N=pv(M)),this.handleDisconnect(this.options.stopLocalTrackOnUnpublish,N),E(M)}}}),k=this.regionUrl;return this.regionUrl=void 0,this.connectFuture=new gn((O,E)=>{S(O,E,k)},()=>{this.clearConnectionFutures()}),this.connectFuture.promise}),this.connectSignal=(u,m,p,g,v,S)=>T(this,void 0,void 0,function*(){var k,O,E;const j=yield p.join(u,m,{autoSubscribe:g.autoSubscribe,adaptiveStream:typeof v.adaptiveStream=="object"?!0:v.adaptiveStream,maxRetries:g.maxRetries,e2eeEnabled:!!this.e2eeManager,websocketTimeout:g.websocketTimeout},S.signal,!v.singlePeerConnection);let U=j.serverInfo;if(U||(U={version:j.serverVersion,region:j.serverRegion}),this.serverInfo=U,this.log.debug("connected to Livekit Server ".concat(Object.entries(U).map(Y=>{let[Z,M]=Y;return"".concat(Z,": ").concat(M)}).join(", ")),{room:(k=j.room)===null||k===void 0?void 0:k.name,roomSid:(O=j.room)===null||O===void 0?void 0:O.sid,identity:(E=j.participant)===null||E===void 0?void 0:E.identity}),!U.version)throw new Ok("unknown server version");return U.version==="0.15.1"&&this.options.dynacast&&(this.log.debug("disabling dynacast due to server version",this.logContext),v.dynacast=!1),j}),this.applyJoinResponse=u=>{const m=u.participant;if(this.localParticipant.sid=m.sid,this.localParticipant.identity=m.identity,this.localParticipant.setEnabledPublishCodecs(u.enabledPublishCodecs),this.e2eeManager)try{this.e2eeManager.setSifTrailer(u.sifTrailer)}catch(p){this.log.error(p instanceof Error?p.message:"Could not set SifTrailer",Object.assign(Object.assign({},this.logContext),{error:p}))}this.handleParticipantUpdates([m,...u.otherParticipants]),u.room&&this.handleRoomUpdate(u.room)},this.attemptConnection=(u,m,p,g)=>T(this,void 0,void 0,function*(){var v,S;this.state===Le.Reconnecting||this.isResuming||!((v=this.engine)===null||v===void 0)&&v.pendingReconnect?(this.log.info("Reconnection attempt replaced by new connection attempt",this.logContext),this.recreateEngine()):this.maybeCreateEngine(),!((S=this.regionUrlProvider)===null||S===void 0)&&S.isCloud()&&this.engine.setRegionUrlProvider(this.regionUrlProvider),this.acquireAudioContext(),this.connOptions=Object.assign(Object.assign({},gf),p),this.connOptions.rtcConfig&&(this.engine.rtcConfig=this.connOptions.rtcConfig),this.connOptions.peerConnectionTimeout&&(this.engine.peerConnectionTimeout=this.connOptions.peerConnectionTimeout);try{const k=yield this.connectSignal(u,m,this.engine,this.connOptions,this.options,g);this.applyJoinResponse(k),this.setupLocalParticipantEvents(),this.emit(J.SignalConnected)}catch(k){yield this.engine.close(),this.recreateEngine();const O=g.signal.aborted?he.cancelled("Signal connection aborted"):he.serverUnreachable("could not establish signal connection");throw k instanceof Error&&(O.message="".concat(O.message,": ").concat(k.message)),k instanceof he&&(O.reason=k.reason,O.status=k.status),this.log.debug("error trying to establish signal connection",Object.assign(Object.assign({},this.logContext),{error:k})),O}if(g.signal.aborted)throw yield this.engine.close(),this.recreateEngine(),he.cancelled("Connection attempt aborted");try{yield this.engine.waitForPCInitialConnection(this.connOptions.peerConnectionTimeout,g)}catch(k){throw yield this.engine.close(),this.recreateEngine(),k}Ft()&&this.options.disconnectOnPageLeave&&(window.addEventListener("pagehide",this.onPageLeave),window.addEventListener("beforeunload",this.onPageLeave)),Ft()&&window.addEventListener("freeze",this.onPageLeave),this.setAndEmitConnectionState(Le.Connected),this.emit(J.Connected),fs.getInstance().resetFailedConnectionAttempts(u),this.registerConnectionReconcile(),this.regionUrlProvider&&this.regionUrlProvider.notifyConnected()}),this.disconnect=function(){for(var u=arguments.length,m=new Array(u),p=0;p<u;p++)m[p]=arguments[p];return T(i,[...m],void 0,function(){var g=this;let v=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;return(function*(){var S,k,O;const E=yield g.disconnectLock.lock();try{if(g.state===Le.Disconnected){g.log.debug("already disconnected",g.logContext);return}if(g.log.info("disconnect from room",Object.assign({},g.logContext)),g.state===Le.Connecting||g.state===Le.Reconnecting||g.isResuming){const j="Abort connection attempt due to user initiated disconnect";g.log.warn(j,g.logContext),(S=g.abortController)===null||S===void 0||S.abort(j),(O=(k=g.connectFuture)===null||k===void 0?void 0:k.reject)===null||O===void 0||O.call(k,he.cancelled("Client initiated disconnect")),g.connectFuture=void 0}g.engine&&(g.engine.client.isDisconnected||(yield g.engine.client.sendLeave()),yield g.engine.close()),g.handleDisconnect(v,_n.CLIENT_INITIATED),g.engine=void 0}finally{E()}})()})},this.onPageLeave=()=>T(this,void 0,void 0,function*(){this.log.info("Page leave detected, disconnecting",this.logContext),yield this.disconnect()}),this.startAudio=()=>T(this,void 0,void 0,function*(){const u=[],m=Gt();if(m&&m.os==="iOS"){const p="livekit-dummy-audio-el";let g=document.getElementById(p);if(!g){g=document.createElement("audio"),g.id=p,g.autoplay=!0,g.hidden=!0;const v=dd();v.enabled=!0;const S=new MediaStream([v]);g.srcObject=S,document.addEventListener("visibilitychange",()=>{g&&(g.srcObject=document.hidden?null:S,document.hidden||(this.log.debug("page visible again, triggering startAudio to resume playback and update playback status",this.logContext),this.startAudio()))}),document.body.append(g),this.once(J.Disconnected,()=>{g==null||g.remove(),g=null})}u.push(g)}this.remoteParticipants.forEach(p=>{p.audioTrackPublications.forEach(g=>{g.track&&g.track.attachedElements.forEach(v=>{u.push(v)})})});try{yield Promise.all([this.acquireAudioContext(),...u.map(p=>(p.muted=!1,p.play()))]),this.handleAudioPlaybackStarted()}catch(p){throw this.handleAudioPlaybackFailed(p),p}}),this.startVideo=()=>T(this,void 0,void 0,function*(){const u=[];for(const m of this.remoteParticipants.values())m.videoTrackPublications.forEach(p=>{var g;(g=p.track)===null||g===void 0||g.attachedElements.forEach(v=>{u.includes(v)||u.push(v)})});yield Promise.all(u.map(m=>m.play())).then(()=>{this.handleVideoPlaybackStarted()}).catch(m=>{m.name==="NotAllowedError"?this.handleVideoPlaybackFailed():this.log.warn("Resuming video playback failed, make sure you call `startVideo` directly in a user gesture handler",this.logContext)})}),this.handleRestarting=()=>{this.clearConnectionReconcile(),this.isResuming=!1;for(const u of this.remoteParticipants.values())this.handleParticipantDisconnected(u.identity,u);this.setAndEmitConnectionState(Le.Reconnecting)&&this.emit(J.Reconnecting)},this.handleSignalRestarted=u=>T(this,void 0,void 0,function*(){this.log.debug("signal reconnected to server, region ".concat(u.serverRegion),Object.assign(Object.assign({},this.logContext),{region:u.serverRegion})),this.bufferedEvents=[],this.applyJoinResponse(u);try{yield this.localParticipant.republishAllTracks(void 0,!0)}catch(m){this.log.error("error trying to re-publish tracks after reconnection",Object.assign(Object.assign({},this.logContext),{error:m}))}try{yield this.engine.waitForRestarted(),this.log.debug("fully reconnected to server",Object.assign(Object.assign({},this.logContext),{region:u.serverRegion}))}catch{return}this.setAndEmitConnectionState(Le.Connected),this.emit(J.Reconnected),this.registerConnectionReconcile(),this.emitBufferedEvents()}),this.handleParticipantUpdates=u=>{u.forEach(m=>{var p;if(m.identity===this.localParticipant.identity){this.localParticipant.updateInfo(m);return}m.identity===""&&(m.identity=(p=this.sidToIdentity.get(m.sid))!==null&&p!==void 0?p:"");let g=this.remoteParticipants.get(m.identity);m.state===rs.DISCONNECTED?this.handleParticipantDisconnected(m.identity,g):g=this.getOrCreateParticipant(m.identity,m)})},this.handleActiveSpeakersUpdate=u=>{const m=[],p={};u.forEach(g=>{if(p[g.sid]=!0,g.sid===this.localParticipant.sid)this.localParticipant.audioLevel=g.level,this.localParticipant.setIsSpeaking(!0),m.push(this.localParticipant);else{const v=this.getRemoteParticipantBySid(g.sid);v&&(v.audioLevel=g.level,v.setIsSpeaking(!0),m.push(v))}}),p[this.localParticipant.sid]||(this.localParticipant.audioLevel=0,this.localParticipant.setIsSpeaking(!1)),this.remoteParticipants.forEach(g=>{p[g.sid]||(g.audioLevel=0,g.setIsSpeaking(!1))}),this.activeSpeakers=m,this.emitWhenConnected(J.ActiveSpeakersChanged,m)},this.handleSpeakersChanged=u=>{const m=new Map;this.activeSpeakers.forEach(g=>{const v=this.remoteParticipants.get(g.identity);v&&v.sid!==g.sid||m.set(g.sid,g)}),u.forEach(g=>{let v=this.getRemoteParticipantBySid(g.sid);g.sid===this.localParticipant.sid&&(v=this.localParticipant),v&&(v.audioLevel=g.level,v.setIsSpeaking(g.active),g.active?m.set(g.sid,v):m.delete(g.sid))});const p=Array.from(m.values());p.sort((g,v)=>v.audioLevel-g.audioLevel),this.activeSpeakers=p,this.emitWhenConnected(J.ActiveSpeakersChanged,p)},this.handleStreamStateUpdate=u=>{u.streamStates.forEach(m=>{const p=this.getRemoteParticipantBySid(m.participantSid);if(!p)return;const g=p.getTrackPublicationBySid(m.trackSid);if(!g||!g.track)return;const v=G.streamStateFromProto(m.state);g.track.setStreamState(v),v!==g.track.streamState&&(p.emit(ee.TrackStreamStateChanged,g,g.track.streamState),this.emitWhenConnected(J.TrackStreamStateChanged,g,g.track.streamState,p))})},this.handleSubscriptionPermissionUpdate=u=>{const m=this.getRemoteParticipantBySid(u.participantSid);if(!m)return;const p=m.getTrackPublicationBySid(u.trackSid);p&&p.setAllowed(u.allowed)},this.handleSubscriptionError=u=>{const m=Array.from(this.remoteParticipants.values()).find(g=>g.trackPublications.has(u.trackSid));if(!m)return;const p=m.getTrackPublicationBySid(u.trackSid);p&&p.setSubscriptionError(u.err)},this.handleDataPacket=(u,m)=>{const p=this.remoteParticipants.get(u.participantIdentity);if(u.value.case==="user")this.handleUserPacket(p,u.value.value,u.kind,m);else if(u.value.case==="transcription")this.handleTranscription(p,u.value.value);else if(u.value.case==="sipDtmf")this.handleSipDtmf(p,u.value.value);else if(u.value.case==="chatMessage")this.handleChatMessage(p,u.value.value);else if(u.value.case==="metrics")this.handleMetrics(u.value.value,p);else if(u.value.case==="streamHeader"||u.value.case==="streamChunk"||u.value.case==="streamTrailer")this.handleDataStream(u,m);else if(u.value.case==="rpcRequest"){const g=u.value.value;this.handleIncomingRpcRequest(u.participantIdentity,g.id,g.method,g.payload,g.responseTimeoutMs,g.version)}},this.handleUserPacket=(u,m,p,g)=>{this.emit(J.DataReceived,m.payload,u,p,m.topic,g),u==null||u.emit(ee.DataReceived,m.payload,p,g)},this.handleSipDtmf=(u,m)=>{this.emit(J.SipDTMFReceived,m,u),u==null||u.emit(ee.SipDTMFReceived,m)},this.handleTranscription=(u,m)=>{const p=m.transcribedParticipantIdentity===this.localParticipant.identity?this.localParticipant:this.getParticipantByIdentity(m.transcribedParticipantIdentity),g=p==null?void 0:p.trackPublications.get(m.trackId),v=eE(m,this.transcriptionReceivedTimes);g==null||g.emit(X.TranscriptionReceived,v),p==null||p.emit(ee.TranscriptionReceived,v,g),this.emit(J.TranscriptionReceived,v,p,g)},this.handleChatMessage=(u,m)=>{const p=tE(m);this.emit(J.ChatMessage,p,u)},this.handleMetrics=(u,m)=>{this.emit(J.MetricsReceived,u,m)},this.handleDataStream=(u,m)=>{this.incomingDataStreamManager.handleDataStreamPacket(u,m)},this.bufferedSegments=new Map,this.handleAudioPlaybackStarted=()=>{this.canPlaybackAudio||(this.audioEnabled=!0,this.emit(J.AudioPlaybackStatusChanged,!0))},this.handleAudioPlaybackFailed=u=>{this.log.warn("could not playback audio",Object.assign(Object.assign({},this.logContext),{error:u})),this.canPlaybackAudio&&(this.audioEnabled=!1,this.emit(J.AudioPlaybackStatusChanged,!1))},this.handleVideoPlaybackStarted=()=>{this.isVideoPlaybackBlocked&&(this.isVideoPlaybackBlocked=!1,this.emit(J.VideoPlaybackStatusChanged,!0))},this.handleVideoPlaybackFailed=()=>{this.isVideoPlaybackBlocked||(this.isVideoPlaybackBlocked=!0,this.emit(J.VideoPlaybackStatusChanged,!1))},this.handleDeviceChange=()=>T(this,void 0,void 0,function*(){var u;((u=Gt())===null||u===void 0?void 0:u.os)!=="iOS"&&(yield this.selectDefaultDevices()),this.emit(J.MediaDevicesChanged)}),this.handleRoomUpdate=u=>{const m=this.roomInfo;this.roomInfo=u,m&&m.metadata!==u.metadata&&this.emitWhenConnected(J.RoomMetadataChanged,u.metadata),(m==null?void 0:m.activeRecording)!==u.activeRecording&&this.emitWhenConnected(J.RecordingStatusChanged,u.activeRecording)},this.handleConnectionQualityUpdate=u=>{u.updates.forEach(m=>{if(m.participantSid===this.localParticipant.sid){this.localParticipant.setConnectionQuality(m.quality);return}const p=this.getRemoteParticipantBySid(m.participantSid);p&&p.setConnectionQuality(m.quality)})},this.onLocalParticipantMetadataChanged=u=>{this.emit(J.ParticipantMetadataChanged,u,this.localParticipant)},this.onLocalParticipantNameChanged=u=>{this.emit(J.ParticipantNameChanged,u,this.localParticipant)},this.onLocalAttributesChanged=u=>{this.emit(J.ParticipantAttributesChanged,u,this.localParticipant)},this.onLocalTrackMuted=u=>{this.emit(J.TrackMuted,u,this.localParticipant)},this.onLocalTrackUnmuted=u=>{this.emit(J.TrackUnmuted,u,this.localParticipant)},this.onTrackProcessorUpdate=u=>{var m;(m=u==null?void 0:u.onPublish)===null||m===void 0||m.call(u,this)},this.onLocalTrackPublished=u=>T(this,void 0,void 0,function*(){var m,p,g,v,S,k;(m=u.track)===null||m===void 0||m.on(X.TrackProcessorUpdate,this.onTrackProcessorUpdate),(p=u.track)===null||p===void 0||p.on(X.Restarted,this.onLocalTrackRestarted),(S=(v=(g=u.track)===null||g===void 0?void 0:g.getProcessor())===null||v===void 0?void 0:v.onPublish)===null||S===void 0||S.call(v,this),this.emit(J.LocalTrackPublished,u,this.localParticipant),ni(u.track)&&(yield u.track.checkForSilence())&&this.emit(J.LocalAudioSilenceDetected,u);const O=yield(k=u.track)===null||k===void 0?void 0:k.getDeviceId(!1),E=Ud(u.source);E&&O&&O!==this.localParticipant.activeDeviceMap.get(E)&&(this.localParticipant.activeDeviceMap.set(E,O),this.emit(J.ActiveDeviceChanged,E,O))}),this.onLocalTrackUnpublished=u=>{var m,p;(m=u.track)===null||m===void 0||m.off(X.TrackProcessorUpdate,this.onTrackProcessorUpdate),(p=u.track)===null||p===void 0||p.off(X.Restarted,this.onLocalTrackRestarted),this.emit(J.LocalTrackUnpublished,u,this.localParticipant)},this.onLocalTrackRestarted=u=>T(this,void 0,void 0,function*(){const m=yield u.getDeviceId(!1),p=Ud(u.source);p&&m&&m!==this.localParticipant.activeDeviceMap.get(p)&&(this.log.debug("local track restarted, setting ".concat(p," ").concat(m," active"),this.logContext),this.localParticipant.activeDeviceMap.set(p,m),this.emit(J.ActiveDeviceChanged,p,m))}),this.onLocalConnectionQualityChanged=u=>{this.emit(J.ConnectionQualityChanged,u,this.localParticipant)},this.onMediaDevicesError=(u,m)=>{this.emit(J.MediaDevicesError,u,m)},this.onLocalParticipantPermissionsChanged=u=>{this.emit(J.ParticipantPermissionsChanged,u,this.localParticipant)},this.onLocalChatMessageSent=u=>{this.emit(J.ChatMessage,u,this.localParticipant)},this.setMaxListeners(100),this.remoteParticipants=new Map,this.sidToIdentity=new Map,this.options=Object.assign(Object.assign({},PE),t),this.log=ci((a=this.options.loggerName)!==null&&a!==void 0?a:Rn.Room),this.transcriptionReceivedTimes=new Map,this.options.audioCaptureDefaults=Object.assign(Object.assign({},py),t==null?void 0:t.audioCaptureDefaults),this.options.videoCaptureDefaults=Object.assign(Object.assign({},gy),t==null?void 0:t.videoCaptureDefaults),this.options.publishDefaults=Object.assign(Object.assign({},NE),t==null?void 0:t.publishDefaults),this.maybeCreateEngine(),this.incomingDataStreamManager=new u1,this.outgoingDataStreamManager=new h1(this.engine,this.log),this.disconnectLock=new xt,this.localParticipant=new T1("","",this.engine,this.options,this.rpcHandlers,this.outgoingDataStreamManager),(this.options.e2ee||this.options.encryption)&&this.setupE2EE(),this.engine.e2eeManager=this.e2eeManager,this.options.videoCaptureDefaults.deviceId&&this.localParticipant.activeDeviceMap.set("videoinput",zi(this.options.videoCaptureDefaults.deviceId)),this.options.audioCaptureDefaults.deviceId&&this.localParticipant.activeDeviceMap.set("audioinput",zi(this.options.audioCaptureDefaults.deviceId)),!((o=this.options.audioOutput)===null||o===void 0)&&o.deviceId&&this.switchActiveDevice("audiooutput",zi(this.options.audioOutput.deviceId)).catch(u=>this.log.warn("Could not set audio output: ".concat(u.message),this.logContext)),Ft()){const u=new AbortController;(f=(l=navigator.mediaDevices)===null||l===void 0?void 0:l.addEventListener)===null||f===void 0||f.call(l,"devicechange",this.handleDeviceChange,{signal:u.signal}),gs.cleanupRegistry&&gs.cleanupRegistry.register(this,()=>{u.abort()})}}registerTextStreamHandler(t,i){return this.incomingDataStreamManager.registerTextStreamHandler(t,i)}unregisterTextStreamHandler(t){return this.incomingDataStreamManager.unregisterTextStreamHandler(t)}registerByteStreamHandler(t,i){return this.incomingDataStreamManager.registerByteStreamHandler(t,i)}unregisterByteStreamHandler(t){return this.incomingDataStreamManager.unregisterByteStreamHandler(t)}registerRpcMethod(t,i){if(this.rpcHandlers.has(t))throw Error("RPC handler already registered for method ".concat(t,", unregisterRpcMethod before trying to register again"));this.rpcHandlers.set(t,i)}unregisterRpcMethod(t){this.rpcHandlers.delete(t)}setE2EEEnabled(t){return T(this,void 0,void 0,function*(){if(this.e2eeManager)yield Promise.all([this.localParticipant.setE2EEEnabled(t)]),this.localParticipant.identity!==""&&this.e2eeManager.setParticipantCryptorEnabled(t,this.localParticipant.identity);else throw Error("e2ee not configured, please set e2ee settings within the room options")})}setupE2EE(){var t;const i=!!this.options.encryption,a=this.options.encryption||this.options.e2ee;a&&("e2eeManager"in a?(this.e2eeManager=a.e2eeManager,this.e2eeManager.isDataChannelEncryptionEnabled=i):this.e2eeManager=new gE(a,i),this.e2eeManager.on(ji.ParticipantEncryptionStatusChanged,(o,l)=>{iE(l)&&(this.isE2EEEnabled=o),this.emit(J.ParticipantEncryptionStatusChanged,o,l)}),this.e2eeManager.on(ji.EncryptionError,(o,l)=>{const f=l?this.getParticipantByIdentity(l):void 0;this.emit(J.EncryptionError,o,f)}),(t=this.e2eeManager)===null||t===void 0||t.setup(this))}get logContext(){var t;return{room:this.name,roomID:(t=this.roomInfo)===null||t===void 0?void 0:t.sid,participant:this.localParticipant.identity,pID:this.localParticipant.sid}}get isRecording(){var t,i;return(i=(t=this.roomInfo)===null||t===void 0?void 0:t.activeRecording)!==null&&i!==void 0?i:!1}getSid(){return this.state===Le.Disconnected?Ht.resolve(""):this.roomInfo&&this.roomInfo.sid!==""?Ht.resolve(this.roomInfo.sid):new Ht((t,i)=>{const a=o=>{o.sid!==""&&(this.engine.off($.RoomUpdate,a),t(o.sid))};this.engine.on($.RoomUpdate,a),this.once(J.Disconnected,()=>{this.engine.off($.RoomUpdate,a),i(new rt("Room disconnected before room server id was available"))})})}get name(){var t,i;return(i=(t=this.roomInfo)===null||t===void 0?void 0:t.name)!==null&&i!==void 0?i:""}get metadata(){var t;return(t=this.roomInfo)===null||t===void 0?void 0:t.metadata}get numParticipants(){var t,i;return(i=(t=this.roomInfo)===null||t===void 0?void 0:t.numParticipants)!==null&&i!==void 0?i:0}get numPublishers(){var t,i;return(i=(t=this.roomInfo)===null||t===void 0?void 0:t.numPublishers)!==null&&i!==void 0?i:0}maybeCreateEngine(){this.engine&&!this.engine.isClosed||(this.engine=new r1(this.options),this.engine.e2eeManager=this.e2eeManager,this.engine.on($.ParticipantUpdate,this.handleParticipantUpdates).on($.RoomUpdate,this.handleRoomUpdate).on($.SpeakersChanged,this.handleSpeakersChanged).on($.StreamStateChanged,this.handleStreamStateUpdate).on($.ConnectionQualityUpdate,this.handleConnectionQualityUpdate).on($.SubscriptionError,this.handleSubscriptionError).on($.SubscriptionPermissionUpdate,this.handleSubscriptionPermissionUpdate).on($.MediaTrackAdded,(t,i,a)=>{this.onTrackAdded(t,i,a)}).on($.Disconnected,t=>{this.handleDisconnect(this.options.stopLocalTrackOnUnpublish,t)}).on($.ActiveSpeakersUpdate,this.handleActiveSpeakersUpdate).on($.DataPacketReceived,this.handleDataPacket).on($.Resuming,()=>{this.clearConnectionReconcile(),this.isResuming=!0,this.log.info("Resuming signal connection",this.logContext),this.setAndEmitConnectionState(Le.SignalReconnecting)&&this.emit(J.SignalReconnecting)}).on($.Resumed,()=>{this.registerConnectionReconcile(),this.isResuming=!1,this.log.info("Resumed signal connection",this.logContext),this.updateSubscriptions(),this.emitBufferedEvents(),this.setAndEmitConnectionState(Le.Connected)&&this.emit(J.Reconnected)}).on($.SignalResumed,()=>{this.bufferedEvents=[],(this.state===Le.Reconnecting||this.isResuming)&&this.sendSyncState()}).on($.Restarting,this.handleRestarting).on($.SignalRestarted,this.handleSignalRestarted).on($.Offline,()=>{this.setAndEmitConnectionState(Le.Reconnecting)&&this.emit(J.Reconnecting)}).on($.DCBufferStatusChanged,(t,i)=>{this.emit(J.DCBufferStatusChanged,t,i)}).on($.LocalTrackSubscribed,t=>{const i=this.localParticipant.getTrackPublications().find(a=>{let{trackSid:o}=a;return o===t});if(!i){this.log.warn("could not find local track subscription for subscribed event",this.logContext);return}this.localParticipant.emit(ee.LocalTrackSubscribed,i),this.emitWhenConnected(J.LocalTrackSubscribed,i,this.localParticipant)}).on($.RoomMoved,t=>{this.log.debug("room moved",t),t.room&&this.handleRoomUpdate(t.room),this.remoteParticipants.forEach((i,a)=>{this.handleParticipantDisconnected(a,i)}),this.emit(J.Moved,t.room.name),t.participant?this.handleParticipantUpdates([t.participant,...t.otherParticipants]):this.handleParticipantUpdates(t.otherParticipants)}),this.localParticipant&&this.localParticipant.setupEngine(this.engine),this.e2eeManager&&this.e2eeManager.setupEngine(this.engine),this.outgoingDataStreamManager&&this.outgoingDataStreamManager.setupEngine(this.engine))}static getLocalDevices(t){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;return bt.getInstance().getDevices(t,i)}prepareConnection(t,i){return T(this,void 0,void 0,function*(){if(this.state===Le.Disconnected){this.log.debug("prepareConnection to ".concat(t),this.logContext);try{if(ps(new URL(t))&&i){this.regionUrlProvider=new De(t,i);const a=yield this.regionUrlProvider.getNextBestRegionUrl();a&&this.state===Le.Disconnected&&(this.regionUrl=a,yield fetch(Dr(a),{method:"HEAD"}),this.log.debug("prepared connection to ".concat(a),this.logContext))}else yield fetch(Dr(t),{method:"HEAD"})}catch(a){this.log.warn("could not prepare connection",Object.assign(Object.assign({},this.logContext),{error:a}))}}})}getParticipantByIdentity(t){return this.localParticipant.identity===t?this.localParticipant:this.remoteParticipants.get(t)}clearConnectionFutures(){this.connectFuture=void 0}simulateScenario(t,i){return T(this,void 0,void 0,function*(){let a=()=>T(this,void 0,void 0,function*(){}),o;switch(t){case"signal-reconnect":yield this.engine.client.handleOnClose("simulate disconnect");break;case"speaker":o=new wn({scenario:{case:"speakerUpdate",value:3}});break;case"node-failure":o=new wn({scenario:{case:"nodeFailure",value:!0}});break;case"server-leave":o=new wn({scenario:{case:"serverLeave",value:!0}});break;case"migration":o=new wn({scenario:{case:"migration",value:!0}});break;case"resume-reconnect":this.engine.failNext(),yield this.engine.client.handleOnClose("simulate resume-disconnect");break;case"disconnect-signal-on-resume":a=()=>T(this,void 0,void 0,function*(){yield this.engine.client.handleOnClose("simulate resume-disconnect")}),o=new wn({scenario:{case:"disconnectSignalOnResume",value:!0}});break;case"disconnect-signal-on-resume-no-messages":a=()=>T(this,void 0,void 0,function*(){yield this.engine.client.handleOnClose("simulate resume-disconnect")}),o=new wn({scenario:{case:"disconnectSignalOnResumeNoMessages",value:!0}});break;case"full-reconnect":this.engine.fullReconnectOnNext=!0,yield this.engine.client.handleOnClose("simulate full-reconnect");break;case"force-tcp":case"force-tls":o=new wn({scenario:{case:"switchCandidateProtocol",value:t==="force-tls"?2:1}}),a=()=>T(this,void 0,void 0,function*(){const l=this.engine.client.onLeave;l&&l(new Ac({reason:_n.CLIENT_INITIATED,action:os.RECONNECT}))});break;case"subscriber-bandwidth":if(i===void 0||typeof i!="number")throw new Error("subscriber-bandwidth requires a number as argument");o=new wn({scenario:{case:"subscriberBandwidth",value:fa(i)}});break;case"leave-full-reconnect":o=new wn({scenario:{case:"leaveRequestFullReconnect",value:!0}})}o&&(yield this.engine.client.sendSimulateScenario(o),yield a())})}get canPlaybackAudio(){return this.audioEnabled}get canPlaybackVideo(){return!this.isVideoPlaybackBlocked}getActiveDevice(t){return this.localParticipant.activeDeviceMap.get(t)}switchActiveDevice(t,i){return T(this,arguments,void 0,function(a,o){var l=this;let f=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0;return(function*(){var u,m,p,g,v,S,k;let O=!0,E=!1;const j=f?{exact:o}:o;if(a==="audioinput"){E=l.localParticipant.audioTrackPublications.size===0;const U=(u=l.getActiveDevice(a))!==null&&u!==void 0?u:l.options.audioCaptureDefaults.deviceId;l.options.audioCaptureDefaults.deviceId=j;const Y=Array.from(l.localParticipant.audioTrackPublications.values()).filter(M=>M.source===G.Source.Microphone);try{O=(yield Promise.all(Y.map(M=>{var N;return(N=M.audioTrack)===null||N===void 0?void 0:N.setDeviceId(j)}))).every(M=>M===!0)}catch(M){throw l.options.audioCaptureDefaults.deviceId=U,M}const Z=Y.some(M=>{var N,q;return(q=(N=M.track)===null||N===void 0?void 0:N.isMuted)!==null&&q!==void 0?q:!1});O&&Z&&(E=!0)}else if(a==="videoinput"){E=l.localParticipant.videoTrackPublications.size===0;const U=(m=l.getActiveDevice(a))!==null&&m!==void 0?m:l.options.videoCaptureDefaults.deviceId;l.options.videoCaptureDefaults.deviceId=j;const Y=Array.from(l.localParticipant.videoTrackPublications.values()).filter(M=>M.source===G.Source.Camera);try{O=(yield Promise.all(Y.map(M=>{var N;return(N=M.videoTrack)===null||N===void 0?void 0:N.setDeviceId(j)}))).every(M=>M===!0)}catch(M){throw l.options.videoCaptureDefaults.deviceId=U,M}const Z=Y.some(M=>{var N,q;return(q=(N=M.track)===null||N===void 0?void 0:N.isMuted)!==null&&q!==void 0?q:!1});O&&Z&&(E=!0)}else if(a==="audiooutput"){if(E=!0,!jd()&&!l.options.webAudioMix||l.options.webAudioMix&&l.audioContext&&!("setSinkId"in l.audioContext))throw new Error("cannot switch audio output, the current browser does not support it");l.options.webAudioMix&&(o=(p=yield bt.getInstance().normalizeDeviceId("audiooutput",o))!==null&&p!==void 0?p:""),(g=(k=l.options).audioOutput)!==null&&g!==void 0||(k.audioOutput={});const U=(v=l.getActiveDevice(a))!==null&&v!==void 0?v:l.options.audioOutput.deviceId;l.options.audioOutput.deviceId=o;try{l.options.webAudioMix&&((S=l.audioContext)===null||S===void 0||S.setSinkId(o)),yield Promise.all(Array.from(l.remoteParticipants.values()).map(Y=>Y.setAudioOutput({deviceId:o})))}catch(Y){throw l.options.audioOutput.deviceId=U,Y}}return E&&(l.localParticipant.activeDeviceMap.set(a,o),l.emit(J.ActiveDeviceChanged,a,o)),O})()})}setupLocalParticipantEvents(){this.localParticipant.on(ee.ParticipantMetadataChanged,this.onLocalParticipantMetadataChanged).on(ee.ParticipantNameChanged,this.onLocalParticipantNameChanged).on(ee.AttributesChanged,this.onLocalAttributesChanged).on(ee.TrackMuted,this.onLocalTrackMuted).on(ee.TrackUnmuted,this.onLocalTrackUnmuted).on(ee.LocalTrackPublished,this.onLocalTrackPublished).on(ee.LocalTrackUnpublished,this.onLocalTrackUnpublished).on(ee.ConnectionQualityChanged,this.onLocalConnectionQualityChanged).on(ee.MediaDevicesError,this.onMediaDevicesError).on(ee.AudioStreamAcquired,this.startAudio).on(ee.ChatMessage,this.onLocalChatMessageSent).on(ee.ParticipantPermissionsChanged,this.onLocalParticipantPermissionsChanged)}recreateEngine(){var t;(t=this.engine)===null||t===void 0||t.close(),this.engine=void 0,this.isResuming=!1,this.remoteParticipants.clear(),this.sidToIdentity.clear(),this.bufferedEvents=[],this.maybeCreateEngine()}onTrackAdded(t,i,a){if(this.state===Le.Connecting||this.state===Le.Reconnecting){const v=()=>{this.log.debug("deferring on track for later",{mediaTrackId:t.id,mediaStreamId:i.id,tracksInStream:i.getTracks().map(k=>k.id)}),this.onTrackAdded(t,i,a),S()},S=()=>{this.off(J.Reconnected,v),this.off(J.Connected,v),this.off(J.Disconnected,S)};this.once(J.Reconnected,v),this.once(J.Connected,v),this.once(J.Disconnected,S);return}if(this.state===Le.Disconnected){this.log.warn("skipping incoming track after Room disconnected",this.logContext);return}if(t.readyState==="ended"){this.log.info("skipping incoming track as it already ended",this.logContext);return}const o=Vk(i.id),l=o[0];let f=o[1],u=t.id;if(f&&f.startsWith("TR")&&(u=f),l===this.localParticipant.sid){this.log.warn("tried to create RemoteParticipant for local participant",this.logContext);return}const m=Array.from(this.remoteParticipants.values()).find(v=>v.sid===l);if(!m){this.log.error("Tried to add a track for a participant, that's not present. Sid: ".concat(l),this.logContext);return}if(!u.startsWith("TR")){const v=this.engine.getTrackIdForReceiver(a);if(!v){this.log.error("Tried to add a track whose 'sid' could not be found for a participant, that's not present. Sid: ".concat(l),this.logContext);return}u=v}u.startsWith("TR")||this.log.warn("Tried to add a track whose 'sid' could not be determined for a participant, that's not present. Sid: ".concat(l,", streamId: ").concat(f,", trackId: ").concat(u),Object.assign(Object.assign({},this.logContext),{rpID:l,streamId:f,trackId:u}));let p;this.options.adaptiveStream&&(typeof this.options.adaptiveStream=="object"?p=this.options.adaptiveStream:p={});const g=m.addSubscribedMediaTrack(t,u,i,a,p);g!=null&&g.isEncrypted&&!this.e2eeManager&&this.emit(J.EncryptionError,new Error("Encrypted ".concat(g.source," track received from participant ").concat(m.sid,", but room does not have encryption enabled!")))}handleDisconnect(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0,i=arguments.length>1?arguments[1]:void 0;var a,o;if(this.clearConnectionReconcile(),this.isResuming=!1,this.bufferedEvents=[],this.transcriptionReceivedTimes.clear(),this.incomingDataStreamManager.clearControllers(),this.state!==Le.Disconnected){this.regionUrl=void 0,this.regionUrlProvider&&this.regionUrlProvider.notifyDisconnected();try{this.remoteParticipants.forEach(l=>{l.trackPublications.forEach(f=>{l.unpublishTrack(f.trackSid)})}),this.localParticipant.trackPublications.forEach(l=>{var f,u,m;l.track&&this.localParticipant.unpublishTrack(l.track,t),t?((f=l.track)===null||f===void 0||f.detach(),(u=l.track)===null||u===void 0||u.stop()):(m=l.track)===null||m===void 0||m.stopMonitor()}),this.localParticipant.off(ee.ParticipantMetadataChanged,this.onLocalParticipantMetadataChanged).off(ee.ParticipantNameChanged,this.onLocalParticipantNameChanged).off(ee.AttributesChanged,this.onLocalAttributesChanged).off(ee.TrackMuted,this.onLocalTrackMuted).off(ee.TrackUnmuted,this.onLocalTrackUnmuted).off(ee.LocalTrackPublished,this.onLocalTrackPublished).off(ee.LocalTrackUnpublished,this.onLocalTrackUnpublished).off(ee.ConnectionQualityChanged,this.onLocalConnectionQualityChanged).off(ee.MediaDevicesError,this.onMediaDevicesError).off(ee.AudioStreamAcquired,this.startAudio).off(ee.ChatMessage,this.onLocalChatMessageSent).off(ee.ParticipantPermissionsChanged,this.onLocalParticipantPermissionsChanged),this.localParticipant.trackPublications.clear(),this.localParticipant.videoTrackPublications.clear(),this.localParticipant.audioTrackPublications.clear(),this.remoteParticipants.clear(),this.sidToIdentity.clear(),this.activeSpeakers=[],this.audioContext&&typeof this.options.webAudioMix=="boolean"&&(this.audioContext.close(),this.audioContext=void 0),Ft()&&(window.removeEventListener("beforeunload",this.onPageLeave),window.removeEventListener("pagehide",this.onPageLeave),window.removeEventListener("freeze",this.onPageLeave),(o=(a=navigator.mediaDevices)===null||a===void 0?void 0:a.removeEventListener)===null||o===void 0||o.call(a,"devicechange",this.handleDeviceChange))}finally{this.setAndEmitConnectionState(Le.Disconnected),this.emit(J.Disconnected,i)}}}handleParticipantDisconnected(t,i){var a;this.remoteParticipants.delete(t),i&&(this.incomingDataStreamManager.validateParticipantHasNoActiveDataStreams(t),i.trackPublications.forEach(o=>{i.unpublishTrack(o.trackSid,!0)}),this.emit(J.ParticipantDisconnected,i),i.setDisconnected(),(a=this.localParticipant)===null||a===void 0||a.handleParticipantDisconnected(i.identity))}handleIncomingRpcRequest(t,i,a,o,l,f){return T(this,void 0,void 0,function*(){if(yield this.engine.publishRpcAck(t,i),f!==1){yield this.engine.publishRpcResponse(t,i,null,nt.builtIn("UNSUPPORTED_VERSION"));return}const u=this.rpcHandlers.get(a);if(!u){yield this.engine.publishRpcResponse(t,i,null,nt.builtIn("UNSUPPORTED_METHOD"));return}let m=null,p=null;try{const g=yield u({requestId:i,callerIdentity:t,payload:o,responseTimeout:l});vf(g)>yy?(m=nt.builtIn("RESPONSE_PAYLOAD_TOO_LARGE"),this.log.warn("RPC Response payload too large for ".concat(a))):p=g}catch(g){g instanceof nt?m=g:(this.log.warn("Uncaught error returned by RPC handler for ".concat(a,". Returning APPLICATION_ERROR instead."),g),m=nt.builtIn("APPLICATION_ERROR"))}yield this.engine.publishRpcResponse(t,i,p,m)})}selectDefaultDevices(){return T(this,void 0,void 0,function*(){var t,i,a;const o=bt.getInstance().previousDevices,l=yield bt.getInstance().getDevices(void 0,!1),f=Gt();if((f==null?void 0:f.name)==="Chrome"&&f.os!=="iOS")for(let m of l){const p=o.find(g=>g.deviceId===m.deviceId);p&&p.label!==""&&p.kind===m.kind&&p.label!==m.label&&this.getActiveDevice(m.kind)==="default"&&this.emit(J.ActiveDeviceChanged,m.kind,m.deviceId)}const u=["audiooutput","audioinput","videoinput"];for(let m of u){const p=Nk(m),g=this.localParticipant.getTrackPublication(p);if(g&&(!((t=g.track)===null||t===void 0)&&t.isUserProvided))continue;const v=l.filter(k=>k.kind===m),S=this.getActiveDevice(m);if(S===((i=o.filter(k=>k.kind===m)[0])===null||i===void 0?void 0:i.deviceId)&&v.length>0&&((a=v[0])===null||a===void 0?void 0:a.deviceId)!==S){yield this.switchActiveDevice(m,v[0].deviceId);continue}m==="audioinput"&&!Ar()||m==="videoinput"||v.length>0&&!v.find(k=>k.deviceId===this.getActiveDevice(m))&&(m!=="audiooutput"||!Ar())&&(yield this.switchActiveDevice(m,v[0].deviceId))}})}acquireAudioContext(){return T(this,void 0,void 0,function*(){var t,i;if(typeof this.options.webAudioMix!="boolean"&&this.options.webAudioMix.audioContext?this.audioContext=this.options.webAudioMix.audioContext:(!this.audioContext||this.audioContext.state==="closed")&&(this.audioContext=(t=ly())!==null&&t!==void 0?t:void 0),this.options.webAudioMix&&this.remoteParticipants.forEach(o=>o.setAudioContext(this.audioContext)),this.localParticipant.setAudioContext(this.audioContext),this.audioContext&&this.audioContext.state==="suspended")try{yield Promise.race([this.audioContext.resume(),Rt(200)])}catch(o){this.log.warn("Could not resume audio context",Object.assign(Object.assign({},this.logContext),{error:o}))}const a=((i=this.audioContext)===null||i===void 0?void 0:i.state)==="running";a!==this.canPlaybackAudio&&(this.audioEnabled=a,this.emit(J.AudioPlaybackStatusChanged,a))})}createParticipant(t,i){var a;let o;return i?o=Cc.fromParticipantInfo(this.engine.client,i,{loggerContextCb:()=>this.logContext,loggerName:this.options.loggerName}):o=new Cc(this.engine.client,"",t,void 0,void 0,void 0,{loggerContextCb:()=>this.logContext,loggerName:this.options.loggerName}),this.options.webAudioMix&&o.setAudioContext(this.audioContext),!((a=this.options.audioOutput)===null||a===void 0)&&a.deviceId&&o.setAudioOutput(this.options.audioOutput).catch(l=>this.log.warn("Could not set audio output: ".concat(l.message),this.logContext)),o}getOrCreateParticipant(t,i){if(this.remoteParticipants.has(t)){const o=this.remoteParticipants.get(t);return i&&o.updateInfo(i)&&this.sidToIdentity.set(i.sid,i.identity),o}const a=this.createParticipant(t,i);return this.remoteParticipants.set(t,a),this.sidToIdentity.set(i.sid,i.identity),this.emitWhenConnected(J.ParticipantConnected,a),a.on(ee.TrackPublished,o=>{this.emitWhenConnected(J.TrackPublished,o,a)}).on(ee.TrackSubscribed,(o,l)=>{o.kind===G.Kind.Audio?(o.on(X.AudioPlaybackStarted,this.handleAudioPlaybackStarted),o.on(X.AudioPlaybackFailed,this.handleAudioPlaybackFailed)):o.kind===G.Kind.Video&&(o.on(X.VideoPlaybackFailed,this.handleVideoPlaybackFailed),o.on(X.VideoPlaybackStarted,this.handleVideoPlaybackStarted)),this.emit(J.TrackSubscribed,o,l,a)}).on(ee.TrackUnpublished,o=>{this.emit(J.TrackUnpublished,o,a)}).on(ee.TrackUnsubscribed,(o,l)=>{this.emit(J.TrackUnsubscribed,o,l,a)}).on(ee.TrackMuted,o=>{this.emitWhenConnected(J.TrackMuted,o,a)}).on(ee.TrackUnmuted,o=>{this.emitWhenConnected(J.TrackUnmuted,o,a)}).on(ee.ParticipantMetadataChanged,o=>{this.emitWhenConnected(J.ParticipantMetadataChanged,o,a)}).on(ee.ParticipantNameChanged,o=>{this.emitWhenConnected(J.ParticipantNameChanged,o,a)}).on(ee.AttributesChanged,o=>{this.emitWhenConnected(J.ParticipantAttributesChanged,o,a)}).on(ee.ConnectionQualityChanged,o=>{this.emitWhenConnected(J.ConnectionQualityChanged,o,a)}).on(ee.ParticipantPermissionsChanged,o=>{this.emitWhenConnected(J.ParticipantPermissionsChanged,o,a)}).on(ee.TrackSubscriptionStatusChanged,(o,l)=>{this.emitWhenConnected(J.TrackSubscriptionStatusChanged,o,l,a)}).on(ee.TrackSubscriptionFailed,(o,l)=>{this.emit(J.TrackSubscriptionFailed,o,a,l)}).on(ee.TrackSubscriptionPermissionChanged,(o,l)=>{this.emitWhenConnected(J.TrackSubscriptionPermissionChanged,o,l,a)}).on(ee.Active,()=>{this.emitWhenConnected(J.ParticipantActive,a),a.kind===_r.AGENT&&this.localParticipant.setActiveAgent(a)}),i&&a.updateInfo(i),a}sendSyncState(){const t=Array.from(this.remoteParticipants.values()).reduce((a,o)=>(a.push(...o.getTrackPublications()),a),[]),i=this.localParticipant.getTrackPublications();this.engine.sendSyncState(t,i)}updateSubscriptions(){for(const t of this.remoteParticipants.values())for(const i of t.videoTrackPublications.values())i.isSubscribed&&nE(i)&&i.emitTrackUpdate()}getRemoteParticipantBySid(t){const i=this.sidToIdentity.get(t);if(i)return this.remoteParticipants.get(i)}registerConnectionReconcile(){this.clearConnectionReconcile();let t=0;this.connectionReconcileInterval=_t.setInterval(()=>{!this.engine||this.engine.isClosed||!this.engine.verifyTransport()?(t++,this.log.warn("detected connection state mismatch",Object.assign(Object.assign({},this.logContext),{numFailures:t,engine:this.engine?{closed:this.engine.isClosed,transportsConnected:this.engine.verifyTransport()}:void 0})),t>=3&&(this.recreateEngine(),this.handleDisconnect(this.options.stopLocalTrackOnUnpublish,_n.STATE_MISMATCH))):t=0},k1)}clearConnectionReconcile(){this.connectionReconcileInterval&&_t.clearInterval(this.connectionReconcileInterval)}setAndEmitConnectionState(t){return t===this.state?!1:(this.state=t,this.emit(J.ConnectionStateChanged,this.state),!0)}emitBufferedEvents(){this.bufferedEvents.forEach(t=>{let[i,a]=t;this.emit(i,...a)}),this.bufferedEvents=[]}emitWhenConnected(t){for(var i=arguments.length,a=new Array(i>1?i-1:0),o=1;o<i;o++)a[o-1]=arguments[o];if(this.state===Le.Reconnecting||this.isResuming||!this.engine||this.engine.pendingReconnect)this.bufferedEvents.push([t,a]);else if(this.state===Le.Connected)return this.emit(t,...a);return!1}simulateParticipants(t){return T(this,void 0,void 0,function*(){var i,a,o,l;const f=Object.assign({audio:!0,video:!0,useRealTracks:!1},t.publish),u=Object.assign({count:9,audio:!1,video:!0,aspectRatios:[1.66,1.7,1.3]},t.participants);if(this.handleDisconnect(),this.roomInfo=new Ec({sid:"RM_SIMULATED",name:"simulated-room",emptyTimeout:0,maxParticipants:0,creationTime:Xe.parse(new Date().getTime()),metadata:"",numParticipants:1,numPublishers:1,turnPassword:"",enabledCodecs:[],activeRecording:!1}),this.localParticipant.updateInfo(new ha({identity:"simulated-local",name:"local-name"})),this.setupLocalParticipantEvents(),this.emit(J.SignalConnected),this.emit(J.Connected),this.setAndEmitConnectionState(Le.Connected),f.video){const m=new Gd(G.Kind.Video,new is({source:ft.CAMERA,sid:Math.floor(Math.random()*1e4).toString(),type:Cn.AUDIO,name:"video-dummy"}),new Tc(f.useRealTracks&&(!((i=window.navigator.mediaDevices)===null||i===void 0)&&i.getUserMedia)?(yield window.navigator.mediaDevices.getUserMedia({video:!0})).getVideoTracks()[0]:mv(160*((a=u.aspectRatios[0])!==null&&a!==void 0?a:1),160,!0,!0),void 0,!1,{loggerName:this.options.loggerName,loggerContextCb:()=>this.logContext}),{loggerName:this.options.loggerName,loggerContextCb:()=>this.logContext});this.localParticipant.addTrackPublication(m),this.localParticipant.emit(ee.LocalTrackPublished,m)}if(f.audio){const m=new Gd(G.Kind.Audio,new is({source:ft.MICROPHONE,sid:Math.floor(Math.random()*1e4).toString(),type:Cn.AUDIO}),new Sc(f.useRealTracks&&(!((o=navigator.mediaDevices)===null||o===void 0)&&o.getUserMedia)?(yield navigator.mediaDevices.getUserMedia({audio:!0})).getAudioTracks()[0]:dd(),void 0,!1,this.audioContext,{loggerName:this.options.loggerName,loggerContextCb:()=>this.logContext}),{loggerName:this.options.loggerName,loggerContextCb:()=>this.logContext});this.localParticipant.addTrackPublication(m),this.localParticipant.emit(ee.LocalTrackPublished,m)}for(let m=0;m<u.count-1;m+=1){let p=new ha({sid:Math.floor(Math.random()*1e4).toString(),identity:"simulated-".concat(m),state:rs.ACTIVE,tracks:[],joinedAt:Xe.parse(Date.now())});const g=this.getOrCreateParticipant(p.identity,p);if(u.video){const v=mv(160*((l=u.aspectRatios[m%u.aspectRatios.length])!==null&&l!==void 0?l:1),160,!1,!0),S=new is({source:ft.CAMERA,sid:Math.floor(Math.random()*1e4).toString(),type:Cn.AUDIO});g.addSubscribedMediaTrack(v,S.sid,new MediaStream([v]),new RTCRtpReceiver),p.tracks=[...p.tracks,S]}if(u.audio){const v=dd(),S=new is({source:ft.MICROPHONE,sid:Math.floor(Math.random()*1e4).toString(),type:Cn.AUDIO});g.addSubscribedMediaTrack(v,S.sid,new MediaStream([v]),new RTCRtpReceiver),p.tracks=[...p.tracks,S]}g.updateInfo(p)}})}emit(t){for(var i=arguments.length,a=new Array(i>1?i-1:0),o=1;o<i;o++)a[o-1]=arguments[o];if(t!==J.ActiveSpeakersChanged&&t!==J.TranscriptionReceived){const l=Ry(a).filter(f=>f!==void 0);(t===J.TrackSubscribed||t===J.TrackUnsubscribed)&&this.log.trace("subscribe trace: ".concat(t),Object.assign(Object.assign({},this.logContext),{event:t,args:l})),this.log.debug("room event ".concat(t),Object.assign(Object.assign({},this.logContext),{event:t,args:l}))}return super.emit(t,...a)}}gs.cleanupRegistry=typeof FinalizationRegistry<"u"&&new FinalizationRegistry(r=>{r()});function Ry(r){return r.map(t=>{if(t)return Array.isArray(t)?Ry(t):typeof t=="object"?"logContext"in t?t.logContext:void 0:t})}var Tn;(function(r){r[r.IDLE=0]="IDLE",r[r.RUNNING=1]="RUNNING",r[r.SKIPPED=2]="SKIPPED",r[r.SUCCESS=3]="SUCCESS",r[r.FAILED=4]="FAILED"})(Tn||(Tn={}));class Gi extends Ln.EventEmitter{constructor(t,i){let a=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};super(),this.status=Tn.IDLE,this.logs=[],this.options={},this.url=t,this.token=i,this.name=this.constructor.name,this.room=new gs(a.roomOptions),this.connectOptions=a.connectOptions,this.options=a}run(t){return T(this,void 0,void 0,function*(){if(this.status!==Tn.IDLE)throw Error("check is running already");this.setStatus(Tn.RUNNING);try{yield this.perform()}catch(i){i instanceof Error&&(this.options.errorsAsWarnings?this.appendWarning(i.message):this.appendError(i.message))}return yield this.disconnect(),yield new Promise(i=>setTimeout(i,500)),this.status!==Tn.SKIPPED&&this.setStatus(this.isSuccess()?Tn.SUCCESS:Tn.FAILED),t&&t(),this.getInfo()})}isSuccess(){return!this.logs.some(t=>t.level==="error")}connect(t){return T(this,void 0,void 0,function*(){return this.room.state===Le.Connected?this.room:(t||(t=this.url),yield this.room.connect(t,this.token,this.connectOptions),this.room)})}disconnect(){return T(this,void 0,void 0,function*(){this.room&&this.room.state!==Le.Disconnected&&(yield this.room.disconnect(),yield new Promise(t=>setTimeout(t,500)))})}skip(){this.setStatus(Tn.SKIPPED)}switchProtocol(t){return T(this,void 0,void 0,function*(){let i=!1,a=!1;if(this.room.on(J.Reconnecting,()=>{i=!0}),this.room.once(J.Reconnected,()=>{a=!0}),this.room.simulateScenario("force-".concat(t)),yield new Promise(l=>setTimeout(l,1e3)),!i)return;const o=Date.now()+1e4;for(;Date.now()<o;){if(a)return;yield Rt(100)}throw new Error("Could not reconnect using ".concat(t," protocol after 10 seconds"))})}appendMessage(t){this.logs.push({level:"info",message:t}),this.emit("update",this.getInfo())}appendWarning(t){this.logs.push({level:"warning",message:t}),this.emit("update",this.getInfo())}appendError(t){this.logs.push({level:"error",message:t}),this.emit("update",this.getInfo())}setStatus(t){this.status=t,this.emit("update",this.getInfo())}get engine(){var t;return(t=this.room)===null||t===void 0?void 0:t.engine}getInfo(){return{logs:this.logs,name:this.name,status:this.status,description:this.description}}}class E1 extends Gi{get description(){return"Cloud regions"}perform(){return T(this,void 0,void 0,function*(){const t=new De(this.url,this.token);if(!t.isCloud()){this.skip();return}const i=[],a=new Set;for(let l=0;l<3;l++){const f=yield t.getNextBestRegionUrl();if(!f)break;if(a.has(f))continue;a.add(f);const u=yield this.checkCloudRegion(f);this.appendMessage("".concat(u.region," RTT: ").concat(u.rtt,"ms, duration: ").concat(u.duration,"ms")),i.push(u)}i.sort((l,f)=>(l.duration-f.duration)*.5+(l.rtt-f.rtt)*.5);const o=i[0];this.bestStats=o,this.appendMessage("best Cloud region: ".concat(o.region))})}getInfo(){const t=super.getInfo();return t.data=this.bestStats,t}checkCloudRegion(t){return T(this,void 0,void 0,function*(){var i,a;yield this.connect(t),this.options.protocol==="tcp"&&(yield this.switchProtocol("tcp"));const o=(i=this.room.serverInfo)===null||i===void 0?void 0:i.region;if(!o)throw new Error("Region not found");const l=yield this.room.localParticipant.streamText({topic:"test"}),f=1e3,m=1e6/f,p="A".repeat(f),g=Date.now();for(let O=0;O<m;O++)yield l.write(p);yield l.close();const v=Date.now(),S=yield(a=this.room.engine.pcManager)===null||a===void 0?void 0:a.publisher.getStats(),k={region:o,rtt:1e4,duration:v-g};return S==null||S.forEach(O=>{O.type==="candidate-pair"&&O.nominated&&(k.rtt=O.currentRoundTripTime*1e3)}),yield this.disconnect(),k})}}const Sd=1e4;class _1 extends Gi{get description(){return"Connection via UDP vs TCP"}perform(){return T(this,void 0,void 0,function*(){const t=yield this.checkConnectionProtocol("udp"),i=yield this.checkConnectionProtocol("tcp");this.bestStats=t,t.qualityLimitationDurations.bandwidth-i.qualityLimitationDurations.bandwidth>.5||(t.packetsLost-i.packetsLost)/t.packetsSent>.01?(this.appendMessage("best connection quality via tcp"),this.bestStats=i):this.appendMessage("best connection quality via udp");const a=this.bestStats;this.appendMessage("upstream bitrate: ".concat((a.bitrateTotal/a.count/1e3/1e3).toFixed(2)," mbps")),this.appendMessage("RTT: ".concat((a.rttTotal/a.count*1e3).toFixed(2)," ms")),this.appendMessage("jitter: ".concat((a.jitterTotal/a.count*1e3).toFixed(2)," ms")),a.packetsLost>0&&this.appendWarning("packets lost: ".concat((a.packetsLost/a.packetsSent*100).toFixed(2),"%")),a.qualityLimitationDurations.bandwidth>1&&this.appendWarning("bandwidth limited ".concat((a.qualityLimitationDurations.bandwidth/(Sd/1e3)*100).toFixed(2),"%")),a.qualityLimitationDurations.cpu>0&&this.appendWarning("cpu limited ".concat((a.qualityLimitationDurations.cpu/(Sd/1e3)*100).toFixed(2),"%"))})}getInfo(){const t=super.getInfo();return t.data=this.bestStats,t}checkConnectionProtocol(t){return T(this,void 0,void 0,function*(){yield this.connect(),t==="tcp"?yield this.switchProtocol("tcp"):yield this.switchProtocol("udp");const i=document.createElement("canvas");i.width=1280,i.height=720;const a=i.getContext("2d");if(!a)throw new Error("Could not get canvas context");let o=0;const l=()=>{o=(o+1)%360,a.fillStyle="hsl(".concat(o,", 100%, 50%)"),a.fillRect(0,0,i.width,i.height),requestAnimationFrame(l)};l();const u=i.captureStream(30).getVideoTracks()[0],p=(yield this.room.localParticipant.publishTrack(u,{simulcast:!1,degradationPreference:"maintain-resolution",videoEncoding:{maxBitrate:2e6}})).track,g={protocol:t,packetsLost:0,packetsSent:0,qualityLimitationDurations:{},rttTotal:0,jitterTotal:0,bitrateTotal:0,count:0},v=setInterval(()=>T(this,void 0,void 0,function*(){const S=yield p.getRTCStatsReport();S==null||S.forEach(k=>{k.type==="outbound-rtp"?(g.packetsSent=k.packetsSent,g.qualityLimitationDurations=k.qualityLimitationDurations,g.bitrateTotal+=k.targetBitrate,g.count++):k.type==="remote-inbound-rtp"&&(g.packetsLost=k.packetsLost,g.rttTotal+=k.roundTripTime,g.jitterTotal+=k.jitter)})}),1e3);return yield new Promise(S=>setTimeout(S,Sd)),clearInterval(v),u.stop(),i.remove(),yield this.disconnect(),g})}}class R1 extends Gi{get description(){return"Can publish audio"}perform(){return T(this,void 0,void 0,function*(){var t;const i=yield this.connect(),a=yield y1();if(yield cy(a,1e3))throw new Error("unable to detect audio from microphone");this.appendMessage("detected audio from microphone"),i.localParticipant.publishTrack(a),yield new Promise(u=>setTimeout(u,3e3));const l=yield(t=a.sender)===null||t===void 0?void 0:t.getStats();if(!l)throw new Error("Could not get RTCStats");let f=0;if(l.forEach(u=>{u.type==="outbound-rtp"&&(u.kind==="audio"||!u.kind&&u.mediaType==="audio")&&(f=u.packetsSent)}),f===0)throw new Error("Could not determine packets are sent");this.appendMessage("published ".concat(f," audio packets"))})}}class O1 extends Gi{get description(){return"Can publish video"}perform(){return T(this,void 0,void 0,function*(){var t;const i=yield this.connect(),a=yield v1();yield this.checkForVideo(a.mediaStreamTrack),i.localParticipant.publishTrack(a),yield new Promise(f=>setTimeout(f,5e3));const o=yield(t=a.sender)===null||t===void 0?void 0:t.getStats();if(!o)throw new Error("Could not get RTCStats");let l=0;if(o.forEach(f=>{f.type==="outbound-rtp"&&(f.kind==="video"||!f.kind&&f.mediaType==="video")&&(l+=f.packetsSent)}),l===0)throw new Error("Could not determine packets are sent");this.appendMessage("published ".concat(l," video packets"))})}checkForVideo(t){return T(this,void 0,void 0,function*(){const i=new MediaStream;i.addTrack(t.clone());const a=document.createElement("video");a.srcObject=i,a.muted=!0,a.autoplay=!0,a.playsInline=!0,a.setAttribute("playsinline","true"),document.body.appendChild(a),yield new Promise(o=>{a.onplay=()=>{setTimeout(()=>{var l,f,u,m;const p=document.createElement("canvas"),g=t.getSettings(),v=(f=(l=g.width)!==null&&l!==void 0?l:a.videoWidth)!==null&&f!==void 0?f:1280,S=(m=(u=g.height)!==null&&u!==void 0?u:a.videoHeight)!==null&&m!==void 0?m:720;p.width=v,p.height=S;const k=p.getContext("2d");k.drawImage(a,0,0);const E=k.getImageData(0,0,p.width,p.height).data;let j=!0;for(let U=0;U<E.length;U+=4)if(E[U]!==0||E[U+1]!==0||E[U+2]!==0){j=!1;break}j?this.appendError("camera appears to be producing only black frames"):this.appendMessage("received video frames"),o()},1e3)},a.play()}),i.getTracks().forEach(o=>o.stop()),a.remove()})}}class A1 extends Gi{get description(){return"Resuming connection after interruption"}perform(){return T(this,void 0,void 0,function*(){var t;const i=yield this.connect();let a=!1,o=!1,l;const f=new Promise(p=>{setTimeout(p,5e3),l=p}),u=()=>{a=!0};i.on(J.SignalReconnecting,u).on(J.Reconnecting,u).on(J.Reconnected,()=>{o=!0,l(!0)}),(t=i.engine.client.ws)===null||t===void 0||t.close();const m=i.engine.client.onClose;if(m&&m(""),yield f,a){if(!o||i.state!==Le.Connected)throw this.appendWarning("reconnection is only possible in Redis-based configurations"),new Error("Not able to reconnect")}else throw new Error("Did not attempt to reconnect")})}}class D1 extends Gi{get description(){return"Can connect via TURN"}perform(){return T(this,void 0,void 0,function*(){var t,i,a;ps(new URL(this.url))&&(this.appendMessage("Using region specific url"),this.url=(t=yield new De(this.url,this.token).getNextBestRegionUrl())!==null&&t!==void 0?t:this.url);const o=new ff,l=yield o.join(this.url,this.token,{autoSubscribe:!0,maxRetries:0,e2eeEnabled:!1,websocketTimeout:15e3},void 0,!0);let f=!1,u=!1,m=!1;for(let p of l.iceServers)for(let g of p.urls)g.startsWith("turn:")?(u=!0,m=!0):g.startsWith("turns:")&&(u=!0,m=!0,f=!0),g.startsWith("stun:")&&(m=!0);m?u&&!f&&this.appendWarning("TURN is configured server side, but TURN/TLS is unavailable."):this.appendWarning("No STUN servers configured on server side."),yield o.close(),!((a=(i=this.connectOptions)===null||i===void 0?void 0:i.rtcConfig)===null||a===void 0)&&a.iceServers||u?yield this.room.connect(this.url,this.token,{rtcConfig:{iceTransportPolicy:"relay"}}):(this.appendWarning("No TURN servers configured."),this.skip(),yield new Promise(p=>setTimeout(p,0)))})}}class M1 extends Gi{get description(){return"Establishing WebRTC connection"}perform(){return T(this,void 0,void 0,function*(){let t=!1,i=!1;this.room.on(J.SignalConnected,()=>{var a;const o=this.room.engine.client.onTrickle;this.room.engine.client.onTrickle=(l,f)=>{if(l.candidate){const u=new RTCIceCandidate(l);let m="".concat(u.protocol," ").concat(u.address,":").concat(u.port," ").concat(u.type);u.address&&(w1(u.address)?m+=" (private)":u.protocol==="tcp"&&u.tcpType==="passive"?(t=!0,m+=" (passive)"):u.protocol==="udp"&&(i=!0)),this.appendMessage(m)}o&&o(l,f)},!((a=this.room.engine.pcManager)===null||a===void 0)&&a.subscriber&&(this.room.engine.pcManager.subscriber.onIceCandidateError=l=>{l instanceof RTCPeerConnectionIceErrorEvent&&this.appendWarning("error with ICE candidate: ".concat(l.errorCode," ").concat(l.errorText," ").concat(l.url))})});try{yield this.connect(),Se.info("now the room is connected")}catch(a){throw this.appendWarning("ports need to be open on firewall in order to connect."),a}t||this.appendWarning("Server is not configured for ICE/TCP"),i||this.appendWarning("No public IPv4 UDP candidates were found. Your server is likely not configured correctly")})}}function w1(r){const t=r.split(".");if(t.length===4){if(t[0]==="10")return!0;if(t[0]==="192"&&t[1]==="168")return!0;if(t[0]==="172"){const i=parseInt(t[1],10);if(i>=16&&i<=31)return!0}}return!1}class x1 extends Gi{get description(){return"Connecting to signal connection via WebSocket"}perform(){return T(this,void 0,void 0,function*(){var t,i,a;(this.url.startsWith("ws:")||this.url.startsWith("http:"))&&this.appendWarning("Server is insecure, clients may block connections to it");let o=new ff,l;try{l=yield o.join(this.url,this.token,{autoSubscribe:!0,maxRetries:0,e2eeEnabled:!1,websocketTimeout:15e3},void 0,!0)}catch(f){if(ps(new URL(this.url))){this.appendMessage("Initial connection failed with error ".concat(f.message,". Retrying with region fallback"));const m=yield new De(this.url,this.token).getNextBestRegionUrl();m&&(l=yield o.join(m,this.token,{autoSubscribe:!0,maxRetries:0,e2eeEnabled:!1,websocketTimeout:15e3},void 0,!0),this.appendMessage("Fallback to region worked. To avoid initial connections failing, ensure you're calling room.prepareConnection() ahead of time"))}}l?(this.appendMessage("Connected to server, version ".concat(l.serverVersion,".")),((t=l.serverInfo)===null||t===void 0?void 0:t.edition)===f0.Cloud&&(!((i=l.serverInfo)===null||i===void 0)&&i.region)&&this.appendMessage("LiveKit Cloud: ".concat((a=l.serverInfo)===null||a===void 0?void 0:a.region))):this.appendError("Websocket connection could not be established"),yield o.close()})}}class n_ extends Ln.EventEmitter{constructor(t,i){let a=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};super(),this.options={},this.checkResults=new Map,this.url=t,this.token=i,this.options=a}getNextCheckId(){const t=this.checkResults.size;return this.checkResults.set(t,{logs:[],status:Tn.IDLE,name:"",description:""}),t}updateCheck(t,i){this.checkResults.set(t,i),this.emit("checkUpdate",t,i)}isSuccess(){return Array.from(this.checkResults.values()).every(t=>t.status!==Tn.FAILED)}getResults(){return Array.from(this.checkResults.values())}createAndRunCheck(t){return T(this,void 0,void 0,function*(){const i=this.getNextCheckId(),a=new t(this.url,this.token,this.options),o=f=>{this.updateCheck(i,f)};a.on("update",o);const l=yield a.run();return a.off("update",o),l})}checkWebsocket(){return T(this,void 0,void 0,function*(){return this.createAndRunCheck(x1)})}checkWebRTC(){return T(this,void 0,void 0,function*(){return this.createAndRunCheck(M1)})}checkTURN(){return T(this,void 0,void 0,function*(){return this.createAndRunCheck(D1)})}checkReconnect(){return T(this,void 0,void 0,function*(){return this.createAndRunCheck(A1)})}checkPublishAudio(){return T(this,void 0,void 0,function*(){return this.createAndRunCheck(R1)})}checkPublishVideo(){return T(this,void 0,void 0,function*(){return this.createAndRunCheck(O1)})}checkConnectionProtocol(){return T(this,void 0,void 0,function*(){const t=yield this.createAndRunCheck(_1);if(t.data&&"protocol"in t.data){const i=t.data;this.options.protocol=i.protocol}return t})}checkCloudRegion(){return T(this,void 0,void 0,function*(){return this.createAndRunCheck(E1)})}}function _e(r,t,i){return(t=P1(t))in r?Object.defineProperty(r,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):r[t]=i,r}function N1(r,t){if(typeof r!="object"||!r)return r;var i=r[Symbol.toPrimitive];if(i!==void 0){var a=i.call(r,t);if(typeof a!="object")return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(r)}function P1(r){var t=N1(r,"string");return typeof t=="symbol"?t:t+""}new TextEncoder;new TextDecoder;class Pt extends Error{constructor(t,i){var a;super(t,i),_e(this,"code","ERR_JOSE_GENERIC"),this.name=this.constructor.name,(a=Error.captureStackTrace)===null||a===void 0||a.call(Error,this,this.constructor)}}_e(Pt,"code","ERR_JOSE_GENERIC");class U1 extends Pt{constructor(t,i){let a=arguments.length>2&&arguments[2]!==void 0?arguments[2]:"unspecified",o=arguments.length>3&&arguments[3]!==void 0?arguments[3]:"unspecified";super(t,{cause:{claim:a,reason:o,payload:i}}),_e(this,"code","ERR_JWT_CLAIM_VALIDATION_FAILED"),_e(this,"claim",void 0),_e(this,"reason",void 0),_e(this,"payload",void 0),this.claim=a,this.reason=o,this.payload=i}}_e(U1,"code","ERR_JWT_CLAIM_VALIDATION_FAILED");class L1 extends Pt{constructor(t,i){let a=arguments.length>2&&arguments[2]!==void 0?arguments[2]:"unspecified",o=arguments.length>3&&arguments[3]!==void 0?arguments[3]:"unspecified";super(t,{cause:{claim:a,reason:o,payload:i}}),_e(this,"code","ERR_JWT_EXPIRED"),_e(this,"claim",void 0),_e(this,"reason",void 0),_e(this,"payload",void 0),this.claim=a,this.reason=o,this.payload=i}}_e(L1,"code","ERR_JWT_EXPIRED");class I1 extends Pt{constructor(){super(...arguments),_e(this,"code","ERR_JOSE_ALG_NOT_ALLOWED")}}_e(I1,"code","ERR_JOSE_ALG_NOT_ALLOWED");class j1 extends Pt{constructor(){super(...arguments),_e(this,"code","ERR_JOSE_NOT_SUPPORTED")}}_e(j1,"code","ERR_JOSE_NOT_SUPPORTED");class B1 extends Pt{constructor(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"decryption operation failed",i=arguments.length>1?arguments[1]:void 0;super(t,i),_e(this,"code","ERR_JWE_DECRYPTION_FAILED")}}_e(B1,"code","ERR_JWE_DECRYPTION_FAILED");class z1 extends Pt{constructor(){super(...arguments),_e(this,"code","ERR_JWE_INVALID")}}_e(z1,"code","ERR_JWE_INVALID");class q1 extends Pt{constructor(){super(...arguments),_e(this,"code","ERR_JWS_INVALID")}}_e(q1,"code","ERR_JWS_INVALID");class V1 extends Pt{constructor(){super(...arguments),_e(this,"code","ERR_JWT_INVALID")}}_e(V1,"code","ERR_JWT_INVALID");class H1 extends Pt{constructor(){super(...arguments),_e(this,"code","ERR_JWK_INVALID")}}_e(H1,"code","ERR_JWK_INVALID");class F1 extends Pt{constructor(){super(...arguments),_e(this,"code","ERR_JWKS_INVALID")}}_e(F1,"code","ERR_JWKS_INVALID");class G1 extends Pt{constructor(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"no applicable key found in the JSON Web Key Set",i=arguments.length>1?arguments[1]:void 0;super(t,i),_e(this,"code","ERR_JWKS_NO_MATCHING_KEY")}}_e(G1,"code","ERR_JWKS_NO_MATCHING_KEY");class K1 extends Pt{constructor(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"multiple matching keys found in the JSON Web Key Set",i=arguments.length>1?arguments[1]:void 0;super(t,i),_e(this,Symbol.asyncIterator,void 0),_e(this,"code","ERR_JWKS_MULTIPLE_MATCHING_KEYS")}}_e(K1,"code","ERR_JWKS_MULTIPLE_MATCHING_KEYS");class Y1 extends Pt{constructor(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"request timed out",i=arguments.length>1?arguments[1]:void 0;super(t,i),_e(this,"code","ERR_JWKS_TIMEOUT")}}_e(Y1,"code","ERR_JWKS_TIMEOUT");class Q1 extends Pt{constructor(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"signature verification failed",i=arguments.length>1?arguments[1]:void 0;super(t,i),_e(this,"code","ERR_JWS_SIGNATURE_VERIFICATION_FAILED")}}_e(Q1,"code","ERR_JWS_SIGNATURE_VERIFICATION_FAILED");const J1="http://localhost:8080";function X1(r){const t=me.useRef(null),[i,a]=me.useState(!1),[o,l]=me.useState(!1),[f,u]=me.useState(!1),[m,p]=me.useState(null);me.useEffect(()=>()=>{t.current&&t.current.disconnect()},[]);const g=me.useCallback(async()=>{var k;if(((k=t.current)==null?void 0:k.state)==="connected"){console.log("Already connected to LiveKit");return}l(!0),p(null);try{const O=await fetch(`${J1}/livekit/token?room=${r}&participant=user-${Date.now()}`);if(!O.ok)throw new Error("Failed to get LiveKit token");const{token:E,url:j}=await O.json();if(!E||!j)throw new Error("Invalid token response");const U=new gs;t.current=U,U.on(J.TrackSubscribed,(Y,Z)=>{if(Y.kind===G.Kind.Audio){const M=Y.attach();M.id=`audio-${Z.trackSid}`,document.body.appendChild(M)}}),U.on(J.TrackUnsubscribed,Y=>{Y.detach().forEach(Z=>Z.remove())}),U.on(J.Disconnected,()=>{a(!1),console.log("Disconnected from LiveKit")}),await U.connect(j,E),console.log("Connected to LiveKit room:",r),await U.localParticipant.setMicrophoneEnabled(!0),a(!0)}catch(O){console.error("LiveKit connection error:",O),p(O instanceof Error?O.message:"Failed to connect to voice")}finally{l(!1)}},[r]),v=me.useCallback(()=>{t.current&&(t.current.disconnect(),t.current=null,a(!1))},[]),S=me.useCallback(()=>{var k;if((k=t.current)!=null&&k.localParticipant){const O=!f;t.current.localParticipant.setMicrophoneEnabled(!O),u(O)}},[f]);return{isConnected:i,isConnecting:o,isMuted:f,error:m,connect:g,disconnect:v,toggleMute:S}}const Z1="http://localhost:8080",W1=2e3;function $1(r,t){const[i,a]=me.useState(!1),[o,l]=me.useState(null),f=me.useRef(null),u=me.useRef(null),m=me.useRef(null),p=me.useRef(!1);me.useEffect(()=>(u.current=document.createElement("canvas"),()=>{u.current=null}),[]);const g=me.useCallback(()=>{const O=f.current,E=u.current;if(!O||!E||O.videoWidth===0)return null;const j=640,U=Math.min(j/O.videoWidth,j/O.videoHeight);E.width=O.videoWidth*U,E.height=O.videoHeight*U;const Y=E.getContext("2d");return Y?(Y.drawImage(O,0,0,E.width,E.height),E.toDataURL("image/jpeg",.7)):null},[]),v=me.useCallback(async()=>{if(p.current)return;const O=g();if(O){p.current=!0;try{console.log("%c[SCAN] Sending frame for analysis...","color: blue");const E=await fetch(`${Z1}/sessions/${r}/frame`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({frame:O})});if(!E.ok){console.error("[SCAN] Frame analysis failed:",E.status);return}const j=await E.json();console.log("%c[SCAN] Result:","color: purple",j),j.detection&&l(j.detection),j.status==="pickup_detected"&&(console.log("%c[SCAN] Product detected! Research starting...","color: green; font-weight: bold"),t())}catch(E){console.error("[SCAN] Error:",E)}finally{p.current=!1}}},[r,g,t]),S=me.useCallback(O=>{m.current||(f.current=O,a(!0),console.log("%c[SCAN] Starting product detection...","color: green; font-weight: bold"),m.current=window.setInterval(v,W1),setTimeout(v,500))},[v]),k=me.useCallback(()=>{m.current&&(clearInterval(m.current),m.current=null),f.current=null,a(!1),console.log("%c[SCAN] Stopped product detection","color: orange")},[]);return me.useEffect(()=>()=>{m.current&&clearInterval(m.current)},[]),{isScanning:i,lastDetection:o,startScanning:S,stopScanning:k}}const Zo=`session-${Date.now()}-${Math.random().toString(36).slice(2,9)}`;function e_(){const r=me.useRef(null),[t,i]=me.useState(!1),{isConnected:a,shoppingData:o,isLoading:l,error:f}=OT(Zo),{isConnected:u,isConnecting:m,isMuted:p,error:g,connect:v,disconnect:S,toggleMute:k}=X1(Zo),O=me.useCallback(()=>{console.log("%c[APP] Product pickup detected!","color: green; font-weight: bold; font-size: 16px")},[]),{isScanning:E,lastDetection:j,startScanning:U,stopScanning:Y}=$1(Zo,O);me.useEffect(()=>{if(t&&r.current){const N=r.current.getVideoElement();if(N){const q=setTimeout(()=>{U(N)},1e3);return()=>clearTimeout(q)}}else Y()},[t,U,Y]);const Z=me.useCallback(N=>{i(N)},[]),M=me.useMemo(()=>{if(!o)return null;const N=o.valueScore==="buy"?"buy":"wait";return{productName:o.productName,brand:o.brand,detectedPrice:o.detectedPrice,competitors:o.competitors,isCompatible:o.isCompatible,compatibilityNote:o.compatibilityNote,valueScore:N,aiInsight:o.aiInsight}},[o]);return F.jsxs("div",{className:"relative h-screen w-screen overflow-hidden bg-black",children:[F.jsx(rT,{ref:r,onCameraStateChange:Z}),F.jsx(_T,{data:M,isLoading:l}),F.jsx(RT,{isConnected:u,isConnecting:m,isMuted:p,onConnect:v,onDisconnect:S,onToggleMute:k,error:g}),F.jsxs("div",{className:"absolute bottom-6 right-6 z-20",children:[F.jsx("div",{className:`flex items-center gap-2 rounded-full px-4 py-2 text-sm font-medium backdrop-blur-lg border ${E?"bg-blue-500/20 border-blue-400/30 text-blue-400":"bg-white/10 border-white/20 text-white/60"}`,children:E?F.jsxs(F.Fragment,{children:[F.jsx(ST,{className:"h-4 w-4 animate-pulse"}),F.jsx("span",{children:"Scanning for products..."})]}):t?F.jsxs(F.Fragment,{children:[F.jsx(dT,{className:"h-4 w-4"}),F.jsx("span",{children:"Camera ready"})]}):F.jsxs(F.Fragment,{children:[F.jsx(uT,{className:"h-4 w-4"}),F.jsx("span",{children:"Camera off"})]})}),j&&j.pickup_detected&&F.jsxs("div",{className:"mt-2 rounded-lg bg-green-500/20 border border-green-400/30 px-3 py-2 text-xs text-green-400",children:["Detected: ",j.visual_description||j.brand_hint||"Product",F.jsx("br",{}),"Confidence: ",(j.confidence*100).toFixed(0),"%"]})]}),F.jsxs("div",{className:"absolute bottom-6 left-6 z-10 flex flex-col gap-2",children:[F.jsxs("div",{className:`flex items-center gap-2 rounded-full px-3 py-1.5 text-xs ${a?"bg-green-500/20 text-green-400":"bg-red-500/20 text-red-400"}`,children:[F.jsx("span",{className:`h-2 w-2 rounded-full ${a?"bg-green-400":"bg-red-400"}`}),a?"Backend Connected":"Backend Disconnected"]}),f&&F.jsx("div",{className:"rounded-full bg-red-500/20 px-3 py-1.5 text-xs text-red-400",children:f})]}),F.jsxs("div",{className:"absolute bottom-6 left-1/2 z-10 -translate-x-1/2 text-center",children:[F.jsx("p",{className:"text-sm font-medium text-white/80",children:"ShoppingLens"}),F.jsx("p",{className:"text-xs text-white/40 font-mono",children:Zo})]})]})}sT.createRoot(document.getElementById("root")).render(F.jsx(me.StrictMode,{children:F.jsx(e_,{})}));
