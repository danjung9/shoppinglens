{"version":3,"sources":["../../src/stream/stream_channel.ts"],"sourcesContent":["// SPDX-FileCopyrightText: 2025 LiveKit, Inc.\n//\n// SPDX-License-Identifier: Apache-2.0\nimport type { ReadableStream } from 'node:stream/web';\nimport { IdentityTransform } from './identity_transform.js';\n\nexport interface StreamChannel<T> {\n  write(chunk: T): Promise<void>;\n  close(): Promise<void>;\n  stream(): ReadableStream<T>;\n  readonly closed: boolean;\n}\n\nexport function createStreamChannel<T>(): StreamChannel<T> {\n  const transform = new IdentityTransform<T>();\n  const writer = transform.writable.getWriter();\n  let isClosed = false;\n\n  return {\n    write: (chunk: T) => writer.write(chunk),\n    stream: () => transform.readable,\n    close: async () => {\n      try {\n        const result = await writer.close();\n        isClosed = true;\n        return result;\n      } catch (e) {\n        if (e instanceof Error && e.name === 'TypeError') {\n          // Ignore error if the stream is already closed\n          isClosed = true;\n          return;\n        }\n        throw e;\n      }\n    },\n    get closed() {\n      return isClosed;\n    },\n  };\n}\n"],"mappings":"AAIA,SAAS,yBAAyB;AAS3B,SAAS,sBAA2C;AACzD,QAAM,YAAY,IAAI,kBAAqB;AAC3C,QAAM,SAAS,UAAU,SAAS,UAAU;AAC5C,MAAI,WAAW;AAEf,SAAO;AAAA,IACL,OAAO,CAAC,UAAa,OAAO,MAAM,KAAK;AAAA,IACvC,QAAQ,MAAM,UAAU;AAAA,IACxB,OAAO,YAAY;AACjB,UAAI;AACF,cAAM,SAAS,MAAM,OAAO,MAAM;AAClC,mBAAW;AACX,eAAO;AAAA,MACT,SAAS,GAAG;AACV,YAAI,aAAa,SAAS,EAAE,SAAS,aAAa;AAEhD,qBAAW;AACX;AAAA,QACF;AACA,cAAM;AAAA,MACR;AAAA,IACF;AAAA,IACA,IAAI,SAAS;AACX,aAAO;AAAA,IACT;AAAA,EACF;AACF;","names":[]}